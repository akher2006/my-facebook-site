;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="6aefe581-8dbe-ae7d-0868-33b08b500b41")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,876450,e=>{"use strict";var i=e.i(439725),r=e.i(394212),n=e.i(297083),s=e.i(399119),o=e.i(904851),a=e.i(557964),l=e.i(90659),c=e.i(721281),h=e.i(663355),u=e.i(862470),f=e.i(445789),d=e.i(167626),_=e.i(878420),v=e.i(530658),g=e.i(346715),p=e.i(119468),y=e.i(463348),m=e.i(817556),S=e.i(903673),k=Object.defineProperty,b=Object.getOwnPropertyDescriptor,w=function(e,i,r,n){for(var s,o=n>1?void 0:n?b(i,r):i,a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n?s(i,r,o):s(o))||o);return n&&o&&k(i,r,o),o},C=function(e,i){return function(r,n){return i(r,n,e)}},x="Terminal input",E=function(){return x},D="Too much output to announce, navigate to rows manually to read",B=function(){return D};function R(e,i,r,n){var s;s=e=e.replace(/\r?\n/g,"\r"),e=r.decPrivateModes.bracketedPasteMode&&!0!==n.rawOptions.ignoreBracketedPasteMode?"\x1b[200~"+s+"\x1b[201~":s,r.triggerDataEvent(e,!0),i.value=""}function M(e,i,r){var n=r.getBoundingClientRect(),s=e.clientX-n.left-10,o=e.clientY-n.top-10;i.style.width="20px",i.style.height="20px",i.style.left="".concat(s,"px"),i.style.top="".concat(o,"px"),i.style.zIndex="1000",i.focus()}function L(e,i,r,n,s){M(e,i,r),s&&n.rightClickSelect(e),i.value=n.selectionText,i.select()}function P(e){return e>65535?String.fromCharCode(((e-=65536)>>10)+55296)+String.fromCharCode(e%1024+56320):String.fromCharCode(e)}function T(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,n="",s=i;s<r;++s){var o=e[s];o>65535?(o-=65536,n+=String.fromCharCode((o>>10)+55296)+String.fromCharCode(o%1024+56320)):n+=String.fromCharCode(o)}return n}var A=function(){function e(){(0,o._)(this,e),this._interim=0}return(0,l._)(e,[{key:"clear",value:function(){this._interim=0}},{key:"decode",value:function(e,i){var r=e.length;if(!r)return 0;var n=0,s=0;if(this._interim){var o=e.charCodeAt(s++);56320<=o&&o<=57343?i[n++]=(this._interim-55296)*1024+o-56320+65536:(i[n++]=this._interim,i[n++]=o),this._interim=0}for(var a=s;a<r;++a){var l=e.charCodeAt(a);if(55296<=l&&l<=56319){if(++a>=r)return this._interim=l,n;var c=e.charCodeAt(a);56320<=c&&c<=57343?i[n++]=(l-55296)*1024+c-56320+65536:(i[n++]=l,i[n++]=c);continue}65279!==l&&(i[n++]=l)}return n}}]),e}(),O=function(){function e(){(0,o._)(this,e),this.interim=new Uint8Array(3)}return(0,l._)(e,[{key:"clear",value:function(){this.interim.fill(0)}},{key:"decode",value:function(e,i){var r=e.length;if(!r)return 0;var n,s,o,a,l=0,c=0,h=0;if(this.interim[0]){var u=!1,f=this.interim[0];f&=(224&f)==192?31:(240&f)==224?15:7;for(var d,_=0;(d=63&this.interim[++_])&&_<4;)f<<=6,f|=d;for(var v=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,g=v-_;h<g;){if(h>=r)return 0;if((192&(d=e[h++]))!=128){h--,u=!0;break}this.interim[_++]=d,f<<=6,f|=63&d}u||(2===v?f<128?h--:i[l++]=f:3===v?f<2048||f>=55296&&f<=57343||65279===f||(i[l++]=f):f<65536||f>1114111||(i[l++]=f)),this.interim.fill(0)}for(var p=r-4,y=h;y<r;){for(;y<p&&!(128&(n=e[y]))&&!(128&(s=e[y+1]))&&!(128&(o=e[y+2]))&&!(128&(a=e[y+3]));)i[l++]=n,i[l++]=s,i[l++]=o,i[l++]=a,y+=4;if((n=e[y++])<128)i[l++]=n;else if((224&n)==192){if(y>=r)return this.interim[0]=n,l;if((192&(s=e[y++]))!=128||(c=(31&n)<<6|63&s)<128){y--;continue}i[l++]=c}else if((240&n)==224){if(y>=r)return this.interim[0]=n,l;if((192&(s=e[y++]))!=128){y--;continue}if(y>=r)return this.interim[0]=n,this.interim[1]=s,l;if((192&(o=e[y++]))!=128){y--;continue}if((c=(15&n)<<12|(63&s)<<6|63&o)<2048||c>=55296&&c<=57343||65279===c)continue;i[l++]=c}else if((248&n)==240){if(y>=r)return this.interim[0]=n,l;if((192&(s=e[y++]))!=128){y--;continue}if(y>=r)return this.interim[0]=n,this.interim[1]=s,l;if((192&(o=e[y++]))!=128){y--;continue}if(y>=r)return this.interim[0]=n,this.interim[1]=s,this.interim[2]=o,l;if((192&(a=e[y++]))!=128){y--;continue}if((c=(7&n)<<18|(63&s)<<12|(63&o)<<6|63&a)<65536||c>1114111)continue;i[l++]=c}}return l}}]),e}(),I=function(){function e(){(0,o._)(this,e),this.fg=0,this.bg=0,this.extended=new N}return(0,l._)(e,[{key:"clone",value:function(){var i=new e;return i.fg=this.fg,i.bg=this.bg,i.extended=this.extended.clone(),i}},{key:"isInverse",value:function(){return 0x4000000&this.fg}},{key:"isBold",value:function(){return 0x8000000&this.fg}},{key:"isUnderline",value:function(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:0x10000000&this.fg}},{key:"isBlink",value:function(){return 0x20000000&this.fg}},{key:"isInvisible",value:function(){return 0x40000000&this.fg}},{key:"isItalic",value:function(){return 0x4000000&this.bg}},{key:"isDim",value:function(){return 0x8000000&this.bg}},{key:"isStrikethrough",value:function(){return 0x80000000&this.fg}},{key:"isProtected",value:function(){return 0x20000000&this.bg}},{key:"isOverline",value:function(){return 0x40000000&this.bg}},{key:"getFgColorMode",value:function(){return 0x3000000&this.fg}},{key:"getBgColorMode",value:function(){return 0x3000000&this.bg}},{key:"isFgRGB",value:function(){return(0x3000000&this.fg)==0x3000000}},{key:"isBgRGB",value:function(){return(0x3000000&this.bg)==0x3000000}},{key:"isFgPalette",value:function(){return(0x3000000&this.fg)==0x1000000||(0x3000000&this.fg)==0x2000000}},{key:"isBgPalette",value:function(){return(0x3000000&this.bg)==0x1000000||(0x3000000&this.bg)==0x2000000}},{key:"isFgDefault",value:function(){return(0x3000000&this.fg)==0}},{key:"isBgDefault",value:function(){return(0x3000000&this.bg)==0}},{key:"isAttributeDefault",value:function(){return 0===this.fg&&0===this.bg}},{key:"getFgColor",value:function(){switch(0x3000000&this.fg){case 0x1000000:case 0x2000000:return 255&this.fg;case 0x3000000:return 0xffffff&this.fg;default:return -1}}},{key:"getBgColor",value:function(){switch(0x3000000&this.bg){case 0x1000000:case 0x2000000:return 255&this.bg;case 0x3000000:return 0xffffff&this.bg;default:return -1}}},{key:"hasExtendedAttrs",value:function(){return 0x10000000&this.bg}},{key:"updateExtended",value:function(){this.extended.isEmpty()?this.bg&=-0x10000001:this.bg|=0x10000000}},{key:"getUnderlineColor",value:function(){if(0x10000000&this.bg&&~this.extended.underlineColor)switch(0x3000000&this.extended.underlineColor){case 0x1000000:case 0x2000000:return 255&this.extended.underlineColor;case 0x3000000:return 0xffffff&this.extended.underlineColor}return this.getFgColor()}},{key:"getUnderlineColorMode",value:function(){return 0x10000000&this.bg&&~this.extended.underlineColor?0x3000000&this.extended.underlineColor:this.getFgColorMode()}},{key:"isUnderlineColorRGB",value:function(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0x3000000:this.isFgRGB()}},{key:"isUnderlineColorPalette",value:function(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0x1000000||(0x3000000&this.extended.underlineColor)==0x2000000:this.isFgPalette()}},{key:"isUnderlineColorDefault",value:function(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0:this.isFgDefault()}},{key:"getUnderlineStyle",value:function(){return 0x10000000&this.fg?0x10000000&this.bg?this.extended.underlineStyle:1:0}},{key:"getUnderlineVariantOffset",value:function(){return this.extended.underlineVariantOffset}}],[{key:"toColorRGB",value:function(e){return[e>>>16&255,e>>>8&255,255&e]}},{key:"fromColorRGB",value:function(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}}]),e}(),N=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o._)(this,e),this._ext=0,this._urlId=0,this._ext=i,this._urlId=r}return(0,l._)(e,[{key:"ext",get:function(){return this._urlId?-0x1c000001&this._ext|this.underlineStyle<<26:this._ext},set:function(e){this._ext=e}},{key:"underlineStyle",get:function(){return this._urlId?5:(0x1c000000&this._ext)>>26},set:function(e){this._ext&=-0x1c000001,this._ext|=e<<26&0x1c000000}},{key:"underlineColor",get:function(){return 0x3ffffff&this._ext},set:function(e){this._ext&=-0x4000000,this._ext|=0x3ffffff&e}},{key:"urlId",get:function(){return this._urlId},set:function(e){this._urlId=e}},{key:"underlineVariantOffset",get:function(){var e=(0xe0000000&this._ext)>>29;return e<0?0xfffffff8^e:e},set:function(e){this._ext&=0x1fffffff,this._ext|=e<<29&0xe0000000}},{key:"clone",value:function(){return new e(this._ext,this._urlId)}},{key:"isEmpty",value:function(){return 0===this.underlineStyle&&0===this._urlId}}]),e}(),H=function(e){function i(){var e;return(0,o._)(this,i),e=(0,s._)(this,i,arguments),e.content=0,e.fg=0,e.bg=0,e.extended=new N,e.combinedData="",e}return(0,f._)(i,e),(0,l._)(i,[{key:"isCombined",value:function(){return 2097152&this.content}},{key:"getWidth",value:function(){return this.content>>22}},{key:"getChars",value:function(){return 2097152&this.content?this.combinedData:2097151&this.content?P(2097151&this.content):""}},{key:"getCode",value:function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}},{key:"setFromCharData",value:function(e){this.fg=e[0],this.bg=0;var i=!1;if(e[1].length>2)i=!0;else if(2===e[1].length){var r=e[1].charCodeAt(0);if(55296<=r&&r<=56319){var n=e[1].charCodeAt(1);56320<=n&&n<=57343?this.content=(r-55296)*1024+n-56320+65536|e[2]<<22:i=!0}else i=!0}else this.content=e[1].charCodeAt(0)|e[2]<<22;i&&(this.combinedData=e[1],this.content=2097152|e[2]<<22)}},{key:"getAsCharData",value:function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}],[{key:"fromCharData",value:function(e){var r=new i;return r.setFromCharData(e),r}}]),i}(I),W="di$target",z="di$dependencies",F=new Map;function K(e){if(F.has(e))return F.get(e);var i=function(e,r,n){var s,o,a;if(3!=arguments.length)throw Error("@IServiceName-decorator can only be used to decorate a parameter");s=i,o=e,a=n,o[W]===o?o[z].push({id:s,index:a}):(o[z]=[{id:s,index:a}],o[W]=o)};return i._id=e,F.set(e,i),i}var U=K("BufferService"),q=K("CoreMouseService"),V=K("CoreService"),Y=K("CharsetService"),X=K("InstantiationService"),j=K("LogService"),G=K("OptionsService"),J=K("OscLinkService"),Z=K("UnicodeService"),$=K("DecorationService"),Q=function(){function e(i,r,n){(0,o._)(this,e),this._bufferService=i,this._optionsService=r,this._oscLinkService=n}return(0,l._)(e,[{key:"provideLinks",value:function(e,i){var r,n=this._bufferService.buffer.lines.get(e-1);if(!n)return void i(void 0);for(var s=[],o=this._optionsService.rawOptions.linkHandler,a=new H,l=n.getTrimmedLength(),c=-1,h=-1,u=!1,f=0;f<l;f++)r=this,function(i){if(!(-1===h&&!n.hasContent(i))){if(n.loadCell(i,a),a.hasExtendedAttrs()&&a.extended.urlId)if(-1===h)return h=i,c=a.extended.urlId;else u=a.extended.urlId!==c;else -1!==h&&(u=!0);if(u||-1!==h&&i===l-1){var f,d=null==(f=r._oscLinkService.getLinkData(c))?void 0:f.uri;if(d){var _={start:{x:h+1,y:e},end:{x:i+ +(!u&&i===l-1),y:e}},v=!1;if(!(null==o?void 0:o.allowNonHttpProtocols))try{var g=new URL(d);["http:","https:"].includes(g.protocol)||(v=!0)}catch(e){v=!0}v||s.push({text:d,range:_,activate:function(e,i){return o?o.activate(e,i,_):function(e,i){if(confirm("Do you want to navigate to ".concat(i,"?\n\nWARNING: This link could potentially be dangerous"))){var r=window.open();if(r){try{r.opener=null}catch(e){}r.location.href=i}else console.warn("Opening link blocked as opener could not be cleared")}}(0,i)},hover:function(e,i){var r;return null==o||null==(r=o.hover)?void 0:r.call(o,e,i,_)},leave:function(e,i){var r;return null==o||null==(r=o.leave)?void 0:r.call(o,e,i,_)}})}u=!1,a.hasExtendedAttrs()&&a.extended.urlId?(h=i,c=a.extended.urlId):(h=-1,c=-1)}}}(f);i(s)}}]),e}();Q=w([C(0,U),C(1,G),C(2,J)],Q);var ee=K("CharSizeService"),et=K("CoreBrowserService"),ei=K("MouseService"),er=K("RenderService"),en=K("SelectionService"),es=K("CharacterJoinerService"),eo=K("ThemeService"),ea=K("LinkProviderService"),el=new(function(){function e(){(0,o._)(this,e),this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(function(){throw e.stack?ef.isErrorNoTelemetry(e)?new ef(e.message+"\n\n"+e.stack):Error(e.message+"\n\n"+e.stack):e},0)}}return(0,l._)(e,[{key:"addListener",value:function(e){var i=this;return this.listeners.push(e),function(){i._removeListener(e)}}},{key:"emit",value:function(e){this.listeners.forEach(function(i){i(e)})}},{key:"_removeListener",value:function(e){this.listeners.splice(this.listeners.indexOf(e),1)}},{key:"setUnexpectedErrorHandler",value:function(e){this.unexpectedErrorHandler=e}},{key:"getUnexpectedErrorHandler",value:function(){return this.unexpectedErrorHandler}},{key:"onUnexpectedError",value:function(e){this.unexpectedErrorHandler(e),this.emit(e)}},{key:"onUnexpectedExternalError",value:function(e){this.unexpectedErrorHandler(e)}}]),e}());function ec(e){var i;i=e,(0,d._)(i,eu)||(0,d._)(i,Error)&&i.name===eh&&i.message===eh||el.onUnexpectedError(e)}var eh="Canceled",eu=function(e){function i(){var e;return(0,o._)(this,i),(e=(0,s._)(this,i,[eh])).name=e.message,e}return(0,f._)(i,e),i}((0,y._)(Error)),ef=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i,[e])).name="CodeExpectedError",r}return(0,f._)(i,e),(0,l._)(i,null,[{key:"fromError",value:function(e){if((0,d._)(e,i))return e;var r=new i;return r.message=e.message,r.stack=e.stack,r}},{key:"isErrorNoTelemetry",value:function(e){return"CodeExpectedError"===e.name}}]),i}((0,y._)(Error)),ed=function(e){function i(e){var r;return(0,o._)(this,i),Object.setPrototypeOf(r=(0,s._)(this,i,[e||"An unexpected bug occurred."]),i.prototype),r}return(0,f._)(i,e),i}((0,y._)(Error));function e_(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[e.length-(1+i)]}(function(){function e(i){(0,o._)(this,e),this._array=i,this._findLastMonotonousLastIdx=0}return(0,l._)(e,[{key:"findLastMonotonous",value:function(i){if(e.assertInvariants){if(this._prevFindLastPredicate){var r=!0,n=!1,s=void 0;try{for(var o,a=this._array[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=o.value;if(this._prevFindLastPredicate(l)&&!i(l))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}}this._prevFindLastPredicate=i}var c=function(e,i){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,s=r,o=n;s<o;){var a=Math.floor((s+o)/2);i(e[a])?s=a+1:o=a}return s-1}(this._array,i,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=c+1,-1===c?void 0:this._array[c]}}]),e})().assertInvariants=!1,(eT=eN||(eN={})).isLessThan=function(e){return e<0},eT.isLessThanOrEqual=function(e){return e<=0},eT.isGreaterThan=function(e){return e>0},eT.isNeitherLessOrGreaterThan=function(e){return 0===e},eT.greaterThan=1,eT.lessThan=-1,eT.neitherLessOrGreaterThan=0;var ev=function(e,i){return e-i},eg=function(){function e(i){(0,o._)(this,e),this.iterate=i}return(0,l._)(e,[{key:"forEach",value:function(e){this.iterate(function(i){return e(i),!0})}},{key:"toArray",value:function(){var e=[];return this.iterate(function(i){return e.push(i),!0}),e}},{key:"filter",value:function(i){var r=this;return new e(function(e){return r.iterate(function(r){return!i(r)||e(r)})})}},{key:"map",value:function(i){var r=this;return new e(function(e){return r.iterate(function(r){return e(i(r))})})}},{key:"some",value:function(e){var i=!1;return this.iterate(function(r){return!(i=e(r))}),i}},{key:"findFirst",value:function(e){var i;return this.iterate(function(r){return!e(r)||(i=r,!1)}),i}},{key:"findLast",value:function(e){var i;return this.iterate(function(r){return e(r)&&(i=r),!0}),i}},{key:"findLastMaxBy",value:function(e){var i,r=!0;return this.iterate(function(n){return(r||eN.isGreaterThan(e(n,i)))&&(r=!1,i=n),!0}),i}}]),e}();eg.empty=new eg(function(e){});var ep=function(){function e(){(0,o._)(this,e),this.map=new Map}return(0,l._)(e,[{key:"add",value:function(e,i){var r=this.map.get(e);r||(r=new Set,this.map.set(e,r)),r.add(i)}},{key:"delete",value:function(e,i){var r=this.map.get(e);r&&(r.delete(i),0===r.size&&this.map.delete(e))}},{key:"forEach",value:function(e,i){var r=this.map.get(e);r&&r.forEach(i)}},{key:"get",value:function(e){return this.map.get(e)||new Set}}]),e}();function ey(e){}function em(e,i){}function eS(e){if(eK.is(e)){var i=[],r=!0,n=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=o.value;if(l)try{l.dispose()}catch(e){i.push(e)}}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}if(1===i.length)throw i[0];if(i.length>1)throw AggregateError(i,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}if(e)return e.dispose(),e}function ek(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var n=eb(function(){return eS(i)});return n}function eb(e){var i={dispose:function(e,i){var r,n=this,s=!1;return function(){if(s)return r;if(s=!0,i)try{r=e.apply(n,arguments)}finally{i()}else r=e.apply(n,arguments);return r}}(function(){ey(i),e()})};return i}eH=eK||(eK={}),eW=function(e){return e&&(void 0===e?"undefined":(0,p._)(e))=="object"&&"function"==typeof e[Symbol.iterator]},ez=function(e){return(0,m._)(this,function(i){switch(i.label){case 0:return[4,e];case 1:return i.sent(),[2]}})},eH.is=eW,eF=Object.freeze([]),eH.empty=function(){return eF},eH.single=ez,eH.wrap=function(e){return eW(e)?e:ez(e)},eH.from=function(e){return e||eF},eH.reverse=function(e){var i;return(0,m._)(this,function(r){switch(r.label){case 0:i=e.length-1,r.label=1;case 1:if(!(i>=0))return[3,4];return[4,e[i]];case 2:r.sent(),r.label=3;case 3:return i--,[3,1];case 4:return[2]}})},eH.isEmpty=function(e){return!e||!0===e[Symbol.iterator]().next().done},eH.first=function(e){return e[Symbol.iterator]().next().value},eH.some=function(e,i){var r=0,n=!0,s=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var c=a.value;if(i(c,r++))return!0}}catch(e){s=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(s)throw o}}return!1},eH.find=function(e,i){var r=!0,n=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=o.value;if(i(l))return l}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}},eH.filter=function(e,i){var r,n,s,o,a,l,c;return(0,m._)(this,function(h){switch(h.label){case 0:r=!0,n=!1,s=void 0,h.label=1;case 1:h.trys.push([1,7,8,9]),o=e[Symbol.iterator](),h.label=2;case 2:if(r=(a=o.next()).done)return[3,6];if(!i(l=a.value))return[3,4];return[4,l];case 3:h.sent(),h.label=4;case 4:h.label=5;case 5:return r=!0,[3,2];case 6:return[3,9];case 7:return c=h.sent(),n=!0,s=c,[3,9];case 8:try{r||null==o.return||o.return()}finally{if(n)throw s}return[7];case 9:return[2]}})},eH.map=function(e,i){var r,n,s,o,a,l,c;return(0,m._)(this,function(h){switch(h.label){case 0:r=0,n=!0,s=!1,o=void 0,h.label=1;case 1:h.trys.push([1,6,7,8]),a=e[Symbol.iterator](),h.label=2;case 2:if(n=(l=a.next()).done)return[3,5];return[4,i(l.value,r++)];case 3:h.sent(),h.label=4;case 4:return n=!0,[3,2];case 5:return[3,8];case 6:return c=h.sent(),s=!0,o=c,[3,8];case 7:try{n||null==a.return||a.return()}finally{if(s)throw o}return[7];case 8:return[2]}})},eH.flatMap=function(e,i){var r,n,s,o,a,l,c,h;return(0,m._)(this,function(u){switch(u.label){case 0:r=0,n=!0,s=!1,o=void 0,u.label=1;case 1:u.trys.push([1,6,7,8]),a=e[Symbol.iterator](),u.label=2;case 2:if(n=(l=a.next()).done)return[3,5];return c=l.value,[5,(0,S._)(i(c,r++))];case 3:u.sent(),u.label=4;case 4:return n=!0,[3,2];case 5:return[3,8];case 6:return h=u.sent(),s=!0,o=h,[3,8];case 7:try{n||null==a.return||a.return()}finally{if(s)throw o}return[7];case 8:return[2]}})},eH.concat=function(){var e,i,r,n,s,o,a,l,c,h,u=arguments;return(0,m._)(this,function(f){switch(f.label){case 0:for(i=Array(e=u.length),r=0;r<e;r++)i[r]=u[r];n=!0,s=!1,o=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),a=i[Symbol.iterator](),f.label=2;case 2:if(n=(l=a.next()).done)return[3,5];return c=l.value,[5,(0,S._)(c)];case 3:f.sent(),f.label=4;case 4:return n=!0,[3,2];case 5:return[3,8];case 6:return h=f.sent(),s=!0,o=h,[3,8];case 7:try{n||null==a.return||a.return()}finally{if(s)throw o}return[7];case 8:return[2]}})},eH.reduce=function(e,i,r){var n=r,s=!0,o=!1,a=void 0;try{for(var l,c=e[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;n=i(n,h)}}catch(e){o=!0,a=e}finally{try{s||null==c.return||c.return()}finally{if(o)throw a}}return n},eH.slice=function(e,i){var r,n=arguments;return(0,m._)(this,function(s){switch(s.label){case 0:r=n.length>2&&void 0!==n[2]?n[2]:e.length,i<0&&(i+=e.length),r<0?r+=e.length:r>e.length&&(r=e.length),s.label=1;case 1:if(!(i<r))return[3,4];return[4,e[i]];case 2:s.sent(),s.label=3;case 3:return i++,[3,1];case 4:return[2]}})},eH.consume=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=[];if(0===i)return[r,e];for(var n=e[Symbol.iterator](),s=0;s<i;s++){var o=n.next();if(o.done)return[r,eH.empty()];r.push(o.value)}return[r,(0,c._)({},Symbol.iterator,function(){return n})]},eH.asyncToArray=function(e){return(0,n._)(function(){var i,n,s,o,a,l,c,h;return(0,m._)(this,function(u){switch(u.label){case 0:i=[],n=!1,s=!1,u.label=1;case 1:u.trys.push([1,6,7,12]),a=(0,r._)(e),u.label=2;case 2:return[4,a.next()];case 3:if(!(n=!(l=u.sent()).done))return[3,5];c=l.value,i.push(c),u.label=4;case 4:return n=!1,[3,2];case 5:return[3,12];case 6:return h=u.sent(),s=!0,o=h,[3,12];case 7:if(u.trys.push([7,,10,11]),!(n&&null!=a.return))return[3,9];return[4,a.return()];case 8:u.sent(),u.label=9;case 9:return[3,11];case 10:if(s)throw o;return[7];case 11:return[7];case 12:return[2,Promise.resolve(i)]}})})()},function(){function e(){(0,o._)(this,e),this.livingDisposables=new Map}return(0,l._)(e,[{key:"getDisposableData",value:function(i){var r=this.livingDisposables.get(i);return r||(r={parent:null,source:null,isSingleton:!1,value:i,idx:e.idx++},this.livingDisposables.set(i,r)),r}},{key:"trackDisposable",value:function(e){var i=this.getDisposableData(e);i.source||(i.source=Error().stack)}},{key:"setParent",value:function(e,i){this.getDisposableData(e).parent=i}},{key:"markAsDisposed",value:function(e){this.livingDisposables.delete(e)}},{key:"markAsSingleton",value:function(e){this.getDisposableData(e).isSingleton=!0}},{key:"getRootParent",value:function(e,i){var r=i.get(e);if(r)return r;var n=e.parent?this.getRootParent(this.getDisposableData(e.parent),i):e;return i.set(e,n),n}},{key:"getTrackedDisposables",value:function(){var e=this,i=new Map;return(0,g._)(this.livingDisposables.entries()).filter(function(r){var n=(0,v._)(r,2)[1];return null!==n.source&&!e.getRootParent(n,i).isSingleton}).flatMap(function(e){return(0,v._)(e,1)[0]})}},{key:"computeLeakingDisposables",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1?arguments[1]:void 0;if(r)u=r;else{var n=new Map,s=(0,g._)(this.livingDisposables.values()).filter(function(i){return null!==i.source&&!e.getRootParent(i,n).isSingleton});if(0===s.length)return;var o=new Set(s.map(function(e){return e.value}));if(0===(u=s.filter(function(e){return!(e.parent&&o.has(e.parent))})).length)throw Error("There are cyclic diposable chains!")}if(u){var a=new ep,l=!0,c=!1,h=void 0;try{for(var u,f,d=u[Symbol.iterator]();!(l=(f=d.next()).done);l=!0)for(var _=f.value,p=P(_),y=0;y<=p.length;y++)a.add(p.slice(0,y).join("\n"),_)}catch(e){c=!0,h=e}finally{try{l||null==d.return||d.return()}finally{if(c)throw h}}u.sort((C=function(e){return e.idx},function(e,i){return ev(C(e),C(i))}));var m="",S=0,k=!0,b=!1,w=void 0;try{for(var C,x,E=u.slice(0,i)[Symbol.iterator]();!(k=(x=E.next()).done);k=!0){var D=function(e){var i=R[e];i="(shared with ".concat(a.get(R.slice(0,e+1).join("\n")).size,"/").concat(u.length," leaks) at ").concat(i);var r=a.get(R.slice(0,e).join("\n")),n=function(e,i){var r=Object.create(null),n=!0,s=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var c=a.value,h=i(c),u=r[h];u||(u=r[h]=[]),u.push(c)}}catch(e){s=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(s)throw o}}return r}((0,g._)(r).map(function(i){return P(i)[e]}),function(e){return e});delete n[R[e]];var s=!0,o=!1,l=void 0;try{for(var c,h=Object.entries(n)[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=(0,v._)(c.value,2),d=f[0],_=f[1];M.unshift("    - stacktraces of ".concat(_.length," other leaks continue with ").concat(d))}}catch(e){o=!0,l=e}finally{try{s||null==h.return||h.return()}finally{if(o)throw l}}M.unshift(i)},B=x.value;S++;for(var R=P(B),M=[],L=0;L<R.length;L++)D(L);m+="\n\n\n==================== Leaking disposable ".concat(S,"/").concat(u.length,": ").concat(B.value.constructor.name," ====================\n").concat(M.join("\n"),"\n============================================================\n\n")}}catch(e){b=!0,w=e}finally{try{k||null==E.return||E.return()}finally{if(b)throw w}}return u.length>i&&(m+="\n\n\n... and ".concat(u.length-i," more leaking disposables\n\n")),{leaks:u,details:m}}function P(e){var i=e.source.split("\n").map(function(e){return e.trim().replace("at ","")}).filter(function(e){return""!==e});return function(e,i){for(;e.length>0&&i.some(function(i){return"string"==typeof i?i===e[0]:e[0].match(i)});)e.shift()}(i,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),i.reverse()}}}]),e}().idx=0;var ew=function(){function e(){(0,o._)(this,e),this._toDispose=new Set,this._isDisposed=!1}return(0,l._)(e,[{key:"dispose",value:function(){this._isDisposed||(ey(this),this._isDisposed=!0,this.clear())}},{key:"isDisposed",get:function(){return this._isDisposed}},{key:"clear",value:function(){if(0!==this._toDispose.size)try{eS(this._toDispose)}finally{this._toDispose.clear()}}},{key:"add",value:function(i){if(!i)return i;if(i===this)throw Error("Cannot register a disposable on itself!");return em(i,this),this._isDisposed?e.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(i),i}},{key:"delete",value:function(e){if(e){if(e===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}},{key:"deleteAndLeak",value:function(e){e&&this._toDispose.has(e)&&(this._toDispose.delete(e),em(e,null))}}]),e}();ew.DISABLE_DISPOSED_WARNING=!1;var eC=function(){function e(){(0,o._)(this,e),this._store=new ew,em(this._store,this)}return(0,l._)(e,[{key:"dispose",value:function(){ey(this),this._store.dispose()}},{key:"_register",value:function(e){if(e===this)throw Error("Cannot register a disposable on itself!");return this._store.add(e)}}]),e}();eC.None=Object.freeze({dispose:function(){}});var ex=function(){function e(){(0,o._)(this,e),this._isDisposed=!1}return(0,l._)(e,[{key:"value",get:function(){return this._isDisposed?void 0:this._value},set:function(e){var i;this._isDisposed||e===this._value||(null==(i=this._value)||i.dispose(),e&&em(e,this),this._value=e)}},{key:"clear",value:function(){this.value=void 0}},{key:"dispose",value:function(){var e;this._isDisposed=!0,ey(this),null==(e=this._value)||e.dispose(),this._value=void 0}},{key:"clearAndLeak",value:function(){var e=this._value;return this._value=void 0,e&&em(e,null),e}}]),e}(),eE=("undefined"==typeof window?"undefined":(0,p._)(window))=="object"?window:globalThis,eD=function e(i){(0,o._)(this,e),this.element=i,this.next=e.Undefined,this.prev=e.Undefined};eD.Undefined=new eD(void 0);var eB=function(){function e(){(0,o._)(this,e),this._first=eD.Undefined,this._last=eD.Undefined,this._size=0}return(0,l._)(e,[{key:"size",get:function(){return this._size}},{key:"isEmpty",value:function(){return this._first===eD.Undefined}},{key:"clear",value:function(){for(var e=this._first;e!==eD.Undefined;){var i=e.next;e.prev=eD.Undefined,e.next=eD.Undefined,e=i}this._first=eD.Undefined,this._last=eD.Undefined,this._size=0}},{key:"unshift",value:function(e){return this._insert(e,!1)}},{key:"push",value:function(e){return this._insert(e,!0)}},{key:"_insert",value:function(e,i){var r=this,n=new eD(e);if(this._first===eD.Undefined)this._first=n,this._last=n;else if(i){var s=this._last;this._last=n,n.prev=s,s.next=n}else{var o=this._first;this._first=n,n.next=o,o.prev=n}this._size+=1;var a=!1;return function(){a||(a=!0,r._remove(n))}}},{key:"shift",value:function(){if(this._first!==eD.Undefined){var e=this._first.element;return this._remove(this._first),e}}},{key:"pop",value:function(){if(this._last!==eD.Undefined){var e=this._last.element;return this._remove(this._last),e}}},{key:"_remove",value:function(e){if(e.prev!==eD.Undefined&&e.next!==eD.Undefined){var i=e.prev;i.next=e.next,e.next.prev=i}else e.prev===eD.Undefined&&e.next===eD.Undefined?(this._first=eD.Undefined,this._last=eD.Undefined):e.next===eD.Undefined?(this._last=this._last.prev,this._last.next=eD.Undefined):e.prev===eD.Undefined&&(this._first=this._first.next,this._first.prev=eD.Undefined);this._size-=1}},{key:Symbol.iterator,value:function(){var e;return(0,m._)(this,function(i){switch(i.label){case 0:e=this._first,i.label=1;case 1:if(e===eD.Undefined)return[3,4];return[4,e.element];case 2:i.sent(),e=e.next,i.label=3;case 3:return[3,1];case 4:return[2]}})}}]),e}(),eR=globalThis.performance&&"function"==typeof globalThis.performance.now,eM=function(){function e(i){(0,o._)(this,e),this._now=eR&&!1===i?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}return(0,l._)(e,[{key:"stop",value:function(){this._stopTime=this._now()}},{key:"reset",value:function(){this._startTime=this._now(),this._stopTime=-1}},{key:"elapsed",value:function(){return -1!==this._stopTime?this._stopTime-this._startTime:this._now()-this._startTime}}],[{key:"create",value:function(i){return new e(i)}}]),e}();eq=eU||(eU={}),eV=function(e){},eY=function(e){return function(i){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,o=!1;return r=e(function(e){if(!o)return r?r.dispose():o=!0,i.call(n,e)},null,s),o&&r.dispose(),r}},eX=function(e,i,r){return eG(function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;return e(function(e){return r.call(n,i(e))},null,s)},r)},ej=function(e,i,r){return eG(function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;return e(function(e){return i(e)&&r.call(n,e)},null,s)},r)},eG=function(e,i){var r,n={onWillAddFirstListener:function(){r=e(s.fire,s)},onDidRemoveLastListener:function(){null==r||r.dispose()}};i||eV(n);var s=new e4(n);return null==i||i.add(s),s.event},eJ=function(e,i){var r,n,s,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,f=0,d={leakWarningThreshold:h,onWillAddFirstListener:function(){r=e(function(e){f++,n=i(n,e),l&&!s&&(_.fire(n),n=void 0),o=function(){var e=n;n=void 0,s=void 0,(!l||f>1)&&_.fire(e),f=0},"number"==typeof a?(clearTimeout(s),s=setTimeout(o,a)):void 0===s&&(s=0,queueMicrotask(o))})},onWillRemoveListener:function(){c&&f>0&&(null==o||o())},onDidRemoveLastListener:function(){o=void 0,r.dispose()}};u||eV(d);var _=new e4(d);return null==u||u.add(_),_.event},eq.None=function(){return eC.None},eq.defer=function(e,i){return eJ(e,function(){},0,void 0,!0,void 0,i)},eq.once=eY,eq.map=eX,eq.forEach=function(e,i,r){return eG(function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;return e(function(e){i(e),r.call(n,e)},null,s)},r)},eq.filter=ej,eq.signal=function(e){return e},eq.any=function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return function(e,i){return(0,d._)(i,Array)?i.push(e):i&&i.add(e),e}(ek.apply(void 0,(0,g._)(i.map(function(i){return i(function(i){return e.call(r,i)})}))),n)}},eq.reduce=function(e,i,r,n){var s=r;return eX(e,function(e){return s=i(s,e)},n)},eq.debounce=eJ,eq.accumulate=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;return eq.debounce(e,function(e,i){return e?(e.push(i),e):[i]},i,void 0,!0,void 0,r)},eq.latch=function(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,i){return e===i},n=arguments.length>2?arguments[2]:void 0,s=!0;return ej(e,function(e){var n=s||!r(e,i);return s=!1,i=e,n},n)},eq.split=function(e,i,r){return[eq.filter(e,i,r),eq.filter(e,function(e){return!i(e)},r)]},eq.buffer=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3?arguments[3]:void 0,s=r.slice(),o=e(function(e){s?s.push(e):l.fire(e)});n&&n.add(o);var a=function(){null==s||s.forEach(function(e){return l.fire(e)}),s=null},l=new e4({onWillAddFirstListener:function(){o||(o=e(function(e){return l.fire(e)}),n&&n.add(o))},onDidAddFirstListener:function(){s&&(i?setTimeout(a):a())},onDidRemoveLastListener:function(){o&&o.dispose(),o=null}});return n&&n.add(l),l.event},eq.chain=function(e,i){return function(r,n,s){var o=i(new e$);return e(function(e){var i=o.evaluate(e);i!==eZ&&r.call(n,i)},void 0,s)}},eZ=Symbol("HaltChainable"),e$=function(){function e(){(0,o._)(this,e),this.steps=[]}return(0,l._)(e,[{key:"map",value:function(e){return this.steps.push(e),this}},{key:"forEach",value:function(e){return this.steps.push(function(i){return e(i),i}),this}},{key:"filter",value:function(e){return this.steps.push(function(i){return e(i)?i:eZ}),this}},{key:"reduce",value:function(e,i){var r=i;return this.steps.push(function(i){return r=e(r,i)}),this}},{key:"latch",value:function(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,i){return e===i},r=!0;return this.steps.push(function(n){var s=r||!i(n,e);return r=!1,e=n,s?n:eZ}),this}},{key:"evaluate",value:function(e){var i=!0,r=!1,n=void 0;try{for(var s,o=this.steps[Symbol.iterator]();!(i=(s=o.next()).done)&&(e=(0,s.value)(e))!==eZ;i=!0);}catch(e){r=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw n}}return e}}]),e}(),eq.fromNodeEventEmitter=function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},n=function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return s.fire(r.apply(void 0,(0,g._)(i)))},s=new e4({onWillAddFirstListener:function(){return e.on(i,n)},onDidRemoveLastListener:function(){return e.removeListener(i,n)}});return s.event},eq.fromDOMEventEmitter=function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},n=function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return s.fire(r.apply(void 0,(0,g._)(i)))},s=new e4({onWillAddFirstListener:function(){return e.addEventListener(i,n)},onDidRemoveLastListener:function(){return e.removeEventListener(i,n)}});return s.event},eq.toPromise=function(e){return new Promise(function(i){return eY(e)(i)})},eq.fromPromise=function(e){var i=new e4;return e.then(function(e){i.fire(e)},function(){i.fire(void 0)}).finally(function(){i.dispose()}),i.event},eq.forward=function(e,i){return e(function(e){return i.fire(e)})},eq.runAndSubscribe=function(e,i,r){return i(r),e(function(e){return i(e)})},eQ=function(){function e(i,r){var n=this;(0,o._)(this,e),this._observable=i,this._counter=0,this._hasChanged=!1;var s={onWillAddFirstListener:function(){i.addObserver(n)},onDidRemoveLastListener:function(){i.removeObserver(n)}};r||eV(s),this.emitter=new e4(s),r&&r.add(this.emitter)}return(0,l._)(e,[{key:"beginUpdate",value:function(e){this._counter++}},{key:"handlePossibleChange",value:function(e){}},{key:"handleChange",value:function(e,i){this._hasChanged=!0}},{key:"endUpdate",value:function(e){this._counter--,0===this._counter&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}]),e}(),eq.fromObservable=function(e,i){return new eQ(e,i).emitter.event},eq.fromObservableLight=function(e){return function(i,r,n){var s=0,o=!1,a={beginUpdate:function(){s++},endUpdate:function(){0==--s&&(e.reportChanges(),o&&(o=!1,i.call(r)))},handlePossibleChange:function(){},handleChange:function(){o=!0}};e.addObserver(a),e.reportChanges();var l={dispose:function(){e.removeObserver(a)}};return(0,d._)(n,ew)?n.add(l):Array.isArray(n)&&n.push(l),l}};var eL=function(){function e(i){(0,o._)(this,e),this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name="".concat(i,"_").concat(e._idPool++),e.all.add(this)}return(0,l._)(e,[{key:"start",value:function(e){this._stopWatch=new eM,this.listenerCount=e}},{key:"stop",value:function(){if(this._stopWatch){var e=this._stopWatch.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this._stopWatch=void 0}}}]),e}();eL.all=new Set,eL._idPool=0;var eP=function(){function e(i,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e._idPool++).toString(16).padStart(3,"0");(0,o._)(this,e),this._errorHandler=i,this.threshold=r,this.name=n,this._warnCountdown=0}return(0,l._)(e,[{key:"dispose",value:function(){var e;null==(e=this._stacks)||e.clear()}},{key:"check",value:function(e,i){var r=this,n=this.threshold;if(!(n<=0)&&!(i<n)){this._stacks||(this._stacks=new Map);var s=this._stacks.get(e.value)||0;if(this._stacks.set(e.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=.5*n;var o=(0,v._)(this.getMostFrequentStack(),2),a=o[0],l=o[1],c="[".concat(this.name,"] potential listener LEAK detected, having ").concat(i," listeners already. MOST frequent listener (").concat(l,"):");console.warn(c),console.warn(a);var h=new e2(c,a);this._errorHandler(h)}return function(){var i=r._stacks.get(e.value)||0;r._stacks.set(e.value,i-1)}}}},{key:"getMostFrequentStack",value:function(){if(this._stacks){var e,i=0,r=!0,n=!1,s=void 0;try{for(var o,a=this._stacks[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=(0,v._)(o.value,2),c=l[0],h=l[1];(!e||i<h)&&(e=[c,h],i=h)}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}return e}}}]),e}();eP._idPool=1;var eT,eA,eO,eI,eN,eH,eW,ez,eF,eK,eU,eq,eV,eY,eX,ej,eG,eJ,eZ,e$,eQ,e0,e1=function(){function e(i){(0,o._)(this,e),this.value=i}return(0,l._)(e,[{key:"print",value:function(){console.warn(this.value.split("\n").slice(2).join("\n"))}}],[{key:"create",value:function(){var i;return new e(null!=(i=Error().stack)?i:"")}}]),e}(),e2=function(e){function i(e,r){var n;return(0,o._)(this,i),(n=(0,s._)(this,i,[e])).name="ListenerLeakError",n.stack=r,n}return(0,f._)(i,e),i}((0,y._)(Error)),e3=function(e){function i(e,r){var n;return(0,o._)(this,i),(n=(0,s._)(this,i,[e])).name="ListenerRefusalError",n.stack=r,n}return(0,f._)(i,e),i}((0,y._)(Error)),e5=0,e6=function e(i){(0,o._)(this,e),this.value=i,this.id=e5++},e4=function(){function e(i){var r,n,s,a,l,c;(0,o._)(this,e),this._size=0,this._options=i,this._leakageMon=(null==(r=this._options)?void 0:r.leakWarningThreshold)?new eP(null!=(l=null==i?void 0:i.onListenerError)?l:ec,null!=(c=null==(n=this._options)?void 0:n.leakWarningThreshold)?c:-1):void 0,this._perfMon=(null==(s=this._options)?void 0:s._profName)?new eL(this._options._profName):void 0,this._deliveryQueue=null==(a=this._options)?void 0:a.deliveryQueue}return(0,l._)(e,[{key:"dispose",value:function(){if(!this._disposed){var e,i,r,n;this._disposed=!0,(null==(e=this._deliveryQueue)?void 0:e.current)===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),null==(r=this._options)||null==(i=r.onDidRemoveLastListener)||i.call(r),null==(n=this._leakageMon)||n.dispose()}}},{key:"event",get:function(){var e=this;return null!=this._event||(this._event=function(i,r,n){if(e._leakageMon&&e._size>Math.pow(e._leakageMon.threshold,2)){var s,o,a,l,c,h,u="[".concat(e._leakageMon.name,"] REFUSES to accept new listeners because it exceeded its threshold by far (").concat(e._size," vs ").concat(e._leakageMon.threshold,")");console.warn(u);var f=null!=(h=e._leakageMon.getMostFrequentStack())?h:["UNKNOWN stack",-1],_=new e3("".concat(u,". HINT: Stack shows most frequent listener (").concat(f[1],"-times)"),f[0]);return((null==(c=e._options)?void 0:c.onListenerError)||ec)(_),eC.None}if(e._disposed)return eC.None;r&&(i=i.bind(r));var v,g=new e6(i);e._leakageMon&&e._size>=Math.ceil(.2*e._leakageMon.threshold)&&(g.stack=e1.create(),v=e._leakageMon.check(g.stack,e._size+1)),e._listeners?(0,d._)(e._listeners,e6)?(null!=e._deliveryQueue||(e._deliveryQueue=new e8),e._listeners=[e._listeners,g]):e._listeners.push(g):(null==(o=e._options)||null==(s=o.onWillAddFirstListener)||s.call(o,e),e._listeners=g,null==(l=e._options)||null==(a=l.onDidAddFirstListener)||a.call(l,e)),e._size++;var p=eb(function(){null==e0||e0.unregister(p),null==v||v(),e._removeListener(g)});if((0,d._)(n,ew)?n.add(p):Array.isArray(n)&&n.push(p),e0){var y,m=Error().stack.split("\n").slice(2,3).join("\n").trim(),S=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(m);e0.register(p,null!=(y=null==S?void 0:S[2])?y:m,p)}return p}),this._event}},{key:"_removeListener",value:function(e){if(null==(r=this._options)||null==(i=r.onWillRemoveListener)||i.call(r,this),this._listeners){if(1===this._size){this._listeners=void 0,null==(s=this._options)||null==(n=s.onDidRemoveLastListener)||n.call(s,this),this._size=0;return}var i,r,n,s,o=this._listeners,a=o.indexOf(e);if(-1===a)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,o[a]=void 0;var l=this._deliveryQueue.current===this;if(2*this._size<=o.length){for(var c=0,h=0;h<o.length;h++)o[h]?o[c++]=o[h]:l&&(this._deliveryQueue.end--,c<this._deliveryQueue.i&&this._deliveryQueue.i--);o.length=c}}}},{key:"_deliver",value:function(e,i){if(e){var r,n=(null==(r=this._options)?void 0:r.onListenerError)||ec;try{e.value(i)}catch(e){n(e)}}}},{key:"_deliverQueue",value:function(e){for(var i=e.current._listeners;e.i<e.end;)this._deliver(i[e.i++],e.value);e.reset()}},{key:"fire",value:function(e){var i,r,n,s;if((null==(i=this._deliveryQueue)?void 0:i.current)&&(this._deliverQueue(this._deliveryQueue),null==(r=this._perfMon)||r.stop()),null==(n=this._perfMon)||n.start(this._size),this._listeners)if((0,d._)(this._listeners,e6))this._deliver(this._listeners,e);else{var o=this._deliveryQueue;o.enqueue(this,e,this._listeners.length),this._deliverQueue(o)}null==(s=this._perfMon)||s.stop()}},{key:"hasListeners",value:function(){return this._size>0}}]),e}(),e8=function(){function e(){(0,o._)(this,e),this.i=-1,this.end=0}return(0,l._)(e,[{key:"enqueue",value:function(e,i,r){this.i=0,this.end=r,this.current=e,this.value=i}},{key:"reset",value:function(){this.i=this.end,this.current=void 0,this.value=void 0}}]),e}(),e7=function(){function e(){(0,o._)(this,e),this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new e4,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new e4,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}return(0,l._)(e,[{key:"getZoomLevel",value:function(e){var i;return null!=(i=this.mapWindowIdToZoomLevel.get(this.getWindowId(e)))?i:0}},{key:"setZoomLevel",value:function(e,i){if(this.getZoomLevel(i)!==e){var r=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(r,e),this._onDidChangeZoomLevel.fire(r)}}},{key:"getZoomFactor",value:function(e){var i;return null!=(i=this.mapWindowIdToZoomFactor.get(this.getWindowId(e)))?i:1}},{key:"setZoomFactor",value:function(e,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),e)}},{key:"setFullscreen",value:function(e,i){if(this.isFullscreen(i)!==e){var r=this.getWindowId(i);this.mapWindowIdToFullScreen.set(r,e),this._onDidChangeFullscreen.fire(r)}}},{key:"isFullscreen",value:function(e){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(e))}},{key:"getWindowId",value:function(e){return e.vscodeWindowId}}]),e}();e7.INSTANCE=new e7,e7.INSTANCE.onDidChangeZoomLevel,e7.INSTANCE.onDidChangeFullscreen;var e9=("undefined"==typeof navigator?"undefined":(0,p._)(navigator))=="object"?navigator.userAgent:"",te=e9.indexOf("Firefox")>=0,tt=e9.indexOf("AppleWebKit")>=0,ti=e9.indexOf("Chrome")>=0,tr=!ti&&e9.indexOf("Safari")>=0;e9.indexOf("Electron/"),e9.indexOf("Android");var tn=!1;if("function"==typeof eE.matchMedia){var ts,to=eE.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),ta=eE.matchMedia("(display-mode: fullscreen)");tn=to.matches,ts=to,"string"==typeof ts&&(ts=eE.matchMedia(ts)),ts.addEventListener("change",function(e){var i=e.matches;tn&&ta.matches||(tn=i)})}var tl,tc,th=!1,tu=!1,tf=!1,td=!1,t_=!1,tv="en",tg=globalThis;"u">(0,p._)(tg.vscode)&&"u">(0,p._)(tg.vscode.process)?tc=tg.vscode.process:(void 0===i.default?"undefined":(0,p._)(i.default))<"u"&&"string"==typeof(null==(eO=i.default)||null==(eA=eO.versions)?void 0:eA.node)&&(tc=i.default);var tp="string"==typeof(null==tc||null==(eI=tc.versions)?void 0:eI.electron)&&(null==tc?void 0:tc.type)==="renderer";if((void 0===tc?"undefined":(0,p._)(tc))=="object"){th="win32"===tc.platform,tu="darwin"===tc.platform,(tf="linux"===tc.platform)&&tc.env.SNAP&&tc.env.SNAP_REVISION,tc.env.CI||tc.env.BUILD_ARTIFACTSTAGINGDIRECTORY,tv="en";var ty=tc.env.VSCODE_NLS_CONFIG;if(ty)try{var tm,tS=JSON.parse(ty);tS.userLocale,tS.osLocale,tv=tS.resolvedLanguage||"en",null==(tm=tS.languagePack)||tm.translationsConfigFile}catch(e){}td=!0}else("undefined"==typeof navigator?"undefined":(0,p._)(navigator))!="object"||tp?console.error("Unable to resolve platform."):(th=(tl=navigator.userAgent).indexOf("Windows")>=0,tu=tl.indexOf("Macintosh")>=0,(tl.indexOf("Macintosh")>=0||tl.indexOf("iPad")>=0||tl.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints,tf=tl.indexOf("Linux")>=0,null==tl||tl.indexOf("Mobi"),t_=!0,tv=globalThis._VSCODE_NLS_LANGUAGE||"en",navigator.language.toLowerCase());var tk=th,tb=tu,tw=tf,tC=td;t_&&"function"==typeof tg.importScripts&&tg.origin;var tx,tE=tl,tD=tv;(tN=tx||(tx={})).value=function(){return tD},tN.isDefaultVariant=function(){return 2===tD.length?"en"===tD:tD.length>=3&&"e"===tD[0]&&"n"===tD[1]&&"-"===tD[2]},tN.isDefault=function(){return"en"===tD};var tB="function"==typeof tg.postMessage&&!tg.importScripts,tR=function(){if(tB){var e=[];tg.addEventListener("message",function(i){if(i.data&&i.data.vscodeScheduleAsyncWork)for(var r=0,n=e.length;r<n;r++){var s=e[r];if(s.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),s.callback();return}}});var i=0;return function(r){var n=++i;e.push({id:n,callback:r}),tg.postMessage({vscodeScheduleAsyncWork:n},"*")}}return function(e){return setTimeout(e)}}(),tM=!!(tE&&tE.indexOf("Chrome")>=0);tE&&tE.indexOf("Firefox"),!tM&&tE&&tE.indexOf("Safari"),tE&&tE.indexOf("Edg/"),tE&&tE.indexOf("Android");var tL=("undefined"==typeof navigator?"undefined":(0,p._)(navigator))=="object"?navigator:{};tC||document.queryCommandSupported&&document.queryCommandSupported("copy")||tL&&tL.clipboard&&tL.clipboard.writeText,tC||tL&&tL.clipboard&&tL.clipboard.readText,tC||tn||tL.keyboard,"ontouchstart"in eE||tL.maxTouchPoints,eE.PointerEvent&&("ontouchstart"in eE||navigator.maxTouchPoints);var tP=function(){function e(){(0,o._)(this,e),this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}return(0,l._)(e,[{key:"define",value:function(e,i){this._keyCodeToStr[e]=i,this._strToKeyCode[i.toLowerCase()]=e}},{key:"keyCodeToStr",value:function(e){return this._keyCodeToStr[e]}},{key:"strToKeyCode",value:function(e){return this._strToKeyCode[e.toLowerCase()]||0}}]),e}(),tT=new tP,tA=new tP,tO=new tP,tI=Array(230);(tH=tW||(tW={})).toString=function(e){return tT.keyCodeToStr(e)},tH.fromString=function(e){return tT.strToKeyCode(e)},tH.toUserSettingsUS=function(e){return tA.keyCodeToStr(e)},tH.toUserSettingsGeneral=function(e){return tO.keyCodeToStr(e)},tH.fromUserSettings=function(e){return tA.strToKeyCode(e)||tO.strToKeyCode(e)},tH.toElectronAccelerator=function(e){if(e>=98&&e<=113)return null;switch(e){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return tT.keyCodeToStr(e)};var tN,tH,tW,tz,tF=function(){function e(i,r,n,s,a){(0,o._)(this,e),this.ctrlKey=i,this.shiftKey=r,this.altKey=n,this.metaKey=s,this.keyCode=a}return(0,l._)(e,[{key:"equals",value:function(i){return(0,d._)(i,e)&&this.ctrlKey===i.ctrlKey&&this.shiftKey===i.shiftKey&&this.altKey===i.altKey&&this.metaKey===i.metaKey&&this.keyCode===i.keyCode}},{key:"getHashCode",value:function(){var e=this.ctrlKey?"1":"0",i=this.shiftKey?"1":"0",r=this.altKey?"1":"0",n=this.metaKey?"1":"0";return"K".concat(e).concat(i).concat(r).concat(n).concat(this.keyCode)}},{key:"isModifierKey",value:function(){return 0===this.keyCode||5===this.keyCode||57===this.keyCode||6===this.keyCode||4===this.keyCode}},{key:"toKeybinding",value:function(){return new tK([this])}},{key:"isDuplicateModifierCase",value:function(){return this.ctrlKey&&5===this.keyCode||this.shiftKey&&4===this.keyCode||this.altKey&&6===this.keyCode||this.metaKey&&57===this.keyCode}}]),e}(),tK=function(){function e(i){if((0,o._)(this,e),0===i.length)throw Error("Illegal argument: ".concat("chords"));this.chords=i}return(0,l._)(e,[{key:"getHashCode",value:function(){for(var e="",i=0,r=this.chords.length;i<r;i++)0!==i&&(e+=";"),e+=this.chords[i].getHashCode();return e}},{key:"equals",value:function(e){if(null===e||this.chords.length!==e.chords.length)return!1;for(var i=0;i<this.chords.length;i++)if(!this.chords[i].equals(e.chords[i]))return!1;return!0}}]),e}(),tU=tb?256:2048,tq=tb?2048:256,tV=function(){function e(i){var r;(0,o._)(this,e),this._standardKeyboardEventBrand=!0,this.browserEvent=i,this.target=i.target,this.ctrlKey=i.ctrlKey,this.shiftKey=i.shiftKey,this.altKey=i.altKey,this.metaKey=i.metaKey,this.altGraphKey=null==(r=i.getModifierState)?void 0:r.call(i,"AltGraph"),this.keyCode=function(e){if(e.charCode){var i=String.fromCharCode(e.charCode).toUpperCase();return tW.fromString(i)}var r=e.keyCode;if(3===r)return 7;if(te)switch(r){case 59:return 85;case 60:if(tw)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(tb)return 57}else if(tt&&(tb&&93===r||!tb&&92===r))return 57;return tI[r]||0}(i),this.code=i.code,this.ctrlKey=this.ctrlKey||5===this.keyCode,this.altKey=this.altKey||6===this.keyCode,this.shiftKey=this.shiftKey||4===this.keyCode,this.metaKey=this.metaKey||57===this.keyCode,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}return(0,l._)(e,[{key:"preventDefault",value:function(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}},{key:"toKeyCodeChord",value:function(){return this._asKeyCodeChord}},{key:"equals",value:function(e){return this._asKeybinding===e}},{key:"_computeKeybinding",value:function(){var e=0;5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(e=this.keyCode);var i=0;return this.ctrlKey&&(i|=tU),this.altKey&&(i|=512),this.shiftKey&&(i|=1024),this.metaKey&&(i|=tq),i|=e}},{key:"_computeKeyCodeChord",value:function(){var e=0;return 5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(e=this.keyCode),new tF(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}}]),e}(),tY=new WeakMap,tX=function(){function e(){(0,o._)(this,e)}return(0,l._)(e,null,[{key:"getSameOriginWindowChain",value:function(e){var i=tY.get(e);if(!i){i=[],tY.set(e,i);var r,n=e;do(r=function(e){if(!e.parent||e.parent===e)return null;try{var i=e.location,r=e.parent.location;if("null"!==i.origin&&"null"!==r.origin&&i.origin!==r.origin)return null}catch(e){return null}return e.parent}(n))?i.push({window:new WeakRef(n),iframeElement:n.frameElement||null}):i.push({window:new WeakRef(n),iframeElement:null}),n=r;while(n)}return i.slice(0)}},{key:"getPositionOfChildWindowRelativeToAncestorWindow",value:function(e,i){if(!i||e===i)return{top:0,left:0};var r=0,n=0,s=this.getSameOriginWindowChain(e),o=!0,a=!1,l=void 0;try{for(var c,h=s[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var u,f,d=c.value,_=d.window.deref();if(r+=null!=(u=null==_?void 0:_.scrollY)?u:0,n+=null!=(f=null==_?void 0:_.scrollX)?f:0,_===i||!d.iframeElement)break;var v=d.iframeElement.getBoundingClientRect();r+=v.top,n+=v.left}}catch(e){a=!0,l=e}finally{try{o||null==h.return||h.return()}finally{if(a)throw l}}return{top:r,left:n}}}]),e}(),tj=function(){function e(i,r){(0,o._)(this,e),this.timestamp=Date.now(),this.browserEvent=r,this.leftButton=0===r.button,this.middleButton=1===r.button,this.rightButton=2===r.button,this.buttons=r.buttons,this.target=r.target,this.detail=r.detail||1,"dblclick"===r.type&&(this.detail=2),this.ctrlKey=r.ctrlKey,this.shiftKey=r.shiftKey,this.altKey=r.altKey,this.metaKey=r.metaKey,"number"==typeof r.pageX?(this.posx=r.pageX,this.posy=r.pageY):(this.posx=r.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=r.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);var n=tX.getPositionOfChildWindowRelativeToAncestorWindow(i,r.view);this.posx-=n.left,this.posy-=n.top}return(0,l._)(e,[{key:"preventDefault",value:function(){this.browserEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.browserEvent.stopPropagation()}}]),e}(),tG=function(){function e(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,o._)(this,e),this.browserEvent=i||null,this.target=i?i.target||i.targetNode||i.srcElement:null,this.deltaY=n,this.deltaX=r;var s=!1;if(ti){var a=navigator.userAgent.match(/Chrome\/(\d+)/);s=(a?parseInt(a[1]):123)<=122}if(i){var l,c=(null==(l=i.view)?void 0:l.devicePixelRatio)||1;"u">(0,p._)(i.wheelDeltaY)?s?this.deltaY=i.wheelDeltaY/(120*c):this.deltaY=i.wheelDeltaY/120:"u">(0,p._)(i.VERTICAL_AXIS)&&i.axis===i.VERTICAL_AXIS?this.deltaY=-i.detail/3:"wheel"===i.type&&(i.deltaMode===i.DOM_DELTA_LINE?te&&!tb?this.deltaY=-i.deltaY/3:this.deltaY=-i.deltaY:this.deltaY=-i.deltaY/40),"u">(0,p._)(i.wheelDeltaX)?tr&&tk?this.deltaX=-(i.wheelDeltaX/120):s?this.deltaX=i.wheelDeltaX/(120*c):this.deltaX=i.wheelDeltaX/120:"u">(0,p._)(i.HORIZONTAL_AXIS)&&i.axis===i.HORIZONTAL_AXIS?this.deltaX=-i.detail/3:"wheel"===i.type&&(i.deltaMode===i.DOM_DELTA_LINE?te&&!tb?this.deltaX=-i.deltaX/3:this.deltaX=-i.deltaX:this.deltaX=-i.deltaX/40),0===this.deltaY&&0===this.deltaX&&i.wheelDelta&&(s?this.deltaY=i.wheelDelta/(120*c):this.deltaY=i.wheelDelta/120)}}return(0,l._)(e,[{key:"preventDefault",value:function(){var e;null==(e=this.browserEvent)||e.preventDefault()}},{key:"stopPropagation",value:function(){var e;null==(e=this.browserEvent)||e.stopPropagation()}}]),e}(),tJ=Object.freeze(function(e,i){var r=setTimeout(e.bind(i),0);return{dispose:function(){clearTimeout(r)}}});(iH=tz||(tz={})).isCancellationToken=function(e){return!!(e===iH.None||e===iH.Cancelled||(0,d._)(e,tZ))||!!e&&(void 0===e?"undefined":(0,p._)(e))=="object"&&"boolean"==typeof e.isCancellationRequested&&"function"==typeof e.onCancellationRequested},iH.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:eU.None}),iH.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:tJ});var tZ=function(){function e(){(0,o._)(this,e),this._isCancelled=!1,this._emitter=null}return(0,l._)(e,[{key:"cancel",value:function(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}},{key:"isCancellationRequested",get:function(){return this._isCancelled}},{key:"onCancellationRequested",get:function(){return this._isCancelled?tJ:(this._emitter||(this._emitter=new e4),this._emitter.event)}},{key:"dispose",value:function(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}]),e}();Symbol("MicrotaskDelay");var t$=function(){function e(i,r){(0,o._)(this,e),this._isDisposed=!1,this._token=-1,"function"==typeof i&&"number"==typeof r&&this.setIfNotSet(i,r)}return(0,l._)(e,[{key:"dispose",value:function(){this.cancel(),this._isDisposed=!0}},{key:"cancel",value:function(){-1!==this._token&&(clearTimeout(this._token),this._token=-1)}},{key:"cancelAndSet",value:function(e,i){var r=this;if(this._isDisposed)throw new ed("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(function(){r._token=-1,e()},i)}},{key:"setIfNotSet",value:function(e,i){var r=this;if(this._isDisposed)throw new ed("Calling 'setIfNotSet' on a disposed TimeoutTimer");-1===this._token&&(this._token=setTimeout(function(){r._token=-1,e()},i))}}]),e}(),tQ=function(){function e(){(0,o._)(this,e),this.disposable=void 0,this.isDisposed=!1}return(0,l._)(e,[{key:"cancel",value:function(){var e;null==(e=this.disposable)||e.dispose(),this.disposable=void 0}},{key:"cancelAndSet",value:function(e,i){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:globalThis;if(this.isDisposed)throw new ed("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();var s=n.setInterval(function(){e()},i);this.disposable=eb(function(){n.clearInterval(s),r.disposable=void 0})}},{key:"dispose",value:function(){this.cancel(),this.isDisposed=!0}}]),e}();(iW=iQ||(iQ={})).settled=function(e){return(0,n._)(function(){var i,r;return(0,m._)(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return e.then(function(e){return e},function(e){i||(i=e)})}))];case 1:if(r=n.sent(),(void 0===i?"undefined":(0,p._)(i))<"u")throw i;return[2,r]}})})()},iW.withAsyncBody=function(e){return new Promise(function(i,r){return(0,n._)(function(){return(0,m._)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e(i,r)];case 1:return n.sent(),[3,3];case 2:return r(n.sent()),[3,3];case 3:return[2]}})})()})};var t0=function(){function e(i,r){var s=this;(0,o._)(this,e),this._state=0,this._results=[],this._error=null,this._onReturn=r,this._onStateChanged=new e4,queueMicrotask(function(){return(0,n._)(function(){var e,r,n;return(0,m._)(this,function(s){switch(s.label){case 0:e=this,r={emitOne:function(i){return e.emitOne(i)},emitMany:function(i){return e.emitMany(i)},reject:function(i){return e.reject(i)}},s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,Promise.resolve(i(r))];case 2:return s.sent(),this.resolve(),[3,5];case 3:return n=s.sent(),this.reject(n),[3,5];case 4:return r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0,[7];case 5:return[2]}})}).call(s)})}return(0,l._)(e,[{key:Symbol.asyncIterator,value:function(){var e=this,i=0;return{next:function(){return(0,n._)(function(){return(0,m._)(this,function(e){switch(e.label){case 0:if(2===this._state)throw this._error;if(i<this._results.length)return[2,{done:!1,value:this._results[i++]}];if(1===this._state)return[2,{done:!0,value:void 0}];return[4,eU.toPromise(this._onStateChanged.event)];case 1:e.sent(),e.label=2;case 2:return[3,0];case 3:return[2]}})}).call(e)},return:function(){return(0,n._)(function(){var e,i;return(0,m._)(this,function(r){return[2,(null==(e=(i=this)._onReturn)||e.call(i),{done:!0,value:void 0})]})}).call(e)}}}},{key:"map",value:function(i){return e.map(this,i)}},{key:"filter",value:function(i){return e.filter(this,i)}},{key:"coalesce",value:function(){return e.coalesce(this)}},{key:"toPromise",value:function(){return e.toPromise(this)}},{key:"emitOne",value:function(e){0===this._state&&(this._results.push(e),this._onStateChanged.fire())}},{key:"emitMany",value:function(e){0===this._state&&(this._results=this._results.concat(e),this._onStateChanged.fire())}},{key:"resolve",value:function(){0===this._state&&(this._state=1,this._onStateChanged.fire())}},{key:"reject",value:function(e){0===this._state&&(this._state=2,this._error=e,this._onStateChanged.fire())}}],[{key:"fromArray",value:function(i){return new e(function(e){e.emitMany(i)})}},{key:"fromPromise",value:function(i){return new e(function(e){return(0,n._)(function(){var r;return(0,m._)(this,function(n){switch(n.label){case 0:return r=e.emitMany,[4,i];case 1:return r.apply(e,[n.sent()]),[2]}})})()})}},{key:"fromPromises",value:function(i){return new e(function(e){return(0,n._)(function(){return(0,m._)(this,function(r){switch(r.label){case 0:return[4,Promise.all(i.map(function(i){return(0,n._)(function(){var r;return(0,m._)(this,function(n){switch(n.label){case 0:return r=e.emitOne,[4,i];case 1:return[2,r.apply(e,[n.sent()])]}})})()}))];case 1:return r.sent(),[2]}})})()})}},{key:"merge",value:function(i){return new e(function(e){return(0,n._)(function(){return(0,m._)(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(i){return(0,n._)(function(){var n,s,o,a,l,c,h;return(0,m._)(this,function(u){switch(u.label){case 0:n=!1,s=!1,u.label=1;case 1:u.trys.push([1,6,7,12]),a=(0,r._)(i),u.label=2;case 2:return[4,a.next()];case 3:if(!(n=!(l=u.sent()).done))return[3,5];c=l.value,e.emitOne(c),u.label=4;case 4:return n=!1,[3,2];case 5:return[3,12];case 6:return h=u.sent(),s=!0,o=h,[3,12];case 7:if(u.trys.push([7,,10,11]),!(n&&null!=a.return))return[3,9];return[4,a.return()];case 8:u.sent(),u.label=9;case 9:return[3,11];case 10:if(s)throw o;return[7];case 11:return[7];case 12:return[2]}})})()}))];case 1:return s.sent(),[2]}})})()})}},{key:"map",value:function(i,s){return new e(function(e){return(0,n._)(function(){var n,o,a,l,c,h,u;return(0,m._)(this,function(f){switch(f.label){case 0:n=!1,o=!1,f.label=1;case 1:f.trys.push([1,6,7,12]),l=(0,r._)(i),f.label=2;case 2:return[4,l.next()];case 3:if(!(n=!(c=f.sent()).done))return[3,5];h=c.value,e.emitOne(s(h)),f.label=4;case 4:return n=!1,[3,2];case 5:return[3,12];case 6:return u=f.sent(),o=!0,a=u,[3,12];case 7:if(f.trys.push([7,,10,11]),!(n&&null!=l.return))return[3,9];return[4,l.return()];case 8:f.sent(),f.label=9;case 9:return[3,11];case 10:if(o)throw a;return[7];case 11:return[7];case 12:return[2]}})})()})}},{key:"filter",value:function(i,s){return new e(function(e){return(0,n._)(function(){var n,o,a,l,c,h,u;return(0,m._)(this,function(f){switch(f.label){case 0:n=!1,o=!1,f.label=1;case 1:f.trys.push([1,6,7,12]),l=(0,r._)(i),f.label=2;case 2:return[4,l.next()];case 3:if(!(n=!(c=f.sent()).done))return[3,5];s(h=c.value)&&e.emitOne(h),f.label=4;case 4:return n=!1,[3,2];case 5:return[3,12];case 6:return u=f.sent(),o=!0,a=u,[3,12];case 7:if(f.trys.push([7,,10,11]),!(n&&null!=l.return))return[3,9];return[4,l.return()];case 8:f.sent(),f.label=9;case 9:return[3,11];case 10:if(o)throw a;return[7];case 11:return[7];case 12:return[2]}})})()})}},{key:"coalesce",value:function(i){return e.filter(i,function(e){return!!e})}},{key:"toPromise",value:function(e){return(0,n._)(function(){var i,n,s,o,a,l,c,h;return(0,m._)(this,function(u){switch(u.label){case 0:i=[],n=!1,s=!1,u.label=1;case 1:u.trys.push([1,6,7,12]),a=(0,r._)(e),u.label=2;case 2:return[4,a.next()];case 3:if(!(n=!(l=u.sent()).done))return[3,5];c=l.value,i.push(c),u.label=4;case 4:return n=!1,[3,2];case 5:return[3,12];case 6:return h=u.sent(),s=!0,o=h,[3,12];case 7:if(u.trys.push([7,,10,11]),!(n&&null!=a.return))return[3,9];return[4,a.return()];case 8:u.sent(),u.label=9;case 9:return[3,11];case 10:if(s)throw o;return[7];case 11:return[7];case 12:return[2,i]}})})()}}]),e}();function t1(e){return 56320<=e&&e<=57343}t0.EMPTY=t0.fromArray([]);function t2(e,i){return(i<<5)-i+e|0}function t3(e,i){i=t2(149417,i);for(var r=0,n=e.length;r<n;r++)i=t2(e.charCodeAt(r),i);return i}function t5(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,n=r-i;return(e<<i|(~((1<<n)-1)&e)>>>n)>>>0}function t6(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=0;s<r;s++)e[i+s]=n}function t4(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;return(0,d._)(e,ArrayBuffer)?Array.from(new Uint8Array(e)).map(function(e){return e.toString(16).padStart(2,"0")}).join(""):function(e,i){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";e.length<i;)e=r+e;return e}((e>>>0).toString(16),i/4)}(function(){function e(){(0,o._)(this,e),this._h0=0x67452301,this._h1=0xefcdab89,this._h2=0x98badcfe,this._h3=0x10325476,this._h4=0xc3d2e1f0,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}return(0,l._)(e,[{key:"update",value:function(e){var i=e.length;if(0!==i){var r,n,s=this._buff,o=this._buffLen,a=this._leftoverHighSurrogate;for(0!==a?(r=a,n=-1,a=0):(r=e.charCodeAt(0),n=0);;){var l,c=r;if(55296<=(l=r)&&l<=56319)if(n+1<i){var h=e.charCodeAt(n+1);t1(h)?(n++,c=(r-55296<<10)+(h-56320)+65536):c=65533}else{a=r;break}else t1(r)&&(c=65533);if(o=this._push(s,o,c),++n<i)r=e.charCodeAt(n);else break}this._buffLen=o,this._leftoverHighSurrogate=a}}},{key:"_push",value:function(e,i,r){return r<128?e[i++]=r:(r<2048?e[i++]=192|(1984&r)>>>6:(r<65536?e[i++]=224|(61440&r)>>>12:(e[i++]=240|(1835008&r)>>>18,e[i++]=128|(258048&r)>>>12),e[i++]=128|(4032&r)>>>6),e[i++]=128|(63&r)>>>0),i>=64&&(this._step(),i-=64,this._totalLen+=64,e[0]=e[64],e[1]=e[65],e[2]=e[66]),i}},{key:"digest",value:function(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),t4(this._h0)+t4(this._h1)+t4(this._h2)+t4(this._h3)+t4(this._h4)}},{key:"_wrapUp",value:function(){this._buff[this._buffLen++]=128,t6(this._buff,this._buffLen),this._buffLen>56&&(this._step(),t6(this._buff));var e=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(e/0x100000000),!1),this._buffDV.setUint32(60,e%0x100000000,!1),this._step()}},{key:"_step",value:function(){for(var i=e._bigBlock32,r=this._buffDV,n=0;n<64;n+=4)i.setUint32(n,r.getUint32(n,!1),!1);for(var s=64;s<320;s+=4)i.setUint32(s,t5(i.getUint32(s-12,!1)^i.getUint32(s-32,!1)^i.getUint32(s-56,!1)^i.getUint32(s-64,!1),1),!1);for(var o,a,l,c=this._h0,h=this._h1,u=this._h2,f=this._h3,d=this._h4,_=0;_<80;_++)_<20?(o=h&u|~h&f,a=0x5a827999):_<40?(o=h^u^f,a=0x6ed9eba1):_<60?(o=h&u|h&f|u&f,a=0x8f1bbcdc):(o=h^u^f,a=0xca62c1d6),l=t5(c,5)+o+d+a+i.getUint32(4*_,!1)|0,d=f,f=u,u=t5(h,30),h=c,c=l;this._h0=this._h0+c|0,this._h1=this._h1+h|0,this._h2=this._h2+u|0,this._h3=this._h3+f|0,this._h4=this._h4+d|0}}]),e})()._bigBlock32=new DataView(new ArrayBuffer(320));var t8=(iz=new Map,iF={window:eE,disposables:new ew},iz.set(eE.vscodeWindowId,iF),iK=new e4,iU=new e4,iq=new e4,{onDidRegisterWindow:iK.event,onWillUnregisterWindow:iq.event,onDidUnregisterWindow:iU.event,registerWindow:function(e){if(iz.has(e.vscodeWindowId))return eC.None;var i=new ew,r={window:e,disposables:i.add(new ew)};return iz.set(e.vscodeWindowId,r),i.add(eb(function(){iz.delete(e.vscodeWindowId),iU.fire(e)})),i.add(ii(e,il.BEFORE_UNLOAD,function(){iq.fire(e)})),iK.fire(r),i},getWindows:function(){return iz.values()},getWindowsCount:function(){return iz.size},getWindowId:function(e){return e.vscodeWindowId},hasWindow:function(e){return iz.has(e)},getWindowById:function(e,i){var r;return null!=(r="number"==typeof e?iz.get(e):void 0)?r:i?iF:void 0},getWindow:function(e){var i;return(null==e||null==(i=e.ownerDocument)?void 0:i.defaultView)?e.ownerDocument.defaultView.window:(null==e?void 0:e.view)?e.view.window:eE},getDocument:function(e){return t7(e).document}}),t7=(t8.registerWindow,t8.getWindow),t9=(t8.getDocument,t8.getWindows,t8.getWindowsCount,t8.getWindowId),ie=(t8.getWindowById,t8.hasWindow,t8.onDidRegisterWindow);t8.onWillUnregisterWindow,t8.onDidUnregisterWindow;var it=function(){function e(i,r,n,s){(0,o._)(this,e),this._node=i,this._type=r,this._handler=n,this._options=s||!1,this._node.addEventListener(this._type,this._handler,this._options)}return(0,l._)(e,[{key:"dispose",value:function(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}}]),e}();function ii(e,i,r,n){return new it(e,i,r,n)}var ir=function(e,i,r,n){var s,o=r;return"click"===i||"mousedown"===i||"contextmenu"===i?(s=t7(e),o=function(e){return r(new tj(s,e))}):("keydown"===i||"keypress"===i||"keyup"===i)&&(o=function(e){return r(new tV(e))}),ii(e,i,o,n)},is=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i)).defaultTarget=e&&t7(e),r}return(0,f._)(i,e),(0,l._)(i,[{key:"cancelAndSet",value:function(e,r,n){return(0,h._)((0,u._)(i.prototype),"cancelAndSet",this).call(this,e,r,null!=n?n:this.defaultTarget)}}]),i}(tQ),io=function(){function e(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o._)(this,e),this._runner=i,this.priority=r,this._canceled=!1}return(0,l._)(e,[{key:"dispose",value:function(){this._canceled=!0}},{key:"execute",value:function(){if(!this._canceled)try{this._runner()}catch(e){ec(e)}}}],[{key:"sort",value:function(e,i){return i.priority-e.priority}}]),e}();iV=new Map,iY=new Map,iX=new Map,ij=new Map,iG=function(e){iX.set(e,!1);var i,r=null!=(i=iV.get(e))?i:[];for(iY.set(e,r),iV.set(e,[]),ij.set(e,!0);r.length>0;)r.sort(io.sort),r.shift().execute();ij.set(e,!1)},i0=function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t9(e),s=new io(i,r),o=iV.get(n);return o||(o=[],iV.set(n,o)),o.push(s),iX.get(n)||(iX.set(n,!0),e.requestAnimationFrame(function(){return iG(n)})),s};var ia=function(){function e(i,r){(0,o._)(this,e),this.width=i,this.height=r}return(0,l._)(e,[{key:"with",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.width,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.height;return i!==this.width||r!==this.height?new e(i,r):this}}],[{key:"is",value:function(e){return(void 0===e?"undefined":(0,p._)(e))=="object"&&"number"==typeof e.height&&"number"==typeof e.width}},{key:"lift",value:function(i){return(0,d._)(i,e)?i:new e(i.width,i.height)}},{key:"equals",value:function(e,i){return e===i||!!e&&!!i&&e.width===i.width&&e.height===i.height}}]),e}();ia.None=new ia(0,0),new(function(){function e(){(0,o._)(this,e),this.mutationObservers=new Map}return(0,l._)(e,[{key:"observe",value:function(e,i,r){var n=this,s=this.mutationObservers.get(e);s||(s=new Map,this.mutationObservers.set(e,s));var o=function e(i,r){switch(void 0===i?"undefined":(0,p._)(i)){case"object":var n,s,o,a;return null===i?t2(349,r):Array.isArray(i)?(n=i,s=t2(104579,s=r),n.reduce(function(i,r){return e(r,i)},s)):(o=i,a=t2(181387,a=r),Object.keys(o).sort().reduce(function(i,r){return i=t3(r,i),e(o[r],i)},a));case"string":return t3(i,r);case"boolean":return t2(i?433:863,r);case"number":return t2(i,r);case"undefined":return t2(937,r);default:return t2(617,r)}}(r,0),a=s.get(o);if(a)a.users+=1;else{var l=new e4,c=new MutationObserver(function(e){return l.fire(e)});c.observe(e,r);var h=a={users:1,observer:c,onDidMutate:l.event};i.add(eb(function(){h.users-=1,0===h.users&&(l.dispose(),c.disconnect(),null==s||s.delete(o),(null==s?void 0:s.size)===0&&n.mutationObservers.delete(e))})),s.set(o,a)}return a.onDidMutate}}]),e}());var il={CLICK:"click",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",KEY_DOWN:"keydown",KEY_UP:"keyup",BEFORE_UNLOAD:"beforeunload",CHANGE:"change",FOCUS:"focus",BLUR:"blur",INPUT:"input"},ic=function(){function e(i){(0,o._)(this,e),this.domNode=i,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}return(0,l._)(e,[{key:"setMaxWidth",value:function(e){var i=ih(e);this._maxWidth!==i&&(this._maxWidth=i,this.domNode.style.maxWidth=this._maxWidth)}},{key:"setWidth",value:function(e){var i=ih(e);this._width!==i&&(this._width=i,this.domNode.style.width=this._width)}},{key:"setHeight",value:function(e){var i=ih(e);this._height!==i&&(this._height=i,this.domNode.style.height=this._height)}},{key:"setTop",value:function(e){var i=ih(e);this._top!==i&&(this._top=i,this.domNode.style.top=this._top)}},{key:"setLeft",value:function(e){var i=ih(e);this._left!==i&&(this._left=i,this.domNode.style.left=this._left)}},{key:"setBottom",value:function(e){var i=ih(e);this._bottom!==i&&(this._bottom=i,this.domNode.style.bottom=this._bottom)}},{key:"setRight",value:function(e){var i=ih(e);this._right!==i&&(this._right=i,this.domNode.style.right=this._right)}},{key:"setPaddingTop",value:function(e){var i=ih(e);this._paddingTop!==i&&(this._paddingTop=i,this.domNode.style.paddingTop=this._paddingTop)}},{key:"setPaddingLeft",value:function(e){var i=ih(e);this._paddingLeft!==i&&(this._paddingLeft=i,this.domNode.style.paddingLeft=this._paddingLeft)}},{key:"setPaddingBottom",value:function(e){var i=ih(e);this._paddingBottom!==i&&(this._paddingBottom=i,this.domNode.style.paddingBottom=this._paddingBottom)}},{key:"setPaddingRight",value:function(e){var i=ih(e);this._paddingRight!==i&&(this._paddingRight=i,this.domNode.style.paddingRight=this._paddingRight)}},{key:"setFontFamily",value:function(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}},{key:"setFontWeight",value:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}},{key:"setFontSize",value:function(e){var i=ih(e);this._fontSize!==i&&(this._fontSize=i,this.domNode.style.fontSize=this._fontSize)}},{key:"setFontStyle",value:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}},{key:"setFontFeatureSettings",value:function(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}},{key:"setFontVariationSettings",value:function(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}},{key:"setTextDecoration",value:function(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}},{key:"setLineHeight",value:function(e){var i=ih(e);this._lineHeight!==i&&(this._lineHeight=i,this.domNode.style.lineHeight=this._lineHeight)}},{key:"setLetterSpacing",value:function(e){var i=ih(e);this._letterSpacing!==i&&(this._letterSpacing=i,this.domNode.style.letterSpacing=this._letterSpacing)}},{key:"setClassName",value:function(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}},{key:"toggleClassName",value:function(e,i){this.domNode.classList.toggle(e,i),this._className=this.domNode.className}},{key:"setDisplay",value:function(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}},{key:"setPosition",value:function(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}},{key:"setVisibility",value:function(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}},{key:"setColor",value:function(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}},{key:"setBackgroundColor",value:function(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}},{key:"setLayerHinting",value:function(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}},{key:"setBoxShadow",value:function(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}},{key:"setContain",value:function(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}},{key:"setAttribute",value:function(e,i){this.domNode.setAttribute(e,i)}},{key:"removeAttribute",value:function(e){this.domNode.removeAttribute(e)}},{key:"appendChild",value:function(e){this.domNode.appendChild(e.domNode)}},{key:"removeChild",value:function(e){this.domNode.removeChild(e.domNode)}}]),e}();function ih(e){return"number"==typeof e?"".concat(e,"px"):e}function iu(e){return new ic(e)}var id=function(){function e(){(0,o._)(this,e),this._hooks=new ew,this._pointerMoveCallback=null,this._onStopCallback=null}return(0,l._)(e,[{key:"dispose",value:function(){this.stopMonitoring(!1),this._hooks.dispose()}},{key:"stopMonitoring",value:function(e,i){if(this.isMonitoring()){this._hooks.clear(),this._pointerMoveCallback=null;var r=this._onStopCallback;this._onStopCallback=null,e&&r&&r(i)}}},{key:"isMonitoring",value:function(){return!!this._pointerMoveCallback}},{key:"startMonitoring",value:function(e,i,r,n,s){var o=this;this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=n,this._onStopCallback=s;var a=e;try{e.setPointerCapture(i),this._hooks.add(eb(function(){try{e.releasePointerCapture(i)}catch(e){}}))}catch(i){a=t7(e)}this._hooks.add(ii(a,il.POINTER_MOVE,function(e){e.buttons!==r?o.stopMonitoring(!0):(e.preventDefault(),o._pointerMoveCallback(e))})),this._hooks.add(ii(a,il.POINTER_UP,function(e){return o.stopMonitoring(!0)}))}}]),e}();(iJ=i1||(i1={})).Tap="-xterm-gesturetap",iJ.Change="-xterm-gesturechange",iJ.Start="-xterm-gesturestart",iJ.End="-xterm-gesturesend",iJ.Contextmenu="-xterm-gesturecontextmenu";var i_=function(e){function i(){var e;return(0,o._)(this,i),(e=(0,s._)(this,i)).dispatched=!1,e.targets=new eB,e.ignoreTargets=new eB,e.activeTouches={},e.handle=null,e._lastSetTapCountTime=0,e._register(eU.runAndSubscribe(ie,function(i){var r=i.window,n=i.disposables;n.add(ii(r.document,"touchstart",function(i){return e.onTouchStart(i)},{passive:!1})),n.add(ii(r.document,"touchend",function(i){return e.onTouchEnd(r,i)})),n.add(ii(r.document,"touchmove",function(i){return e.onTouchMove(i)},{passive:!1}))},{window:eE,disposables:e._store})),e}return(0,f._)(i,e),(0,l._)(i,[{key:"dispose",value:function(){this.handle&&(this.handle.dispose(),this.handle=null),(0,h._)((0,u._)(i.prototype),"dispose",this).call(this)}},{key:"onTouchStart",value:function(e){var i=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(var r=0,n=e.targetTouches.length;r<n;r++){var s=e.targetTouches.item(r);this.activeTouches[s.identifier]={id:s.identifier,initialTarget:s.target,initialTimeStamp:i,initialPageX:s.pageX,initialPageY:s.pageY,rollingTimestamps:[i],rollingPageX:[s.pageX],rollingPageY:[s.pageY]};var o=this.newGestureEvent(i1.Start,s.target);o.pageX=s.pageX,o.pageY=s.pageY,this.dispatchEvent(o)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}},{key:"onTouchEnd",value:function(e,r){for(var n,s=Date.now(),o=Object.keys(this.activeTouches).length,a=0,l=r.changedTouches.length;a<l;a++)n=this,function(a,l){var c=r.changedTouches.item(a);if(!n.activeTouches.hasOwnProperty(String(c.identifier)))return console.warn("move of an UNKNOWN touch",c);var h=n.activeTouches[c.identifier],u=Date.now()-h.initialTimeStamp;if(u<i.HOLD_DELAY&&30>Math.abs(h.initialPageX-e_(h.rollingPageX))&&30>Math.abs(h.initialPageY-e_(h.rollingPageY))){var f=n.newGestureEvent(i1.Tap,h.initialTarget);f.pageX=e_(h.rollingPageX),f.pageY=e_(h.rollingPageY),n.dispatchEvent(f)}else if(u>=i.HOLD_DELAY&&30>Math.abs(h.initialPageX-e_(h.rollingPageX))&&30>Math.abs(h.initialPageY-e_(h.rollingPageY))){var _=n.newGestureEvent(i1.Contextmenu,h.initialTarget);_.pageX=e_(h.rollingPageX),_.pageY=e_(h.rollingPageY),n.dispatchEvent(_)}else if(1===o){var v=e_(h.rollingPageX),p=e_(h.rollingPageY),y=e_(h.rollingTimestamps)-h.rollingTimestamps[0],m=v-h.rollingPageX[0],S=p-h.rollingPageY[0],k=(0,g._)(n.targets).filter(function(e){return(0,d._)(h.initialTarget,Node)&&e.contains(h.initialTarget)});n.inertia(e,k,s,Math.abs(m)/y,m>0?1:-1,v,Math.abs(S)/y,S>0?1:-1,p)}n.dispatchEvent(n.newGestureEvent(i1.End,h.initialTarget)),delete n.activeTouches[c.identifier]}(a,0);this.dispatched&&(r.preventDefault(),r.stopPropagation(),this.dispatched=!1)}},{key:"newGestureEvent",value:function(e,i){var r=document.createEvent("CustomEvent");return r.initEvent(e,!1,!0),r.initialTarget=i,r.tapCount=0,r}},{key:"dispatchEvent",value:function(e){if(e.type===i1.Tap){var r=new Date().getTime(),n=0;n=r-this._lastSetTapCountTime>i.CLEAR_TAP_COUNT_TIME?1:2,this._lastSetTapCountTime=r,e.tapCount=n}else(e.type===i1.Change||e.type===i1.Contextmenu)&&(this._lastSetTapCountTime=0);if((0,d._)(e.initialTarget,Node)){var s=!0,o=!1,a=void 0;try{for(var l,c=this.ignoreTargets[Symbol.iterator]();!(s=(l=c.next()).done);s=!0)if(l.value.contains(e.initialTarget))return}catch(e){o=!0,a=e}finally{try{s||null==c.return||c.return()}finally{if(o)throw a}}var h=[],u=!0,f=!1,_=void 0;try{for(var g,p=this.targets[Symbol.iterator]();!(u=(g=p.next()).done);u=!0){var y=g.value;if(y.contains(e.initialTarget)){for(var m=0,S=e.initialTarget;S&&S!==y;)m++,S=S.parentElement;h.push([m,y])}}}catch(e){f=!0,_=e}finally{try{u||null==p.return||p.return()}finally{if(f)throw _}}h.sort(function(e,i){return e[0]-i[0]});var k=!0,b=!1,w=void 0;try{for(var C,x=h[Symbol.iterator]();!(k=(C=x.next()).done);k=!0){var E=(0,v._)(C.value,2);(E[0],E[1]).dispatchEvent(e),this.dispatched=!0}}catch(e){b=!0,w=e}finally{try{k||null==x.return||x.return()}finally{if(b)throw w}}}}},{key:"inertia",value:function(e,r,n,s,o,a,l,c,h){var u=this;this.handle=i0(e,function(){var f=Date.now(),d=f-n,_=0,v=0,g=!0;s+=i.SCROLL_FRICTION*d,l+=i.SCROLL_FRICTION*d,s>0&&(g=!1,_=o*s*d),l>0&&(g=!1,v=c*l*d);var p=u.newGestureEvent(i1.Change);p.translationX=_,p.translationY=v,r.forEach(function(e){return e.dispatchEvent(p)}),g||u.inertia(e,r,f,s,o,a+_,l,c,h+v)})}},{key:"onTouchMove",value:function(e){for(var i=Date.now(),r=0,n=e.changedTouches.length;r<n;r++){var s=e.changedTouches.item(r);if(!this.activeTouches.hasOwnProperty(String(s.identifier))){console.warn("end of an UNKNOWN touch",s);continue}var o=this.activeTouches[s.identifier],a=this.newGestureEvent(i1.Change,o.initialTarget);a.translationX=s.pageX-e_(o.rollingPageX),a.translationY=s.pageY-e_(o.rollingPageY),a.pageX=s.pageX,a.pageY=s.pageY,this.dispatchEvent(a),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(s.pageX),o.rollingPageY.push(s.pageY),o.rollingTimestamps.push(i)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}}],[{key:"addTarget",value:function(e){return i.isTouchDevice()?(i.INSTANCE||(i.INSTANCE=new i),eb(i.INSTANCE.targets.push(e))):eC.None}},{key:"ignoreTarget",value:function(e){return i.isTouchDevice()?(i.INSTANCE||(i.INSTANCE=new i),eb(i.INSTANCE.ignoreTargets.push(e))):eC.None}},{key:"isTouchDevice",value:function(){return"ontouchstart"in eE||navigator.maxTouchPoints>0}}]),i}(eC);i_.SCROLL_FRICTION=-.005,i_.HOLD_DELAY=700,i_.CLEAR_TAP_COUNT_TIME=400,w([function(e,i,r){var n=null,s=null;if("function"==typeof r.value?(n="value",0!==(s=r.value).length&&console.warn("Memoize should only be used in functions with zero parameters")):"function"==typeof r.get&&(n="get",s=r.get),!s)throw Error("not supported");var o="$memoize$".concat(i);r[n]=function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,i)}),this[o]}}],i_,"isTouchDevice",1);var iv=function(e){function i(){return(0,o._)(this,i),(0,s._)(this,i,arguments)}return(0,f._)(i,e),(0,l._)(i,[{key:"onclick",value:function(e,i){this._register(ii(e,il.CLICK,function(r){return i(new tj(t7(e),r))}))}},{key:"onmousedown",value:function(e,i){this._register(ii(e,il.MOUSE_DOWN,function(r){return i(new tj(t7(e),r))}))}},{key:"onmouseover",value:function(e,i){this._register(ii(e,il.MOUSE_OVER,function(r){return i(new tj(t7(e),r))}))}},{key:"onmouseleave",value:function(e,i){this._register(ii(e,il.MOUSE_LEAVE,function(r){return i(new tj(t7(e),r))}))}},{key:"onkeydown",value:function(e,i){this._register(ii(e,il.KEY_DOWN,function(e){return i(new tV(e))}))}},{key:"onkeyup",value:function(e,i){this._register(ii(e,il.KEY_UP,function(e){return i(new tV(e))}))}},{key:"oninput",value:function(e,i){this._register(ii(e,il.INPUT,i))}},{key:"onblur",value:function(e,i){this._register(ii(e,il.BLUR,i))}},{key:"onfocus",value:function(e,i){this._register(ii(e,il.FOCUS,i))}},{key:"onchange",value:function(e,i){this._register(ii(e,il.CHANGE,i))}},{key:"ignoreGesture",value:function(e){return i_.ignoreTarget(e)}}]),i}(eC),ig=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._onActivate=e.onActivate,r.bgDomNode=document.createElement("div"),r.bgDomNode.className="arrow-background",r.bgDomNode.style.position="absolute",r.bgDomNode.style.width=e.bgWidth+"px",r.bgDomNode.style.height=e.bgHeight+"px","u">(0,p._)(e.top)&&(r.bgDomNode.style.top="0px"),"u">(0,p._)(e.left)&&(r.bgDomNode.style.left="0px"),"u">(0,p._)(e.bottom)&&(r.bgDomNode.style.bottom="0px"),"u">(0,p._)(e.right)&&(r.bgDomNode.style.right="0px"),r.domNode=document.createElement("div"),r.domNode.className=e.className,r.domNode.style.position="absolute",r.domNode.style.width="11px",r.domNode.style.height="11px","u">(0,p._)(e.top)&&(r.domNode.style.top=e.top+"px"),"u">(0,p._)(e.left)&&(r.domNode.style.left=e.left+"px"),"u">(0,p._)(e.bottom)&&(r.domNode.style.bottom=e.bottom+"px"),"u">(0,p._)(e.right)&&(r.domNode.style.right=e.right+"px"),r._pointerMoveMonitor=r._register(new id),r._register(ir(r.bgDomNode,il.POINTER_DOWN,function(e){return r._arrowPointerDown(e)})),r._register(ir(r.domNode,il.POINTER_DOWN,function(e){return r._arrowPointerDown(e)})),r._pointerdownRepeatTimer=r._register(new is),r._pointerdownScheduleRepeatTimer=r._register(new t$),r}return(0,f._)(i,e),(0,l._)(i,[{key:"_arrowPointerDown",value:function(e){var i=this;e.target&&(0,d._)(e.target,Element)&&(this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(function(){i._pointerdownRepeatTimer.cancelAndSet(function(){return i._onActivate()},1e3/24,t7(e))},200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,function(e){},function(){i._pointerdownRepeatTimer.cancel(),i._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault())}}]),i}(iv),ip=function(){function e(i,r,n,s,a,l,c){(0,o._)(this,e),this._forceIntegerValues=i,this._scrollStateBrand=void 0,this._forceIntegerValues&&(r|=0,n|=0,s|=0,a|=0,l|=0,c|=0),this.rawScrollLeft=s,this.rawScrollTop=c,r<0&&(r=0),s+r>n&&(s=n-r),s<0&&(s=0),a<0&&(a=0),c+a>l&&(c=l-a),c<0&&(c=0),this.width=r,this.scrollWidth=n,this.scrollLeft=s,this.height=a,this.scrollHeight=l,this.scrollTop=c}return(0,l._)(e,[{key:"equals",value:function(e){return this.rawScrollLeft===e.rawScrollLeft&&this.rawScrollTop===e.rawScrollTop&&this.width===e.width&&this.scrollWidth===e.scrollWidth&&this.scrollLeft===e.scrollLeft&&this.height===e.height&&this.scrollHeight===e.scrollHeight&&this.scrollTop===e.scrollTop}},{key:"withScrollDimensions",value:function(i,r){return new e(this._forceIntegerValues,"u">(0,p._)(i.width)?i.width:this.width,"u">(0,p._)(i.scrollWidth)?i.scrollWidth:this.scrollWidth,r?this.rawScrollLeft:this.scrollLeft,"u">(0,p._)(i.height)?i.height:this.height,"u">(0,p._)(i.scrollHeight)?i.scrollHeight:this.scrollHeight,r?this.rawScrollTop:this.scrollTop)}},{key:"withScrollPosition",value:function(i){return new e(this._forceIntegerValues,this.width,this.scrollWidth,"u">(0,p._)(i.scrollLeft)?i.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,"u">(0,p._)(i.scrollTop)?i.scrollTop:this.rawScrollTop)}},{key:"createScrollEvent",value:function(e,i){var r=this.width!==e.width,n=this.scrollWidth!==e.scrollWidth,s=this.scrollLeft!==e.scrollLeft,o=this.height!==e.height,a=this.scrollHeight!==e.scrollHeight,l=this.scrollTop!==e.scrollTop;return{inSmoothScrolling:i,oldWidth:e.width,oldScrollWidth:e.scrollWidth,oldScrollLeft:e.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:e.height,oldScrollHeight:e.scrollHeight,oldScrollTop:e.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:r,scrollWidthChanged:n,scrollLeftChanged:s,heightChanged:o,scrollHeightChanged:a,scrollTopChanged:l}}}]),e}(),iy=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._scrollableBrand=void 0,r._onScroll=r._register(new e4),r.onScroll=r._onScroll.event,r._smoothScrollDuration=e.smoothScrollDuration,r._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,r._state=new ip(e.forceIntegerValues,0,0,0,0,0,0),r._smoothScrolling=null,r}return(0,f._)(i,e),(0,l._)(i,[{key:"dispose",value:function(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),(0,h._)((0,u._)(i.prototype),"dispose",this).call(this)}},{key:"setSmoothScrollDuration",value:function(e){this._smoothScrollDuration=e}},{key:"validateScrollPosition",value:function(e){return this._state.withScrollPosition(e)}},{key:"getScrollDimensions",value:function(){return this._state}},{key:"setScrollDimensions",value:function(e,i){var r,n=this._state.withScrollDimensions(e,i);this._setState(n,!!this._smoothScrolling),null==(r=this._smoothScrolling)||r.acceptScrollDimensions(this._state)}},{key:"getFutureScrollPosition",value:function(){return this._smoothScrolling?this._smoothScrolling.to:this._state}},{key:"getCurrentScrollPosition",value:function(){return this._state}},{key:"setScrollPositionNow",value:function(e){var i=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(i,!1)}},{key:"setScrollPositionSmooth",value:function(e,i){var r=this;if(0===this._smoothScrollDuration)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:(0,p._)(e.scrollLeft)>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:(0,p._)(e.scrollTop)>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};var n,s=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===s.scrollLeft&&this._smoothScrolling.to.scrollTop===s.scrollTop)return;n=i?new ik(this._smoothScrolling.from,s,this._smoothScrolling.startTime,this._smoothScrolling.duration):this._smoothScrolling.combine(this._state,s,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=n}else{var o=this._state.withScrollPosition(e);this._smoothScrolling=ik.start(this._state,o,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(function(){r._smoothScrolling&&(r._smoothScrolling.animationFrameDisposable=null,r._performSmoothScrolling())})}},{key:"hasPendingScrollAnimation",value:function(){return!!this._smoothScrolling}},{key:"_performSmoothScrolling",value:function(){var e=this;if(this._smoothScrolling){var i=this._smoothScrolling.tick(),r=this._state.withScrollPosition(i);if(this._setState(r,!0),this._smoothScrolling){if(i.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(function(){e._smoothScrolling&&(e._smoothScrolling.animationFrameDisposable=null,e._performSmoothScrolling())})}}}},{key:"_setState",value:function(e,i){var r=this._state;r.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(r,i)))}}]),i}(eC),im=function e(i,r,n){(0,o._)(this,e),this.scrollLeft=i,this.scrollTop=r,this.isDone=n};function iS(e,i){var r=i-e;return function(i){return e+r*(1-Math.pow(1-i,3))}}var ik=function(){function e(i,r,n,s){(0,o._)(this,e),this.from=i,this.to=r,this.duration=s,this.startTime=n,this.animationFrameDisposable=null,this._initAnimations()}return(0,l._)(e,[{key:"_initAnimations",value:function(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}},{key:"_initAnimation",value:function(e,i,r){if(Math.abs(e-i)>2.5*r){var n,s,o,a;return e<i?(n=e+.75*r,s=i-.75*r):(n=e-.75*r,s=i+.75*r),o=iS(e,n),a=iS(s,i),function(e){return e<.33?o(e/.33):a((e-.33)/(1-.33))}}return iS(e,i)}},{key:"dispose",value:function(){null!==this.animationFrameDisposable&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}},{key:"acceptScrollDimensions",value:function(e){this.to=e.withScrollPosition(this.to),this._initAnimations()}},{key:"tick",value:function(){return this._tick(Date.now())}},{key:"_tick",value:function(e){var i=(e-this.startTime)/this.duration;return i<1?new im(this.scrollLeft(i),this.scrollTop(i),!1):new im(this.to.scrollLeft,this.to.scrollTop,!0)}},{key:"combine",value:function(i,r,n){return e.start(i,r,n)}}],[{key:"start",value:function(i,r,n){return n+=10,new e(i,r,Date.now()-10,n)}}]),e}(),ib=function(e){function i(e,r,n){var a;return(0,o._)(this,i),(a=(0,s._)(this,i))._visibility=e,a._visibleClassName=r,a._invisibleClassName=n,a._domNode=null,a._isVisible=!1,a._isNeeded=!1,a._rawShouldBeVisible=!1,a._shouldBeVisible=!1,a._revealTimer=a._register(new t$),a}return(0,f._)(i,e),(0,l._)(i,[{key:"setVisibility",value:function(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}},{key:"setShouldBeVisible",value:function(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}},{key:"_applyVisibilitySetting",value:function(){return 2!==this._visibility&&(3===this._visibility||this._rawShouldBeVisible)}},{key:"_updateShouldBeVisible",value:function(){var e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}},{key:"setIsNeeded",value:function(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}},{key:"setDomNode",value:function(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}},{key:"ensureVisibility",value:function(){this._isNeeded?this._shouldBeVisible?this._reveal():this._hide(!0):this._hide(!1)}},{key:"_reveal",value:function(){var e=this;this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(function(){var i;null==(i=e._domNode)||i.setClassName(e._visibleClassName)},0))}},{key:"_hide",value:function(e){var i;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,null==(i=this._domNode)||i.setClassName(this._invisibleClassName+(e?" fade":"")))}}]),i}(eC),iw=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._lazyRender=e.lazyRender,r._host=e.host,r._scrollable=e.scrollable,r._scrollByPage=e.scrollByPage,r._scrollbarState=e.scrollbarState,r._visibilityController=r._register(new ib(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),r._visibilityController.setIsNeeded(r._scrollbarState.isNeeded()),r._pointerMoveMonitor=r._register(new id),r._shouldRender=!0,r.domNode=iu(document.createElement("div")),r.domNode.setAttribute("role","presentation"),r.domNode.setAttribute("aria-hidden","true"),r._visibilityController.setDomNode(r.domNode),r.domNode.setPosition("absolute"),r._register(ii(r.domNode.domNode,il.POINTER_DOWN,function(e){return r._domNodePointerDown(e)})),r}return(0,f._)(i,e),(0,l._)(i,[{key:"_createArrow",value:function(e){var i=this._register(new ig(e));this.domNode.domNode.appendChild(i.bgDomNode),this.domNode.domNode.appendChild(i.domNode)}},{key:"_createSlider",value:function(e,i,r,n){var s=this;this.slider=iu(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(i),"number"==typeof r&&this.slider.setWidth(r),"number"==typeof n&&this.slider.setHeight(n),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(ii(this.slider.domNode,il.POINTER_DOWN,function(e){0===e.button&&(e.preventDefault(),s._sliderPointerDown(e))})),this.onclick(this.slider.domNode,function(e){e.leftButton&&e.stopPropagation()})}},{key:"_onElementSize",value:function(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}},{key:"_onElementScrollSize",value:function(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}},{key:"_onElementScrollPosition",value:function(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}},{key:"beginReveal",value:function(){this._visibilityController.setShouldBeVisible(!0)}},{key:"beginHide",value:function(){this._visibilityController.setShouldBeVisible(!1)}},{key:"render",value:function(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}},{key:"_domNodePointerDown",value:function(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}},{key:"delegatePointerDown",value:function(e){var i=this.domNode.domNode.getClientRects()[0].top,r=i+this._scrollbarState.getSliderPosition(),n=i+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),s=this._sliderPointerPosition(e);r<=s&&s<=n?0===e.button&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}},{key:"_onPointerDown",value:function(e){if(e.target===this.domNode.domNode&&"number"==typeof e.offsetX&&"number"==typeof e.offsetY)s=e.offsetX,o=e.offsetY;else{var i,r,n,s,o,a=(r=(i=this.domNode.domNode).getBoundingClientRect(),n=t7(i),{left:r.left+n.scrollX,top:r.top+n.scrollY,width:r.width,height:r.height});s=e.pageX-a.left,o=e.pageY-a.top}var l=this._pointerDownRelativePosition(s,o);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(l):this._scrollbarState.getDesiredScrollPositionFromOffset(l)),0===e.button&&(e.preventDefault(),this._sliderPointerDown(e))}},{key:"_sliderPointerDown",value:function(e){var i=this;if(e.target&&(0,d._)(e.target,Element)){var r=this._sliderPointerPosition(e),n=this._sliderOrthogonalPointerPosition(e),s=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,function(e){var o=Math.abs(i._sliderOrthogonalPointerPosition(e)-n);if(tk&&o>140)return void i._setDesiredScrollPositionNow(s.getScrollPosition());var a=i._sliderPointerPosition(e)-r;i._setDesiredScrollPositionNow(s.getDesiredScrollPositionFromDelta(a))},function(){i.slider.toggleClassName("active",!1),i._host.onDragEnd()}),this._host.onDragStart()}}},{key:"_setDesiredScrollPositionNow",value:function(e){var i={};this.writeScrollPosition(i,e),this._scrollable.setScrollPositionNow(i)}},{key:"updateScrollbarSize",value:function(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}},{key:"isNeeded",value:function(){return this._scrollbarState.isNeeded()}}]),i}(iv),iC=function(){function e(i,r,n,s,a,l){(0,o._)(this,e),this._scrollbarSize=Math.round(r),this._oppositeScrollbarSize=Math.round(n),this._arrowSize=Math.round(i),this._visibleSize=s,this._scrollSize=a,this._scrollPosition=l,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}return(0,l._)(e,[{key:"clone",value:function(){return new e(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}},{key:"setVisibleSize",value:function(e){var i=Math.round(e);return this._visibleSize!==i&&(this._visibleSize=i,this._refreshComputedValues(),!0)}},{key:"setScrollSize",value:function(e){var i=Math.round(e);return this._scrollSize!==i&&(this._scrollSize=i,this._refreshComputedValues(),!0)}},{key:"setScrollPosition",value:function(e){var i=Math.round(e);return this._scrollPosition!==i&&(this._scrollPosition=i,this._refreshComputedValues(),!0)}},{key:"setScrollbarSize",value:function(e){this._scrollbarSize=Math.round(e)}},{key:"setOppositeScrollbarSize",value:function(e){this._oppositeScrollbarSize=Math.round(e)}},{key:"_refreshComputedValues",value:function(){var i=e._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=i.computedAvailableSize,this._computedIsNeeded=i.computedIsNeeded,this._computedSliderSize=i.computedSliderSize,this._computedSliderRatio=i.computedSliderRatio,this._computedSliderPosition=i.computedSliderPosition}},{key:"getArrowSize",value:function(){return this._arrowSize}},{key:"getScrollPosition",value:function(){return this._scrollPosition}},{key:"getRectangleLargeSize",value:function(){return this._computedAvailableSize}},{key:"getRectangleSmallSize",value:function(){return this._scrollbarSize}},{key:"isNeeded",value:function(){return this._computedIsNeeded}},{key:"getSliderSize",value:function(){return this._computedSliderSize}},{key:"getSliderPosition",value:function(){return this._computedSliderPosition}},{key:"getDesiredScrollPositionFromOffset",value:function(e){return this._computedIsNeeded?Math.round((e-this._arrowSize-this._computedSliderSize/2)/this._computedSliderRatio):0}},{key:"getDesiredScrollPositionFromOffsetPaged",value:function(e){if(!this._computedIsNeeded)return 0;var i=e-this._arrowSize,r=this._scrollPosition;return i<this._computedSliderPosition?r-=this._visibleSize:r+=this._visibleSize,r}},{key:"getDesiredScrollPositionFromDelta",value:function(e){return this._computedIsNeeded?Math.round((this._computedSliderPosition+e)/this._computedSliderRatio):0}}],[{key:"_computeValues",value:function(e,i,r,n,s){var o=Math.max(0,r-e),a=Math.max(0,o-2*i),l=n>0&&n>r;if(!l)return{computedAvailableSize:Math.round(o),computedIsNeeded:l,computedSliderSize:Math.round(a),computedSliderRatio:0,computedSliderPosition:0};var c=Math.round(Math.max(20,Math.floor(r*a/n))),h=(a-c)/(n-r);return{computedAvailableSize:Math.round(o),computedIsNeeded:l,computedSliderSize:Math.round(c),computedSliderRatio:h,computedSliderPosition:Math.round(s*h)}}}]),e}(),ix=function(e){function i(e,r,n){(0,o._)(this,i);var a,l=e.getScrollDimensions(),c=e.getCurrentScrollPosition();if(a=(0,s._)(this,i,[{lazyRender:r.lazyRender,host:n,scrollbarState:new iC(r.horizontalHasArrows?r.arrowSize:0,2===r.horizontal?0:r.horizontalScrollbarSize,2===r.vertical?0:r.verticalScrollbarSize,l.width,l.scrollWidth,c.scrollLeft),visibility:r.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:r.scrollByPage}]),r.horizontalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");return a._createSlider(Math.floor((r.horizontalScrollbarSize-r.horizontalSliderSize)/2),0,void 0,r.horizontalSliderSize),a}return(0,f._)(i,e),(0,l._)(i,[{key:"_updateSlider",value:function(e,i){this.slider.setWidth(e),this.slider.setLeft(i)}},{key:"_renderDomNode",value:function(e,i){this.domNode.setWidth(e),this.domNode.setHeight(i),this.domNode.setLeft(0),this.domNode.setBottom(0)}},{key:"onDidScroll",value:function(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}},{key:"_pointerDownRelativePosition",value:function(e,i){return e}},{key:"_sliderPointerPosition",value:function(e){return e.pageX}},{key:"_sliderOrthogonalPointerPosition",value:function(e){return e.pageY}},{key:"_updateScrollbarSize",value:function(e){this.slider.setHeight(e)}},{key:"writeScrollPosition",value:function(e,i){e.scrollLeft=i}},{key:"updateOptions",value:function(e){this.updateScrollbarSize(2===e.horizontal?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(2===e.vertical?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}}]),i}(iw),iE=function(e){function i(e,r,n){(0,o._)(this,i);var a,l=e.getScrollDimensions(),c=e.getCurrentScrollPosition();if(a=(0,s._)(this,i,[{lazyRender:r.lazyRender,host:n,scrollbarState:new iC(r.verticalHasArrows?r.arrowSize:0,2===r.vertical?0:r.verticalScrollbarSize,0,l.height,l.scrollHeight,c.scrollTop),visibility:r.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:r.scrollByPage}]),r.verticalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");return a._createSlider(0,Math.floor((r.verticalScrollbarSize-r.verticalSliderSize)/2),r.verticalSliderSize,void 0),a}return(0,f._)(i,e),(0,l._)(i,[{key:"_updateSlider",value:function(e,i){this.slider.setHeight(e),this.slider.setTop(i)}},{key:"_renderDomNode",value:function(e,i){this.domNode.setWidth(i),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}},{key:"onDidScroll",value:function(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}},{key:"_pointerDownRelativePosition",value:function(e,i){return i}},{key:"_sliderPointerPosition",value:function(e){return e.pageY}},{key:"_sliderOrthogonalPointerPosition",value:function(e){return e.pageX}},{key:"_updateScrollbarSize",value:function(e){this.slider.setWidth(e)}},{key:"writeScrollPosition",value:function(e,i){e.scrollTop=i}},{key:"updateOptions",value:function(e){this.updateScrollbarSize(2===e.vertical?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}}]),i}(iw),iD=function e(i,r,n){(0,o._)(this,e),this.timestamp=i,this.deltaX=r,this.deltaY=n,this.score=0},iB=function(){function e(){(0,o._)(this,e),this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}return(0,l._)(e,[{key:"isPhysicalMouseWheel",value:function(){if(-1===this._front&&-1===this._rear)return!1;for(var e=1,i=0,r=1,n=this._rear;;){var s=n===this._front?e:Math.pow(2,-r);if(e-=s,i+=this._memory[n].score*s,n===this._front)break;n=(this._capacity+n-1)%this._capacity,r++}return i<=.5}},{key:"acceptStandardWheelEvent",value:function(e){if(ti){var i,r=(i=t7(e.browserEvent),e7.INSTANCE.getZoomFactor(i));this.accept(Date.now(),e.deltaX*r,e.deltaY*r)}else this.accept(Date.now(),e.deltaX,e.deltaY)}},{key:"accept",value:function(e,i,r){var n=null,s=new iD(e,i,r);-1===this._front&&-1===this._rear?(this._memory[0]=s,this._front=0,this._rear=0):(n=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=s),s.score=this._computeScore(s,n)}},{key:"_computeScore",value:function(e,i){if(Math.abs(e.deltaX)>0&&Math.abs(e.deltaY)>0)return 1;var r=.5;if(this._isAlmostInt(e.deltaX)&&this._isAlmostInt(e.deltaY)||(r+=.25),i){var n=Math.abs(e.deltaX),s=Math.abs(e.deltaY),o=Math.abs(i.deltaX),a=Math.abs(i.deltaY),l=Math.max(Math.min(n,o),1),c=Math.max(Math.min(s,a),1),h=Math.max(s,a);Math.max(n,o)%l==0&&h%c==0&&(r-=.5)}return Math.min(Math.max(r,0),1)}},{key:"_isAlmostInt",value:function(e){return .01>Math.abs(Math.round(e)-e)}}]),e}();iB.INSTANCE=new iB;var iR=function(e){function i(e,r,n){return(0,o._)(this,i),(0,s._)(this,i,[e,r,n])}return(0,f._)(i,e),(0,l._)(i,[{key:"setScrollPosition",value:function(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}},{key:"getScrollPosition",value:function(){return this._scrollable.getCurrentScrollPosition()}}]),i}(function(e){function i(e,r,n){(0,o._)(this,i),(c=(0,s._)(this,i))._onScroll=c._register(new e4),c.onScroll=c._onScroll.event,c._onWillScroll=c._register(new e4),c.onWillScroll=c._onWillScroll.event,a=r,(l={lazyRender:"u">(0,p._)(a.lazyRender)&&a.lazyRender,className:"u">(0,p._)(a.className)?a.className:"",useShadows:!("u">(0,p._)(a.useShadows))||a.useShadows,handleMouseWheel:!("u">(0,p._)(a.handleMouseWheel))||a.handleMouseWheel,flipAxes:"u">(0,p._)(a.flipAxes)&&a.flipAxes,consumeMouseWheelIfScrollbarIsNeeded:"u">(0,p._)(a.consumeMouseWheelIfScrollbarIsNeeded)&&a.consumeMouseWheelIfScrollbarIsNeeded,alwaysConsumeMouseWheel:"u">(0,p._)(a.alwaysConsumeMouseWheel)&&a.alwaysConsumeMouseWheel,scrollYToX:"u">(0,p._)(a.scrollYToX)&&a.scrollYToX,mouseWheelScrollSensitivity:"u">(0,p._)(a.mouseWheelScrollSensitivity)?a.mouseWheelScrollSensitivity:1,fastScrollSensitivity:"u">(0,p._)(a.fastScrollSensitivity)?a.fastScrollSensitivity:5,scrollPredominantAxis:!("u">(0,p._)(a.scrollPredominantAxis))||a.scrollPredominantAxis,mouseWheelSmoothScroll:!("u">(0,p._)(a.mouseWheelSmoothScroll))||a.mouseWheelSmoothScroll,arrowSize:"u">(0,p._)(a.arrowSize)?a.arrowSize:11,listenOnDomNode:"u">(0,p._)(a.listenOnDomNode)?a.listenOnDomNode:null,horizontal:"u">(0,p._)(a.horizontal)?a.horizontal:1,horizontalScrollbarSize:"u">(0,p._)(a.horizontalScrollbarSize)?a.horizontalScrollbarSize:10,horizontalSliderSize:"u">(0,p._)(a.horizontalSliderSize)?a.horizontalSliderSize:0,horizontalHasArrows:"u">(0,p._)(a.horizontalHasArrows)&&a.horizontalHasArrows,vertical:"u">(0,p._)(a.vertical)?a.vertical:1,verticalScrollbarSize:"u">(0,p._)(a.verticalScrollbarSize)?a.verticalScrollbarSize:10,verticalHasArrows:"u">(0,p._)(a.verticalHasArrows)&&a.verticalHasArrows,verticalSliderSize:"u">(0,p._)(a.verticalSliderSize)?a.verticalSliderSize:0,scrollByPage:"u">(0,p._)(a.scrollByPage)&&a.scrollByPage}).horizontalSliderSize="u">(0,p._)(a.horizontalSliderSize)?a.horizontalSliderSize:l.horizontalScrollbarSize,l.verticalSliderSize="u">(0,p._)(a.verticalSliderSize)?a.verticalSliderSize:l.verticalScrollbarSize,tb&&(l.className+=" mac"),c._options=l,c._scrollable=n,c._register(c._scrollable.onScroll(function(e){c._onWillScroll.fire(e),c._onDidScroll(e),c._onScroll.fire(e)}));var a,l,c,h={onMouseWheel:function(e){return c._onMouseWheel(e)},onDragStart:function(){return c._onDragStart()},onDragEnd:function(){return c._onDragEnd()}};return c._verticalScrollbar=c._register(new iE(c._scrollable,c._options,h)),c._horizontalScrollbar=c._register(new ix(c._scrollable,c._options,h)),c._domNode=document.createElement("div"),c._domNode.className="xterm-scrollable-element "+c._options.className,c._domNode.setAttribute("role","presentation"),c._domNode.style.position="relative",c._domNode.appendChild(e),c._domNode.appendChild(c._horizontalScrollbar.domNode.domNode),c._domNode.appendChild(c._verticalScrollbar.domNode.domNode),c._options.useShadows?(c._leftShadowDomNode=iu(document.createElement("div")),c._leftShadowDomNode.setClassName("shadow"),c._domNode.appendChild(c._leftShadowDomNode.domNode),c._topShadowDomNode=iu(document.createElement("div")),c._topShadowDomNode.setClassName("shadow"),c._domNode.appendChild(c._topShadowDomNode.domNode),c._topLeftShadowDomNode=iu(document.createElement("div")),c._topLeftShadowDomNode.setClassName("shadow"),c._domNode.appendChild(c._topLeftShadowDomNode.domNode)):(c._leftShadowDomNode=null,c._topShadowDomNode=null,c._topLeftShadowDomNode=null),c._listenOnDomNode=c._options.listenOnDomNode||c._domNode,c._mouseWheelToDispose=[],c._setListeningToMouseWheel(c._options.handleMouseWheel),c.onmouseover(c._listenOnDomNode,function(e){return c._onMouseOver(e)}),c.onmouseleave(c._listenOnDomNode,function(e){return c._onMouseLeave(e)}),c._hideTimeout=c._register(new t$),c._isDragging=!1,c._mouseIsOver=!1,c._shouldRender=!0,c._revealOnScroll=!0,c}return(0,f._)(i,e),(0,l._)(i,[{key:"options",get:function(){return this._options}},{key:"dispose",value:function(){this._mouseWheelToDispose=eS(this._mouseWheelToDispose),(0,h._)((0,u._)(i.prototype),"dispose",this).call(this)}},{key:"getDomNode",value:function(){return this._domNode}},{key:"getOverviewRulerLayoutInfo",value:function(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}},{key:"delegateVerticalScrollbarPointerDown",value:function(e){this._verticalScrollbar.delegatePointerDown(e)}},{key:"getScrollDimensions",value:function(){return this._scrollable.getScrollDimensions()}},{key:"setScrollDimensions",value:function(e){this._scrollable.setScrollDimensions(e,!1)}},{key:"updateClassName",value:function(e){this._options.className=e,tb&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}},{key:"updateOptions",value:function(e){"u">(0,p._)(e.handleMouseWheel)&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),"u">(0,p._)(e.mouseWheelScrollSensitivity)&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),"u">(0,p._)(e.fastScrollSensitivity)&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),"u">(0,p._)(e.scrollPredominantAxis)&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),"u">(0,p._)(e.horizontal)&&(this._options.horizontal=e.horizontal),"u">(0,p._)(e.vertical)&&(this._options.vertical=e.vertical),"u">(0,p._)(e.horizontalScrollbarSize)&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),"u">(0,p._)(e.verticalScrollbarSize)&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),"u">(0,p._)(e.scrollByPage)&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}},{key:"setRevealOnScroll",value:function(e){this._revealOnScroll=e}},{key:"delegateScrollFromMouseWheelEvent",value:function(e){this._onMouseWheel(new tG(e))}},{key:"_setListeningToMouseWheel",value:function(e){var i=this;this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=eS(this._mouseWheelToDispose),e)&&this._mouseWheelToDispose.push(ii(this._listenOnDomNode,il.MOUSE_WHEEL,function(e){i._onMouseWheel(new tG(e))},{passive:!1}))}},{key:"_onMouseWheel",value:function(e){if(null==(n=e.browserEvent)||!n.defaultPrevented){var i=iB.INSTANCE;i.acceptStandardWheelEvent(e);var r=!1;if(e.deltaY||e.deltaX){var n,s,o=e.deltaY*this._options.mouseWheelScrollSensitivity,a=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&a+o===0?a=o=0:Math.abs(o)>=Math.abs(a)?a=0:o=0),this._options.flipAxes&&(o=(s=[a,o])[0],a=s[1]);var l=!tb&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||l)&&!a&&(a=o,o=0),e.browserEvent&&e.browserEvent.altKey&&(a*=this._options.fastScrollSensitivity,o*=this._options.fastScrollSensitivity);var c=this._scrollable.getFutureScrollPosition(),h={};if(o){var u=50*o,f=c.scrollTop-(u<0?Math.floor(u):Math.ceil(u));this._verticalScrollbar.writeScrollPosition(h,f)}if(a){var d=50*a,_=c.scrollLeft-(d<0?Math.floor(d):Math.ceil(d));this._horizontalScrollbar.writeScrollPosition(h,_)}h=this._scrollable.validateScrollPosition(h),(c.scrollLeft!==h.scrollLeft||c.scrollTop!==h.scrollTop)&&(this._options.mouseWheelSmoothScroll&&i.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(h):this._scrollable.setScrollPositionNow(h),r=!0)}var v=r;!v&&this._options.alwaysConsumeMouseWheel&&(v=!0),!v&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(v=!0),v&&(e.preventDefault(),e.stopPropagation())}}},{key:"_onDidScroll",value:function(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}},{key:"renderNow",value:function(){if(!this._options.lazyRender)throw Error("Please use `lazyRender` together with `renderNow`!");this._render()}},{key:"_render",value:function(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){var e=this._scrollable.getCurrentScrollPosition(),i=e.scrollTop>0,r=e.scrollLeft>0,n=r?" left":"",s=i?" top":"";this._leftShadowDomNode.setClassName("shadow".concat(n)),this._topShadowDomNode.setClassName("shadow".concat(s)),this._topLeftShadowDomNode.setClassName("shadow".concat(r||i?" top-left-corner":"").concat(s).concat(n))}}},{key:"_onDragStart",value:function(){this._isDragging=!0,this._reveal()}},{key:"_onDragEnd",value:function(){this._isDragging=!1,this._hide()}},{key:"_onMouseLeave",value:function(e){this._mouseIsOver=!1,this._hide()}},{key:"_onMouseOver",value:function(e){this._mouseIsOver=!0,this._reveal()}},{key:"_reveal",value:function(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}},{key:"_hide",value:function(){this._mouseIsOver||this._isDragging||(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}},{key:"_scheduleHide",value:function(){var e=this;this._mouseIsOver||this._isDragging||this._hideTimeout.cancelAndSet(function(){return e._hide()},500)}}]),i}(iv)),iM=function(e){function i(e,r,n,a,l,c,h,u){(0,o._)(this,i),(f=(0,s._)(this,i))._bufferService=n,f._optionsService=h,f._renderService=u,f._onRequestScrollLines=f._register(new e4),f.onRequestScrollLines=f._onRequestScrollLines.event,f._isSyncing=!1,f._isHandlingScroll=!1,f._suppressOnScrollHandler=!1;var f,d=f._register(new iy({forceIntegerValues:!1,smoothScrollDuration:f._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:function(e){return i0(a.window,e)}}));return f._register(f._optionsService.onSpecificOptionChange("smoothScrollDuration",function(){d.setSmoothScrollDuration(f._optionsService.rawOptions.smoothScrollDuration)})),f._scrollableElement=f._register(new iR(r,(0,_._)({vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0},f._getChangeOptions()),d)),f._register(f._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],function(){return f._scrollableElement.updateOptions(f._getChangeOptions())})),f._register(l.onProtocolChange(function(e){f._scrollableElement.updateOptions({handleMouseWheel:!(16&e)})})),f._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),f._register(eU.runAndSubscribe(c.onChangeColors,function(){f._scrollableElement.getDomNode().style.backgroundColor=c.colors.background.css})),e.appendChild(f._scrollableElement.getDomNode()),f._register(eb(function(){return f._scrollableElement.getDomNode().remove()})),f._styleElement=a.mainDocument.createElement("style"),r.appendChild(f._styleElement),f._register(eb(function(){return f._styleElement.remove()})),f._register(eU.runAndSubscribe(c.onChangeColors,function(){f._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {","  background: ".concat(c.colors.scrollbarSliderBackground.css,";"),"}\n.xterm .xterm-scrollable-element > .scrollbar > .slider:hover {","  background: ".concat(c.colors.scrollbarSliderHoverBackground.css,";"),"}\n.xterm .xterm-scrollable-element > .scrollbar > .slider.active {","  background: ".concat(c.colors.scrollbarSliderActiveBackground.css,";"),"}"].join("\n")})),f._register(f._bufferService.onResize(function(){return f.queueSync()})),f._register(f._bufferService.buffers.onBufferActivate(function(){f._latestYDisp=void 0,f.queueSync()})),f._register(f._bufferService.onScroll(function(){return f._sync()})),f._register(f._scrollableElement.onScroll(function(e){return f._handleScroll(e)})),f}return(0,f._)(i,e),(0,l._)(i,[{key:"scrollLines",value:function(e){var i=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:i.scrollTop+e*this._renderService.dimensions.css.cell.height})}},{key:"scrollToLine",value:function(e,i){i&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!i,scrollTop:e*this._renderService.dimensions.css.cell.height})}},{key:"_getChangeOptions",value:function(){var e;return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:(null==(e=this._optionsService.rawOptions.overviewRuler)?void 0:e.width)||14}}},{key:"queueSync",value:function(e){var i=this;void 0!==e&&(this._latestYDisp=e),void 0===this._queuedAnimationFrame&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(function(){i._queuedAnimationFrame=void 0,i._sync(i._latestYDisp)}))}},{key:"_sync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._bufferService.buffer.ydisp;!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}},{key:"_handleScroll",value:function(e){if(this._renderService&&!this._isHandlingScroll&&!this._suppressOnScrollHandler){this._isHandlingScroll=!0;var i=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),r=i-this._bufferService.buffer.ydisp;0!==r&&(this._latestYDisp=i,this._onRequestScrollLines.fire(r)),this._isHandlingScroll=!1}}}]),i}(eC);iM=w([C(2,U),C(3,et),C(4,q),C(5,eo),C(6,G),C(7,er)],iM);var iL=function(e){function i(e,r,n,a,l){var c;return(0,o._)(this,i),(c=(0,s._)(this,i))._screenElement=e,c._bufferService=r,c._coreBrowserService=n,c._decorationService=a,c._renderService=l,c._decorationElements=new Map,c._altBufferIsActive=!1,c._dimensionsChanged=!1,c._container=document.createElement("div"),c._container.classList.add("xterm-decoration-container"),c._screenElement.appendChild(c._container),c._register(c._renderService.onRenderedViewportChange(function(){return c._doRefreshDecorations()})),c._register(c._renderService.onDimensionsChange(function(){c._dimensionsChanged=!0,c._queueRefresh()})),c._register(c._coreBrowserService.onDprChange(function(){return c._queueRefresh()})),c._register(c._bufferService.buffers.onBufferActivate(function(){c._altBufferIsActive=c._bufferService.buffer===c._bufferService.buffers.alt})),c._register(c._decorationService.onDecorationRegistered(function(){return c._queueRefresh()})),c._register(c._decorationService.onDecorationRemoved(function(e){return c._removeDecoration(e)})),c._register(eb(function(){c._container.remove(),c._decorationElements.clear()})),c}return(0,f._)(i,e),(0,l._)(i,[{key:"_queueRefresh",value:function(){var e=this;void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback(function(){e._doRefreshDecorations(),e._animationFrame=void 0}))}},{key:"_doRefreshDecorations",value:function(){var e=!0,i=!1,r=void 0;try{for(var n,s=this._decorationService.decorations[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var o=n.value;this._renderDecoration(o)}}catch(e){i=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(i)throw r}}this._dimensionsChanged=!1}},{key:"_renderDecoration",value:function(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}},{key:"_createElement",value:function(e){var i,r,n=this._coreBrowserService.mainDocument.createElement("div");n.classList.add("xterm-decoration"),n.classList.toggle("xterm-decoration-top-layer",(null==e||null==(i=e.options)?void 0:i.layer)==="top"),n.style.width="".concat(Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width),"px"),n.style.height="".concat((e.options.height||1)*this._renderService.dimensions.css.cell.height,"px"),n.style.top="".concat((e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height,"px"),n.style.lineHeight="".concat(this._renderService.dimensions.css.cell.height,"px");var s=null!=(r=e.options.x)?r:0;return s&&s>this._bufferService.cols&&(n.style.display="none"),this._refreshXPosition(e,n),n}},{key:"_refreshStyle",value:function(e){var i=this,r=e.marker.line-this._bufferService.buffers.active.ydisp;if(r<0||r>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{var n=this._decorationElements.get(e);n||(n=this._createElement(e),e.element=n,this._decorationElements.set(e,n),this._container.appendChild(n),e.onDispose(function(){i._decorationElements.delete(e),n.remove()})),n.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(n.style.width="".concat(Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width),"px"),n.style.height="".concat((e.options.height||1)*this._renderService.dimensions.css.cell.height,"px"),n.style.top="".concat(r*this._renderService.dimensions.css.cell.height,"px"),n.style.lineHeight="".concat(this._renderService.dimensions.css.cell.height,"px")),e.onRenderEmitter.fire(n)}}},{key:"_refreshXPosition",value:function(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.element;if(r){var n=null!=(i=e.options.x)?i:0;"right"===(e.options.anchor||"left")?r.style.right=n?"".concat(n*this._renderService.dimensions.css.cell.width,"px"):"":r.style.left=n?"".concat(n*this._renderService.dimensions.css.cell.width,"px"):""}}},{key:"_removeDecoration",value:function(e){var i;null==(i=this._decorationElements.get(e))||i.remove(),this._decorationElements.delete(e),e.dispose()}}]),i}(eC);iL=w([C(1,U),C(2,et),C(3,$),C(4,er)],iL);var iP=function(){function e(){(0,o._)(this,e),this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}return(0,l._)(e,[{key:"zones",get:function(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}},{key:"clear",value:function(){this._zones.length=0,this._zonePoolIndex=0}},{key:"addDecoration",value:function(e){if(e.options.overviewRulerOptions){var i=!0,r=!1,n=void 0;try{for(var s,o=this._zones[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var a=s.value;if(a.color===e.options.overviewRulerOptions.color&&a.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(a,e.marker.line))return;if(this._lineAdjacentToZone(a,e.marker.line,e.options.overviewRulerOptions.position))return void this._addLineToZone(a,e.marker.line)}}}catch(e){r=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw n}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}},{key:"setPadding",value:function(e){this._linePadding=e}},{key:"_lineIntersectsZone",value:function(e,i){return i>=e.startBufferLine&&i<=e.endBufferLine}},{key:"_lineAdjacentToZone",value:function(e,i,r){return i>=e.startBufferLine-this._linePadding[r||"full"]&&i<=e.endBufferLine+this._linePadding[r||"full"]}},{key:"_addLineToZone",value:function(e,i){e.startBufferLine=Math.min(e.startBufferLine,i),e.endBufferLine=Math.max(e.endBufferLine,i)}}]),e}(),iT={full:0,left:0,center:0,right:0},iA={full:0,left:0,center:0,right:0},iO={full:0,left:0,center:0,right:0},iI=function(e){function i(e,r,n,a,l,c,h,u){(0,o._)(this,i),(f=(0,s._)(this,i))._viewportElement=e,f._screenElement=r,f._bufferService=n,f._decorationService=a,f._renderService=l,f._optionsService=c,f._themeService=h,f._coreBrowserService=u,f._colorZoneStore=new iP,f._shouldUpdateDimensions=!0,f._shouldUpdateAnchor=!0,f._lastKnownBufferLength=0,f._canvas=f._coreBrowserService.mainDocument.createElement("canvas"),f._canvas.classList.add("xterm-decoration-overview-ruler"),f._refreshCanvasDimensions(),null==(d=f._viewportElement.parentElement)||d.insertBefore(f._canvas,f._viewportElement),f._register(eb(function(){var e;return null==(e=f._canvas)?void 0:e.remove()}));var f,d,_=f._canvas.getContext("2d");if(_)f._ctx=_;else throw Error("Ctx cannot be null");return f._register(f._decorationService.onDecorationRegistered(function(){return f._queueRefresh(void 0,!0)})),f._register(f._decorationService.onDecorationRemoved(function(){return f._queueRefresh(void 0,!0)})),f._register(f._renderService.onRenderedViewportChange(function(){return f._queueRefresh()})),f._register(f._bufferService.buffers.onBufferActivate(function(){f._canvas.style.display=f._bufferService.buffer===f._bufferService.buffers.alt?"none":"block"})),f._register(f._bufferService.onScroll(function(){f._lastKnownBufferLength!==f._bufferService.buffers.normal.lines.length&&(f._refreshDrawHeightConstants(),f._refreshColorZonePadding())})),f._register(f._renderService.onRender(function(){f._containerHeight&&f._containerHeight===f._screenElement.clientHeight||(f._queueRefresh(!0),f._containerHeight=f._screenElement.clientHeight)})),f._register(f._coreBrowserService.onDprChange(function(){return f._queueRefresh(!0)})),f._register(f._optionsService.onSpecificOptionChange("overviewRuler",function(){return f._queueRefresh(!0)})),f._register(f._themeService.onChangeColors(function(){return f._queueRefresh()})),f._queueRefresh(!0),f}return(0,f._)(i,e),(0,l._)(i,[{key:"_width",get:function(){var e;return(null==(e=this._optionsService.options.overviewRuler)?void 0:e.width)||0}},{key:"_refreshDrawConstants",value:function(){var e=Math.floor((this._canvas.width-1)/3),i=Math.ceil((this._canvas.width-1)/3);iA.full=this._canvas.width,iA.left=e,iA.center=i,iA.right=e,this._refreshDrawHeightConstants(),iO.full=1,iO.left=1,iO.center=1+iA.left,iO.right=1+iA.left+iA.center}},{key:"_refreshDrawHeightConstants",value:function(){iT.full=Math.round(2*this._coreBrowserService.dpr);var e=Math.round(Math.max(Math.min(this._canvas.height/this._bufferService.buffer.lines.length,12),6)*this._coreBrowserService.dpr);iT.left=e,iT.center=e,iT.right=e}},{key:"_refreshColorZonePadding",value:function(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*iT.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*iT.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*iT.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*iT.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}},{key:"_refreshCanvasDimensions",value:function(){this._canvas.style.width="".concat(this._width,"px"),this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height="".concat(this._screenElement.clientHeight,"px"),this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}},{key:"_refreshDecorations",value:function(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();var e=!0,i=!1,r=void 0;try{for(var n,s=this._decorationService.decorations[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var o=n.value;this._colorZoneStore.addDecoration(o)}}catch(e){i=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(i)throw r}}this._ctx.lineWidth=1,this._renderRulerOutline();var a=this._colorZoneStore.zones,l=!0,c=!1,h=void 0;try{for(var u,f=a[Symbol.iterator]();!(l=(u=f.next()).done);l=!0){var d=u.value;"full"!==d.position&&this._renderColorZone(d)}}catch(e){c=!0,h=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw h}}var _=!0,v=!1,g=void 0;try{for(var p,y=a[Symbol.iterator]();!(_=(p=y.next()).done);_=!0){var m=p.value;"full"===m.position&&this._renderColorZone(m)}}catch(e){v=!0,g=e}finally{try{_||null==y.return||y.return()}finally{if(v)throw g}}this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}},{key:"_renderRulerOutline",value:function(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}},{key:"_renderColorZone",value:function(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(iO[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-iT[e.position||"full"]/2),iA[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+iT[e.position||"full"]))}},{key:"_queueRefresh",value:function(e,i){var r=this;this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=i||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){r._refreshDecorations(),r._animationFrame=void 0}))}}]),i}(eC);iI=w([C(2,U),C(3,$),C(4,er),C(5,G),C(6,eo),C(7,et)],iI),(iZ=i2||(i2={})).NUL="\0",iZ.SOH="\x01",iZ.STX="\x02",iZ.ETX="\x03",iZ.EOT="\x04",iZ.ENQ="\x05",iZ.ACK="\x06",iZ.BEL="\x07",iZ.BS="\b",iZ.HT="	",iZ.LF="\n",iZ.VT="\v",iZ.FF="\f",iZ.CR="\r",iZ.SO="\x0e",iZ.SI="\x0f",iZ.DLE="\x10",iZ.DC1="\x11",iZ.DC2="\x12",iZ.DC3="\x13",iZ.DC4="\x14",iZ.NAK="\x15",iZ.SYN="\x16",iZ.ETB="\x17",iZ.CAN="\x18",iZ.EM="\x19",iZ.SUB="\x1a",iZ.ESC="\x1b",iZ.FS="\x1c",iZ.GS="\x1d",iZ.RS="\x1e",iZ.US="\x1f",iZ.SP=" ",iZ.DEL="",(i$=i3||(i3={})).PAD="",i$.HOP="",i$.BPH="",i$.NBH="",i$.IND="",i$.NEL="",i$.SSA="",i$.ESA="",i$.HTS="",i$.HTJ="",i$.VTS="",i$.PLD="",i$.PLU="",i$.RI="",i$.SS2="",i$.SS3="",i$.DCS="",i$.PU1="",i$.PU2="",i$.STS="",i$.CCH="",i$.MW="",i$.SPA="",i$.EPA="",i$.SOS="",i$.SGCI="",i$.SCI="",i$.CSI="",i$.ST="",i$.OSC="",i$.PM="",i$.APC="",(i5||(i5={})).ST="".concat(i2.ESC,"\\");var iN=function(){function e(i,r,n,s,a,l){(0,o._)(this,e),this._textarea=i,this._compositionView=r,this._bufferService=n,this._optionsService=s,this._coreService=a,this._renderService=l,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}return(0,l._)(e,[{key:"isComposing",get:function(){return this._isComposing}},{key:"compositionstart",value:function(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}},{key:"compositionupdate",value:function(e){var i=this;this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(function(){i._compositionPosition.end=i._textarea.value.length},0)}},{key:"compositionend",value:function(){this._finalizeComposition(!0)}},{key:"keydown",value:function(e){if(this._isComposing||this._isSendingComposition){if(20===e.keyCode||229===e.keyCode||16===e.keyCode||17===e.keyCode||18===e.keyCode)return!1;this._finalizeComposition(!1)}return 229!==e.keyCode||(this._handleAnyTextareaChanges(),!1)}},{key:"_finalizeComposition",value:function(e){var i=this;if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){var r={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(function(){if(i._isSendingComposition){var e;i._isSendingComposition=!1,r.start+=i._dataAlreadySent.length,(e=i._isComposing?i._textarea.value.substring(r.start,i._compositionPosition.start):i._textarea.value.substring(r.start)).length>0&&i._coreService.triggerDataEvent(e,!0)}},0)}else{this._isSendingComposition=!1;var n=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(n,!0)}}},{key:"_handleAnyTextareaChanges",value:function(){var e=this,i=this._textarea.value;setTimeout(function(){if(!e._isComposing){var r=e._textarea.value,n=r.replace(i,"");e._dataAlreadySent=n,r.length>i.length?e._coreService.triggerDataEvent(n,!0):r.length<i.length?e._coreService.triggerDataEvent("".concat(i2.DEL),!0):r.length===i.length&&r!==i&&e._coreService.triggerDataEvent(r,!0)}},0)}},{key:"updateCompositionElements",value:function(e){var i=this;if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){var r=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),n=this._renderService.dimensions.css.cell.height,s=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,o=r*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=o+"px",this._compositionView.style.top=s+"px",this._compositionView.style.height=n+"px",this._compositionView.style.lineHeight=n+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";var a=this._compositionView.getBoundingClientRect();this._textarea.style.left=o+"px",this._textarea.style.top=s+"px",this._textarea.style.width=Math.max(a.width,1)+"px",this._textarea.style.height=Math.max(a.height,1)+"px",this._textarea.style.lineHeight=a.height+"px"}e||setTimeout(function(){return i.updateCompositionElements(!0)},0)}}}]),e}();iN=w([C(2,U),C(3,G),C(4,V),C(5,er)],iN);var iH,iW,iz,iF,iK,iU,iq,iV,iY,iX,ij,iG,iJ,iZ,i$,iQ,i0,i1,i2,i3,i5,i6,i4=0,i8=0,i7=0,i9=0,re={css:"#00000000",rgba:0};function rt(e){var i=e.toString(16);return i.length<2?"0"+i:i}function ri(e,i){return e<i?(i+.05)/(e+.05):(e+.05)/(i+.05)}(nP=i6||(i6={})).toCss=function(e,i,r,n){return void 0!==n?"#".concat(rt(e)).concat(rt(i)).concat(rt(r)).concat(rt(n)):"#".concat(rt(e)).concat(rt(i)).concat(rt(r))},nP.toRgba=function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;return(e<<24|i<<16|r<<8|n)>>>0},nP.toColor=function(e,i,r,n){return{css:nP.toCss(e,i,r,n),rgba:nP.toRgba(e,i,r,n)}},nT=nz||(nz={}),nA=function(e,i){var r;return i9=Math.round(255*i),i4=(r=(0,v._)(nU.toChannels(e.rgba),3))[0],i8=r[1],i7=r[2],{css:i6.toCss(i4,i8,i7,i9),rgba:i6.toRgba(i4,i8,i7,i9)}},nT.blend=function(e,i){if(1==(i9=(255&i.rgba)/255))return{css:i.css,rgba:i.rgba};var r=i.rgba>>24&255,n=i.rgba>>16&255,s=i.rgba>>8&255,o=e.rgba>>24&255,a=e.rgba>>16&255,l=e.rgba>>8&255;return i4=o+Math.round((r-o)*i9),i8=a+Math.round((n-a)*i9),i7=l+Math.round((s-l)*i9),{css:i6.toCss(i4,i8,i7),rgba:i6.toRgba(i4,i8,i7)}},nT.isOpaque=function(e){return(255&e.rgba)==255},nT.ensureContrastRatio=function(e,i,r){var n=nU.ensureContrastRatio(e.rgba,i.rgba,r);if(n)return i6.toColor(n>>24&255,n>>16&255,n>>8&255)},nT.opaque=function(e){var i,r=(255|e.rgba)>>>0;return i4=(i=(0,v._)(nU.toChannels(r),3))[0],i8=i[1],i7=i[2],{css:i6.toCss(i4,i8,i7),rgba:r}},nT.opacity=nA,nT.multiplyOpacity=function(e,i){return i9=255&e.rgba,nA(e,i9*i/255)},nT.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]},function(e){var i,r;try{var n=document.createElement("canvas");n.width=1,n.height=1;var s=n.getContext("2d",{willReadFrequently:!0});s&&((i=s).globalCompositeOperation="copy",r=i.createLinearGradient(0,0,1,1))}catch(e){}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return i4=parseInt(e.slice(1,2).repeat(2),16),i8=parseInt(e.slice(2,3).repeat(2),16),i7=parseInt(e.slice(3,4).repeat(2),16),i6.toColor(i4,i8,i7);case 5:return i4=parseInt(e.slice(1,2).repeat(2),16),i8=parseInt(e.slice(2,3).repeat(2),16),i7=parseInt(e.slice(3,4).repeat(2),16),i9=parseInt(e.slice(4,5).repeat(2),16),i6.toColor(i4,i8,i7,i9);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}var n,s=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(s)return i4=parseInt(s[1]),i8=parseInt(s[2]),i7=parseInt(s[3]),i9=Math.round((void 0===s[5]?1:parseFloat(s[5]))*255),i6.toColor(i4,i8,i7,i9);if(!i||!r||(i.fillStyle=r,i.fillStyle=e,"string"!=typeof i.fillStyle)||(i.fillRect(0,0,1,1),i4=(n=(0,v._)(i.getImageData(0,0,1,1).data,4))[0],i8=n[1],i7=n[2],255!==(i9=n[3])))throw Error("css.toColor: Unsupported css format");return{rgba:i6.toRgba(i4,i8,i7,i9),css:e}}}(nF||(nF={})),nO=nK||(nK={}),nI=function(e,i,r){var n=e/255,s=i/255,o=r/255;return .2126*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.7152*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))},nO.relativeLuminance=function(e){return nI(e>>16&255,e>>8&255,255&e)},nO.relativeLuminance2=nI,nN=nU||(nU={}),nH=function(e,i,r){for(var n=e>>24&255,s=e>>16&255,o=e>>8&255,a=i>>24&255,l=i>>16&255,c=i>>8&255,h=ri(nK.relativeLuminance2(a,l,c),nK.relativeLuminance2(n,s,o));h<r&&(a>0||l>0||c>0);)a-=Math.max(0,Math.ceil(.1*a)),l-=Math.max(0,Math.ceil(.1*l)),c-=Math.max(0,Math.ceil(.1*c)),h=ri(nK.relativeLuminance2(a,l,c),nK.relativeLuminance2(n,s,o));return(a<<24|l<<16|c<<8|255)>>>0},nW=function(e,i,r){for(var n=e>>24&255,s=e>>16&255,o=e>>8&255,a=i>>24&255,l=i>>16&255,c=i>>8&255,h=ri(nK.relativeLuminance2(a,l,c),nK.relativeLuminance2(n,s,o));h<r&&(a<255||l<255||c<255);)a=Math.min(255,a+Math.ceil((255-a)*.1)),l=Math.min(255,l+Math.ceil((255-l)*.1)),c=Math.min(255,c+Math.ceil((255-c)*.1)),h=ri(nK.relativeLuminance2(a,l,c),nK.relativeLuminance2(n,s,o));return(a<<24|l<<16|c<<8|255)>>>0},nN.blend=function(e,i){if(1==(i9=(255&i)/255))return i;var r=e>>24&255,n=e>>16&255,s=e>>8&255;return i4=r+Math.round(((i>>24&255)-r)*i9),i8=n+Math.round(((i>>16&255)-n)*i9),i7=s+Math.round(((i>>8&255)-s)*i9),i6.toRgba(i4,i8,i7)},nN.ensureContrastRatio=function(e,i,r){var n=nK.relativeLuminance(e>>8),s=nK.relativeLuminance(i>>8);if(ri(n,s)<r){if(s<n){var o=nH(e,i,r),a=ri(n,nK.relativeLuminance(o>>8));if(a<r){var l=nW(e,i,r);return a>ri(n,nK.relativeLuminance(l>>8))?o:l}return o}var c=nW(e,i,r),h=ri(n,nK.relativeLuminance(c>>8));if(h<r){var u=nH(e,i,r);return h>ri(n,nK.relativeLuminance(u>>8))?c:u}return c}},nN.reduceLuminance=nH,nN.increaseLuminance=nW,nN.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]};var rr=function(e){function i(e,r,n){var a;return(0,o._)(this,i),(a=(0,s._)(this,i)).content=0,a.combinedData="",a.fg=e.fg,a.bg=e.bg,a.combinedData=r,a._width=n,a}return(0,f._)(i,e),(0,l._)(i,[{key:"isCombined",value:function(){return 2097152}},{key:"getWidth",value:function(){return this._width}},{key:"getChars",value:function(){return this.combinedData}},{key:"getCode",value:function(){return 2097151}},{key:"setFromCharData",value:function(e){throw Error("not implemented")}},{key:"getAsCharData",value:function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}]),i}(I),rn=function(){function e(i){(0,o._)(this,e),this._bufferService=i,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new H}return(0,l._)(e,[{key:"register",value:function(e){var i={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(i),i.id}},{key:"deregister",value:function(e){for(var i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===e)return this._characterJoiners.splice(i,1),!0;return!1}},{key:"getJoinedCharacters",value:function(e){if(0===this._characterJoiners.length)return[];var i=this._bufferService.buffer.lines.get(e);if(!i||0===i.length)return[];for(var r=[],n=i.translateToString(!0),s=0,o=0,a=0,l=i.getFg(0),c=i.getBg(0),h=0;h<i.getTrimmedLength();h++)if(i.loadCell(h,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==l||this._workCell.bg!==c){if(h-s>1)for(var u=this._getJoinedRanges(n,a,o,i,s),f=0;f<u.length;f++)r.push(u[f]);s=h,a=o,l=this._workCell.fg,c=this._workCell.bg}o+=this._workCell.getChars().length||1}if(this._bufferService.cols-s>1)for(var d=this._getJoinedRanges(n,a,o,i,s),_=0;_<d.length;_++)r.push(d[_]);return r}},{key:"_getJoinedRanges",value:function(e,i,r,n,s){var o=e.substring(i,r),a=[];try{a=this._characterJoiners[0].handler(o)}catch(e){console.error(e)}for(var l=1;l<this._characterJoiners.length;l++)try{for(var c=this._characterJoiners[l].handler(o),h=0;h<c.length;h++)rn._mergeRanges(a,c[h])}catch(e){console.error(e)}return this._stringRangesToCellRanges(a,n,s),a}},{key:"_stringRangesToCellRanges",value:function(e,i,r){var n=0,s=!1,o=0,a=e[0];if(a){for(var l=r;l<this._bufferService.cols;l++){var c=i.getWidth(l),h=i.getString(l).length||1;if(0!==c){if(!s&&a[0]<=o&&(a[0]=l,s=!0),a[1]<=o){if(a[1]=l,!(a=e[++n]))break;a[0]<=o?(a[0]=l,s=!0):s=!1}o+=h}}a&&(a[1]=this._bufferService.cols)}}}],[{key:"_mergeRanges",value:function(e,i){for(var r=!1,n=0;n<e.length;n++){var s=e[n];if(r){if(i[1]<=s[0])return e[n-1][1]=i[1],e;if(i[1]<=s[1])return e[n-1][1]=Math.max(i[1],s[1]),e.splice(n,1),e;e.splice(n,1),n--}else{if(i[1]<=s[0])return e.splice(n,0,i),e;if(i[1]<=s[1])return s[0]=Math.min(i[0],s[0]),e;i[0]<s[1]&&(s[0]=Math.min(i[0],s[0]),r=!0);continue}}return r?e[e.length-1][1]=i[1]:e.push(i),e}}]),e}();function rs(){return{width:0,height:0}}rn=w([C(0,U)],rn);var ro=function(){function e(i,r,n,s,a,l,c){(0,o._)(this,e),this._document=i,this._characterJoinerService=r,this._optionsService=n,this._coreBrowserService=s,this._coreService=a,this._decorationService=l,this._themeService=c,this._workCell=new H,this._columnSelectMode=!1,this.defaultSpacing=0}return(0,l._)(e,[{key:"handleSelectionChanged",value:function(e,i,r){this._selectionStart=e,this._selectionEnd=i,this._columnSelectMode=r}},{key:"createRow",value:function(e,i,r,n,s,o,a,l,c,h,u){var f=[],d=this._characterJoinerService.getJoinedCharacters(i),_=this._themeService.colors,v=e.getNoBgTrimmedLength();r&&v<o+1&&(v=o+1);for(var g,p,y=0,m="",S=0,k=0,b=0,w=0,C=!1,x=0,E=!1,D=0,B=0,R=[],M=-1!==h&&-1!==u,L=0;L<v;L++)g=this,function(v){e.loadCell(v,g._workCell);var P=g._workCell.getWidth();if(0===P)return L=v;var T=!1,A=v>=B,O=v,N=g._workCell;if(d.length>0&&v===d[0][0]&&A){var H=d.shift(),W=g._isCellInSelection(H[0],i);for(S=H[0]+1;S<H[1];S++)A&&(A=W===g._isCellInSelection(S,i));A&&(A=!r||o<H[0]||o>=H[1]),A?(T=!0,N=new rr(g._workCell,e.translateToString(!0,H[0],H[1]),H[1]-H[0]),O=H[1]-1,P=N.getWidth()):B=H[1]}var z=g._isCellInSelection(v,i),F=r&&v===o,K=M&&v>=h&&v<=u,U=!1;g._decorationService.forEachDecorationAtCell(v,i,void 0,function(e){U=!0});var q=N.getChars()||" ";if(" "===q&&(N.isUnderline()||N.isOverline())&&(q=""),D=P*l-c.get(q,N.isBold(),N.isItalic()),p)if(y&&(z&&E||!z&&!E&&N.bg===k)&&(z&&E&&_.selectionForeground||N.fg===b)&&N.extended.ext===w&&K===C&&D===x&&!F&&!T&&!U&&A)return N.isInvisible()?m+=" ":m+=q,y++,L=v;else y&&(p.textContent=m),p=g._document.createElement("span"),y=0,m="";else p=g._document.createElement("span");if(k=N.bg,b=N.fg,w=N.extended.ext,C=K,x=D,E=z,T&&o>=v&&o<=O&&(o=v),!g._coreService.isCursorHidden&&F&&g._coreService.isCursorInitialized){if(R.push("xterm-cursor"),g._coreBrowserService.isFocused)a&&R.push("xterm-cursor-blink"),R.push("bar"===n?"xterm-cursor-bar":"underline"===n?"xterm-cursor-underline":"xterm-cursor-block");else if(s)switch(s){case"outline":R.push("xterm-cursor-outline");break;case"block":R.push("xterm-cursor-block");break;case"bar":R.push("xterm-cursor-bar");break;case"underline":R.push("xterm-cursor-underline")}}if(N.isBold()&&R.push("xterm-bold"),N.isItalic()&&R.push("xterm-italic"),N.isDim()&&R.push("xterm-dim"),m=N.isInvisible()?" ":N.getChars()||" ",N.isUnderline()&&(R.push("xterm-underline-".concat(N.extended.underlineStyle))," "===m&&(m=""),!N.isUnderlineColorDefault()))if(N.isUnderlineColorRGB())p.style.textDecorationColor="rgb(".concat(I.toColorRGB(N.getUnderlineColor()).join(","),")");else{var V=N.getUnderlineColor();g._optionsService.rawOptions.drawBoldTextInBrightColors&&N.isBold()&&V<8&&(V+=8),p.style.textDecorationColor=_.ansi[V].css}N.isOverline()&&(R.push("xterm-overline")," "===m&&(m="")),N.isStrikethrough()&&R.push("xterm-strikethrough"),K&&(p.style.textDecoration="underline");var Y=N.getFgColor(),X=N.getFgColorMode(),j=N.getBgColor(),G=N.getBgColorMode(),J=!!N.isInverse();if(J){var Z=Y;Y=j,j=Z;var $=X;X=G,G=$}var Q=void 0,ee=void 0,et=!1;g._decorationService.forEachDecorationAtCell(v,i,void 0,function(e){"top"!==e.options.layer&&et||(e.backgroundColorRGB&&(G=0x3000000,j=e.backgroundColorRGB.rgba>>8&0xffffff,Q=e.backgroundColorRGB),e.foregroundColorRGB&&(X=0x3000000,Y=e.foregroundColorRGB.rgba>>8&0xffffff,ee=e.foregroundColorRGB),et="top"===e.options.layer)}),!et&&z&&(j=(Q=g._coreBrowserService.isFocused?_.selectionBackgroundOpaque:_.selectionInactiveBackgroundOpaque).rgba>>8&0xffffff,G=0x3000000,et=!0,_.selectionForeground&&(X=0x3000000,Y=_.selectionForeground.rgba>>8&0xffffff,ee=_.selectionForeground)),et&&R.push("xterm-decoration-top");var ei=void 0;switch(G){case 0x1000000:case 0x2000000:ei=_.ansi[j],R.push("xterm-bg-".concat(j));break;case 0x3000000:ei=i6.toColor(j>>16,j>>8&255,255&j),g._addStyle(p,"background-color:#".concat(ra((j>>>0).toString(16),"0",6)));break;default:J?(ei=_.foreground,R.push("xterm-bg-".concat(257))):ei=_.background}switch(Q||N.isDim()&&(Q=nz.multiplyOpacity(ei,.5)),X){case 0x1000000:case 0x2000000:N.isBold()&&Y<8&&g._optionsService.rawOptions.drawBoldTextInBrightColors&&(Y+=8),g._applyMinimumContrast(p,ei,_.ansi[Y],N,Q,void 0)||R.push("xterm-fg-".concat(Y));break;case 0x3000000:var er=i6.toColor(Y>>16&255,Y>>8&255,255&Y);g._applyMinimumContrast(p,ei,er,N,Q,ee)||g._addStyle(p,"color:#".concat(ra(Y.toString(16),"0",6)));break;default:g._applyMinimumContrast(p,ei,_.foreground,N,Q,ee)||J&&R.push("xterm-fg-".concat(257))}R.length&&(p.className=R.join(" "),R.length=0),F||T||U||!A?p.textContent=m:y++,D!==g.defaultSpacing&&(p.style.letterSpacing="".concat(D,"px")),f.push(p),L=O}(L);return p&&y&&(p.textContent=m),f}},{key:"_applyMinimumContrast",value:function(e,i,r,n,s,o){if(1===this._optionsService.rawOptions.minimumContrastRatio||57508<=(l=a=n.getCode())&&l<=57558||9472<=(c=a)&&c<=9631)return!1;var a,l,c,h,u=this._getContrastCache(n);if(s||o||(h=u.getColor(i.rgba,r.rgba)),void 0===h){var f=this._optionsService.rawOptions.minimumContrastRatio/(n.isDim()?2:1);h=nz.ensureContrastRatio(s||i,o||r,f),u.setColor((s||i).rgba,(o||r).rgba,null!=h?h:null)}return!!h&&(this._addStyle(e,"color:".concat(h.css)),!0)}},{key:"_getContrastCache",value:function(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}},{key:"_addStyle",value:function(e,i){e.setAttribute("style","".concat(e.getAttribute("style")||"").concat(i,";"))}},{key:"_isCellInSelection",value:function(e,i){var r=this._selectionStart,n=this._selectionEnd;return!!r&&!!n&&(this._columnSelectMode?r[0]<=n[0]?e>=r[0]&&i>=r[1]&&e<n[0]&&i<=n[1]:e<r[0]&&i>=r[1]&&e>=n[0]&&i<=n[1]:i>r[1]&&i<n[1]||r[1]===n[1]&&i===r[1]&&e>=r[0]&&e<n[0]||r[1]<n[1]&&i===n[1]&&e<n[0]||r[1]<n[1]&&i===r[1]&&e>=r[0])}}]),e}();function ra(e,i,r){for(;e.length<r;)e=i+e;return e}ro=w([C(1,es),C(2,G),C(3,et),C(4,V),C(5,$),C(6,eo)],ro);var rl=function(){function e(i,r){(0,o._)(this,e),this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=i.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";var n=i.createElement("span");n.classList.add("xterm-char-measure-element");var s=i.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontWeight="bold";var a=i.createElement("span");a.classList.add("xterm-char-measure-element"),a.style.fontStyle="italic";var l=i.createElement("span");l.classList.add("xterm-char-measure-element"),l.style.fontWeight="bold",l.style.fontStyle="italic",this._measureElements=[n,s,a,l],this._container.appendChild(n),this._container.appendChild(s),this._container.appendChild(a),this._container.appendChild(l),r.appendChild(this._container),this.clear()}return(0,l._)(e,[{key:"dispose",value:function(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}},{key:"clear",value:function(){this._flat.fill(-9999),this._holey=new Map}},{key:"setFont",value:function(e,i,r,n){e===this._font&&i===this._fontSize&&r===this._weight&&n===this._weightBold||(this._font=e,this._fontSize=i,this._weight=r,this._weightBold=n,this._container.style.fontFamily=this._font,this._container.style.fontSize="".concat(this._fontSize,"px"),this._measureElements[0].style.fontWeight="".concat(r),this._measureElements[1].style.fontWeight="".concat(n),this._measureElements[2].style.fontWeight="".concat(r),this._measureElements[3].style.fontWeight="".concat(n),this.clear())}},{key:"get",value:function(e,i,r){var n=0;if(!i&&!r&&1===e.length&&(n=e.charCodeAt(0))<256){if(-9999!==this._flat[n])return this._flat[n];var s=this._measure(e,0);return s>0&&(this._flat[n]=s),s}var o=e;i&&(o+="B"),r&&(o+="I");var a=this._holey.get(o);if(void 0===a){var l=0;i&&(l|=1),r&&(l|=2),(a=this._measure(e,l))>0&&this._holey.set(o,a)}return a}},{key:"_measure",value:function(e,i){var r=this._measureElements[i];return r.textContent=e.repeat(32),r.offsetWidth/32}}]),e}(),rc=function(){function e(){(0,o._)(this,e),this.clear()}return(0,l._)(e,[{key:"clear",value:function(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}},{key:"update",value:function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.selectionStart=i,this.selectionEnd=r,!i||!r||i[0]===r[0]&&i[1]===r[1])return void this.clear();var s=e.buffers.active.ydisp,o=i[1]-s,a=r[1]-s,l=Math.max(o,0),c=Math.min(a,e.rows-1);l>=e.rows||c<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=n,this.viewportStartRow=o,this.viewportEndRow=a,this.viewportCappedStartRow=l,this.viewportCappedEndRow=c,this.startCol=i[0],this.endCol=r[0])}},{key:"isCellSelected",value:function(e,i,r){return!!this.hasSelection&&(r-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?i>=this.startCol&&r>=this.viewportCappedStartRow&&i<this.endCol&&r<=this.viewportCappedEndRow:i<this.startCol&&r>=this.viewportCappedStartRow&&i>=this.endCol&&r<=this.viewportCappedEndRow:r>this.viewportStartRow&&r<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&r===this.viewportStartRow&&i>=this.startCol&&i<this.endCol||this.viewportStartRow<this.viewportEndRow&&r===this.viewportEndRow&&i<this.endCol||this.viewportStartRow<this.viewportEndRow&&r===this.viewportStartRow&&i>=this.startCol)}}]),e}(),rh="xterm-dom-renderer-owner-",ru="xterm-rows",rf="xterm-fg-",rd="xterm-bg-",r_="xterm-focus",rv="xterm-selection",rg=1,rp=function(e){function i(e,r,n,a,l,c,h,u,f,d,_,v,g,p){var y;return(0,o._)(this,i),(y=(0,s._)(this,i))._terminal=e,y._document=r,y._element=n,y._screenElement=a,y._viewportElement=l,y._helperContainer=c,y._linkifier2=h,y._charSizeService=f,y._optionsService=d,y._bufferService=_,y._coreService=v,y._coreBrowserService=g,y._themeService=p,y._terminalClass=rg++,y._rowElements=[],y._selectionRenderModel=new rc,y.onRequestRedraw=y._register(new e4).event,y._rowContainer=y._document.createElement("div"),y._rowContainer.classList.add(ru),y._rowContainer.style.lineHeight="normal",y._rowContainer.setAttribute("aria-hidden","true"),y._refreshRowElements(y._bufferService.cols,y._bufferService.rows),y._selectionContainer=y._document.createElement("div"),y._selectionContainer.classList.add(rv),y._selectionContainer.setAttribute("aria-hidden","true"),y.dimensions={css:{canvas:rs(),cell:rs()},device:{canvas:rs(),cell:rs(),char:{width:0,height:0,left:0,top:0}}},y._updateDimensions(),y._register(y._optionsService.onOptionChange(function(){return y._handleOptionsChanged()})),y._register(y._themeService.onChangeColors(function(e){return y._injectCss(e)})),y._injectCss(y._themeService.colors),y._rowFactory=u.createInstance(ro,document),y._element.classList.add(rh+y._terminalClass),y._screenElement.appendChild(y._rowContainer),y._screenElement.appendChild(y._selectionContainer),y._register(y._linkifier2.onShowLinkUnderline(function(e){return y._handleLinkHover(e)})),y._register(y._linkifier2.onHideLinkUnderline(function(e){return y._handleLinkLeave(e)})),y._register(eb(function(){y._element.classList.remove(rh+y._terminalClass),y._rowContainer.remove(),y._selectionContainer.remove(),y._widthCache.dispose(),y._themeStyleElement.remove(),y._dimensionsStyleElement.remove()})),y._widthCache=new rl(y._document,y._helperContainer),y._widthCache.setFont(y._optionsService.rawOptions.fontFamily,y._optionsService.rawOptions.fontSize,y._optionsService.rawOptions.fontWeight,y._optionsService.rawOptions.fontWeightBold),y._setDefaultSpacing(),y}return(0,f._)(i,e),(0,l._)(i,[{key:"_updateDimensions",value:function(){var e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;var i=!0,r=!1,n=void 0;try{for(var s,o=this._rowElements[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var a=s.value;a.style.width="".concat(this.dimensions.css.canvas.width,"px"),a.style.height="".concat(this.dimensions.css.cell.height,"px"),a.style.lineHeight="".concat(this.dimensions.css.cell.height,"px"),a.style.overflow="hidden"}}catch(e){r=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw n}}this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));var l="".concat(this._terminalSelector," .").concat(ru," span { display: inline-block; height: 100%; vertical-align: top;}");this._dimensionsStyleElement.textContent=l,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width="".concat(this.dimensions.css.canvas.width,"px"),this._screenElement.style.height="".concat(this.dimensions.css.canvas.height,"px")}},{key:"_injectCss",value:function(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));var i="".concat(this._terminalSelector," .").concat(ru," { pointer-events: none; color: ").concat(e.foreground.css,"; font-family: ").concat(this._optionsService.rawOptions.fontFamily,"; font-size: ").concat(this._optionsService.rawOptions.fontSize,"px; font-kerning: none; white-space: pre}");i+="".concat(this._terminalSelector," .").concat(ru," .xterm-dim { color: ").concat(nz.multiplyOpacity(e.foreground,.5).css,";}"),i+="".concat(this._terminalSelector," span:not(.xterm-bold) { font-weight: ").concat(this._optionsService.rawOptions.fontWeight,";}").concat(this._terminalSelector," span.xterm-bold { font-weight: ").concat(this._optionsService.rawOptions.fontWeightBold,";}").concat(this._terminalSelector," span.xterm-italic { font-style: italic;}");var r="blink_underline_".concat(this._terminalClass),n="blink_bar_".concat(this._terminalClass),s="blink_block_".concat(this._terminalClass);i+="@keyframes ".concat(r," { 50% {  border-bottom-style: hidden; }}"),i+="@keyframes ".concat(n," { 50% {  box-shadow: none; }}"),i+="@keyframes ".concat(s," { 0% {  background-color: ").concat(e.cursor.css,";  color: ").concat(e.cursorAccent.css,"; } 50% {  background-color: inherit;  color: ").concat(e.cursor.css,"; }}"),i+="".concat(this._terminalSelector," .").concat(ru,".").concat(r_," .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ").concat(r," 1s step-end infinite;}").concat(this._terminalSelector," .").concat(ru,".").concat(r_," .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ").concat(n," 1s step-end infinite;}").concat(this._terminalSelector," .").concat(ru,".").concat(r_," .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ").concat(s," 1s step-end infinite;}").concat(this._terminalSelector," .").concat(ru," .xterm-cursor.xterm-cursor-block { background-color: ").concat(e.cursor.css,"; color: ").concat(e.cursorAccent.css,";}").concat(this._terminalSelector," .").concat(ru," .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ").concat(e.cursor.css," !important; color: ").concat(e.cursorAccent.css," !important;}").concat(this._terminalSelector," .").concat(ru," .xterm-cursor.xterm-cursor-outline { outline: 1px solid ").concat(e.cursor.css,"; outline-offset: -1px;}").concat(this._terminalSelector," .").concat(ru," .xterm-cursor.xterm-cursor-bar { box-shadow: ").concat(this._optionsService.rawOptions.cursorWidth,"px 0 0 ").concat(e.cursor.css," inset;}").concat(this._terminalSelector," .").concat(ru," .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ").concat(e.cursor.css,"; border-bottom-style: solid; height: calc(100% - 1px);}"),i+="".concat(this._terminalSelector," .").concat(rv," { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}").concat(this._terminalSelector,".focus .").concat(rv," div { position: absolute; background-color: ").concat(e.selectionBackgroundOpaque.css,";}").concat(this._terminalSelector," .").concat(rv," div { position: absolute; background-color: ").concat(e.selectionInactiveBackgroundOpaque.css,";}");var o=!0,a=!1,l=void 0;try{for(var c,h=e.ansi.entries()[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var u=(0,v._)(c.value,2),f=u[0],d=u[1];i+="".concat(this._terminalSelector," .").concat(rf).concat(f," { color: ").concat(d.css,"; }").concat(this._terminalSelector," .").concat(rf).concat(f,".xterm-dim { color: ").concat(nz.multiplyOpacity(d,.5).css,"; }").concat(this._terminalSelector," .").concat(rd).concat(f," { background-color: ").concat(d.css,"; }")}}catch(e){a=!0,l=e}finally{try{o||null==h.return||h.return()}finally{if(a)throw l}}i+="".concat(this._terminalSelector," .").concat(rf,257," { color: ").concat(nz.opaque(e.background).css,"; }").concat(this._terminalSelector," .").concat(rf,257,".xterm-dim { color: ").concat(nz.multiplyOpacity(nz.opaque(e.background),.5).css,"; }").concat(this._terminalSelector," .").concat(rd,257," { background-color: ").concat(e.foreground.css,"; }"),this._themeStyleElement.textContent=i}},{key:"_setDefaultSpacing",value:function(){var e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing="".concat(e,"px"),this._rowFactory.defaultSpacing=e}},{key:"handleDevicePixelRatioChange",value:function(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}},{key:"_refreshRowElements",value:function(e,i){for(var r=this._rowElements.length;r<=i;r++){var n=this._document.createElement("div");this._rowContainer.appendChild(n),this._rowElements.push(n)}for(;this._rowElements.length>i;)this._rowContainer.removeChild(this._rowElements.pop())}},{key:"handleResize",value:function(e,i){this._refreshRowElements(e,i),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}},{key:"handleCharSizeChanged",value:function(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}},{key:"handleBlur",value:function(){this._rowContainer.classList.remove(r_),this.renderRows(0,this._bufferService.rows-1)}},{key:"handleFocus",value:function(){this._rowContainer.classList.add(r_),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}},{key:"handleSelectionChanged",value:function(e,i,r){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,i,r),this.renderRows(0,this._bufferService.rows-1),e&&i&&(this._selectionRenderModel.update(this._terminal,e,i,r),this._selectionRenderModel.hasSelection)){var n=this._selectionRenderModel.viewportStartRow,s=this._selectionRenderModel.viewportEndRow,o=this._selectionRenderModel.viewportCappedStartRow,a=this._selectionRenderModel.viewportCappedEndRow,l=this._document.createDocumentFragment();if(r){var c=e[0]>i[0];l.appendChild(this._createSelectionElement(o,c?i[0]:e[0],c?e[0]:i[0],a-o+1))}else{var h=n===o?e[0]:0,u=o===s?i[0]:this._bufferService.cols;if(l.appendChild(this._createSelectionElement(o,h,u)),l.appendChild(this._createSelectionElement(o+1,0,this._bufferService.cols,a-o-1)),o!==a){var f=s===a?i[0]:this._bufferService.cols;l.appendChild(this._createSelectionElement(a,0,f))}}this._selectionContainer.appendChild(l)}}},{key:"_createSelectionElement",value:function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=this._document.createElement("div"),o=i*this.dimensions.css.cell.width,a=this.dimensions.css.cell.width*(r-i);return o+a>this.dimensions.css.canvas.width&&(a=this.dimensions.css.canvas.width-o),s.style.height="".concat(n*this.dimensions.css.cell.height,"px"),s.style.top="".concat(e*this.dimensions.css.cell.height,"px"),s.style.left="".concat(o,"px"),s.style.width="".concat(a,"px"),s}},{key:"handleCursorMove",value:function(){}},{key:"_handleOptionsChanged",value:function(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}},{key:"clear",value:function(){var e=!0,i=!1,r=void 0;try{for(var n,s=this._rowElements[Symbol.iterator]();!(e=(n=s.next()).done);e=!0)n.value.replaceChildren()}catch(e){i=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(i)throw r}}}},{key:"renderRows",value:function(e,i){for(var r=this._bufferService.buffer,n=r.ybase+r.y,s=Math.min(r.x,this._bufferService.cols-1),o=null!=(h=this._coreService.decPrivateModes.cursorBlink)?h:this._optionsService.rawOptions.cursorBlink,a=null!=(u=this._coreService.decPrivateModes.cursorStyle)?u:this._optionsService.rawOptions.cursorStyle,l=this._optionsService.rawOptions.cursorInactiveStyle,c=e;c<=i;c++){var h,u,f=c+r.ydisp,d=this._rowElements[c],_=r.lines.get(f);if(!d||!_)break;d.replaceChildren.apply(d,(0,g._)(this._rowFactory.createRow(_,f,f===n,a,l,s,o,this.dimensions.css.cell.width,this._widthCache,-1,-1)))}}},{key:"_terminalSelector",get:function(){return".".concat(rh).concat(this._terminalClass)}},{key:"_handleLinkHover",value:function(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}},{key:"_handleLinkLeave",value:function(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}},{key:"_setCellUnderline",value:function(e,i,r,n,s,o){r<0&&(e=0),n<0&&(i=0);var a=this._bufferService.rows-1;r=Math.max(Math.min(r,a),0),n=Math.max(Math.min(n,a),0),s=Math.min(s,this._bufferService.cols);for(var l=this._bufferService.buffer,c=l.ybase+l.y,h=Math.min(l.x,s-1),u=this._optionsService.rawOptions.cursorBlink,f=this._optionsService.rawOptions.cursorStyle,d=this._optionsService.rawOptions.cursorInactiveStyle,_=r;_<=n;++_){var v=_+l.ydisp,p=this._rowElements[_],y=l.lines.get(v);if(!p||!y)break;p.replaceChildren.apply(p,(0,g._)(this._rowFactory.createRow(y,v,v===c,f,d,h,u,this.dimensions.css.cell.width,this._widthCache,o?_===r?e:0:-1,o?(_===n?i:s)-1:-1)))}}}]),i}(eC);rp=w([C(7,X),C(8,ee),C(9,G),C(10,U),C(11,V),C(12,et),C(13,eo)],rp);var ry=function(e){function i(e,r,n){var a;(0,o._)(this,i),(a=(0,s._)(this,i))._optionsService=n,a.width=0,a.height=0,a._onCharSizeChange=a._register(new e4),a.onCharSizeChange=a._onCharSizeChange.event;try{a._measureStrategy=a._register(new rk(a._optionsService))}catch(i){a._measureStrategy=a._register(new rS(e,r,a._optionsService))}return a._register(a._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],function(){return a.measure()})),a}return(0,f._)(i,e),(0,l._)(i,[{key:"hasValidSize",get:function(){return this.width>0&&this.height>0}},{key:"measure",value:function(){var e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}}]),i}(eC);ry=w([C(2,G)],ry);var rm=function(e){function i(){var e;return(0,o._)(this,i),e=(0,s._)(this,i,arguments),e._result={width:0,height:0},e}return(0,f._)(i,e),(0,l._)(i,[{key:"_validateAndSet",value:function(e,i){void 0!==e&&e>0&&void 0!==i&&i>0&&(this._result.width=e,this._result.height=i)}}]),i}(eC),rS=function(e){function i(e,r,n){var a;return(0,o._)(this,i),(a=(0,s._)(this,i))._document=e,a._parentElement=r,a._optionsService=n,a._measureElement=a._document.createElement("span"),a._measureElement.classList.add("xterm-char-measure-element"),a._measureElement.textContent="W".repeat(32),a._measureElement.setAttribute("aria-hidden","true"),a._measureElement.style.whiteSpace="pre",a._measureElement.style.fontKerning="none",a._parentElement.appendChild(a._measureElement),a}return(0,f._)(i,e),(0,l._)(i,[{key:"measure",value:function(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize="".concat(this._optionsService.rawOptions.fontSize,"px"),this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}]),i}(rm),rk=function(e){function i(e){(0,o._)(this,i),(r=(0,s._)(this,i))._optionsService=e,r._canvas=new OffscreenCanvas(100,100),r._ctx=r._canvas.getContext("2d");var r,n=r._ctx.measureText("W");if(!("width"in n&&"fontBoundingBoxAscent"in n&&"fontBoundingBoxDescent"in n))throw Error("Required font metrics not supported");return r}return(0,f._)(i,e),(0,l._)(i,[{key:"measure",value:function(){this._ctx.font="".concat(this._optionsService.rawOptions.fontSize,"px ").concat(this._optionsService.rawOptions.fontFamily);var e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}}]),i}(rm),rb=function(e){function i(e,r,n){var a;return(0,o._)(this,i),(a=(0,s._)(this,i))._textarea=e,a._window=r,a.mainDocument=n,a._isFocused=!1,a._cachedIsFocused=void 0,a._screenDprMonitor=a._register(new rw(a._window)),a._onDprChange=a._register(new e4),a.onDprChange=a._onDprChange.event,a._onWindowChange=a._register(new e4),a.onWindowChange=a._onWindowChange.event,a._register(a.onWindowChange(function(e){return a._screenDprMonitor.setWindow(e)})),a._register(eU.forward(a._screenDprMonitor.onDprChange,a._onDprChange)),a._register(ii(a._textarea,"focus",function(){return a._isFocused=!0})),a._register(ii(a._textarea,"blur",function(){return a._isFocused=!1})),a}return(0,f._)(i,e),(0,l._)(i,[{key:"window",get:function(){return this._window},set:function(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}},{key:"dpr",get:function(){return this.window.devicePixelRatio}},{key:"isFocused",get:function(){var e=this;return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(function(){return e._cachedIsFocused=void 0})),this._cachedIsFocused}}]),i}(eC),rw=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._parentWindow=e,r._windowResizeListener=r._register(new ex),r._onDprChange=r._register(new e4),r.onDprChange=r._onDprChange.event,r._outerListener=function(){return r._setDprAndFireIfDiffers()},r._currentDevicePixelRatio=r._parentWindow.devicePixelRatio,r._updateDpr(),r._setWindowResizeListener(),r._register(eb(function(){return r.clearListener()})),r}return(0,f._)(i,e),(0,l._)(i,[{key:"setWindow",value:function(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}},{key:"_setWindowResizeListener",value:function(){var e=this;this._windowResizeListener.value=ii(this._parentWindow,"resize",function(){return e._setDprAndFireIfDiffers()})}},{key:"_setDprAndFireIfDiffers",value:function(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}},{key:"_updateDpr",value:function(){var e;this._outerListener&&(null==(e=this._resolutionMediaMatchList)||e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia("screen and (resolution: ".concat(this._parentWindow.devicePixelRatio,"dppx)")),this._resolutionMediaMatchList.addListener(this._outerListener))}},{key:"clearListener",value:function(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}]),i}(eC),rC=function(e){function i(){var e;return(0,o._)(this,i),(e=(0,s._)(this,i)).linkProviders=[],e._register(eb(function(){return e.linkProviders.length=0})),e}return(0,f._)(i,e),(0,l._)(i,[{key:"registerLinkProvider",value:function(e){var i=this;return this.linkProviders.push(e),{dispose:function(){var r=i.linkProviders.indexOf(e);-1!==r&&i.linkProviders.splice(r,1)}}}}]),i}(eC);function rx(e,i,r){var n=r.getBoundingClientRect(),s=e.getComputedStyle(r),o=parseInt(s.getPropertyValue("padding-left")),a=parseInt(s.getPropertyValue("padding-top"));return[i.clientX-n.left-o,i.clientY-n.top-a]}var rE=function(){function e(i,r){(0,o._)(this,e),this._renderService=i,this._charSizeService=r}return(0,l._)(e,[{key:"getCoords",value:function(e,i,r,n,s){return function(e,i,r,n,s,o,a,l,c){if(o){var h=rx(e,i,r);return h[0]=Math.ceil((h[0]+(c?a/2:0))/a),h[1]=Math.ceil(h[1]/l),h[0]=Math.min(Math.max(h[0],1),n+ +!!c),h[1]=Math.min(Math.max(h[1],1),s),h}}(window,e,i,r,n,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,s)}},{key:"getMouseReportCoords",value:function(e,i){var r=rx(window,e,i);if(this._charSizeService.hasValidSize)return r[0]=Math.min(Math.max(r[0],0),this._renderService.dimensions.css.canvas.width-1),r[1]=Math.min(Math.max(r[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(r[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(r[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(r[0]),y:Math.floor(r[1])}}}]),e}();rE=w([C(0,er),C(1,ee)],rE);var rD=function(){function e(i,r){(0,o._)(this,e),this._renderCallback=i,this._coreBrowserService=r,this._refreshCallbacks=[]}return(0,l._)(e,[{key:"dispose",value:function(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}},{key:"addRefreshCallback",value:function(e){var i=this;return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){return i._innerRefresh()})),this._animationFrame}},{key:"refresh",value:function(e,i,r){var n=this;this._rowCount=r,e=void 0!==e?e:0,i=void 0!==i?i:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,i):i,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){return n._innerRefresh()}))}},{key:"_innerRefresh",value:function(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();var e=Math.max(this._rowStart,0),i=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,i),this._runRefreshCallbacks()}},{key:"_runRefreshCallbacks",value:function(){var e=!0,i=!1,r=void 0;try{for(var n,s=this._refreshCallbacks[Symbol.iterator]();!(e=(n=s.next()).done);e=!0)(0,n.value)(0)}catch(e){i=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(i)throw r}}this._refreshCallbacks=[]}}]),e}(),rB={},rR={getSafariVersion:function(){return rN},isChromeOS:function(){return rU},isFirefox:function(){return rA},isIpad:function(){return rW},isIphone:function(){return rz},isLegacyEdge:function(){return rO},isLinux:function(){return rK},isMac:function(){return rH},isNode:function(){return rL},isSafari:function(){return rI},isWindows:function(){return rF}};for(var rM in rR)k(rB,rM,{get:rR[rM],enumerable:!0});var rL=(void 0===i.default?"undefined":(0,p._)(i.default))<"u"&&"title"in i.default,rP=rL?"node":navigator.userAgent,rT=rL?"node":navigator.platform,rA=rP.includes("Firefox"),rO=rP.includes("Edge"),rI=/^((?!chrome|android).)*safari/i.test(rP);function rN(){if(!rI)return 0;var e=rP.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])}var rH=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(rT),rW="iPad"===rT,rz="iPhone"===rT,rF=["Windows","Win16","Win32","WinCE"].includes(rT),rK=rT.indexOf("Linux")>=0,rU=/\bCrOS\b/.test(rP),rq=function(){function e(){(0,o._)(this,e),this._tasks=[],this._i=0}return(0,l._)(e,[{key:"enqueue",value:function(e){this._tasks.push(e),this._start()}},{key:"flush",value:function(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}},{key:"clear",value:function(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}},{key:"_start",value:function(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}},{key:"_process",value:function(e){this._idleCallback=void 0;for(var i=0,r=0,n=e.timeRemaining(),s=0;this._i<this._tasks.length;){if(i=performance.now(),this._tasks[this._i]()||this._i++,1.5*(r=Math.max(i=Math.max(1,performance.now()-i),r))>(s=e.timeRemaining())){n-i<-20&&console.warn("task queue exceeded allotted deadline by ".concat(Math.abs(Math.round(n-i)),"ms")),this._start();return}n=s}this.clear()}}]),e}(),rV=function(e){function i(){return(0,o._)(this,i),(0,s._)(this,i,arguments)}return(0,f._)(i,e),(0,l._)(i,[{key:"_requestCallback",value:function(e){var i=this;return setTimeout(function(){return e(i._createDeadline(16))})}},{key:"_cancelCallback",value:function(e){clearTimeout(e)}},{key:"_createDeadline",value:function(e){var i=performance.now()+e;return{timeRemaining:function(){return Math.max(0,i-performance.now())}}}}]),i}(rq),rY=function(e){function i(){return(0,o._)(this,i),(0,s._)(this,i,arguments)}return(0,f._)(i,e),(0,l._)(i,[{key:"_requestCallback",value:function(e){return requestIdleCallback(e)}},{key:"_cancelCallback",value:function(e){cancelIdleCallback(e)}}]),i}(rq),rX=!rL&&"requestIdleCallback"in window?rY:rV,rj=function(){function e(){(0,o._)(this,e),this._queue=new rX}return(0,l._)(e,[{key:"set",value:function(e){this._queue.clear(),this._queue.enqueue(e)}},{key:"flush",value:function(){this._queue.flush()}}]),e}(),rG=function(e){function i(e,r,n,a,l,c,h,u,f){var d;return(0,o._)(this,i),(d=(0,s._)(this,i))._rowCount=e,d._optionsService=n,d._charSizeService=a,d._coreService=l,d._coreBrowserService=u,d._renderer=d._register(new ex),d._pausedResizeTask=new rj,d._observerDisposable=d._register(new ex),d._isPaused=!1,d._needsFullRefresh=!1,d._isNextRenderRedrawOnly=!0,d._needsSelectionRefresh=!1,d._canvasWidth=0,d._canvasHeight=0,d._selectionState={start:void 0,end:void 0,columnSelectMode:!1},d._onDimensionsChange=d._register(new e4),d.onDimensionsChange=d._onDimensionsChange.event,d._onRenderedViewportChange=d._register(new e4),d.onRenderedViewportChange=d._onRenderedViewportChange.event,d._onRender=d._register(new e4),d.onRender=d._onRender.event,d._onRefreshRequest=d._register(new e4),d.onRefreshRequest=d._onRefreshRequest.event,d._renderDebouncer=new rD(function(e,i){return d._renderRows(e,i)},d._coreBrowserService),d._register(d._renderDebouncer),d._syncOutputHandler=new rJ(d._coreBrowserService,d._coreService,function(){return d._fullRefresh()}),d._register(eb(function(){return d._syncOutputHandler.dispose()})),d._register(d._coreBrowserService.onDprChange(function(){return d.handleDevicePixelRatioChange()})),d._register(h.onResize(function(){return d._fullRefresh()})),d._register(h.buffers.onBufferActivate(function(){var e;return null==(e=d._renderer.value)?void 0:e.clear()})),d._register(d._optionsService.onOptionChange(function(){return d._handleOptionsChanged()})),d._register(d._charSizeService.onCharSizeChange(function(){return d.handleCharSizeChanged()})),d._register(c.onDecorationRegistered(function(){return d._fullRefresh()})),d._register(c.onDecorationRemoved(function(){return d._fullRefresh()})),d._register(d._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],function(){d.clear(),d.handleResize(h.cols,h.rows),d._fullRefresh()})),d._register(d._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],function(){return d.refreshRows(h.buffer.y,h.buffer.y,!0)})),d._register(f.onChangeColors(function(){return d._fullRefresh()})),d._registerIntersectionObserver(d._coreBrowserService.window,r),d._register(d._coreBrowserService.onWindowChange(function(e){return d._registerIntersectionObserver(e,r)})),d}return(0,f._)(i,e),(0,l._)(i,[{key:"dimensions",get:function(){return this._renderer.value.dimensions}},{key:"_registerIntersectionObserver",value:function(e,i){var r=this;if("IntersectionObserver"in e){var n=new e.IntersectionObserver(function(e){return r._handleIntersectionChange(e[e.length-1])},{threshold:0});n.observe(i),this._observerDisposable.value=eb(function(){return n.disconnect()})}}},{key:"_handleIntersectionChange",value:function(e){this._isPaused=void 0===e.isIntersecting?0===e.intersectionRatio:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}},{key:"refreshRows",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput)return void this._syncOutputHandler.bufferRows(e,i);var n=this._syncOutputHandler.flush();n&&(e=Math.min(e,n.start),i=Math.max(i,n.end)),r||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,i,this._rowCount)}},{key:"_renderRows",value:function(e,i){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput)return void this._syncOutputHandler.bufferRows(e,i);e=Math.min(e,this._rowCount-1),i=Math.min(i,this._rowCount-1),this._renderer.value.renderRows(e,i),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:i}),this._onRender.fire({start:e,end:i}),this._isNextRenderRedrawOnly=!0}}},{key:"resize",value:function(e,i){this._rowCount=i,this._fireOnCanvasResize()}},{key:"_handleOptionsChanged",value:function(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}},{key:"_fireOnCanvasResize",value:function(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}},{key:"hasRenderer",value:function(){return!!this._renderer.value}},{key:"setRenderer",value:function(e){var i=this;this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(function(e){return i.refreshRows(e.start,e.end,!0)}),this._needsSelectionRefresh=!0,this._fullRefresh())}},{key:"addRefreshCallback",value:function(e){return this._renderDebouncer.addRefreshCallback(e)}},{key:"_fullRefresh",value:function(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}},{key:"clearTextureAtlas",value:function(){var e,i;this._renderer.value&&(null==(e=(i=this._renderer.value).clearTextureAtlas)||e.call(i),this._fullRefresh())}},{key:"handleDevicePixelRatioChange",value:function(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}},{key:"handleResize",value:function(e,i){var r=this;this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(function(){var n;return null==(n=r._renderer.value)?void 0:n.handleResize(e,i)}):this._renderer.value.handleResize(e,i),this._fullRefresh())}},{key:"handleCharSizeChanged",value:function(){var e;null==(e=this._renderer.value)||e.handleCharSizeChanged()}},{key:"handleBlur",value:function(){var e;null==(e=this._renderer.value)||e.handleBlur()}},{key:"handleFocus",value:function(){var e;null==(e=this._renderer.value)||e.handleFocus()}},{key:"handleSelectionChanged",value:function(e,i,r){var n;this._selectionState.start=e,this._selectionState.end=i,this._selectionState.columnSelectMode=r,null==(n=this._renderer.value)||n.handleSelectionChanged(e,i,r)}},{key:"handleCursorMove",value:function(){var e;null==(e=this._renderer.value)||e.handleCursorMove()}},{key:"clear",value:function(){var e;null==(e=this._renderer.value)||e.clear()}}]),i}(eC);rG=w([C(2,G),C(3,ee),C(4,V),C(5,$),C(6,U),C(7,et),C(8,eo)],rG);var rJ=function(){function e(i,r,n){(0,o._)(this,e),this._coreBrowserService=i,this._coreService=r,this._onTimeout=n,this._start=0,this._end=0,this._isBuffering=!1}return(0,l._)(e,[{key:"bufferRows",value:function(e,i){var r=this;this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,i)):(this._start=e,this._end=i,this._isBuffering=!0),void 0===this._timeout&&(this._timeout=this._coreBrowserService.window.setTimeout(function(){r._timeout=void 0,r._coreService.decPrivateModes.synchronizedOutput=!1,r._onTimeout()},1e3))}},{key:"flush",value:function(){if(void 0!==this._timeout&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),this._isBuffering){var e={start:this._start,end:this._end};return this._isBuffering=!1,e}}},{key:"dispose",value:function(){void 0!==this._timeout&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}}]),e}();function rZ(e,i,r,n){return r1(Math.abs(e-r$(e,r)-(i-r$(i,r)))-function(e,i,r){for(var n=0,s=e-r$(e,r),o=i-r$(i,r),a=0;a<Math.abs(s-o);a++){var l,c="A"===function(e,i){return e>i?"A":"B"}(e,i)?-1:1;(null==(l=r.buffer.lines.get(s+c*a))?void 0:l.isWrapped)&&n++}return n}(e,i,r),r0(e>i?"A":"B",n))}function r$(e,i){for(var r=0,n=i.buffer.lines.get(e),s=null==n?void 0:n.isWrapped;s&&e>=0&&e<i.rows;)r++,s=null==(n=i.buffer.lines.get(--e))?void 0:n.isWrapped;return r}function rQ(e,i,r,n,s,o){for(var a=e,l=i,c="";(a!==r||l!==n)&&l>=0&&l<o.buffer.lines.length;)a+=s?1:-1,s&&a>o.cols-1?(c+=o.buffer.translateBufferLineToString(l,!1,e,a),a=0,e=0,l++):!s&&a<0&&(c+=o.buffer.translateBufferLineToString(l,!1,0,e+1),e=a=o.cols-1,l--);return c+o.buffer.translateBufferLineToString(l,!1,e,a)}function r0(e,i){return i2.ESC+(i?"O":"[")+e}function r1(e,i){e=Math.floor(e);for(var r="",n=0;n<e;n++)r+=i;return r}var r2=function(){function e(i){(0,o._)(this,e),this._bufferService=i,this.isSelectAllActive=!1,this.selectionStartLength=0}return(0,l._)(e,[{key:"clearSelection",value:function(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}},{key:"finalSelectionStart",get:function(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}},{key:"finalSelectionEnd",get:function(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){var e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){var i=this.selectionStart[0]+this.selectionStartLength;return i>this._bufferService.cols?[i%this._bufferService.cols,this.selectionStart[1]+Math.floor(i/this._bufferService.cols)]:[Math.max(i,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}},{key:"areSelectionValuesReversed",value:function(){var e=this.selectionStart,i=this.selectionEnd;return!!e&&!!i&&(e[1]>i[1]||e[1]===i[1]&&e[0]>i[0])}},{key:"handleTrim",value:function(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}]),e}();function r3(e,i){if(e.start.y>e.end.y)throw Error("Buffer range end (".concat(e.end.x,", ").concat(e.end.y,") cannot be before start (").concat(e.start.x,", ").concat(e.start.y,")"));return i*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var r5=RegExp("","g"),r6=function(e){function i(e,r,n,a,l,c,h,u,f){var d;return(0,o._)(this,i),(d=(0,s._)(this,i))._element=e,d._screenElement=r,d._linkifier=n,d._bufferService=a,d._coreService=l,d._mouseService=c,d._optionsService=h,d._renderService=u,d._coreBrowserService=f,d._dragScrollAmount=0,d._enabled=!0,d._workCell=new H,d._mouseDownTimeStamp=0,d._oldHasSelection=!1,d._oldSelectionStart=void 0,d._oldSelectionEnd=void 0,d._onLinuxMouseSelection=d._register(new e4),d.onLinuxMouseSelection=d._onLinuxMouseSelection.event,d._onRedrawRequest=d._register(new e4),d.onRequestRedraw=d._onRedrawRequest.event,d._onSelectionChange=d._register(new e4),d.onSelectionChange=d._onSelectionChange.event,d._onRequestScrollLines=d._register(new e4),d.onRequestScrollLines=d._onRequestScrollLines.event,d._mouseMoveListener=function(e){return d._handleMouseMove(e)},d._mouseUpListener=function(e){return d._handleMouseUp(e)},d._coreService.onUserInput(function(){d.hasSelection&&d.clearSelection()}),d._trimListener=d._bufferService.buffer.lines.onTrim(function(e){return d._handleTrim(e)}),d._register(d._bufferService.buffers.onBufferActivate(function(e){return d._handleBufferActivate(e)})),d.enable(),d._model=new r2(d._bufferService),d._activeSelectionMode=0,d._register(eb(function(){d._removeMouseDownListeners()})),d._register(d._bufferService.onResize(function(e){e.rowsChanged&&d.clearSelection()})),d}return(0,f._)(i,e),(0,l._)(i,[{key:"reset",value:function(){this.clearSelection()}},{key:"disable",value:function(){this.clearSelection(),this._enabled=!1}},{key:"enable",value:function(){this._enabled=!0}},{key:"selectionStart",get:function(){return this._model.finalSelectionStart}},{key:"selectionEnd",get:function(){return this._model.finalSelectionEnd}},{key:"hasSelection",get:function(){var e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!!e&&!!i&&(e[0]!==i[0]||e[1]!==i[1])}},{key:"selectionText",get:function(){var e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;if(!e||!i)return"";var r=this._bufferService.buffer,n=[];if(3===this._activeSelectionMode){if(e[0]===i[0])return"";for(var s=e[0]<i[0]?e[0]:i[0],o=e[0]<i[0]?i[0]:e[0],a=e[1];a<=i[1];a++){var l=r.translateBufferLineToString(a,!0,s,o);n.push(l)}}else{var c=e[1]===i[1]?i[0]:void 0;n.push(r.translateBufferLineToString(e[1],!0,e[0],c));for(var h=e[1]+1;h<=i[1]-1;h++){var u=r.lines.get(h),f=r.translateBufferLineToString(h,!0);(null==u?void 0:u.isWrapped)?n[n.length-1]+=f:n.push(f)}if(e[1]!==i[1]){var d=r.lines.get(i[1]),_=r.translateBufferLineToString(i[1],!0,0,i[0]);d&&d.isWrapped?n[n.length-1]+=_:n.push(_)}}return n.map(function(e){return e.replace(r5," ")}).join(rF?"\r\n":"\n")}},{key:"clearSelection",value:function(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}},{key:"refresh",value:function(e){var i=this;this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){return i._refresh()})),rK&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}},{key:"_refresh",value:function(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}},{key:"_isClickInSelection",value:function(e){var i=this._getMouseBufferCoords(e),r=this._model.finalSelectionStart,n=this._model.finalSelectionEnd;return!!r&&!!n&&!!i&&this._areCoordsInSelection(i,r,n)}},{key:"isCellInSelection",value:function(e,i){var r=this._model.finalSelectionStart,n=this._model.finalSelectionEnd;return!!r&&!!n&&this._areCoordsInSelection([e,i],r,n)}},{key:"_areCoordsInSelection",value:function(e,i,r){return e[1]>i[1]&&e[1]<r[1]||i[1]===r[1]&&e[1]===i[1]&&e[0]>=i[0]&&e[0]<r[0]||i[1]<r[1]&&e[1]===r[1]&&e[0]<r[0]||i[1]<r[1]&&e[1]===i[1]&&e[0]>=i[0]}},{key:"_selectWordAtCursor",value:function(e,i){var r,n,s=null==(n=this._linkifier.currentLink)||null==(r=n.link)?void 0:r.range;if(s)return this._model.selectionStart=[s.start.x-1,s.start.y-1],this._model.selectionStartLength=r3(s,this._bufferService.cols),this._model.selectionEnd=void 0,!0;var o=this._getMouseBufferCoords(e);return!!o&&(this._selectWordAt(o,i),this._model.selectionEnd=void 0,!0)}},{key:"selectAll",value:function(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}},{key:"selectLines",value:function(e,i){this._model.clearSelection(),e=Math.max(e,0),i=Math.min(i,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,i],this.refresh(),this._onSelectionChange.fire()}},{key:"_handleTrim",value:function(e){this._model.handleTrim(e)&&this.refresh()}},{key:"_getMouseBufferCoords",value:function(e){var i=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(i)return i[0]--,i[1]--,i[1]+=this._bufferService.buffer.ydisp,i}},{key:"_getMouseEventScrollAmount",value:function(e){var i=rx(this._coreBrowserService.window,e,this._screenElement)[1],r=this._renderService.dimensions.css.canvas.height;return i>=0&&i<=r?0:(i>r&&(i-=r),(i=Math.min(Math.max(i,-50),50)/50)/Math.abs(i)+Math.round(14*i))}},{key:"shouldForceSelection",value:function(e){return rH?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}},{key:"handleMouseDown",value:function(e){if(this._mouseDownTimeStamp=e.timeStamp,!(2===e.button&&this.hasSelection)&&0===e.button){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):1===e.detail?this._handleSingleClick(e):2===e.detail?this._handleDoubleClick(e):3===e.detail&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}},{key:"_addMouseDownListeners",value:function(){var e=this;this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(function(){return e._dragScroll()},50)}},{key:"_removeMouseDownListeners",value:function(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}},{key:"_handleIncrementalClick",value:function(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}},{key:"_handleSingleClick",value:function(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=3*!!this.shouldColumnSelect(e),this._model.selectionStart=this._getMouseBufferCoords(e),this._model.selectionStart){this._model.selectionEnd=void 0;var i=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);i&&i.length!==this._model.selectionStart[0]&&0===i.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}}},{key:"_handleDoubleClick",value:function(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}},{key:"_handleTripleClick",value:function(e){var i=this._getMouseBufferCoords(e);i&&(this._activeSelectionMode=2,this._selectLineAt(i[1]))}},{key:"shouldColumnSelect",value:function(e){return e.altKey&&!(rH&&this._optionsService.rawOptions.macOptionClickForcesSelection)}},{key:"_handleMouseMove",value:function(e){if(e.stopImmediatePropagation(),this._model.selectionStart){var i=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));var r=this._bufferService.buffer;if(this._model.selectionEnd[1]<r.lines.length){var n=r.lines.get(this._model.selectionEnd[1]);n&&0===n.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}i&&i[0]===this._model.selectionEnd[0]&&i[1]===this._model.selectionEnd[1]||this.refresh(!0)}}},{key:"_dragScroll",value:function(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});var e=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}},{key:"_handleMouseUp",value:function(e){var i=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&i<500&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){var r=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(r&&void 0!==r[0]&&void 0!==r[1]){var n=function(e,i,r,n){var s,o,a,l,c,h,u,f,d,_,v,g,p,y,m,S,k,b,w,C,x,E,D=r.buffer.x,B=r.buffer.y;if(!r.buffer.hasScrollback){return s=D,a=0,(0===rZ(o=B,i,l=r,c=n).length?"":r1(rQ(s,o,s,o-r$(o,l),!1,l).length,r0("D",c)))+rZ(B,i,r,n)+(h=D,u=B,f=e,b=rZ(u,d=i,_=r,v=n).length>0?d-r$(d,_):u,w=(g=h,p=u,k=rZ(y=f,m=d,S=_,v).length>0?m-r$(m,S):p,g<y&&k<=m||g>=y&&k<m?"C":"D"),r1(rQ(h,b,f,d,"C"===w,_).length,r0(w,v)))}if(B===i)return E=D>e?"D":"C",r1(Math.abs(D-e),r0(E,n));E=B>i?"D":"C";var R=Math.abs(B-i);return r1((C=B>i?e:D,r.cols-C+(R-1)*r.cols+1+(x=0,(B>i?D:e)-1)),r0(E,n))}(r[0]-1,r[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(n,!0)}}}else this._fireEventIfSelectionChanged()}},{key:"_fireEventIfSelectionChanged",value:function(){var e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd,r=!!e&&!!i&&(e[0]!==i[0]||e[1]!==i[1]);if(!r){this._oldHasSelection&&this._fireOnSelectionChange(e,i,r);return}!e||!i||this._oldSelectionStart&&this._oldSelectionEnd&&e[0]===this._oldSelectionStart[0]&&e[1]===this._oldSelectionStart[1]&&i[0]===this._oldSelectionEnd[0]&&i[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(e,i,r)}},{key:"_fireOnSelectionChange",value:function(e,i,r){this._oldSelectionStart=e,this._oldSelectionEnd=i,this._oldHasSelection=r,this._onSelectionChange.fire()}},{key:"_handleBufferActivate",value:function(e){var i=this;this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(function(e){return i._handleTrim(e)})}},{key:"_convertViewportColToCharacterIndex",value:function(e,i){for(var r=i,n=0;i>=n;n++){var s=e.loadCell(n,this._workCell).getChars().length;0===this._workCell.getWidth()?r--:s>1&&i!==n&&(r+=s-1)}return r}},{key:"setSelection",value:function(e,i,r){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,i],this._model.selectionStartLength=r,this.refresh(),this._fireEventIfSelectionChanged()}},{key:"rightClickSelect",value:function(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}},{key:"_getWordAt",value:function(e,i){var r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(!(e[0]>=this._bufferService.cols)){var s=this._bufferService.buffer,o=s.lines.get(e[1]);if(o){var a=s.translateBufferLineToString(e[1],!1),l=this._convertViewportColToCharacterIndex(o,e[0]),c=l,h=e[0]-l,u=0,f=0,d=0,_=0;if(" "===a.charAt(l)){for(;l>0&&" "===a.charAt(l-1);)l--;for(;c<a.length&&" "===a.charAt(c+1);)c++}else{var v=e[0],g=e[0];0===o.getWidth(v)&&(u++,v--),2===o.getWidth(g)&&(f++,g++);var p=o.getString(g).length;for(p>1&&(_+=p-1,c+=p-1);v>0&&l>0&&!this._isCharWordSeparator(o.loadCell(v-1,this._workCell));){o.loadCell(v-1,this._workCell);var y=this._workCell.getChars().length;0===this._workCell.getWidth()?(u++,v--):y>1&&(d+=y-1,l-=y-1),l--,v--}for(;g<o.length&&c+1<a.length&&!this._isCharWordSeparator(o.loadCell(g+1,this._workCell));){o.loadCell(g+1,this._workCell);var m=this._workCell.getChars().length;2===this._workCell.getWidth()?(f++,g++):m>1&&(_+=m-1,c+=m-1),c++,g++}}c++;var S=l+h-u+d,k=Math.min(this._bufferService.cols,c-l+u+f-d-_);if(!(!i&&""===a.slice(l,c).trim())){if(r&&0===S&&32!==o.getCodePoint(0)){var b=s.lines.get(e[1]-1);if(b&&o.isWrapped&&32!==b.getCodePoint(this._bufferService.cols-1)){var w=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(w){var C=this._bufferService.cols-w.start;S-=C,k+=C}}}if(n&&S+k===this._bufferService.cols&&32!==o.getCodePoint(this._bufferService.cols-1)){var x=s.lines.get(e[1]+1);if((null==x?void 0:x.isWrapped)&&32!==x.getCodePoint(0)){var E=this._getWordAt([0,e[1]+1],!1,!1,!0);E&&(k+=E.length)}}return{start:S,length:k}}}}}},{key:"_selectWordAt",value:function(e,i){var r=this._getWordAt(e,i);if(r){for(;r.start<0;)r.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[r.start,e[1]],this._model.selectionStartLength=r.length}}},{key:"_selectToWordAt",value:function(e){var i=this._getWordAt(e,!0);if(i){for(var r=e[1];i.start<0;)i.start+=this._bufferService.cols,r--;if(!this._model.areSelectionValuesReversed())for(;i.start+i.length>this._bufferService.cols;)i.length-=this._bufferService.cols,r++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?i.start:i.start+i.length,r]}}},{key:"_isCharWordSeparator",value:function(e){return 0!==e.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}},{key:"_selectLineAt",value:function(e){var i=this._bufferService.buffer.getWrappedRangeForLine(e),r={start:{x:0,y:i.first},end:{x:this._bufferService.cols-1,y:i.last}};this._model.selectionStart=[0,i.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=r3(r,this._bufferService.cols)}}]),i}(eC);r6=w([C(3,U),C(4,V),C(5,ei),C(6,G),C(7,er),C(8,et)],r6);var r4=function(){function e(){(0,o._)(this,e),this._data={}}return(0,l._)(e,[{key:"set",value:function(e,i,r){this._data[e]||(this._data[e]={}),this._data[e][i]=r}},{key:"get",value:function(e,i){return this._data[e]?this._data[e][i]:void 0}},{key:"clear",value:function(){this._data={}}}]),e}(),r8=function(){function e(){(0,o._)(this,e),this._color=new r4,this._css=new r4}return(0,l._)(e,[{key:"setCss",value:function(e,i,r){this._css.set(e,i,r)}},{key:"getCss",value:function(e,i){return this._css.get(e,i)}},{key:"setColor",value:function(e,i,r){this._color.set(e,i,r)}},{key:"getColor",value:function(e,i){return this._color.get(e,i)}},{key:"clear",value:function(){this._color.clear(),this._css.clear()}}]),e}(),r7=Object.freeze(function(){for(var e=[nF.toColor("#2e3436"),nF.toColor("#cc0000"),nF.toColor("#4e9a06"),nF.toColor("#c4a000"),nF.toColor("#3465a4"),nF.toColor("#75507b"),nF.toColor("#06989a"),nF.toColor("#d3d7cf"),nF.toColor("#555753"),nF.toColor("#ef2929"),nF.toColor("#8ae234"),nF.toColor("#fce94f"),nF.toColor("#729fcf"),nF.toColor("#ad7fa8"),nF.toColor("#34e2e2"),nF.toColor("#eeeeec")],i=[0,95,135,175,215,255],r=0;r<216;r++){var n=i[r/36%6|0],s=i[r/6%6|0],o=i[r%6];e.push({css:i6.toCss(n,s,o),rgba:i6.toRgba(n,s,o)})}for(var a=0;a<24;a++){var l=8+10*a;e.push({css:i6.toCss(l,l,l),rgba:i6.toRgba(l,l,l)})}return e}()),r9=nF.toColor("#ffffff"),ne=nF.toColor("#000000"),nt=nF.toColor("#ffffff"),ni={css:"rgba(255, 255, 255, 0.3)",rgba:0xffffff4d},nr=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._optionsService=e,r._contrastCache=new r8,r._halfContrastCache=new r8,r._onChangeColors=r._register(new e4),r.onChangeColors=r._onChangeColors.event,r._colors={foreground:r9,background:ne,cursor:nt,cursorAccent:ne,selectionForeground:void 0,selectionBackgroundTransparent:ni,selectionBackgroundOpaque:nz.blend(ne,ni),selectionInactiveBackgroundTransparent:ni,selectionInactiveBackgroundOpaque:nz.blend(ne,ni),scrollbarSliderBackground:nz.opacity(r9,.2),scrollbarSliderHoverBackground:nz.opacity(r9,.4),scrollbarSliderActiveBackground:nz.opacity(r9,.5),overviewRulerBorder:r9,ansi:r7.slice(),contrastCache:r._contrastCache,halfContrastCache:r._halfContrastCache},r._updateRestoreColors(),r._setTheme(r._optionsService.rawOptions.theme),r._register(r._optionsService.onSpecificOptionChange("minimumContrastRatio",function(){return r._contrastCache.clear()})),r._register(r._optionsService.onSpecificOptionChange("theme",function(){return r._setTheme(r._optionsService.rawOptions.theme)})),r}return(0,f._)(i,e),(0,l._)(i,[{key:"colors",get:function(){return this._colors}},{key:"_setTheme",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this._colors;if(i.foreground=nn(e.foreground,r9),i.background=nn(e.background,ne),i.cursor=nz.blend(i.background,nn(e.cursor,nt)),i.cursorAccent=nz.blend(i.background,nn(e.cursorAccent,ne)),i.selectionBackgroundTransparent=nn(e.selectionBackground,ni),i.selectionBackgroundOpaque=nz.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=nn(e.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=nz.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=e.selectionForeground?nn(e.selectionForeground,re):void 0,i.selectionForeground===re&&(i.selectionForeground=void 0),nz.isOpaque(i.selectionBackgroundTransparent)&&(i.selectionBackgroundTransparent=nz.opacity(i.selectionBackgroundTransparent,.3)),nz.isOpaque(i.selectionInactiveBackgroundTransparent)&&(i.selectionInactiveBackgroundTransparent=nz.opacity(i.selectionInactiveBackgroundTransparent,.3)),i.scrollbarSliderBackground=nn(e.scrollbarSliderBackground,nz.opacity(i.foreground,.2)),i.scrollbarSliderHoverBackground=nn(e.scrollbarSliderHoverBackground,nz.opacity(i.foreground,.4)),i.scrollbarSliderActiveBackground=nn(e.scrollbarSliderActiveBackground,nz.opacity(i.foreground,.5)),i.overviewRulerBorder=nn(e.overviewRulerBorder,r9),i.ansi=r7.slice(),i.ansi[0]=nn(e.black,r7[0]),i.ansi[1]=nn(e.red,r7[1]),i.ansi[2]=nn(e.green,r7[2]),i.ansi[3]=nn(e.yellow,r7[3]),i.ansi[4]=nn(e.blue,r7[4]),i.ansi[5]=nn(e.magenta,r7[5]),i.ansi[6]=nn(e.cyan,r7[6]),i.ansi[7]=nn(e.white,r7[7]),i.ansi[8]=nn(e.brightBlack,r7[8]),i.ansi[9]=nn(e.brightRed,r7[9]),i.ansi[10]=nn(e.brightGreen,r7[10]),i.ansi[11]=nn(e.brightYellow,r7[11]),i.ansi[12]=nn(e.brightBlue,r7[12]),i.ansi[13]=nn(e.brightMagenta,r7[13]),i.ansi[14]=nn(e.brightCyan,r7[14]),i.ansi[15]=nn(e.brightWhite,r7[15]),e.extendedAnsi)for(var r=Math.min(i.ansi.length-16,e.extendedAnsi.length),n=0;n<r;n++)i.ansi[n+16]=nn(e.extendedAnsi[n],r7[n+16]);this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}},{key:"restoreColor",value:function(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}},{key:"_restoreColor",value:function(e){if(void 0===e){for(var i=0;i<this._restoreColors.ansi.length;++i)this._colors.ansi[i]=this._restoreColors.ansi[i];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}},{key:"modifyColors",value:function(e){e(this._colors),this._onChangeColors.fire(this.colors)}},{key:"_updateRestoreColors",value:function(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}}]),i}(eC);function nn(e,i){if(void 0!==e)try{return nF.toColor(e)}catch(e){}return i}nr=w([C(0,G)],nr);var ns=function(){function e(){for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];(0,o._)(this,e),this._entries=new Map;var s=!0,a=!1,l=void 0;try{for(var c,h=r[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var u=(0,v._)(c.value,2),f=u[0],d=u[1];this.set(f,d)}}catch(e){a=!0,l=e}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}}return(0,l._)(e,[{key:"set",value:function(e,i){var r=this._entries.get(e);return this._entries.set(e,i),r}},{key:"forEach",value:function(e){var i=!0,r=!1,n=void 0;try{for(var s,o=this._entries.entries()[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var a=(0,v._)(s.value,2),l=a[0],c=a[1];e(l,c)}}catch(e){r=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"has",value:function(e){return this._entries.has(e)}},{key:"get",value:function(e){return this._entries.get(e)}}]),e}(),no=function(){function e(){(0,o._)(this,e),this._services=new ns,this._services.set(X,this)}return(0,l._)(e,[{key:"setService",value:function(e,i){this._services.set(e,i)}},{key:"getService",value:function(e){return this._services.get(e)}},{key:"createInstance",value:function(e){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];var s=(e[z]||[]).sort(function(e,i){return e.index-i.index}),o=[],l=!0,c=!1,h=void 0;try{for(var u,f=s[Symbol.iterator]();!(l=(u=f.next()).done);l=!0){var d=u.value,_=this._services.get(d.id);if(!_)throw Error("[createInstance] ".concat(e.name," depends on UNKNOWN service ").concat(d.id._id,"."));o.push(_)}}catch(e){c=!0,h=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw h}}var v=s.length>0?s[0].index:r.length;if(r.length!==v)throw Error("[createInstance] First service dependency of ".concat(e.name," at position ").concat(v+1," conflicts with ").concat(r.length," static arguments"));return(0,a._)(e,(0,g._)(r).concat((0,g._)(o)))}}]),e}(),na={trace:0,debug:1,info:2,warn:3,error:4,off:5},nl=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._optionsService=e,r._logLevel=5,r._updateLogLevel(),r._register(r._optionsService.onSpecificOptionChange("logLevel",function(){return r._updateLogLevel()})),r}return(0,f._)(i,e),(0,l._)(i,[{key:"logLevel",get:function(){return this._logLevel}},{key:"_updateLogLevel",value:function(){this._logLevel=na[this._optionsService.rawOptions.logLevel]}},{key:"_evalLazyOptionalParams",value:function(e){for(var i=0;i<e.length;i++)"function"==typeof e[i]&&(e[i]=e[i]())}},{key:"_log",value:function(e,i,r){this._evalLazyOptionalParams(r),e.call.apply(e,[console,(this._optionsService.options.logger?"":"xterm.js: ")+i].concat((0,g._)(r)))}},{key:"trace",value:function(e){for(var i,r,n=arguments.length,s=Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];this._logLevel<=0&&this._log(null!=(r=null==(i=this._optionsService.options.logger)?void 0:i.trace.bind(this._optionsService.options.logger))?r:console.log,e,s)}},{key:"debug",value:function(e){for(var i,r,n=arguments.length,s=Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];this._logLevel<=1&&this._log(null!=(r=null==(i=this._optionsService.options.logger)?void 0:i.debug.bind(this._optionsService.options.logger))?r:console.log,e,s)}},{key:"info",value:function(e){for(var i,r,n=arguments.length,s=Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];this._logLevel<=2&&this._log(null!=(r=null==(i=this._optionsService.options.logger)?void 0:i.info.bind(this._optionsService.options.logger))?r:console.info,e,s)}},{key:"warn",value:function(e){for(var i,r,n=arguments.length,s=Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];this._logLevel<=3&&this._log(null!=(r=null==(i=this._optionsService.options.logger)?void 0:i.warn.bind(this._optionsService.options.logger))?r:console.warn,e,s)}},{key:"error",value:function(e){for(var i,r,n=arguments.length,s=Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];this._logLevel<=4&&this._log(null!=(r=null==(i=this._optionsService.options.logger)?void 0:i.error.bind(this._optionsService.options.logger))?r:console.error,e,s)}}]),i}(eC);nl=w([C(0,G)],nl);var nc=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._maxLength=e,r.onDeleteEmitter=r._register(new e4),r.onDelete=r.onDeleteEmitter.event,r.onInsertEmitter=r._register(new e4),r.onInsert=r.onInsertEmitter.event,r.onTrimEmitter=r._register(new e4),r.onTrim=r.onTrimEmitter.event,r._array=Array(r._maxLength),r._startIndex=0,r._length=0,r}return(0,f._)(i,e),(0,l._)(i,[{key:"maxLength",get:function(){return this._maxLength},set:function(e){if(this._maxLength!==e){for(var i=Array(e),r=0;r<Math.min(e,this.length);r++)i[r]=this._array[this._getCyclicIndex(r)];this._array=i,this._maxLength=e,this._startIndex=0}}},{key:"length",get:function(){return this._length},set:function(e){if(e>this._length)for(var i=this._length;i<e;i++)this._array[i]=void 0;this._length=e}},{key:"get",value:function(e){return this._array[this._getCyclicIndex(e)]}},{key:"set",value:function(e,i){this._array[this._getCyclicIndex(e)]=i}},{key:"push",value:function(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}},{key:"recycle",value:function(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}},{key:"isFull",get:function(){return this._length===this._maxLength}},{key:"pop",value:function(){return this._array[this._getCyclicIndex(this._length---1)]}},{key:"splice",value:function(e,i){for(var r=arguments.length,n=Array(r>2?r-2:0),s=2;s<r;s++)n[s-2]=arguments[s];if(i){for(var o=e;o<this._length-i;o++)this._array[this._getCyclicIndex(o)]=this._array[this._getCyclicIndex(o+i)];this._length-=i,this.onDeleteEmitter.fire({index:e,amount:i})}for(var a=this._length-1;a>=e;a--)this._array[this._getCyclicIndex(a+n.length)]=this._array[this._getCyclicIndex(a)];for(var l=0;l<n.length;l++)this._array[this._getCyclicIndex(e+l)]=n[l];if(n.length&&this.onInsertEmitter.fire({index:e,amount:n.length}),this._length+n.length>this._maxLength){var c=this._length+n.length-this._maxLength;this._startIndex+=c,this._length=this._maxLength,this.onTrimEmitter.fire(c)}else this._length+=n.length}},{key:"trimStart",value:function(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}},{key:"shiftElements",value:function(e,i,r){if(!(i<=0)){if(e<0||e>=this._length)throw Error("start argument out of range");if(e+r<0)throw Error("Cannot shift elements in list beyond index 0");if(r>0){for(var n=i-1;n>=0;n--)this.set(e+n+r,this.get(e+n));var s=e+i+r-this._length;if(s>0)for(this._length+=s;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(var o=0;o<i;o++)this.set(e+o+r,this.get(e+o))}}},{key:"_getCyclicIndex",value:function(e){return(this._startIndex+e)%this._maxLength}}]),i}(eC),nh=Object.freeze(new I),nu=0,nf=function(){function e(i,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,o._)(this,e),this.isWrapped=n,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*i);for(var s=r||H.fromCharData([0,"",1,0]),a=0;a<i;++a)this.setCell(a,s);this.length=i}return(0,l._)(e,[{key:"get",value:function(e){var i=this._data[3*e+0],r=2097151&i;return[this._data[3*e+1],2097152&i?this._combined[e]:r?P(r):"",i>>22,2097152&i?this._combined[e].charCodeAt(this._combined[e].length-1):r]}},{key:"set",value:function(e,i){this._data[3*e+1]=i[0],i[1].length>1?(this._combined[e]=i[1],this._data[3*e+0]=2097152|e|i[2]<<22):this._data[3*e+0]=i[1].charCodeAt(0)|i[2]<<22}},{key:"getWidth",value:function(e){return this._data[3*e+0]>>22}},{key:"hasWidth",value:function(e){return 0xc00000&this._data[3*e+0]}},{key:"getFg",value:function(e){return this._data[3*e+1]}},{key:"getBg",value:function(e){return this._data[3*e+2]}},{key:"hasContent",value:function(e){return 4194303&this._data[3*e+0]}},{key:"getCodePoint",value:function(e){var i=this._data[3*e+0];return 2097152&i?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&i}},{key:"isCombined",value:function(e){return 2097152&this._data[3*e+0]}},{key:"getString",value:function(e){var i=this._data[3*e+0];return 2097152&i?this._combined[e]:2097151&i?P(2097151&i):""}},{key:"isProtected",value:function(e){return 0x20000000&this._data[3*e+2]}},{key:"loadCell",value:function(e,i){return nu=3*e,i.content=this._data[nu+0],i.fg=this._data[nu+1],i.bg=this._data[nu+2],2097152&i.content&&(i.combinedData=this._combined[e]),0x10000000&i.bg&&(i.extended=this._extendedAttrs[e]),i}},{key:"setCell",value:function(e,i){2097152&i.content&&(this._combined[e]=i.combinedData),0x10000000&i.bg&&(this._extendedAttrs[e]=i.extended),this._data[3*e+0]=i.content,this._data[3*e+1]=i.fg,this._data[3*e+2]=i.bg}},{key:"setCellFromCodepoint",value:function(e,i,r,n){0x10000000&n.bg&&(this._extendedAttrs[e]=n.extended),this._data[3*e+0]=i|r<<22,this._data[3*e+1]=n.fg,this._data[3*e+2]=n.bg}},{key:"addCodepointToCell",value:function(e,i,r){var n=this._data[3*e+0];2097152&n?this._combined[e]+=P(i):2097151&n?(this._combined[e]=P(2097151&n)+P(i),n&=-2097152,n|=2097152):n=4194304|i,r&&(n&=-0xc00001,n|=r<<22),this._data[3*e+0]=n}},{key:"insertCells",value:function(e,i,r){if((e%=this.length)&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,r),i<this.length-e){for(var n=new H,s=this.length-e-i-1;s>=0;--s)this.setCell(e+i+s,this.loadCell(e+s,n));for(var o=0;o<i;++o)this.setCell(e+o,r)}else for(var a=e;a<this.length;++a)this.setCell(a,r);2===this.getWidth(this.length-1)&&this.setCellFromCodepoint(this.length-1,0,1,r)}},{key:"deleteCells",value:function(e,i,r){if(e%=this.length,i<this.length-e){for(var n=new H,s=0;s<this.length-e-i;++s)this.setCell(e+s,this.loadCell(e+i+s,n));for(var o=this.length-i;o<this.length;++o)this.setCell(o,r)}else for(var a=e;a<this.length;++a)this.setCell(a,r);e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,r),0!==this.getWidth(e)||this.hasContent(e)||this.setCellFromCodepoint(e,0,1,r)}},{key:"replaceCells",value:function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n){for(e&&2===this.getWidth(e-1)&&!this.isProtected(e-1)&&this.setCellFromCodepoint(e-1,0,1,r),i<this.length&&2===this.getWidth(i-1)&&!this.isProtected(i)&&this.setCellFromCodepoint(i,0,1,r);e<i&&e<this.length;)this.isProtected(e)||this.setCell(e,r),e++;return}for(e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,r),i<this.length&&2===this.getWidth(i-1)&&this.setCellFromCodepoint(i,0,1,r);e<i&&e<this.length;)this.setCell(e++,r)}},{key:"resize",value:function(e,i){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;var r=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*r)this._data=new Uint32Array(this._data.buffer,0,r);else{var n=new Uint32Array(r);n.set(this._data),this._data=n}for(var s=this.length;s<e;++s)this.setCell(s,i)}else{this._data=this._data.subarray(0,r);for(var o=Object.keys(this._combined),a=0;a<o.length;a++){var l=parseInt(o[a],10);l>=e&&delete this._combined[l]}for(var c=Object.keys(this._extendedAttrs),h=0;h<c.length;h++){var u=parseInt(c[h],10);u>=e&&delete this._extendedAttrs[u]}}return this.length=e,4*r*2<this._data.buffer.byteLength}},{key:"cleanupMemory",value:function(){if(4*this._data.length*2<this._data.buffer.byteLength){var e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}},{key:"fill",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i){for(var r=0;r<this.length;++r)this.isProtected(r)||this.setCell(r,e);return}this._combined={},this._extendedAttrs={};for(var n=0;n<this.length;++n)this.setCell(n,e)}},{key:"copyFrom",value:function(e){for(var i in this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={},e._combined)this._combined[i]=e._combined[i];for(var r in this._extendedAttrs={},e._extendedAttrs)this._extendedAttrs[r]=e._extendedAttrs[r];this.isWrapped=e.isWrapped}},{key:"clone",value:function(){var i=new e(0);for(var r in i._data=new Uint32Array(this._data),i.length=this.length,this._combined)i._combined[r]=this._combined[r];for(var n in this._extendedAttrs)i._extendedAttrs[n]=this._extendedAttrs[n];return i.isWrapped=this.isWrapped,i}},{key:"getTrimmedLength",value:function(){for(var e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}},{key:"getNoBgTrimmedLength",value:function(){for(var e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||0x3000000&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}},{key:"copyCellsFrom",value:function(e,i,r,n,s){var o=e._data;if(s)for(var a=n-1;a>=0;a--){for(var l=0;l<3;l++)this._data[(r+a)*3+l]=o[(i+a)*3+l];0x10000000&o[(i+a)*3+2]&&(this._extendedAttrs[r+a]=e._extendedAttrs[i+a])}else for(var c=0;c<n;c++){for(var h=0;h<3;h++)this._data[(r+c)*3+h]=o[(i+c)*3+h];0x10000000&o[(i+c)*3+2]&&(this._extendedAttrs[r+c]=e._extendedAttrs[i+c])}for(var u=Object.keys(e._combined),f=0;f<u.length;f++){var d=parseInt(u[f],10);d>=i&&(this._combined[d-i+r]=e._combined[d])}}},{key:"translateToString",value:function(e,i,r,n){i=null!=i?i:0,r=null!=r?r:this.length,e&&(r=Math.min(r,this.getTrimmedLength())),n&&(n.length=0);for(var s="";i<r;){var o=this._data[3*i+0],a=2097151&o,l=2097152&o?this._combined[i]:a?P(a):" ";if(s+=l,n)for(var c=0;c<l.length;++c)n.push(i);i+=o>>22||1}return n&&n.push(i),s}}]),e}();function nd(e,i,r){if(i===e.length-1)return e[i].getTrimmedLength();var n=!e[i].hasContent(r-1)&&1===e[i].getWidth(r-1),s=2===e[i+1].getWidth(0);return n&&s?r-1:r}var n_=function(){function e(i){(0,o._)(this,e),this.line=i,this.isDisposed=!1,this._disposables=[],this._id=e._nextId++,this._onDispose=this.register(new e4),this.onDispose=this._onDispose.event}return(0,l._)(e,[{key:"id",get:function(){return this._id}},{key:"dispose",value:function(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),eS(this._disposables),this._disposables.length=0)}},{key:"register",value:function(e){return this._disposables.push(e),e}}]),e}();n_._nextId=1;var nv={},ng=nv.B;nv[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},nv.A={"#":""},nv.B=void 0,nv[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},nv.C=nv[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},nv.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},nv.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},nv.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},nv.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},nv.E=nv[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},nv.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},nv.H=nv[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},nv["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var np=function(){function e(i,r,n){(0,o._)(this,e),this._hasScrollback=i,this._optionsService=r,this._bufferService=n,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=nh.clone(),this.savedCharset=ng,this.markers=[],this._nullCell=H.fromCharData([0,"",1,0]),this._whitespaceCell=H.fromCharData([0," ",1,32]),this._isClearing=!1,this._memoryCleanupQueue=new rX,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new nc(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}return(0,l._)(e,[{key:"getNullCell",value:function(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new N),this._nullCell}},{key:"getWhitespaceCell",value:function(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new N),this._whitespaceCell}},{key:"getBlankLine",value:function(e,i){return new nf(this._bufferService.cols,this.getNullCell(e),i)}},{key:"hasScrollback",get:function(){return this._hasScrollback&&this.lines.maxLength>this._rows}},{key:"isCursorInViewport",get:function(){var e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}},{key:"_getCorrectBufferLength",value:function(e){if(!this._hasScrollback)return e;var i=e+this._optionsService.rawOptions.scrollback;return i>0xffffffff?0xffffffff:i}},{key:"fillViewportRows",value:function(e){if(0===this.lines.length){void 0===e&&(e=nh);for(var i=this._rows;i--;)this.lines.push(this.getBlankLine(e))}}},{key:"clear",value:function(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new nc(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}},{key:"resize",value:function(e,i){var r=this,n=this.getNullCell(nh),s=0,o=this._getCorrectBufferLength(i);if(o>this.lines.maxLength&&(this.lines.maxLength=o),this.lines.length>0){if(this._cols<e)for(var a=0;a<this.lines.length;a++)s+=+this.lines.get(a).resize(e,n);var l=0;if(this._rows<i)for(var c=this._rows;c<i;c++)this.lines.length<i+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new nf(e,n)):this.ybase>0&&this.lines.length<=this.ybase+this.y+l+1?(this.ybase--,l++,this.ydisp>0&&this.ydisp--):this.lines.push(new nf(e,n)));else for(var h=this._rows;h>i;h--)this.lines.length>i+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(o<this.lines.maxLength){var u=this.lines.length-o;u>0&&(this.lines.trimStart(u),this.ybase=Math.max(this.ybase-u,0),this.ydisp=Math.max(this.ydisp-u,0),this.savedY=Math.max(this.savedY-u,0)),this.lines.maxLength=o}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,i-1),l&&(this.y+=l),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=i-1,this._isReflowEnabled&&(this._reflow(e,i),this._cols>e))for(var f=0;f<this.lines.length;f++)s+=+this.lines.get(f).resize(e,n);this._cols=e,this._rows=i,this._memoryCleanupQueue.clear(),s>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(function(){return r._batchedMemoryCleanup()}))}},{key:"_batchedMemoryCleanup",value:function(){var e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);for(var i=0;this._memoryCleanupPosition<this.lines.length;)if((i+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory())>100)return!0;return e}},{key:"_isReflowEnabled",get:function(){var e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&"conpty"===e.backend&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}},{key:"_reflow",value:function(e,i){this._cols!==e&&(e>this._cols?this._reflowLarger(e,i):this._reflowSmaller(e,i))}},{key:"_reflowLarger",value:function(e,i){var r=this._optionsService.rawOptions.reflowCursorLine,n=function(e,i,r,n,s,o){for(var a=[],l=0;l<e.length-1;l++){var c=l,h=e.get(++c);if(h.isWrapped){for(var u=[e.get(l)];c<e.length&&h.isWrapped;)u.push(h),h=e.get(++c);if(!o&&n>=l&&n<c){l+=u.length-1;continue}for(var f=0,d=nd(u,0,i),_=1,v=0;_<u.length;){var g=nd(u,_,i),p=Math.min(g-v,r-d);u[f].copyCellsFrom(u[_],v,d,p,!1),(d+=p)===r&&(f++,d=0),(v+=p)===g&&(_++,v=0),0===d&&0!==f&&2===u[f-1].getWidth(r-1)&&(u[f].copyCellsFrom(u[f-1],r-1,d++,1,!1),u[f-1].setCell(r-1,s))}u[f].replaceCells(d,r,s);for(var y=0,m=u.length-1;m>0&&(m>f||0===u[m].getTrimmedLength());m--)y++;y>0&&(a.push(l+u.length-y),a.push(y)),l+=u.length-1}}return a}(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(nh),r);if(n.length>0){var s=function(e,i){for(var r=[],n=0,s=i[0],o=0,a=0;a<e.length;a++)if(s===a){var l=i[++n];e.onDeleteEmitter.fire({index:a-o,amount:l}),a+=l-1,o+=l,s=i[++n]}else r.push(a);return{layout:r,countRemoved:o}}(this.lines,n);(function(e,i){for(var r=[],n=0;n<i.length;n++)r.push(e.get(i[n]));for(var s=0;s<r.length;s++)e.set(s,r[s]);e.length=i.length})(this.lines,s.layout),this._reflowLargerAdjustViewport(e,i,s.countRemoved)}}},{key:"_reflowLargerAdjustViewport",value:function(e,i,r){for(var n=this.getNullCell(nh),s=r;s-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<i&&this.lines.push(new nf(e,n))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-r,0)}},{key:"_reflowSmaller",value:function(e,i){for(var r=this._optionsService.rawOptions.reflowCursorLine,n=this.getNullCell(nh),s=[],o=0,a=this.lines.length-1;a>=0;a--){var l=this.lines.get(a);if(!(!l||!l.isWrapped&&l.getTrimmedLength()<=e)){for(var c=[l];l.isWrapped&&a>0;)l=this.lines.get(--a),c.unshift(l);if(!r){var h=this.ybase+this.y;if(h>=a&&h<a+c.length)continue}var u=c[c.length-1].getTrimmedLength(),f=function(e,i,r){for(var n=[],s=e.map(function(r,n){return nd(e,n,i)}).reduce(function(e,i){return e+i}),o=0,a=0,l=0;l<s;){if(s-l<r){n.push(s-l);break}o+=r;var c=nd(e,a,i);o>c&&(o-=c,a++);var h=2===e[a].getWidth(o-1);h&&o--;var u=h?r-1:r;n.push(u),l+=u}return n}(c,this._cols,e),d=f.length-c.length,_=void 0;_=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+d):Math.max(0,this.lines.length-this.lines.maxLength+d);for(var v=[],p=0;p<d;p++){var y=this.getBlankLine(nh,!0);v.push(y)}v.length>0&&(s.push({start:a+c.length+o,newLines:v}),o+=v.length),c.push.apply(c,(0,g._)(v));var m=f.length-1,S=f[m];0===S&&(S=f[--m]);for(var k=c.length-d-1,b=u;k>=0;){var w=Math.min(b,S);if(void 0===c[m])break;c[m].copyCellsFrom(c[k],b-w,S-w,w,!0),0==(S-=w)&&(S=f[--m]),0==(b-=w)&&(b=nd(c,Math.max(--k,0),this._cols))}for(var C=0;C<c.length;C++)f[C]<e&&c[C].setCell(f[C],n);for(var x=d-_;x-- >0;)0===this.ybase?this.y<i-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+o)-i&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+d,this.ybase+i-1)}}if(s.length>0){for(var E=[],D=[],B=0;B<this.lines.length;B++)D.push(this.lines.get(B));var R=this.lines.length,M=R-1,L=0,P=s[0];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+o);for(var T=0,A=Math.min(this.lines.maxLength-1,R+o-1);A>=0;A--)if(P&&P.start>M+T){for(var O=P.newLines.length-1;O>=0;O--)this.lines.set(A--,P.newLines[O]);A++,E.push({index:M+1,amount:P.newLines.length}),T+=P.newLines.length,P=s[++L]}else this.lines.set(A,D[M--]);for(var I=0,N=E.length-1;N>=0;N--)E[N].index+=I,this.lines.onInsertEmitter.fire(E[N]),I+=E[N].amount;var H=Math.max(0,R+o-this.lines.maxLength);H>0&&this.lines.onTrimEmitter.fire(H)}}},{key:"translateBufferLineToString",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,s=this.lines.get(e);return s?s.translateToString(i,r,n):""}},{key:"getWrappedRangeForLine",value:function(e){for(var i=e,r=e;i>0&&this.lines.get(i).isWrapped;)i--;for(;r+1<this.lines.length&&this.lines.get(r+1).isWrapped;)r++;return{first:i,last:r}}},{key:"setupTabStops",value:function(e){for(null!=e?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}},{key:"prevStop",value:function(e){for(null==e&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}},{key:"nextStop",value:function(e){for(null==e&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}},{key:"clearMarkers",value:function(e){this._isClearing=!0;for(var i=0;i<this.markers.length;i++)this.markers[i].line===e&&(this.markers[i].dispose(),this.markers.splice(i--,1));this._isClearing=!1}},{key:"clearAllMarkers",value:function(){this._isClearing=!0;for(var e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}},{key:"addMarker",value:function(e){var i=this,r=new n_(e);return this.markers.push(r),r.register(this.lines.onTrim(function(e){r.line-=e,r.line<0&&r.dispose()})),r.register(this.lines.onInsert(function(e){r.line>=e.index&&(r.line+=e.amount)})),r.register(this.lines.onDelete(function(e){r.line>=e.index&&r.line<e.index+e.amount&&r.dispose(),r.line>e.index&&(r.line-=e.amount)})),r.register(r.onDispose(function(){return i._removeMarker(r)})),r}},{key:"_removeMarker",value:function(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}]),e}(),ny=function(e){function i(e,r){var n;return(0,o._)(this,i),(n=(0,s._)(this,i))._optionsService=e,n._bufferService=r,n._onBufferActivate=n._register(new e4),n.onBufferActivate=n._onBufferActivate.event,n.reset(),n._register(n._optionsService.onSpecificOptionChange("scrollback",function(){return n.resize(n._bufferService.cols,n._bufferService.rows)})),n._register(n._optionsService.onSpecificOptionChange("tabStopWidth",function(){return n.setupTabStops()})),n}return(0,f._)(i,e),(0,l._)(i,[{key:"reset",value:function(){this._normal=new np(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new np(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}},{key:"alt",get:function(){return this._alt}},{key:"active",get:function(){return this._activeBuffer}},{key:"normal",get:function(){return this._normal}},{key:"activateNormalBuffer",value:function(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}},{key:"activateAltBuffer",value:function(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}},{key:"resize",value:function(e,i){this._normal.resize(e,i),this._alt.resize(e,i),this.setupTabStops(e)}},{key:"setupTabStops",value:function(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}]),i}(eC),nm=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i)).isUserScrolling=!1,r._onResize=r._register(new e4),r.onResize=r._onResize.event,r._onScroll=r._register(new e4),r.onScroll=r._onScroll.event,r.cols=Math.max(e.rawOptions.cols||0,2),r.rows=Math.max(e.rawOptions.rows||0,1),r.buffers=r._register(new ny(e,r)),r._register(r.buffers.onBufferActivate(function(e){r._onScroll.fire(e.activeBuffer.ydisp)})),r}return(0,f._)(i,e),(0,l._)(i,[{key:"buffer",get:function(){return this.buffers.active}},{key:"resize",value:function(e,i){var r=this.cols!==e,n=this.rows!==i;this.cols=e,this.rows=i,this.buffers.resize(e,i),this._onResize.fire({cols:e,rows:i,colsChanged:r,rowsChanged:n})}},{key:"reset",value:function(){this.buffers.reset(),this.isUserScrolling=!1}},{key:"scroll",value:function(e){var i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.buffer;(i=this._cachedBlankLine)&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=n.getBlankLine(e,r),this._cachedBlankLine=i),i.isWrapped=r;var s=n.ybase+n.scrollTop,o=n.ybase+n.scrollBottom;if(0===n.scrollTop){var a=n.lines.isFull;o===n.lines.length-1?a?n.lines.recycle().copyFrom(i):n.lines.push(i.clone()):n.lines.splice(o+1,0,i.clone()),a?this.isUserScrolling&&(n.ydisp=Math.max(n.ydisp-1,0)):(n.ybase++,this.isUserScrolling||n.ydisp++)}else{var l=o-s+1;n.lines.shiftElements(s+1,l-1,-1),n.lines.set(o,i.clone())}this.isUserScrolling||(n.ydisp=n.ybase),this._onScroll.fire(n.ydisp)}},{key:"scrollLines",value:function(e,i){var r=this.buffer;if(e<0){if(0===r.ydisp)return;this.isUserScrolling=!0}else e+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);var n=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+e,r.ybase),0),n!==r.ydisp&&(i||this._onScroll.fire(r.ydisp))}}]),i}(eC);nm=w([C(0,G)],nm);var nS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:rH,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},nk=["normal","bold","100","200","300","400","500","600","700","800","900"],nb=function(e){function i(e){(0,o._)(this,i),(r=(0,s._)(this,i))._onOptionChange=r._register(new e4),r.onOptionChange=r._onOptionChange.event;var r,n=(0,_._)({},nS);for(var a in e)if(a in n)try{var l=e[a];n[a]=r._sanitizeAndValidateOption(a,l)}catch(e){console.error(e)}return r.rawOptions=n,r.options=(0,_._)({},n),r._setupOptions(),r._register(eb(function(){r.rawOptions.linkHandler=null,r.rawOptions.documentOverride=null})),r}return(0,f._)(i,e),(0,l._)(i,[{key:"onSpecificOptionChange",value:function(e,i){var r=this;return this.onOptionChange(function(n){n===e&&i(r.rawOptions[e])})}},{key:"onMultipleOptionChange",value:function(e,i){return this.onOptionChange(function(r){-1!==e.indexOf(r)&&i()})}},{key:"_setupOptions",value:function(){var e=this,i=function(i){if(!(i in nS))throw Error('No option with key "'.concat(i,'"'));return e.rawOptions[i]},r=function(i,r){if(!(i in nS))throw Error('No option with key "'.concat(i,'"'));r=e._sanitizeAndValidateOption(i,r),e.rawOptions[i]!==r&&(e.rawOptions[i]=r,e._onOptionChange.fire(i))};for(var n in this.rawOptions){var s={get:i.bind(this,n),set:r.bind(this,n)};Object.defineProperty(this.options,n,s)}}},{key:"_sanitizeAndValidateOption",value:function(e,i){switch(e){case"cursorStyle":var r;if(i||(i=nS[e]),"block"!==(r=i)&&"underline"!==r&&"bar"!==r)throw Error('"'.concat(i,'" is not a valid value for ').concat(e));break;case"wordSeparator":i||(i=nS[e]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof i&&1<=i&&i<=1e3)break;i=nk.includes(i)?i:nS[e];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw Error("".concat(e," cannot be less than 1, value: ").concat(i));break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(10*i)/10));break;case"scrollback":if((i=Math.min(i,0xffffffff))<0)throw Error("".concat(e," cannot be less than 0, value: ").concat(i));break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw Error("".concat(e," cannot be less than or equal to 0, value: ").concat(i));break;case"rows":case"cols":if(!i&&0!==i)throw Error("".concat(e," must be numeric, value: ").concat(i));break;case"windowsPty":i=null!=i?i:{}}return i}}]),i}(eC);function nw(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if((void 0===e?"undefined":(0,p._)(e))!="object")return e;var r=Array.isArray(e)?[]:{};for(var n in e)r[n]=i<=1?e[n]:e[n]&&nw(e[n],i-1);return r}var nC=Object.freeze({insertMode:!1}),nx=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),nE=function(e){function i(e,r,n){var a;return(0,o._)(this,i),(a=(0,s._)(this,i))._bufferService=e,a._logService=r,a._optionsService=n,a.isCursorInitialized=!1,a.isCursorHidden=!1,a._onData=a._register(new e4),a.onData=a._onData.event,a._onUserInput=a._register(new e4),a.onUserInput=a._onUserInput.event,a._onBinary=a._register(new e4),a.onBinary=a._onBinary.event,a._onRequestScrollToBottom=a._register(new e4),a.onRequestScrollToBottom=a._onRequestScrollToBottom.event,a.modes=nw(nC),a.decPrivateModes=nw(nx),a}return(0,f._)(i,e),(0,l._)(i,[{key:"reset",value:function(){this.modes=nw(nC),this.decPrivateModes=nw(nx)}},{key:"triggerDataEvent",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._optionsService.rawOptions.disableStdin){var r=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&r.ybase!==r.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug('sending data "'.concat(e,'"')),this._logService.trace("sending data (codes)",function(){return e.split("").map(function(e){return e.charCodeAt(0)})}),this._onData.fire(e)}}},{key:"triggerBinaryEvent",value:function(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug('sending binary "'.concat(e,'"')),this._logService.trace("sending binary (codes)",function(){return e.split("").map(function(e){return e.charCodeAt(0)})}),this._onBinary.fire(e))}}]),i}(eC);nE=w([C(0,U),C(1,j),C(2,G)],nE);var nD={NONE:{events:0,restrict:function(){return!1}},X10:{events:1,restrict:function(e){return 4!==e.button&&1===e.action&&(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)}},VT200:{events:19,restrict:function(e){return 32!==e.action}},DRAG:{events:23,restrict:function(e){return 32!==e.action||3!==e.button}},ANY:{events:31,restrict:function(e){return!0}}};function nB(e,i){var r=16*!!e.ctrl|4*!!e.shift|8*!!e.alt;return 4===e.button?(r|=64,r|=e.action):(r|=3&e.button,4&e.button&&(r|=64),8&e.button&&(r|=128),32===e.action?r|=32:0!==e.action||i||(r|=3)),r}var nR=String.fromCharCode,nM={DEFAULT:function(e){var i=[nB(e,!1)+32,e.col+32,e.row+32];return i[0]>255||i[1]>255||i[2]>255?"":"\x1b[M".concat(nR(i[0])).concat(nR(i[1])).concat(nR(i[2]))},SGR:function(e){var i=0===e.action&&4!==e.button?"m":"M";return"\x1b[<".concat(nB(e,!0),";").concat(e.col,";").concat(e.row).concat(i)},SGR_PIXELS:function(e){var i=0===e.action&&4!==e.button?"m":"M";return"\x1b[<".concat(nB(e,!0),";").concat(e.x,";").concat(e.y).concat(i)}},nL=function(e){function i(e,r,n){(0,o._)(this,i),(h=(0,s._)(this,i))._bufferService=e,h._coreService=r,h._optionsService=n,h._protocols={},h._encodings={},h._activeProtocol="",h._activeEncoding="",h._lastEvent=null,h._wheelPartialScroll=0,h._onProtocolChange=h._register(new e4),h.onProtocolChange=h._onProtocolChange.event;var a=!0,l=!1,c=void 0;try{for(var h,u,f=Object.keys(nD)[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){var d=u.value;h.addProtocol(d,nD[d])}}catch(e){l=!0,c=e}finally{try{a||null==f.return||f.return()}finally{if(l)throw c}}var _=!0,v=!1,g=void 0;try{for(var p,y=Object.keys(nM)[Symbol.iterator]();!(_=(p=y.next()).done);_=!0){var m=p.value;h.addEncoding(m,nM[m])}}catch(e){v=!0,g=e}finally{try{_||null==y.return||y.return()}finally{if(v)throw g}}return h.reset(),h}return(0,f._)(i,e),(0,l._)(i,[{key:"addProtocol",value:function(e,i){this._protocols[e]=i}},{key:"addEncoding",value:function(e,i){this._encodings[e]=i}},{key:"activeProtocol",get:function(){return this._activeProtocol},set:function(e){if(!this._protocols[e])throw Error('unknown protocol "'.concat(e,'"'));this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}},{key:"areMouseEventsActive",get:function(){return 0!==this._protocols[this._activeProtocol].events}},{key:"activeEncoding",get:function(){return this._activeEncoding},set:function(e){if(!this._encodings[e])throw Error('unknown encoding "'.concat(e,'"'));this._activeEncoding=e}},{key:"reset",value:function(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}},{key:"consumeWheelEvent",value:function(e,i,r){if(0===e.deltaY||e.shiftKey||void 0===i||void 0===r)return 0;var n=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(n/=i/r+0,50>Math.abs(e.deltaY)&&(n*=.3),this._wheelPartialScroll+=n,n=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(n*=this._bufferService.rows),n}},{key:"_applyScrollModifier",value:function(e,i){return i.altKey||i.ctrlKey||i.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}},{key:"triggerMouseEvent",value:function(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||4===e.button&&32===e.action||3===e.button&&32!==e.action||4!==e.button&&(2===e.action||3===e.action)||(e.col++,e.row++,32===e.action&&this._lastEvent&&this._equalEvents(this._lastEvent,e,"SGR_PIXELS"===this._activeEncoding))||!this._protocols[this._activeProtocol].restrict(e))return!1;var i=this._encodings[this._activeEncoding](e);return i&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(i):this._coreService.triggerDataEvent(i,!0)),this._lastEvent=e,!0}},{key:"explainEvents",value:function(e){return{down:!!(1&e),up:!!(2&e),drag:!!(4&e),move:!!(8&e),wheel:!!(16&e)}}},{key:"_equalEvents",value:function(e,i,r){if(r){if(e.x!==i.x||e.y!==i.y)return!1}else if(e.col!==i.col||e.row!==i.row)return!1;return e.button===i.button&&e.action===i.action&&e.ctrl===i.ctrl&&e.alt===i.alt&&e.shift===i.shift}}]),i}(eC);nL=w([C(0,U),C(1,V),C(2,G)],nL);var nP,nT,nA,nO,nI,nN,nH,nW,nz,nF,nK,nU,nq,nV=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],nY=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],nX=function(){function e(){if((0,o._)(this,e),this.version="6",!nq){(nq=new Uint8Array(65536)).fill(1),nq[0]=0,nq.fill(0,1,32),nq.fill(0,127,160),nq.fill(2,4352,4448),nq[9001]=2,nq[9002]=2,nq.fill(2,11904,42192),nq[12351]=1,nq.fill(2,44032,55204),nq.fill(2,63744,64256),nq.fill(2,65040,65050),nq.fill(2,65072,65136),nq.fill(2,65280,65377),nq.fill(2,65504,65511);for(var i=0;i<nV.length;++i)nq.fill(0,nV[i][0],nV[i][1]+1)}}return(0,l._)(e,[{key:"wcwidth",value:function(e){return e<32?0:e<127?1:e<65536?nq[e]:!function(e,i){var r,n=0,s=i.length-1;if(e<i[0][0]||e>i[s][1])return!1;for(;s>=n;)if(e>i[r=n+s>>1][1])n=r+1;else{if(!(e<i[r][0]))return!0;s=r-1}return!1}(e,nY)?e>=131072&&e<=196605||e>=196608&&e<=262141?2:1:0}},{key:"charProperties",value:function(e,i){var r=this.wcwidth(e),n=0===r&&0!==i;if(n){var s=nj.extractWidth(i);0===s?n=!1:s>r&&(r=s)}return nj.createPropertyValue(0,r,n)}}]),e}(),nj=function(){function e(){(0,o._)(this,e),this._providers=Object.create(null),this._active="",this._onChange=new e4,this.onChange=this._onChange.event;var i=new nX;this.register(i),this._active=i.version,this._activeProvider=i}return(0,l._)(e,[{key:"dispose",value:function(){this._onChange.dispose()}},{key:"versions",get:function(){return Object.keys(this._providers)}},{key:"activeVersion",get:function(){return this._active},set:function(e){if(!this._providers[e])throw Error('unknown Unicode version "'.concat(e,'"'));this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}},{key:"register",value:function(e){this._providers[e.version]=e}},{key:"wcwidth",value:function(e){return this._activeProvider.wcwidth(e)}},{key:"getStringCellWidth",value:function(i){for(var r=0,n=0,s=i.length,o=0;o<s;++o){var a=i.charCodeAt(o);if(55296<=a&&a<=56319){if(++o>=s)return r+this.wcwidth(a);var l=i.charCodeAt(o);56320<=l&&l<=57343?a=(a-55296)*1024+l-56320+65536:r+=this.wcwidth(l)}var c=this.charProperties(a,n),h=e.extractWidth(c);e.extractShouldJoin(c)&&(h-=e.extractWidth(n)),r+=h,n=c}return r}},{key:"charProperties",value:function(e,i){return this._activeProvider.charProperties(e,i)}}],[{key:"extractShouldJoin",value:function(e){return(1&e)!=0}},{key:"extractWidth",value:function(e){return e>>1&3}},{key:"extractCharKind",value:function(e){return e>>3}},{key:"createPropertyValue",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0xffffff&e)<<3|(3&i)<<1|!!r}}]),e}(),nG=function(){function e(){(0,o._)(this,e),this.glevel=0,this._charsets=[]}return(0,l._)(e,[{key:"reset",value:function(){this.charset=void 0,this._charsets=[],this.glevel=0}},{key:"setgLevel",value:function(e){this.glevel=e,this.charset=this._charsets[e]}},{key:"setgCharset",value:function(e,i){this._charsets[e]=i,this.glevel===e&&(this.charset=i)}}]),e}();function nJ(e){var i,r=null==(i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1))?void 0:i.get(e.cols-1),n=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);n&&r&&(n.isWrapped=0!==r[3]&&32!==r[3])}var nZ=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;if((0,o._)(this,e),this.maxLength=i,this.maxSubParamsLength=r,r>256)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(i),this.length=0,this._subParams=new Int32Array(r),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(i),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}return(0,l._)(e,[{key:"clone",value:function(){var i=new e(this.maxLength,this.maxSubParamsLength);return i.params.set(this.params),i.length=this.length,i._subParams.set(this._subParams),i._subParamsLength=this._subParamsLength,i._subParamsIdx.set(this._subParamsIdx),i._rejectDigits=this._rejectDigits,i._rejectSubDigits=this._rejectSubDigits,i._digitIsSub=this._digitIsSub,i}},{key:"toArray",value:function(){for(var e=[],i=0;i<this.length;++i){e.push(this.params[i]);var r=this._subParamsIdx[i]>>8,n=255&this._subParamsIdx[i];n-r>0&&e.push(Array.prototype.slice.call(this._subParams,r,n))}return e}},{key:"reset",value:function(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}},{key:"addParam",value:function(e){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(e<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>0x7fffffff?0x7fffffff:e}},{key:"addSubParam",value:function(e){if(this._digitIsSub=!0,this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(e<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>0x7fffffff?0x7fffffff:e,this._subParamsIdx[this.length-1]++}}},{key:"hasSubParams",value:function(e){return(255&this._subParamsIdx[e])-(this._subParamsIdx[e]>>8)>0}},{key:"getSubParams",value:function(e){var i=this._subParamsIdx[e]>>8,r=255&this._subParamsIdx[e];return r-i>0?this._subParams.subarray(i,r):null}},{key:"getSubParamsAll",value:function(){for(var e={},i=0;i<this.length;++i){var r=this._subParamsIdx[i]>>8,n=255&this._subParamsIdx[i];n-r>0&&(e[i]=this._subParams.slice(r,n))}return e}},{key:"addDigit",value:function(e){if(!this._rejectDigits&&(i=this._digitIsSub?this._subParamsLength:this.length)&&(!this._digitIsSub||!this._rejectSubDigits)){var i,r=this._digitIsSub?this._subParams:this.params,n=r[i-1];r[i-1]=~n?Math.min(10*n+e,0x7fffffff):e}}}],[{key:"fromArray",value:function(i){var r=new e;if(!i.length)return r;for(var n=+!!Array.isArray(i[0]);n<i.length;++n){var s=i[n];if(Array.isArray(s))for(var o=0;o<s.length;++o)r.addSubParam(s[o]);else r.addParam(s)}return r}}]),e}(),n$=[],nQ=function(){function e(){(0,o._)(this,e),this._state=0,this._active=n$,this._id=-1,this._handlers=Object.create(null),this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return(0,l._)(e,[{key:"registerHandler",value:function(e,i){void 0===this._handlers[e]&&(this._handlers[e]=[]);var r=this._handlers[e];return r.push(i),{dispose:function(){var e=r.indexOf(i);-1!==e&&r.splice(e,1)}}}},{key:"clearHandler",value:function(e){this._handlers[e]&&delete this._handlers[e]}},{key:"setHandlerFallback",value:function(e){this._handlerFb=e}},{key:"dispose",value:function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=n$}},{key:"reset",value:function(){if(2===this._state)for(var e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=n$,this._id=-1,this._state=0}},{key:"_start",value:function(){if(this._active=this._handlers[this._id]||n$,this._active.length)for(var e=this._active.length-1;e>=0;e--)this._active[e].start();else this._handlerFb(this._id,"START")}},{key:"_put",value:function(e,i,r){if(this._active.length)for(var n=this._active.length-1;n>=0;n--)this._active[n].put(e,i,r);else this._handlerFb(this._id,"PUT",T(e,i,r))}},{key:"start",value:function(){this.reset(),this._state=1}},{key:"put",value:function(e,i,r){if(3!==this._state){if(1===this._state)for(;i<r;){var n=e[i++];if(59===n){this._state=2,this._start();break}if(n<48||57<n){this._state=3;return}-1===this._id&&(this._id=0),this._id=10*this._id+n-48}2===this._state&&r-i>0&&this._put(e,i,r)}}},{key:"end",value:function(e){var i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){var r=!1,n=this._active.length-1,s=!1;if(this._stack.paused&&(n=this._stack.loopPosition-1,r=i,s=this._stack.fallThrough,this._stack.paused=!1),!s&&!1===r){for(;n>=0&&!0!==(r=this._active[n].end(e));n--)if((0,d._)(r,Promise))return this._stack.paused=!0,this._stack.loopPosition=n,this._stack.fallThrough=!1,r;n--}for(;n>=0;n--)if(r=this._active[n].end(!1),(0,d._)(r,Promise))return this._stack.paused=!0,this._stack.loopPosition=n,this._stack.fallThrough=!0,r}else this._handlerFb(this._id,"END",e);this._active=n$,this._id=-1,this._state=0}}}]),e}(),n0=function(){function e(i){(0,o._)(this,e),this._handler=i,this._data="",this._hitLimit=!1}return(0,l._)(e,[{key:"start",value:function(){this._data="",this._hitLimit=!1}},{key:"put",value:function(e,i,r){this._hitLimit||(this._data+=T(e,i,r),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}},{key:"end",value:function(e){var i=this,r=!1;if(this._hitLimit)r=!1;else if(e&&(r=this._handler(this._data),(0,d._)(r,Promise)))return r.then(function(e){return i._data="",i._hitLimit=!1,e});return this._data="",this._hitLimit=!1,r}}]),e}(),n1=[],n2=function(){function e(){(0,o._)(this,e),this._handlers=Object.create(null),this._active=n1,this._ident=0,this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return(0,l._)(e,[{key:"dispose",value:function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=n1}},{key:"registerHandler",value:function(e,i){void 0===this._handlers[e]&&(this._handlers[e]=[]);var r=this._handlers[e];return r.push(i),{dispose:function(){var e=r.indexOf(i);-1!==e&&r.splice(e,1)}}}},{key:"clearHandler",value:function(e){this._handlers[e]&&delete this._handlers[e]}},{key:"setHandlerFallback",value:function(e){this._handlerFb=e}},{key:"reset",value:function(){if(this._active.length)for(var e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=n1,this._ident=0}},{key:"hook",value:function(e,i){if(this.reset(),this._ident=e,this._active=this._handlers[e]||n1,this._active.length)for(var r=this._active.length-1;r>=0;r--)this._active[r].hook(i);else this._handlerFb(this._ident,"HOOK",i)}},{key:"put",value:function(e,i,r){if(this._active.length)for(var n=this._active.length-1;n>=0;n--)this._active[n].put(e,i,r);else this._handlerFb(this._ident,"PUT",T(e,i,r))}},{key:"unhook",value:function(e){var i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this._active.length){var r=!1,n=this._active.length-1,s=!1;if(this._stack.paused&&(n=this._stack.loopPosition-1,r=i,s=this._stack.fallThrough,this._stack.paused=!1),!s&&!1===r){for(;n>=0&&!0!==(r=this._active[n].unhook(e));n--)if((0,d._)(r,Promise))return this._stack.paused=!0,this._stack.loopPosition=n,this._stack.fallThrough=!1,r;n--}for(;n>=0;n--)if(r=this._active[n].unhook(!1),(0,d._)(r,Promise))return this._stack.paused=!0,this._stack.loopPosition=n,this._stack.fallThrough=!0,r}else this._handlerFb(this._ident,"UNHOOK",e);this._active=n1,this._ident=0}}]),e}(),n3=new nZ;n3.addParam(0);var n5=function(){function e(i){(0,o._)(this,e),this._handler=i,this._data="",this._params=n3,this._hitLimit=!1}return(0,l._)(e,[{key:"hook",value:function(e){this._params=e.length>1||e.params[0]?e.clone():n3,this._data="",this._hitLimit=!1}},{key:"put",value:function(e,i,r){this._hitLimit||(this._data+=T(e,i,r),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}},{key:"unhook",value:function(e){var i=this,r=!1;if(this._hitLimit)r=!1;else if(e&&(r=this._handler(this._data,this._params),(0,d._)(r,Promise)))return r.then(function(e){return i._params=n3,i._data="",i._hitLimit=!1,e});return this._params=n3,this._data="",this._hitLimit=!1,r}}]),e}(),n6=function(){function e(i){(0,o._)(this,e),this.table=new Uint8Array(i)}return(0,l._)(e,[{key:"setDefault",value:function(e,i){this.table.fill(e<<4|i)}},{key:"add",value:function(e,i,r,n){this.table[i<<8|e]=r<<4|n}},{key:"addMany",value:function(e,i,r,n){for(var s=0;s<e.length;s++)this.table[i<<8|e[s]]=r<<4|n}}]),e}(),n4=function(){var e=new n6(4095),i=Array.apply(null,Array(256)).map(function(e,i){return i}),r=function(e,r){return i.slice(e,r)},n=r(32,127),s=r(0,24);s.push(25),s.push.apply(s,r(28,32));var o,a=r(0,14);for(o in e.setDefault(1,0),e.addMany(n,0,2,0),a)e.addMany([24,26,153,154],o,3,0),e.addMany(r(128,144),o,3,0),e.addMany(r(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(s,0,3,0),e.addMany(s,1,3,1),e.add(127,1,0,1),e.addMany(s,8,0,8),e.addMany(s,3,3,3),e.add(127,3,0,3),e.addMany(s,4,3,4),e.add(127,4,0,4),e.addMany(s,6,3,6),e.addMany(s,5,3,5),e.add(127,5,0,5),e.addMany(s,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(n,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(r(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(n,7,0,7),e.addMany(s,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(r(64,127),3,7,0),e.addMany(r(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(r(48,60),4,8,4),e.addMany(r(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(r(32,64),6,0,6),e.add(127,6,0,6),e.addMany(r(64,127),6,0,0),e.addMany(r(32,48),3,9,5),e.addMany(r(32,48),5,9,5),e.addMany(r(48,64),5,0,6),e.addMany(r(64,127),5,7,0),e.addMany(r(32,48),4,9,5),e.addMany(r(32,48),1,9,2),e.addMany(r(32,48),2,9,2),e.addMany(r(48,127),2,10,0),e.addMany(r(48,80),1,10,0),e.addMany(r(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(r(96,127),1,10,0),e.add(80,1,11,9),e.addMany(s,9,0,9),e.add(127,9,0,9),e.addMany(r(28,32),9,0,9),e.addMany(r(32,48),9,9,12),e.addMany(r(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(s,11,0,11),e.addMany(r(32,128),11,0,11),e.addMany(r(28,32),11,0,11),e.addMany(s,10,0,10),e.add(127,10,0,10),e.addMany(r(28,32),10,0,10),e.addMany(r(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(r(32,48),10,9,12),e.addMany(s,12,0,12),e.add(127,12,0,12),e.addMany(r(28,32),12,0,12),e.addMany(r(32,48),12,9,12),e.addMany(r(48,64),12,0,11),e.addMany(r(64,127),12,12,13),e.addMany(r(64,127),10,12,13),e.addMany(r(64,127),9,12,13),e.addMany(s,13,13,13),e.addMany(n,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(160,0,2,0),e.add(160,8,5,8),e.add(160,6,0,6),e.add(160,11,0,11),e.add(160,13,13,13),e}(),n8=function(e){function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n4;return(0,o._)(this,i),(e=(0,s._)(this,i))._transitions=r,e._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},e.initialState=0,e.currentState=e.initialState,e._params=new nZ,e._params.addParam(0),e._collect=0,e.precedingJoinState=0,e._printHandlerFb=function(e,i,r){},e._executeHandlerFb=function(e){},e._csiHandlerFb=function(e,i){},e._escHandlerFb=function(e){},e._errorHandlerFb=function(e){return e},e._printHandler=e._printHandlerFb,e._executeHandlers=Object.create(null),e._csiHandlers=Object.create(null),e._escHandlers=Object.create(null),e._register(eb(function(){e._csiHandlers=Object.create(null),e._executeHandlers=Object.create(null),e._escHandlers=Object.create(null)})),e._oscParser=e._register(new nQ),e._dcsParser=e._register(new n2),e._errorHandler=e._errorHandlerFb,e.registerEscHandler({final:"\\"},function(){return!0}),e}return(0,f._)(i,e),(0,l._)(i,[{key:"_identifier",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[64,126],r=0;if(e.prefix){if(e.prefix.length>1)throw Error("only one byte as prefix supported");if((r=e.prefix.charCodeAt(0))&&60>r||r>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(var n=0;n<e.intermediates.length;++n){var s=e.intermediates.charCodeAt(n);if(32>s||s>47)throw Error("intermediate must be in range 0x20 .. 0x2f");r<<=8,r|=s}}if(1!==e.final.length)throw Error("final must be a single byte");var o=e.final.charCodeAt(0);if(i[0]>o||o>i[1])throw Error("final must be in range ".concat(i[0]," .. ").concat(i[1]));return r<<=8,r|=o}},{key:"identToString",value:function(e){for(var i=[];e;)i.push(String.fromCharCode(255&e)),e>>=8;return i.reverse().join("")}},{key:"setPrintHandler",value:function(e){this._printHandler=e}},{key:"clearPrintHandler",value:function(){this._printHandler=this._printHandlerFb}},{key:"registerEscHandler",value:function(e,i){var r=this._identifier(e,[48,126]);void 0===this._escHandlers[r]&&(this._escHandlers[r]=[]);var n=this._escHandlers[r];return n.push(i),{dispose:function(){var e=n.indexOf(i);-1!==e&&n.splice(e,1)}}}},{key:"clearEscHandler",value:function(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}},{key:"setEscHandlerFallback",value:function(e){this._escHandlerFb=e}},{key:"setExecuteHandler",value:function(e,i){this._executeHandlers[e.charCodeAt(0)]=i}},{key:"clearExecuteHandler",value:function(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}},{key:"setExecuteHandlerFallback",value:function(e){this._executeHandlerFb=e}},{key:"registerCsiHandler",value:function(e,i){var r=this._identifier(e);void 0===this._csiHandlers[r]&&(this._csiHandlers[r]=[]);var n=this._csiHandlers[r];return n.push(i),{dispose:function(){var e=n.indexOf(i);-1!==e&&n.splice(e,1)}}}},{key:"clearCsiHandler",value:function(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}},{key:"setCsiHandlerFallback",value:function(e){this._csiHandlerFb=e}},{key:"registerDcsHandler",value:function(e,i){return this._dcsParser.registerHandler(this._identifier(e),i)}},{key:"clearDcsHandler",value:function(e){this._dcsParser.clearHandler(this._identifier(e))}},{key:"setDcsHandlerFallback",value:function(e){this._dcsParser.setHandlerFallback(e)}},{key:"registerOscHandler",value:function(e,i){return this._oscParser.registerHandler(e,i)}},{key:"clearOscHandler",value:function(e){this._oscParser.clearHandler(e)}},{key:"setOscHandlerFallback",value:function(e){this._oscParser.setHandlerFallback(e)}},{key:"setErrorHandler",value:function(e){this._errorHandler=e}},{key:"clearErrorHandler",value:function(){this._errorHandler=this._errorHandlerFb}},{key:"reset",value:function(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}},{key:"_preserveStack",value:function(e,i,r,n,s){this._parseStack.state=e,this._parseStack.handlers=i,this._parseStack.handlerPos=r,this._parseStack.transition=n,this._parseStack.chunkPos=s}},{key:"parse",value:function(e,i,r){var n,s=0,o=0,a=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,a=this._parseStack.chunkPos+1;else{if(void 0===r||1===this._parseStack.state)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");var l=this._parseStack.handlers,c=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===r&&c>-1){for(;c>=0&&!0!==(n=l[c](this._params));c--)if((0,d._)(n,Promise))return this._parseStack.handlerPos=c,n}this._parseStack.handlers=[];break;case 4:if(!1===r&&c>-1){for(;c>=0&&!0!==(n=l[c]());c--)if((0,d._)(n,Promise))return this._parseStack.handlerPos=c,n}this._parseStack.handlers=[];break;case 6:if(s=e[this._parseStack.chunkPos],n=this._dcsParser.unhook(24!==s&&26!==s,r))return n;27===s&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(s=e[this._parseStack.chunkPos],n=this._oscParser.end(24!==s&&26!==s,r))return n;27===s&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,a=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(var h=a;h<i;++h){switch(s=e[h],(o=this._transitions.table[this.currentState<<8|(s<160?s:160)])>>4){case 2:for(var u=h+1;;++u)if(u>=i||(s=e[u])<32||s>126&&s<160||++u>=i||(s=e[u])<32||s>126&&s<160||++u>=i||(s=e[u])<32||s>126&&s<160||++u>=i||(s=e[u])<32||s>126&&s<160){this._printHandler(e,h,u),h=u-1;break}break;case 3:this._executeHandlers[s]?this._executeHandlers[s]():this._executeHandlerFb(s),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:h,code:s,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:for(var f=this._csiHandlers[this._collect<<8|s],_=f?f.length-1:-1;_>=0&&!0!==(n=f[_](this._params));_--)if((0,d._)(n,Promise))return this._preserveStack(3,f,_,o,h),n;_<0&&this._csiHandlerFb(this._collect<<8|s,this._params),this.precedingJoinState=0;break;case 8:do switch(s){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(s-48)}while(++h<i&&(s=e[h])>47&&s<60)h--;break;case 9:this._collect<<=8,this._collect|=s;break;case 10:for(var v=this._escHandlers[this._collect<<8|s],g=v?v.length-1:-1;g>=0&&!0!==(n=v[g]());g--)if((0,d._)(n,Promise))return this._preserveStack(4,v,g,o,h),n;g<0&&this._escHandlerFb(this._collect<<8|s),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|s,this._params);break;case 13:for(var p=h+1;;++p)if(p>=i||24===(s=e[p])||26===s||27===s||s>127&&s<160){this._dcsParser.put(e,h,p),h=p-1;break}break;case 14:if(n=this._dcsParser.unhook(24!==s&&26!==s))return this._preserveStack(6,[],0,o,h),n;27===s&&(o|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(var y=h+1;;y++)if(y>=i||(s=e[y])<32||s>127&&s<160){this._oscParser.put(e,h,y),h=y-1;break}break;case 6:if(n=this._oscParser.end(24!==s&&26!==s))return this._preserveStack(5,[],0,o,h),n;27===s&&(o|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&o}}}]),i}(eC),n7=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,n9=/^[\da-f]+$/;function se(e){if(e){var i=e.toLowerCase();if(0===i.indexOf("rgb:")){i=i.slice(4);var r=n7.exec(i);if(r){var n=r[1]?15:r[4]?255:r[7]?4095:65535;return[Math.round(parseInt(r[1]||r[4]||r[7]||r[10],16)/n*255),Math.round(parseInt(r[2]||r[5]||r[8]||r[11],16)/n*255),Math.round(parseInt(r[3]||r[6]||r[9]||r[12],16)/n*255)]}}else if(0===i.indexOf("#")&&(i=i.slice(1),n9.exec(i)&&[3,6,9,12].includes(i.length))){for(var s=i.length/3,o=[0,0,0],a=0;a<3;++a){var l=parseInt(i.slice(s*a,s*a+s),16);o[a]=1===s?l<<4:2===s?l:3===s?l>>4:l>>8}return o}}}function st(e,i){var r=e.toString(16),n=r.length<2?"0"+r:r;switch(i){case 4:return r[0];case 8:return n;case 12:return(n+n).slice(0,3);default:return n+n}}var si={"(":0,")":1,"*":2,"+":3,"-":1,".":2};function sr(e,i){if(e>24)return i.setWinLines||!1;switch(e){case 1:return!!i.restoreWin;case 2:return!!i.minimizeWin;case 3:return!!i.setWinPosition;case 4:return!!i.setWinSizePixels;case 5:return!!i.raiseWin;case 6:return!!i.lowerWin;case 7:return!!i.refreshWin;case 8:return!!i.setWinSizeChars;case 9:return!!i.maximizeWin;case 10:return!!i.fullscreenWin;case 11:return!!i.getWinState;case 13:return!!i.getWinPosition;case 14:return!!i.getWinSizePixels;case 15:return!!i.getScreenSizePixels;case 16:return!!i.getCellSizePixels;case 18:return!!i.getWinSizeChars;case 19:return!!i.getScreenSizeChars;case 20:return!!i.getIconTitle;case 21:return!!i.getWinTitle;case 22:return!!i.pushTitle;case 23:return!!i.popTitle;case 24:return!!i.setWinLines}return!1}var sn=0,ss=function(e){function i(e,r,n,a,l,c,h,u){var f,d=function(e){f._parser.registerEscHandler({intermediates:"(",final:e},function(){return f.selectCharset("("+e)}),f._parser.registerEscHandler({intermediates:")",final:e},function(){return f.selectCharset(")"+e)}),f._parser.registerEscHandler({intermediates:"*",final:e},function(){return f.selectCharset("*"+e)}),f._parser.registerEscHandler({intermediates:"+",final:e},function(){return f.selectCharset("+"+e)}),f._parser.registerEscHandler({intermediates:"-",final:e},function(){return f.selectCharset("-"+e)}),f._parser.registerEscHandler({intermediates:".",final:e},function(){return f.selectCharset("."+e)}),f._parser.registerEscHandler({intermediates:"/",final:e},function(){return f.selectCharset("/"+e)})},_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new n8;for(var v in(0,o._)(this,i),(f=(0,s._)(this,i))._bufferService=e,f._charsetService=r,f._coreService=n,f._logService=a,f._optionsService=l,f._oscLinkService=c,f._coreMouseService=h,f._unicodeService=u,f._parser=_,f._parseBuffer=new Uint32Array(4096),f._stringDecoder=new A,f._utf8Decoder=new O,f._windowTitle="",f._iconName="",f._windowTitleStack=[],f._iconNameStack=[],f._curAttrData=nh.clone(),f._eraseAttrDataInternal=nh.clone(),f._onRequestBell=f._register(new e4),f.onRequestBell=f._onRequestBell.event,f._onRequestRefreshRows=f._register(new e4),f.onRequestRefreshRows=f._onRequestRefreshRows.event,f._onRequestReset=f._register(new e4),f.onRequestReset=f._onRequestReset.event,f._onRequestSendFocus=f._register(new e4),f.onRequestSendFocus=f._onRequestSendFocus.event,f._onRequestSyncScrollBar=f._register(new e4),f.onRequestSyncScrollBar=f._onRequestSyncScrollBar.event,f._onRequestWindowsOptionsReport=f._register(new e4),f.onRequestWindowsOptionsReport=f._onRequestWindowsOptionsReport.event,f._onA11yChar=f._register(new e4),f.onA11yChar=f._onA11yChar.event,f._onA11yTab=f._register(new e4),f.onA11yTab=f._onA11yTab.event,f._onCursorMove=f._register(new e4),f.onCursorMove=f._onCursorMove.event,f._onLineFeed=f._register(new e4),f.onLineFeed=f._onLineFeed.event,f._onScroll=f._register(new e4),f.onScroll=f._onScroll.event,f._onTitleChange=f._register(new e4),f.onTitleChange=f._onTitleChange.event,f._onColor=f._register(new e4),f.onColor=f._onColor.event,f._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},f._specialColors=[256,257,258],f._register(f._parser),f._dirtyRowTracker=new so(f._bufferService),f._activeBuffer=f._bufferService.buffer,f._register(f._bufferService.buffers.onBufferActivate(function(e){return f._activeBuffer=e.activeBuffer})),f._parser.setCsiHandlerFallback(function(e,i){f._logService.debug("Unknown CSI code: ",{identifier:f._parser.identToString(e),params:i.toArray()})}),f._parser.setEscHandlerFallback(function(e){f._logService.debug("Unknown ESC code: ",{identifier:f._parser.identToString(e)})}),f._parser.setExecuteHandlerFallback(function(e){f._logService.debug("Unknown EXECUTE code: ",{code:e})}),f._parser.setOscHandlerFallback(function(e,i,r){f._logService.debug("Unknown OSC code: ",{identifier:e,action:i,data:r})}),f._parser.setDcsHandlerFallback(function(e,i,r){"HOOK"===i&&(r=r.toArray()),f._logService.debug("Unknown DCS code: ",{identifier:f._parser.identToString(e),action:i,payload:r})}),f._parser.setPrintHandler(function(e,i,r){return f.print(e,i,r)}),f._parser.registerCsiHandler({final:"@"},function(e){return f.insertChars(e)}),f._parser.registerCsiHandler({intermediates:" ",final:"@"},function(e){return f.scrollLeft(e)}),f._parser.registerCsiHandler({final:"A"},function(e){return f.cursorUp(e)}),f._parser.registerCsiHandler({intermediates:" ",final:"A"},function(e){return f.scrollRight(e)}),f._parser.registerCsiHandler({final:"B"},function(e){return f.cursorDown(e)}),f._parser.registerCsiHandler({final:"C"},function(e){return f.cursorForward(e)}),f._parser.registerCsiHandler({final:"D"},function(e){return f.cursorBackward(e)}),f._parser.registerCsiHandler({final:"E"},function(e){return f.cursorNextLine(e)}),f._parser.registerCsiHandler({final:"F"},function(e){return f.cursorPrecedingLine(e)}),f._parser.registerCsiHandler({final:"G"},function(e){return f.cursorCharAbsolute(e)}),f._parser.registerCsiHandler({final:"H"},function(e){return f.cursorPosition(e)}),f._parser.registerCsiHandler({final:"I"},function(e){return f.cursorForwardTab(e)}),f._parser.registerCsiHandler({final:"J"},function(e){return f.eraseInDisplay(e,!1)}),f._parser.registerCsiHandler({prefix:"?",final:"J"},function(e){return f.eraseInDisplay(e,!0)}),f._parser.registerCsiHandler({final:"K"},function(e){return f.eraseInLine(e,!1)}),f._parser.registerCsiHandler({prefix:"?",final:"K"},function(e){return f.eraseInLine(e,!0)}),f._parser.registerCsiHandler({final:"L"},function(e){return f.insertLines(e)}),f._parser.registerCsiHandler({final:"M"},function(e){return f.deleteLines(e)}),f._parser.registerCsiHandler({final:"P"},function(e){return f.deleteChars(e)}),f._parser.registerCsiHandler({final:"S"},function(e){return f.scrollUp(e)}),f._parser.registerCsiHandler({final:"T"},function(e){return f.scrollDown(e)}),f._parser.registerCsiHandler({final:"X"},function(e){return f.eraseChars(e)}),f._parser.registerCsiHandler({final:"Z"},function(e){return f.cursorBackwardTab(e)}),f._parser.registerCsiHandler({final:"`"},function(e){return f.charPosAbsolute(e)}),f._parser.registerCsiHandler({final:"a"},function(e){return f.hPositionRelative(e)}),f._parser.registerCsiHandler({final:"b"},function(e){return f.repeatPrecedingCharacter(e)}),f._parser.registerCsiHandler({final:"c"},function(e){return f.sendDeviceAttributesPrimary(e)}),f._parser.registerCsiHandler({prefix:">",final:"c"},function(e){return f.sendDeviceAttributesSecondary(e)}),f._parser.registerCsiHandler({final:"d"},function(e){return f.linePosAbsolute(e)}),f._parser.registerCsiHandler({final:"e"},function(e){return f.vPositionRelative(e)}),f._parser.registerCsiHandler({final:"f"},function(e){return f.hVPosition(e)}),f._parser.registerCsiHandler({final:"g"},function(e){return f.tabClear(e)}),f._parser.registerCsiHandler({final:"h"},function(e){return f.setMode(e)}),f._parser.registerCsiHandler({prefix:"?",final:"h"},function(e){return f.setModePrivate(e)}),f._parser.registerCsiHandler({final:"l"},function(e){return f.resetMode(e)}),f._parser.registerCsiHandler({prefix:"?",final:"l"},function(e){return f.resetModePrivate(e)}),f._parser.registerCsiHandler({final:"m"},function(e){return f.charAttributes(e)}),f._parser.registerCsiHandler({final:"n"},function(e){return f.deviceStatus(e)}),f._parser.registerCsiHandler({prefix:"?",final:"n"},function(e){return f.deviceStatusPrivate(e)}),f._parser.registerCsiHandler({intermediates:"!",final:"p"},function(e){return f.softReset(e)}),f._parser.registerCsiHandler({intermediates:" ",final:"q"},function(e){return f.setCursorStyle(e)}),f._parser.registerCsiHandler({final:"r"},function(e){return f.setScrollRegion(e)}),f._parser.registerCsiHandler({final:"s"},function(e){return f.saveCursor(e)}),f._parser.registerCsiHandler({final:"t"},function(e){return f.windowOptions(e)}),f._parser.registerCsiHandler({final:"u"},function(e){return f.restoreCursor(e)}),f._parser.registerCsiHandler({intermediates:"'",final:"}"},function(e){return f.insertColumns(e)}),f._parser.registerCsiHandler({intermediates:"'",final:"~"},function(e){return f.deleteColumns(e)}),f._parser.registerCsiHandler({intermediates:'"',final:"q"},function(e){return f.selectProtected(e)}),f._parser.registerCsiHandler({intermediates:"$",final:"p"},function(e){return f.requestMode(e,!0)}),f._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},function(e){return f.requestMode(e,!1)}),f._parser.setExecuteHandler(i2.BEL,function(){return f.bell()}),f._parser.setExecuteHandler(i2.LF,function(){return f.lineFeed()}),f._parser.setExecuteHandler(i2.VT,function(){return f.lineFeed()}),f._parser.setExecuteHandler(i2.FF,function(){return f.lineFeed()}),f._parser.setExecuteHandler(i2.CR,function(){return f.carriageReturn()}),f._parser.setExecuteHandler(i2.BS,function(){return f.backspace()}),f._parser.setExecuteHandler(i2.HT,function(){return f.tab()}),f._parser.setExecuteHandler(i2.SO,function(){return f.shiftOut()}),f._parser.setExecuteHandler(i2.SI,function(){return f.shiftIn()}),f._parser.setExecuteHandler(i3.IND,function(){return f.index()}),f._parser.setExecuteHandler(i3.NEL,function(){return f.nextLine()}),f._parser.setExecuteHandler(i3.HTS,function(){return f.tabSet()}),f._parser.registerOscHandler(0,new n0(function(e){return f.setTitle(e),f.setIconName(e),!0})),f._parser.registerOscHandler(1,new n0(function(e){return f.setIconName(e)})),f._parser.registerOscHandler(2,new n0(function(e){return f.setTitle(e)})),f._parser.registerOscHandler(4,new n0(function(e){return f.setOrReportIndexedColor(e)})),f._parser.registerOscHandler(8,new n0(function(e){return f.setHyperlink(e)})),f._parser.registerOscHandler(10,new n0(function(e){return f.setOrReportFgColor(e)})),f._parser.registerOscHandler(11,new n0(function(e){return f.setOrReportBgColor(e)})),f._parser.registerOscHandler(12,new n0(function(e){return f.setOrReportCursorColor(e)})),f._parser.registerOscHandler(104,new n0(function(e){return f.restoreIndexedColor(e)})),f._parser.registerOscHandler(110,new n0(function(e){return f.restoreFgColor(e)})),f._parser.registerOscHandler(111,new n0(function(e){return f.restoreBgColor(e)})),f._parser.registerOscHandler(112,new n0(function(e){return f.restoreCursorColor(e)})),f._parser.registerEscHandler({final:"7"},function(){return f.saveCursor()}),f._parser.registerEscHandler({final:"8"},function(){return f.restoreCursor()}),f._parser.registerEscHandler({final:"D"},function(){return f.index()}),f._parser.registerEscHandler({final:"E"},function(){return f.nextLine()}),f._parser.registerEscHandler({final:"H"},function(){return f.tabSet()}),f._parser.registerEscHandler({final:"M"},function(){return f.reverseIndex()}),f._parser.registerEscHandler({final:"="},function(){return f.keypadApplicationMode()}),f._parser.registerEscHandler({final:">"},function(){return f.keypadNumericMode()}),f._parser.registerEscHandler({final:"c"},function(){return f.fullReset()}),f._parser.registerEscHandler({final:"n"},function(){return f.setgLevel(2)}),f._parser.registerEscHandler({final:"o"},function(){return f.setgLevel(3)}),f._parser.registerEscHandler({final:"|"},function(){return f.setgLevel(3)}),f._parser.registerEscHandler({final:"}"},function(){return f.setgLevel(2)}),f._parser.registerEscHandler({final:"~"},function(){return f.setgLevel(1)}),f._parser.registerEscHandler({intermediates:"%",final:"@"},function(){return f.selectDefaultCharset()}),f._parser.registerEscHandler({intermediates:"%",final:"G"},function(){return f.selectDefaultCharset()}),nv)d(v);return f._parser.registerEscHandler({intermediates:"#",final:"8"},function(){return f.screenAlignmentPattern()}),f._parser.setErrorHandler(function(e){return f._logService.error("Parsing error: ",e),e}),f._parser.registerDcsHandler({intermediates:"$",final:"q"},new n5(function(e,i){return f.requestStatusString(e,i)})),f}return(0,f._)(i,e),(0,l._)(i,[{key:"getAttrData",value:function(){return this._curAttrData}},{key:"_preserveStack",value:function(e,i,r,n){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=i,this._parseStack.decodedLength=r,this._parseStack.position=n}},{key:"_logSlowResolvingAsync",value:function(e){this._logService.logLevel<=3&&Promise.race([e,new Promise(function(e,i){return setTimeout(function(){return i("#SLOW_TIMEOUT")},5e3)})]).catch(function(e){if("#SLOW_TIMEOUT"!==e)throw e;console.warn("async parser handler taking longer than ".concat(5e3," ms"))})}},{key:"_getCurrentLinkId",value:function(){return this._curAttrData.extended.urlId}},{key:"parse",value:function(e,i){var r,n=this._activeBuffer.x,s=this._activeBuffer.y,o=0,a=this._parseStack.paused;if(a){if(r=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,i))return this._logSlowResolvingAsync(r),r;n=this._parseStack.cursorStartX,s=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>131072&&(o=this._parseStack.position+131072)}if(this._logService.logLevel<=1&&this._logService.debug("parsing data ".concat("string"==typeof e?' "'.concat(e,'"'):' "'.concat(Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join(""),'"'))),0===this._logService.logLevel&&this._logService.trace("parsing data (codes)","string"==typeof e?e.split("").map(function(e){return e.charCodeAt(0)}):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<131072&&(this._parseBuffer=new Uint32Array(Math.min(e.length,131072))),a||this._dirtyRowTracker.clearRange(),e.length>131072)for(var l=o;l<e.length;l+=131072){var c=l+131072<e.length?l+131072:e.length,h="string"==typeof e?this._stringDecoder.decode(e.substring(l,c),this._parseBuffer):this._utf8Decoder.decode(e.subarray(l,c),this._parseBuffer);if(r=this._parser.parse(this._parseBuffer,h))return this._preserveStack(n,s,h,l),this._logSlowResolvingAsync(r),r}else if(!a){var u="string"==typeof e?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(r=this._parser.parse(this._parseBuffer,u))return this._preserveStack(n,s,u,0),this._logSlowResolvingAsync(r),r}(this._activeBuffer.x!==n||this._activeBuffer.y!==s)&&this._onCursorMove.fire();var f=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),d=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);d<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(d,this._bufferService.rows-1),end:Math.min(f,this._bufferService.rows-1)})}},{key:"print",value:function(e,i,r){var n,s,o=this._charsetService.charset,a=this._optionsService.rawOptions.screenReaderMode,l=this._bufferService.cols,c=this._coreService.decPrivateModes.wraparound,h=this._coreService.modes.insertMode,u=this._curAttrData,f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&r-i>0&&2===f.getWidth(this._activeBuffer.x-1)&&f.setCellFromCodepoint(this._activeBuffer.x-1,0,1,u);for(var _=this._parser.precedingJoinState,v=i;v<r;++v){if((n=e[v])<127&&o){var g=o[String.fromCharCode(n)];g&&(n=g.charCodeAt(0))}var p=this._unicodeService.charProperties(n,_);s=nj.extractWidth(p);var y=nj.extractShouldJoin(p),m=y?nj.extractWidth(_):0;if(_=p,a&&this._onA11yChar.fire(P(n)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+s-m>l){if(c){var S=f,k=this._activeBuffer.x-m;for(this._activeBuffer.x=m,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),m>0&&(0,d._)(f,nf)&&f.copyCellsFrom(S,k,0,m,!1);k<l;)S.setCellFromCodepoint(k++,0,1,u)}else if(this._activeBuffer.x=l-1,2===s)continue}if(y&&this._activeBuffer.x){var b=f.getWidth(this._activeBuffer.x-1)?1:2;f.addCodepointToCell(this._activeBuffer.x-b,n,s);for(var w=s-m;--w>=0;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,u);continue}if(h&&(f.insertCells(this._activeBuffer.x,s-m,this._activeBuffer.getNullCell(u)),2===f.getWidth(l-1)&&f.setCellFromCodepoint(l-1,0,1,u)),f.setCellFromCodepoint(this._activeBuffer.x++,n,s,u),s>0)for(;--s;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,u)}this._parser.precedingJoinState=_,this._activeBuffer.x<l&&r-i>0&&0===f.getWidth(this._activeBuffer.x)&&!f.hasContent(this._activeBuffer.x)&&f.setCellFromCodepoint(this._activeBuffer.x,0,1,u),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}},{key:"registerCsiHandler",value:function(e,i){var r=this;return"t"!==e.final||e.prefix||e.intermediates?this._parser.registerCsiHandler(e,i):this._parser.registerCsiHandler(e,function(e){return!sr(e.params[0],r._optionsService.rawOptions.windowOptions)||i(e)})}},{key:"registerDcsHandler",value:function(e,i){return this._parser.registerDcsHandler(e,new n5(i))}},{key:"registerEscHandler",value:function(e,i){return this._parser.registerEscHandler(e,i)}},{key:"registerOscHandler",value:function(e,i){return this._parser.registerOscHandler(e,new n0(i))}},{key:"bell",value:function(){return this._onRequestBell.fire(),!0}},{key:"lineFeed",value:function(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}},{key:"carriageReturn",value:function(){return this._activeBuffer.x=0,!0}},{key:"backspace",value:function(){var e;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(null==(e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))?void 0:e.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);i.hasWidth(this._activeBuffer.x)&&!i.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}},{key:"tab",value:function(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;var e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}},{key:"shiftOut",value:function(){return this._charsetService.setgLevel(1),!0}},{key:"shiftIn",value:function(){return this._charsetService.setgLevel(0),!0}},{key:"_restrictCursor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._bufferService.cols-1;this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}},{key:"_setCursor",value:function(e,i){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+i):(this._activeBuffer.x=e,this._activeBuffer.y=i),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}},{key:"_moveCursor",value:function(e,i){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+i)}},{key:"cursorUp",value:function(e){var i=this._activeBuffer.y-this._activeBuffer.scrollTop;return i>=0?this._moveCursor(0,-Math.min(i,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}},{key:"cursorDown",value:function(e){var i=this._activeBuffer.scrollBottom-this._activeBuffer.y;return i>=0?this._moveCursor(0,Math.min(i,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}},{key:"cursorForward",value:function(e){return this._moveCursor(e.params[0]||1,0),!0}},{key:"cursorBackward",value:function(e){return this._moveCursor(-(e.params[0]||1),0),!0}},{key:"cursorNextLine",value:function(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}},{key:"cursorPrecedingLine",value:function(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}},{key:"cursorCharAbsolute",value:function(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}},{key:"cursorPosition",value:function(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}},{key:"charPosAbsolute",value:function(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}},{key:"hPositionRelative",value:function(e){return this._moveCursor(e.params[0]||1,0),!0}},{key:"linePosAbsolute",value:function(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}},{key:"vPositionRelative",value:function(e){return this._moveCursor(0,e.params[0]||1),!0}},{key:"hVPosition",value:function(e){return this.cursorPosition(e),!0}},{key:"tabClear",value:function(e){var i=e.params[0];return 0===i?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===i&&(this._activeBuffer.tabs={}),!0}},{key:"cursorForwardTab",value:function(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var i=e.params[0]||1;i--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}},{key:"cursorBackwardTab",value:function(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var i=e.params[0]||1;i--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}},{key:"selectProtected",value:function(e){var i=e.params[0];return 1===i&&(this._curAttrData.bg|=0x20000000),(2===i||0===i)&&(this._curAttrData.bg&=-0x20000001),!0}},{key:"_eraseInBufferLine",value:function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);o.replaceCells(i,r,this._activeBuffer.getNullCell(this._eraseAttrData()),s),n&&(o.isWrapped=!1)}},{key:"_resetBufferLine",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);r&&(r.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),i),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),r.isWrapped=!1)}},{key:"eraseInDisplay",value:function(e){var i,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,n);i<this._bufferService.rows;i++)this._resetBufferLine(i,n);this._dirtyRowTracker.markDirty(i);break;case 1:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i,0,this._activeBuffer.x+1,!0,n),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(i+1).isWrapped=!1);i--;)this._resetBufferLine(i,n);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(i=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,i-1);i--&&!(null==(r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i))?void 0:r.getTrimmedLength()););for(;i>=0;i--)this._bufferService.scroll(this._eraseAttrData())}else{for(i=this._bufferService.rows,this._dirtyRowTracker.markDirty(i-1);i--;)this._resetBufferLine(i,n);this._dirtyRowTracker.markDirty(0)}break;case 3:var s=this._activeBuffer.lines.length-this._bufferService.rows;s>0&&(this._activeBuffer.lines.trimStart(s),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-s,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-s,0),this._onScroll.fire(0))}return!0}},{key:"eraseInLine",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,i);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,i);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,i)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}},{key:"insertLines",value:function(e){this._restrictCursor();var i=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var r=this._activeBuffer.ybase+this._activeBuffer.y,n=this._bufferService.rows-1-this._activeBuffer.scrollBottom,s=this._bufferService.rows-1+this._activeBuffer.ybase-n+1;i--;)this._activeBuffer.lines.splice(s-1,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}},{key:"deleteLines",value:function(e){this._restrictCursor();var i=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;var r,n=this._activeBuffer.ybase+this._activeBuffer.y;for(r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-r;i--;)this._activeBuffer.lines.splice(n,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}},{key:"insertChars",value:function(e){this._restrictCursor();var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}},{key:"deleteChars",value:function(e){this._restrictCursor();var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}},{key:"scrollUp",value:function(e){for(var i=e.params[0]||1;i--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"scrollDown",value:function(e){for(var i=e.params[0]||1;i--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(nh));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"scrollLeft",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){var n=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);n.deleteCells(0,i,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"scrollRight",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){var n=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);n.insertCells(0,i,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"insertColumns",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){var n=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);n.insertCells(this._activeBuffer.x,i,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"deleteColumns",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){var n=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);n.deleteCells(this._activeBuffer.x,i,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"eraseChars",value:function(e){this._restrictCursor();var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}},{key:"repeatPrecedingCharacter",value:function(e){var i=this._parser.precedingJoinState;if(!i)return!0;for(var r=e.params[0]||1,n=nj.extractWidth(i),s=this._activeBuffer.x-n,o=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(s),a=new Uint32Array(o.length*r),l=0,c=0;c<o.length;){var h=o.codePointAt(c)||0;a[l++]=h,c+=h>65535?2:1}for(var u=l,f=1;f<r;++f)a.copyWithin(u,0,l),u+=l;return this.print(a,0,u),!0}},{key:"sendDeviceAttributesPrimary",value:function(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(i2.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(i2.ESC+"[?6c")),!0}},{key:"sendDeviceAttributesSecondary",value:function(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(i2.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(i2.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(i2.ESC+"[>83;40003;0c")),!0}},{key:"_is",value:function(e){return 0===(this._optionsService.rawOptions.termName+"").indexOf(e)}},{key:"setMode",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}},{key:"setModePrivate",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,ng),this._charsetService.setgCharset(1,ng),this._charsetService.setgCharset(2,ng),this._charsetService.setgCharset(3,ng);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0}return!0}},{key:"resetMode",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}},{key:"resetModePrivate",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===e.params[i]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0)}return!0}},{key:"requestMode",value:function(e,i){(s=o||(o={}))[s.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",s[s.SET=1]="SET",s[s.RESET=2]="RESET",s[s.PERMANENTLY_SET=3]="PERMANENTLY_SET",s[s.PERMANENTLY_RESET=4]="PERMANENTLY_RESET";var r,n,s,o,a=this._coreService.decPrivateModes,l=this._coreMouseService,c=l.activeProtocol,h=l.activeEncoding,u=this._coreService,f=this._bufferService,d=f.buffers,_=f.cols,v=d.active,g=d.alt,p=this._optionsService.rawOptions,y=function(e){return e?1:2},m=e.params[0];return r=m,n=i?2===m?4:4===m?y(u.modes.insertMode):12===m?3:20===m?y(p.convertEol):0:1===m?y(a.applicationCursorKeys):3===m?p.windowOptions.setWinLines?80===_?2:+(132===_):0:6===m?y(a.origin):7===m?y(a.wraparound):8===m?3:9===m?y("X10"===c):12===m?y(p.cursorBlink):25===m?y(!u.isCursorHidden):45===m?y(a.reverseWraparound):66===m?y(a.applicationKeypad):67===m?4:1e3===m?y("VT200"===c):1002===m?y("DRAG"===c):1003===m?y("ANY"===c):1004===m?y(a.sendFocus):1005===m?4:1006===m?y("SGR"===h):1015===m?4:1016===m?y("SGR_PIXELS"===h):1048===m?1:47===m||1047===m||1049===m?y(v===g):2004===m?y(a.bracketedPasteMode):2026===m?y(a.synchronizedOutput):0,u.triggerDataEvent("".concat(i2.ESC,"[").concat(i?"":"?").concat(r,";").concat(n,"$y")),!0}},{key:"_updateAttrColor",value:function(e,i,r,n,s){return 2===i?(e|=0x3000000,e&=-0x1000000,e|=I.fromColorRGB([r,n,s])):5===i&&(e&=-0x3000100,e|=0x2000000|255&r),e}},{key:"_extractColor",value:function(e,i,r){var n=[0,0,-1,0,0,0],s=0,o=0;do{if(n[o+s]=e.params[i+o],e.hasSubParams(i+o)){var a=e.getSubParams(i+o),l=0;do 5===n[1]&&(s=1),n[o+l+1+s]=a[l];while(++l<a.length&&l+o+1+s<n.length)break}if(5===n[1]&&o+s>=2||2===n[1]&&o+s>=5)break;n[1]&&(s=1)}while(++o+i<e.length&&o+s<n.length)for(var c=2;c<n.length;++c)-1===n[c]&&(n[c]=0);switch(n[0]){case 38:r.fg=this._updateAttrColor(r.fg,n[1],n[3],n[4],n[5]);break;case 48:r.bg=this._updateAttrColor(r.bg,n[1],n[3],n[4],n[5]);break;case 58:r.extended=r.extended.clone(),r.extended.underlineColor=this._updateAttrColor(r.extended.underlineColor,n[1],n[3],n[4],n[5])}return o}},{key:"_processUnderline",value:function(e,i){i.extended=i.extended.clone(),(!~e||e>5)&&(e=1),i.extended.underlineStyle=e,i.fg|=0x10000000,0===e&&(i.fg&=-0x10000001),i.updateExtended()}},{key:"_processSGR0",value:function(e){e.fg=nh.fg,e.bg=nh.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-0x4000000,e.updateExtended()}},{key:"charAttributes",value:function(e){if(1===e.length&&0===e.params[0])return this._processSGR0(this._curAttrData),!0;for(var i,r=e.length,n=this._curAttrData,s=0;s<r;s++)(i=e.params[s])>=30&&i<=37?(n.fg&=-0x3000100,n.fg|=0x1000000|i-30):i>=40&&i<=47?(n.bg&=-0x3000100,n.bg|=0x1000000|i-40):i>=90&&i<=97?(n.fg&=-0x3000100,n.fg|=0x1000000|i-90|8):i>=100&&i<=107?(n.bg&=-0x3000100,n.bg|=0x1000000|i-100|8):0===i?this._processSGR0(n):1===i?n.fg|=0x8000000:3===i?n.bg|=0x4000000:4===i?(n.fg|=0x10000000,this._processUnderline(e.hasSubParams(s)?e.getSubParams(s)[0]:1,n)):5===i?n.fg|=0x20000000:7===i?n.fg|=0x4000000:8===i?n.fg|=0x40000000:9===i?n.fg|=0x80000000:2===i?n.bg|=0x8000000:21===i?this._processUnderline(2,n):22===i?(n.fg&=-0x8000001,n.bg&=-0x8000001):23===i?n.bg&=-0x4000001:24===i?(n.fg&=-0x10000001,this._processUnderline(0,n)):25===i?n.fg&=-0x20000001:27===i?n.fg&=-0x4000001:28===i?n.fg&=-0x40000001:29===i?n.fg&=0x7fffffff:39===i?(n.fg&=-0x4000000,n.fg|=0xffffff&nh.fg):49===i?(n.bg&=-0x4000000,n.bg|=0xffffff&nh.bg):38===i||48===i||58===i?s+=this._extractColor(e,s,n):53===i?n.bg|=0x40000000:55===i?n.bg&=-0x40000001:59===i?(n.extended=n.extended.clone(),n.extended.underlineColor=-1,n.updateExtended()):100===i?(n.fg&=-0x4000000,n.fg|=0xffffff&nh.fg,n.bg&=-0x4000000,n.bg|=0xffffff&nh.bg):this._logService.debug("Unknown SGR attribute: %d.",i);return!0}},{key:"deviceStatus",value:function(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent("".concat(i2.ESC,"[0n"));break;case 6:var i=this._activeBuffer.y+1,r=this._activeBuffer.x+1;this._coreService.triggerDataEvent("".concat(i2.ESC,"[").concat(i,";").concat(r,"R"))}return!0}},{key:"deviceStatusPrivate",value:function(e){if(6===e.params[0]){var i=this._activeBuffer.y+1,r=this._activeBuffer.x+1;this._coreService.triggerDataEvent("".concat(i2.ESC,"[?").concat(i,";").concat(r,"R"))}return!0}},{key:"softReset",value:function(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=nh.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}},{key:"setCursorStyle",value:function(e){var i=0===e.length?1:e.params[0];if(0===i)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(i){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar"}this._coreService.decPrivateModes.cursorBlink=i%2==1}return!0}},{key:"setScrollRegion",value:function(e){var i,r=e.params[0]||1;return(e.length<2||(i=e.params[1])>this._bufferService.rows||0===i)&&(i=this._bufferService.rows),i>r&&(this._activeBuffer.scrollTop=r-1,this._activeBuffer.scrollBottom=i-1,this._setCursor(0,0)),!0}},{key:"windowOptions",value:function(e){if(!sr(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;var i=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:2!==i&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent("".concat(i2.ESC,"[8;").concat(this._bufferService.rows,";").concat(this._bufferService.cols,"t"));break;case 22:(0===i||2===i)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),(0===i||1===i)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:(0===i||2===i)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(0===i||1===i)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}},{key:"saveCursor",value:function(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}},{key:"restoreCursor",value:function(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}},{key:"setTitle",value:function(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}},{key:"setIconName",value:function(e){return this._iconName=e,!0}},{key:"setOrReportIndexedColor",value:function(e){for(var i=[],r=e.split(";");r.length>1;){var n=r.shift(),s=r.shift();if(/^\d+$/.exec(n)){var o=parseInt(n);if(sa(o))if("?"===s)i.push({type:0,index:o});else{var a=se(s);a&&i.push({type:1,index:o,color:a})}}}return i.length&&this._onColor.fire(i),!0}},{key:"setHyperlink",value:function(e){var i=e.indexOf(";");if(-1===i)return!0;var r=e.slice(0,i).trim(),n=e.slice(i+1);return n?this._createHyperlink(r,n):!r.trim()&&this._finishHyperlink()}},{key:"_createHyperlink",value:function(e,i){this._getCurrentLinkId()&&this._finishHyperlink();var r,n=e.split(":"),s=n.findIndex(function(e){return e.startsWith("id=")});return -1!==s&&(r=n[s].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:r,uri:i}),this._curAttrData.updateExtended(),!0}},{key:"_finishHyperlink",value:function(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}},{key:"_setOrReportSpecialColor",value:function(e,i){for(var r=e.split(";"),n=0;n<r.length&&!(i>=this._specialColors.length);++n,++i)if("?"===r[n])this._onColor.fire([{type:0,index:this._specialColors[i]}]);else{var s=se(r[n]);s&&this._onColor.fire([{type:1,index:this._specialColors[i],color:s}])}return!0}},{key:"setOrReportFgColor",value:function(e){return this._setOrReportSpecialColor(e,0)}},{key:"setOrReportBgColor",value:function(e){return this._setOrReportSpecialColor(e,1)}},{key:"setOrReportCursorColor",value:function(e){return this._setOrReportSpecialColor(e,2)}},{key:"restoreIndexedColor",value:function(e){if(!e)return this._onColor.fire([{type:2}]),!0;for(var i=[],r=e.split(";"),n=0;n<r.length;++n)if(/^\d+$/.exec(r[n])){var s=parseInt(r[n]);sa(s)&&i.push({type:2,index:s})}return i.length&&this._onColor.fire(i),!0}},{key:"restoreFgColor",value:function(e){return this._onColor.fire([{type:2,index:256}]),!0}},{key:"restoreBgColor",value:function(e){return this._onColor.fire([{type:2,index:257}]),!0}},{key:"restoreCursorColor",value:function(e){return this._onColor.fire([{type:2,index:258}]),!0}},{key:"nextLine",value:function(){return this._activeBuffer.x=0,this.index(),!0}},{key:"keypadApplicationMode",value:function(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}},{key:"keypadNumericMode",value:function(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}},{key:"selectDefaultCharset",value:function(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,ng),!0}},{key:"selectCharset",value:function(e){return 2!==e.length?this.selectDefaultCharset():"/"===e[0]||this._charsetService.setgCharset(si[e[0]],nv[e[1]]||ng),!0}},{key:"index",value:function(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}},{key:"tabSet",value:function(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}},{key:"reverseIndex",value:function(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){var e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}},{key:"fullReset",value:function(){return this._parser.reset(),this._onRequestReset.fire(),!0}},{key:"reset",value:function(){this._curAttrData=nh.clone(),this._eraseAttrDataInternal=nh.clone()}},{key:"_eraseAttrData",value:function(){return this._eraseAttrDataInternal.bg&=-0x4000000,this._eraseAttrDataInternal.bg|=0x3ffffff&this._curAttrData.bg,this._eraseAttrDataInternal}},{key:"setgLevel",value:function(e){return this._charsetService.setgLevel(e),!0}},{key:"screenAlignmentPattern",value:function(){var e=new H;e.content=4194373,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(var i=0;i<this._bufferService.rows;++i){var r=this._activeBuffer.ybase+this._activeBuffer.y+i,n=this._activeBuffer.lines.get(r);n&&(n.fill(e),n.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}},{key:"requestStatusString",value:function(e,i){var r,n=this._bufferService.buffer,s=this._optionsService.rawOptions;return r='"q'===e?"P1$r".concat(+!!this._curAttrData.isProtected(),'"q'):'"p'===e?'P1$r61;1"p':"r"===e?"P1$r".concat(n.scrollTop+1,";").concat(n.scrollBottom+1,"r"):"m"===e?"P1$r0m":" q"===e?"P1$r".concat({block:2,underline:4,bar:6}[s.cursorStyle]-!!s.cursorBlink," q"):"P0$r",this._coreService.triggerDataEvent("".concat(i2.ESC).concat(r).concat(i2.ESC,"\\")),!0}},{key:"markRangeDirty",value:function(e,i){this._dirtyRowTracker.markRangeDirty(e,i)}}]),i}(eC),so=function(){function e(i){(0,o._)(this,e),this._bufferService=i,this.clearRange()}return(0,l._)(e,[{key:"clearRange",value:function(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}},{key:"markDirty",value:function(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}},{key:"markRangeDirty",value:function(e,i){e>i&&(sn=e,e=i,i=sn),e<this.start&&(this.start=e),i>this.end&&(this.end=i)}},{key:"markAllDirty",value:function(){this.markRangeDirty(0,this._bufferService.rows-1)}}]),e}();function sa(e){return 0<=e&&e<256}so=w([C(0,U)],so);var sl=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._action=e,r._writeBuffer=[],r._callbacks=[],r._pendingData=0,r._bufferOffset=0,r._isSyncWriting=!1,r._syncCalls=0,r._didUserInput=!1,r._onWriteParsed=r._register(new e4),r.onWriteParsed=r._onWriteParsed.event,r}return(0,f._)(i,e),(0,l._)(i,[{key:"handleUserInput",value:function(){this._didUserInput=!0}},{key:"writeSync",value:function(e,i){if(void 0!==i&&this._syncCalls>i){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,!this._isSyncWriting){for(this._isSyncWriting=!0;r=this._writeBuffer.shift();){this._action(r);var r,n=this._callbacks.shift();n&&n()}this._pendingData=0,this._bufferOffset=0x7fffffff,this._isSyncWriting=!1,this._syncCalls=0}}},{key:"write",value:function(e,i){var r=this;if(this._pendingData>5e7)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(i),this._innerWrite();return}setTimeout(function(){return r._innerWrite()})}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(i)}},{key:"_innerWrite",value:function(){for(var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=i||performance.now();this._writeBuffer.length>this._bufferOffset;){var s=this._writeBuffer[this._bufferOffset],o=this._action(s,r);if(o){var a=function(i){return performance.now()-n>=12?setTimeout(function(){return e._innerWrite(0,i)}):e._innerWrite(n,i)};o.catch(function(e){return queueMicrotask(function(){throw e}),Promise.resolve(!1)}).then(a);return}var l=this._callbacks[this._bufferOffset];if(l&&l(),this._bufferOffset++,this._pendingData-=s.length,performance.now()-n>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(function(){return e._innerWrite()})):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}]),i}(eC),sc=function(){function e(i){(0,o._)(this,e),this._bufferService=i,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}return(0,l._)(e,[{key:"registerLink",value:function(e){var i=this,r=this._bufferService.buffer;if(void 0===e.id){var n=r.addMarker(r.ybase+r.y),s={data:e,id:this._nextId++,lines:[n]};return n.onDispose(function(){return i._removeMarkerFromLink(s,n)}),this._dataByLinkId.set(s.id,s),s.id}var o=this._getEntryIdKey(e),a=this._entriesWithId.get(o);if(a)return this.addLineToLink(a.id,r.ybase+r.y),a.id;var l=r.addMarker(r.ybase+r.y),c={id:this._nextId++,key:this._getEntryIdKey(e),data:e,lines:[l]};return l.onDispose(function(){return i._removeMarkerFromLink(c,l)}),this._entriesWithId.set(c.key,c),this._dataByLinkId.set(c.id,c),c.id}},{key:"addLineToLink",value:function(e,i){var r=this,n=this._dataByLinkId.get(e);if(n&&n.lines.every(function(e){return e.line!==i})){var s=this._bufferService.buffer.addMarker(i);n.lines.push(s),s.onDispose(function(){return r._removeMarkerFromLink(n,s)})}}},{key:"getLinkData",value:function(e){var i;return null==(i=this._dataByLinkId.get(e))?void 0:i.data}},{key:"_getEntryIdKey",value:function(e){return"".concat(e.id,";;").concat(e.uri)}},{key:"_removeMarkerFromLink",value:function(e,i){var r=e.lines.indexOf(i);-1!==r&&(e.lines.splice(r,1),0===e.lines.length&&(void 0!==e.data.id&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}}]),e}();sc=w([C(0,U)],sc);var sh=!1,su=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._windowsWrappingHeuristics=r._register(new ex),r._onBinary=r._register(new e4),r.onBinary=r._onBinary.event,r._onData=r._register(new e4),r.onData=r._onData.event,r._onLineFeed=r._register(new e4),r.onLineFeed=r._onLineFeed.event,r._onResize=r._register(new e4),r.onResize=r._onResize.event,r._onWriteParsed=r._register(new e4),r.onWriteParsed=r._onWriteParsed.event,r._onScroll=r._register(new e4),r._instantiationService=new no,r.optionsService=r._register(new nb(e)),r._instantiationService.setService(G,r.optionsService),r._bufferService=r._register(r._instantiationService.createInstance(nm)),r._instantiationService.setService(U,r._bufferService),r._logService=r._register(r._instantiationService.createInstance(nl)),r._instantiationService.setService(j,r._logService),r.coreService=r._register(r._instantiationService.createInstance(nE)),r._instantiationService.setService(V,r.coreService),r.coreMouseService=r._register(r._instantiationService.createInstance(nL)),r._instantiationService.setService(q,r.coreMouseService),r.unicodeService=r._register(r._instantiationService.createInstance(nj)),r._instantiationService.setService(Z,r.unicodeService),r._charsetService=r._instantiationService.createInstance(nG),r._instantiationService.setService(Y,r._charsetService),r._oscLinkService=r._instantiationService.createInstance(sc),r._instantiationService.setService(J,r._oscLinkService),r._inputHandler=r._register(new ss(r._bufferService,r._charsetService,r.coreService,r._logService,r.optionsService,r._oscLinkService,r.coreMouseService,r.unicodeService)),r._register(eU.forward(r._inputHandler.onLineFeed,r._onLineFeed)),r._register(r._inputHandler),r._register(eU.forward(r._bufferService.onResize,r._onResize)),r._register(eU.forward(r.coreService.onData,r._onData)),r._register(eU.forward(r.coreService.onBinary,r._onBinary)),r._register(r.coreService.onRequestScrollToBottom(function(){return r.scrollToBottom(!0)})),r._register(r.coreService.onUserInput(function(){return r._writeBuffer.handleUserInput()})),r._register(r.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],function(){return r._handleWindowsPtyOptionChange()})),r._register(r._bufferService.onScroll(function(){r._onScroll.fire({position:r._bufferService.buffer.ydisp}),r._inputHandler.markRangeDirty(r._bufferService.buffer.scrollTop,r._bufferService.buffer.scrollBottom)})),r._writeBuffer=r._register(new sl(function(e,i){return r._inputHandler.parse(e,i)})),r._register(eU.forward(r._writeBuffer.onWriteParsed,r._onWriteParsed)),r}return(0,f._)(i,e),(0,l._)(i,[{key:"onScroll",get:function(){var e=this;return this._onScrollApi||(this._onScrollApi=this._register(new e4),this._onScroll.event(function(i){var r;null==(r=e._onScrollApi)||r.fire(i.position)})),this._onScrollApi.event}},{key:"cols",get:function(){return this._bufferService.cols}},{key:"rows",get:function(){return this._bufferService.rows}},{key:"buffers",get:function(){return this._bufferService.buffers}},{key:"options",get:function(){return this.optionsService.options},set:function(e){for(var i in e)this.optionsService.options[i]=e[i]}},{key:"write",value:function(e,i){this._writeBuffer.write(e,i)}},{key:"writeSync",value:function(e,i){this._logService.logLevel<=3&&!sh&&(this._logService.warn("writeSync is unreliable and will be removed soon."),sh=!0),this._writeBuffer.writeSync(e,i)}},{key:"input",value:function(e){var i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.coreService.triggerDataEvent(e,i)}},{key:"resize",value:function(e,i){isNaN(e)||isNaN(i)||(e=Math.max(e,2),i=Math.max(i,1),this._bufferService.resize(e,i))}},{key:"scroll",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._bufferService.scroll(e,i)}},{key:"scrollLines",value:function(e,i){this._bufferService.scrollLines(e,i)}},{key:"scrollPages",value:function(e){this.scrollLines(e*(this.rows-1))}},{key:"scrollToTop",value:function(){this.scrollLines(-this._bufferService.buffer.ydisp)}},{key:"scrollToBottom",value:function(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}},{key:"scrollToLine",value:function(e){var i=e-this._bufferService.buffer.ydisp;0!==i&&this.scrollLines(i)}},{key:"registerEscHandler",value:function(e,i){return this._inputHandler.registerEscHandler(e,i)}},{key:"registerDcsHandler",value:function(e,i){return this._inputHandler.registerDcsHandler(e,i)}},{key:"registerCsiHandler",value:function(e,i){return this._inputHandler.registerCsiHandler(e,i)}},{key:"registerOscHandler",value:function(e,i){return this._inputHandler.registerOscHandler(e,i)}},{key:"_setup",value:function(){this._handleWindowsPtyOptionChange()}},{key:"reset",value:function(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}},{key:"_handleWindowsPtyOptionChange",value:function(){var e=!1,i=this.optionsService.rawOptions.windowsPty;i&&void 0!==i.buildNumber&&void 0!==i.buildNumber?e="conpty"===i.backend&&i.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}},{key:"_enableWindowsWrappingHeuristics",value:function(){var e=this;if(!this._windowsWrappingHeuristics.value){var i=[];i.push(this.onLineFeed(nJ.bind(null,this._bufferService))),i.push(this.registerCsiHandler({final:"H"},function(){return nJ(e._bufferService),!1})),this._windowsWrappingHeuristics.value=eb(function(){var e=!0,r=!1,n=void 0;try{for(var s,o=i[Symbol.iterator]();!(e=(s=o.next()).done);e=!0)s.value.dispose()}catch(e){r=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}})}}}]),i}(eC),sf={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']},sd=0,s_=function(){function e(i){(0,o._)(this,e),this._getKey=i,this._array=[],this._insertedValues=[],this._flushInsertedTask=new rX,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new rX,this._isFlushingDeleted=!1}return(0,l._)(e,[{key:"clear",value:function(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}},{key:"insert",value:function(e){var i=this;this._flushCleanupDeleted(),0===this._insertedValues.length&&this._flushInsertedTask.enqueue(function(){return i._flushInserted()}),this._insertedValues.push(e)}},{key:"_flushInserted",value:function(){for(var e=this,i=this._insertedValues.sort(function(i,r){return e._getKey(i)-e._getKey(r)}),r=0,n=0,s=Array(this._array.length+this._insertedValues.length),o=0;o<s.length;o++)n>=this._array.length||this._getKey(i[r])<=this._getKey(this._array[n])?(s[o]=i[r],r++):s[o]=this._array[n++];this._array=s,this._insertedValues.length=0}},{key:"_flushCleanupInserted",value:function(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}},{key:"delete",value:function(e){var i=this;if(this._flushCleanupInserted(),0===this._array.length)return!1;var r=this._getKey(e);if(void 0===r||-1===(sd=this._search(r))||this._getKey(this._array[sd])!==r)return!1;do if(this._array[sd]===e)return 0===this._deletedIndices.length&&this._flushDeletedTask.enqueue(function(){return i._flushDeleted()}),this._deletedIndices.push(sd),!0;while(++sd<this._array.length&&this._getKey(this._array[sd])===r)return!1}},{key:"_flushDeleted",value:function(){this._isFlushingDeleted=!0;for(var e=this._deletedIndices.sort(function(e,i){return e-i}),i=0,r=Array(this._array.length-e.length),n=0,s=0;s<this._array.length;s++)e[i]===s?i++:r[n++]=this._array[s];this._array=r,this._deletedIndices.length=0,this._isFlushingDeleted=!1}},{key:"_flushCleanupDeleted",value:function(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}},{key:"getKeyIterator",value:function(e){return(0,m._)(this,function(i){switch(i.label){case 0:if(this._flushCleanupInserted(),this._flushCleanupDeleted(),0===this._array.length||(sd=this._search(e))<0||sd>=this._array.length||this._getKey(this._array[sd])!==e)return[3,4];i.label=1;case 1:return[4,this._array[sd]];case 2:i.sent(),i.label=3;case 3:if(++sd<this._array.length&&this._getKey(this._array[sd])===e)return[3,1];i.label=4;case 4:return[2]}})}},{key:"forEachByKey",value:function(e,i){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),0!==this._array.length&&!((sd=this._search(e))<0||sd>=this._array.length)&&this._getKey(this._array[sd])===e)do i(this._array[sd]);while(++sd<this._array.length&&this._getKey(this._array[sd])===e)}},{key:"values",value:function(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),(0,g._)(this._array).values()}},{key:"_search",value:function(e){for(var i=0,r=this._array.length-1;r>=i;){var n=i+r>>1,s=this._getKey(this._array[n]);if(s>e)r=n-1;else if(s<e)i=n+1;else{for(;n>0&&this._getKey(this._array[n-1])===e;)n--;return n}}return i}}]),e}(),sv=0,sg=0,sp=function(e){function i(){var e;return(0,o._)(this,i),(e=(0,s._)(this,i))._decorations=new s_(function(e){return null==e?void 0:e.marker.line}),e._onDecorationRegistered=e._register(new e4),e.onDecorationRegistered=e._onDecorationRegistered.event,e._onDecorationRemoved=e._register(new e4),e.onDecorationRemoved=e._onDecorationRemoved.event,e._register(eb(function(){return e.reset()})),e}return(0,f._)(i,e),(0,l._)(i,[{key:"decorations",get:function(){return this._decorations.values()}},{key:"registerDecoration",value:function(e){var i=this;if(!e.marker.isDisposed){var r=new sy(e);if(r){var n=r.marker.onDispose(function(){return r.dispose()}),s=r.onDispose(function(){s.dispose(),r&&(i._decorations.delete(r)&&i._onDecorationRemoved.fire(r),n.dispose())});this._decorations.insert(r),this._onDecorationRegistered.fire(r)}return r}}},{key:"reset",value:function(){var e=!0,i=!1,r=void 0;try{for(var n,s=this._decorations.values()[Symbol.iterator]();!(e=(n=s.next()).done);e=!0)n.value.dispose()}catch(e){i=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(i)throw r}}this._decorations.clear()}},{key:"getDecorationsAtCell",value:function(e,i,r){var n,s,o,a,l,c,h,u,f,d,_,v;return(0,m._)(this,function(g){switch(g.label){case 0:n=0,s=0,c=!0,h=!1,u=void 0,g.label=1;case 1:g.trys.push([1,7,8,9]),f=this._decorations.getKeyIterator(i)[Symbol.iterator](),g.label=2;case 2:if(c=(d=f.next()).done)return[3,6];if(s=(n=null!=(o=(_=d.value).options.x)?o:0)+(null!=(a=_.options.width)?a:1),!(e>=n&&e<s&&(!r||(null!=(l=_.options.layer)?l:"bottom")===r)))return[3,4];return[4,_];case 3:g.sent(),g.label=4;case 4:g.label=5;case 5:return c=!0,[3,2];case 6:return[3,9];case 7:return v=g.sent(),h=!0,u=v,[3,9];case 8:try{c||null==f.return||f.return()}finally{if(h)throw u}return[7];case 9:return[2]}})}},{key:"forEachDecorationAtCell",value:function(e,i,r,n){this._decorations.forEachByKey(i,function(i){var s,o,a;sg=(sv=null!=(s=i.options.x)?s:0)+(null!=(o=i.options.width)?o:1),e>=sv&&e<sg&&(!r||(null!=(a=i.options.layer)?a:"bottom")===r)&&n(i)})}}]),i}(eC),sy=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i)).options=e,r.onRenderEmitter=r.add(new e4),r.onRender=r.onRenderEmitter.event,r._onDispose=r.add(new e4),r.onDispose=r._onDispose.event,r._cachedBg=null,r._cachedFg=null,r.marker=e.marker,r.options.overviewRulerOptions&&!r.options.overviewRulerOptions.position&&(r.options.overviewRulerOptions.position="full"),r}return(0,f._)(i,e),(0,l._)(i,[{key:"backgroundColorRGB",get:function(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=nF.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}},{key:"foregroundColorRGB",get:function(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=nF.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}},{key:"dispose",value:function(){this._onDispose.fire(),(0,h._)((0,u._)(i.prototype),"dispose",this).call(this)}}]),i}(ew),sm=function(){function e(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;(0,o._)(this,e),this._renderCallback=i,this._debounceThresholdMS=r,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}return(0,l._)(e,[{key:"dispose",value:function(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}},{key:"refresh",value:function(e,i,r){var n=this;this._rowCount=r,e=void 0!==e?e:0,i=void 0!==i?i:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,i):i;var s=performance.now();if(s-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=s,this._innerRefresh();else if(!this._additionalRefreshRequested){var o=s-this._lastRefreshMs,a=this._debounceThresholdMS-o;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(function(){n._lastRefreshMs=performance.now(),n._innerRefresh(),n._additionalRefreshRequested=!1,n._refreshTimeoutID=void 0},a)}}},{key:"_innerRefresh",value:function(){if(void 0!==this._rowStart&&void 0!==this._rowEnd&&void 0!==this._rowCount){var e=Math.max(this._rowStart,0),i=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,i)}}}]),e}(),sS=function(e){function i(e,r,n,a){(0,o._)(this,i),(l=(0,s._)(this,i))._terminal=e,l._coreBrowserService=n,l._renderService=a,l._rowColumns=new WeakMap,l._liveRegionLineCount=0,l._charsToConsume=[],l._charsToAnnounce="";var l,c=l._coreBrowserService.mainDocument;l._accessibilityContainer=c.createElement("div"),l._accessibilityContainer.classList.add("xterm-accessibility"),l._rowContainer=c.createElement("div"),l._rowContainer.setAttribute("role","list"),l._rowContainer.classList.add("xterm-accessibility-tree"),l._rowElements=[];for(var h=0;h<l._terminal.rows;h++)l._rowElements[h]=l._createAccessibilityTreeNode(),l._rowContainer.appendChild(l._rowElements[h]);if(l._topBoundaryFocusListener=function(e){return l._handleBoundaryFocus(e,0)},l._bottomBoundaryFocusListener=function(e){return l._handleBoundaryFocus(e,1)},l._rowElements[0].addEventListener("focus",l._topBoundaryFocusListener),l._rowElements[l._rowElements.length-1].addEventListener("focus",l._bottomBoundaryFocusListener),l._accessibilityContainer.appendChild(l._rowContainer),l._liveRegion=c.createElement("div"),l._liveRegion.classList.add("live-region"),l._liveRegion.setAttribute("aria-live","assertive"),l._accessibilityContainer.appendChild(l._liveRegion),l._liveRegionDebouncer=l._register(new sm(l._renderRows.bind(l))),!l._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");return l._terminal.element.insertAdjacentElement("afterbegin",l._accessibilityContainer),l._register(l._terminal.onResize(function(e){return l._handleResize(e.rows)})),l._register(l._terminal.onRender(function(e){return l._refreshRows(e.start,e.end)})),l._register(l._terminal.onScroll(function(){return l._refreshRows()})),l._register(l._terminal.onA11yChar(function(e){return l._handleChar(e)})),l._register(l._terminal.onLineFeed(function(){return l._handleChar("\n")})),l._register(l._terminal.onA11yTab(function(e){return l._handleTab(e)})),l._register(l._terminal.onKey(function(e){return l._handleKey(e.key)})),l._register(l._terminal.onBlur(function(){return l._clearLiveRegion()})),l._register(l._renderService.onDimensionsChange(function(){return l._refreshRowsDimensions()})),l._register(ii(c,"selectionchange",function(){return l._handleSelectionChange()})),l._register(l._coreBrowserService.onDprChange(function(){return l._refreshRowsDimensions()})),l._refreshRowsDimensions(),l._refreshRows(),l._register(eb(function(){l._accessibilityContainer.remove(),l._rowElements.length=0})),l}return(0,f._)(i,e),(0,l._)(i,[{key:"_handleTab",value:function(e){for(var i=0;i<e;i++)this._handleChar(" ")}},{key:"_handleChar",value:function(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,"\n"===e&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=B())))}},{key:"_clearLiveRegion",value:function(){this._liveRegion.textContent="",this._liveRegionLineCount=0}},{key:"_handleKey",value:function(e){this._clearLiveRegion(),RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}},{key:"_refreshRows",value:function(e,i){this._liveRegionDebouncer.refresh(e,i,this._terminal.rows)}},{key:"_renderRows",value:function(e,i){for(var r=this._terminal.buffer,n=r.lines.length.toString(),s=e;s<=i;s++){var o=r.lines.get(r.ydisp+s),a=[],l=(null==o?void 0:o.translateToString(!0,void 0,void 0,a))||"",c=(r.ydisp+s+1).toString(),h=this._rowElements[s];h&&(0===l.length?(h.textContent="",this._rowColumns.set(h,[0,1])):(h.textContent=l,this._rowColumns.set(h,a)),h.setAttribute("aria-posinset",c),h.setAttribute("aria-setsize",n),this._alignRowWidth(h))}this._announceCharacters()}},{key:"_announceCharacters",value:function(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}},{key:"_handleBoundaryFocus",value:function(e,i){var r,n,s=e.target,o=this._rowElements[0===i?1:this._rowElements.length-2];if(s.getAttribute("aria-posinset")!==(0===i?"1":"".concat(this._terminal.buffer.lines.length))&&e.relatedTarget===o){if(0===i?(r=s,n=this._rowElements.pop(),this._rowContainer.removeChild(n)):(r=this._rowElements.shift(),n=s,this._rowContainer.removeChild(r)),r.removeEventListener("focus",this._topBoundaryFocusListener),n.removeEventListener("focus",this._bottomBoundaryFocusListener),0===i){var a=this._createAccessibilityTreeNode();this._rowElements.unshift(a),this._rowContainer.insertAdjacentElement("afterbegin",a)}else{var l=this._createAccessibilityTreeNode();this._rowElements.push(l),this._rowContainer.appendChild(l)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===i?-1:1),this._rowElements[0===i?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}}},{key:"_handleSelectionChange",value:function(){var e,i,r,n=this;if(0===this._rowElements.length)return;var s=this._coreBrowserService.mainDocument.getSelection();if(s){if(s.isCollapsed){this._rowContainer.contains(s.anchorNode)&&this._terminal.clearSelection();return}if(!s.anchorNode||!s.focusNode)return void console.error("anchorNode and/or focusNode are null");var o={node:s.anchorNode,offset:s.anchorOffset},a={node:s.focusNode,offset:s.focusOffset};if((o.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING||o.node===a.node&&o.offset>a.offset)&&(o=(i=[a,o])[0],a=i[1]),o.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(o={node:this._rowElements[0].childNodes[0],offset:0}),this._rowContainer.contains(o.node)){var l=this._rowElements.slice(-1)[0];if(a.node.compareDocumentPosition(l)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(a={node:l,offset:null!=(r=null==(e=l.textContent)?void 0:e.length)?r:0}),this._rowContainer.contains(a.node)){var c=function(e){var i=e.node,r=e.offset,s=(0,d._)(i,Text)?i.parentNode:i,o=parseInt(null==s?void 0:s.getAttribute("aria-posinset"),10)-1;if(isNaN(o))return console.warn("row is invalid. Race condition?"),null;var a=n._rowColumns.get(s);if(!a)return console.warn("columns is null. Race condition?"),null;var l=r<a.length?a[r]:a.slice(-1)[0]+1;return l>=n._terminal.cols&&(++o,l=0),{row:o,column:l}},h=c(o),u=c(a);if(!(!h||!u)){if(h.row>u.row||h.row===u.row&&h.column>=u.column)throw Error("invalid range");this._terminal.select(h.column,h.row,(u.row-h.row)*this._terminal.cols-h.column+u.column)}}}}}},{key:"_handleResize",value:function(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(var i=this._rowContainer.children.length;i<this._terminal.rows;i++)this._rowElements[i]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[i]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}},{key:"_createAccessibilityTreeNode",value:function(){var e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}},{key:"_refreshRowsDimensions",value:function(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:"".concat(this._renderService.dimensions.css.canvas.width,"px"),fontSize:"".concat(this._terminal.options.fontSize,"px")}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(var e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}},{key:"_refreshRowDimensions",value:function(e){e.style.height="".concat(this._renderService.dimensions.css.cell.height,"px")}},{key:"_alignRowWidth",value:function(e){e.style.transform="";var i,r,n=e.getBoundingClientRect().width,s=null==(r=this._rowColumns.get(e))||null==(i=r.slice(-1))?void 0:i[0];if(s){var o=s*this._renderService.dimensions.css.cell.width;e.style.transform="scaleX(".concat(o/n,")")}}}]),i}(eC);sS=w([C(1,X),C(2,et),C(3,er)],sS);var sk=function(e){function i(e,r,n,a,l){var c;return(0,o._)(this,i),(c=(0,s._)(this,i))._element=e,c._mouseService=r,c._renderService=n,c._bufferService=a,c._linkProviderService=l,c._linkCacheDisposables=[],c._isMouseOut=!0,c._wasResized=!1,c._activeLine=-1,c._onShowLinkUnderline=c._register(new e4),c.onShowLinkUnderline=c._onShowLinkUnderline.event,c._onHideLinkUnderline=c._register(new e4),c.onHideLinkUnderline=c._onHideLinkUnderline.event,c._register(eb(function(){var e;eS(c._linkCacheDisposables),c._linkCacheDisposables.length=0,c._lastMouseEvent=void 0,null==(e=c._activeProviderReplies)||e.clear()})),c._register(c._bufferService.onResize(function(){c._clearCurrentLink(),c._wasResized=!0})),c._register(ii(c._element,"mouseleave",function(){c._isMouseOut=!0,c._clearCurrentLink()})),c._register(ii(c._element,"mousemove",c._handleMouseMove.bind(c))),c._register(ii(c._element,"mousedown",c._handleMouseDown.bind(c))),c._register(ii(c._element,"mouseup",c._handleMouseUp.bind(c))),c}return(0,f._)(i,e),(0,l._)(i,[{key:"currentLink",get:function(){return this._currentLink}},{key:"_handleMouseMove",value:function(e){this._lastMouseEvent=e;var i=this._positionFromMouseEvent(e,this._element,this._mouseService);if(i){this._isMouseOut=!1;for(var r=e.composedPath(),n=0;n<r.length;n++){var s=r[n];if(s.classList.contains("xterm"))break;if(s.classList.contains("xterm-hover"))return}this._lastBufferCell&&i.x===this._lastBufferCell.x&&i.y===this._lastBufferCell.y||(this._handleHover(i),this._lastBufferCell=i)}}},{key:"_handleHover",value:function(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}},{key:"_askForLink",value:function(e,i){var r=this;this._activeProviderReplies&&i||(null==(l=this._activeProviderReplies)||l.forEach(function(e){null==e||e.forEach(function(e){e.link.dispose&&e.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);var n=!1,s=!0,o=!1,a=void 0;try{for(var l,c,h,u,f=this._linkProviderService.linkProviders.entries()[Symbol.iterator]();!(s=(u=f.next()).done);s=!0)h=this,function(){var s=(0,v._)(u.value,2),o=s[0],a=s[1];i?(null==(c=h._activeProviderReplies)?void 0:c.get(o))&&(n=h._checkLinkProviderResult(o,e,n)):a.provideLinks(e.y,function(i){if(!r._isMouseOut){var s,a,l=null==i?void 0:i.map(function(e){return{link:e}});null==(s=r._activeProviderReplies)||s.set(o,l),n=r._checkLinkProviderResult(o,e,n),(null==(a=r._activeProviderReplies)?void 0:a.size)===r._linkProviderService.linkProviders.length&&r._removeIntersectingLinks(e.y,r._activeProviderReplies)}})}()}catch(e){o=!0,a=e}finally{try{s||null==f.return||f.return()}finally{if(o)throw a}}}},{key:"_removeIntersectingLinks",value:function(e,i){for(var r=new Set,n=0;n<i.size;n++){var s=i.get(n);if(s)for(var o=0;o<s.length;o++)for(var a=s[o],l=a.link.range.start.y<e?0:a.link.range.start.x,c=a.link.range.end.y>e?this._bufferService.cols:a.link.range.end.x,h=l;h<=c;h++){if(r.has(h)){s.splice(o--,1);break}r.add(h)}}}},{key:"_checkLinkProviderResult",value:function(e,i,r){var n=this;if(!this._activeProviderReplies)return r;for(var s=this._activeProviderReplies.get(e),o=!1,a=0;a<e;a++)(!this._activeProviderReplies.has(a)||this._activeProviderReplies.get(a))&&(o=!0);if(!o&&s){var l=s.find(function(e){return n._linkAtPosition(e.link,i)});l&&(r=!0,this._handleNewLink(l))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!r)for(var c=0;c<this._activeProviderReplies.size;c++){var h,u=null==(h=this._activeProviderReplies.get(c))?void 0:h.find(function(e){return n._linkAtPosition(e.link,i)});if(u){r=!0,this._handleNewLink(u);break}}return r}},{key:"_handleMouseDown",value:function(){this._mouseDownLink=this._currentLink}},{key:"_handleMouseUp",value:function(e){if(this._currentLink){var i,r,n=this._positionFromMouseEvent(e,this._element,this._mouseService);n&&this._mouseDownLink&&(i=this._mouseDownLink.link,r=this._currentLink.link,i.text===r.text&&i.range.start.x===r.range.start.x&&i.range.start.y===r.range.start.y&&i.range.end.x===r.range.end.x&&i.range.end.y===r.range.end.y)&&this._linkAtPosition(this._currentLink.link,n)&&this._currentLink.link.activate(e,this._currentLink.link.text)}}},{key:"_clearCurrentLink",value:function(e,i){this._currentLink&&this._lastMouseEvent&&(!e||!i||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=i)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,eS(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}},{key:"_handleNewLink",value:function(e){var i=this;if(this._lastMouseEvent){var r=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);r&&this._linkAtPosition(e.link,r)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:void 0===e.link.decorations||e.link.decorations.underline,pointerCursor:void 0===e.link.decorations||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:function(){var e,r;return null==(r=i._currentLink)||null==(e=r.state)?void 0:e.decorations.pointerCursor},set:function(e){var r;(null==(r=i._currentLink)?void 0:r.state)&&i._currentLink.state.decorations.pointerCursor!==e&&(i._currentLink.state.decorations.pointerCursor=e,i._currentLink.state.isHovered&&i._element.classList.toggle("xterm-cursor-pointer",e))}},underline:{get:function(){var e,r;return null==(r=i._currentLink)||null==(e=r.state)?void 0:e.decorations.underline},set:function(r){var n,s,o;(null==(n=i._currentLink)?void 0:n.state)&&(null==(o=i._currentLink)||null==(s=o.state)?void 0:s.decorations.underline)!==r&&(i._currentLink.state.decorations.underline=r,i._currentLink.state.isHovered&&i._fireUnderlineEvent(e.link,r))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(function(e){if(i._currentLink){var r=0===e.start?0:e.start+1+i._bufferService.buffer.ydisp,n=i._bufferService.buffer.ydisp+1+e.end;if(i._currentLink.link.range.start.y>=r&&i._currentLink.link.range.end.y<=n&&(i._clearCurrentLink(r,n),i._lastMouseEvent)){var s=i._positionFromMouseEvent(i._lastMouseEvent,i._element,i._mouseService);s&&i._askForLink(s,!1)}}})))}}},{key:"_linkHover",value:function(e,i,r){var n;(null==(n=this._currentLink)?void 0:n.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(i,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),i.hover&&i.hover(r,i.text)}},{key:"_fireUnderlineEvent",value:function(e,i){var r=e.range,n=this._bufferService.buffer.ydisp,s=this._createLinkUnderlineEvent(r.start.x-1,r.start.y-n-1,r.end.x,r.end.y-n-1,void 0);(i?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(s)}},{key:"_linkLeave",value:function(e,i,r){var n;(null==(n=this._currentLink)?void 0:n.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(i,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),i.leave&&i.leave(r,i.text)}},{key:"_linkAtPosition",value:function(e,i){var r=e.range.start.y*this._bufferService.cols+e.range.start.x,n=e.range.end.y*this._bufferService.cols+e.range.end.x,s=i.y*this._bufferService.cols+i.x;return r<=s&&s<=n}},{key:"_positionFromMouseEvent",value:function(e,i,r){var n=r.getCoords(e,i,this._bufferService.cols,this._bufferService.rows);if(n)return{x:n[0],y:n[1]+this._bufferService.buffer.ydisp}}},{key:"_createLinkUnderlineEvent",value:function(e,i,r,n,s){return{x1:e,y1:i,x2:r,y2:n,cols:this._bufferService.cols,fg:s}}}]),i}(eC);sk=w([C(1,ei),C(2,er),C(3,U),C(4,ea)],sk);var sb=function(e){function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o._)(this,i),(e=(0,s._)(this,i,[r]))._linkifier=e._register(new ex),e.browser=rB,e._keyDownHandled=!1,e._keyDownSeen=!1,e._keyPressHandled=!1,e._unprocessedDeadKey=!1,e._accessibilityManager=e._register(new ex),e._onCursorMove=e._register(new e4),e.onCursorMove=e._onCursorMove.event,e._onKey=e._register(new e4),e.onKey=e._onKey.event,e._onRender=e._register(new e4),e.onRender=e._onRender.event,e._onSelectionChange=e._register(new e4),e.onSelectionChange=e._onSelectionChange.event,e._onTitleChange=e._register(new e4),e.onTitleChange=e._onTitleChange.event,e._onBell=e._register(new e4),e.onBell=e._onBell.event,e._onFocus=e._register(new e4),e._onBlur=e._register(new e4),e._onA11yCharEmitter=e._register(new e4),e._onA11yTabEmitter=e._register(new e4),e._onWillOpen=e._register(new e4),e._setup(),e._decorationService=e._instantiationService.createInstance(sp),e._instantiationService.setService($,e._decorationService),e._linkProviderService=e._instantiationService.createInstance(rC),e._instantiationService.setService(ea,e._linkProviderService),e._linkProviderService.registerLinkProvider(e._instantiationService.createInstance(Q)),e._register(e._inputHandler.onRequestBell(function(){return e._onBell.fire()})),e._register(e._inputHandler.onRequestRefreshRows(function(i){var r,n;return e.refresh(null!=(r=null==i?void 0:i.start)?r:0,null!=(n=null==i?void 0:i.end)?n:e.rows-1)})),e._register(e._inputHandler.onRequestSendFocus(function(){return e._reportFocus()})),e._register(e._inputHandler.onRequestReset(function(){return e.reset()})),e._register(e._inputHandler.onRequestWindowsOptionsReport(function(i){return e._reportWindowsOptions(i)})),e._register(e._inputHandler.onColor(function(i){return e._handleColorEvent(i)})),e._register(eU.forward(e._inputHandler.onCursorMove,e._onCursorMove)),e._register(eU.forward(e._inputHandler.onTitleChange,e._onTitleChange)),e._register(eU.forward(e._inputHandler.onA11yChar,e._onA11yCharEmitter)),e._register(eU.forward(e._inputHandler.onA11yTab,e._onA11yTabEmitter)),e._register(e._bufferService.onResize(function(i){return e._afterResize(i.cols,i.rows)})),e._register(eb(function(){var i,r;e._customKeyEventHandler=void 0,null==(r=e.element)||null==(i=r.parentNode)||i.removeChild(e.element)})),e}return(0,f._)(i,e),(0,l._)(i,[{key:"linkifier",get:function(){return this._linkifier.value}},{key:"onFocus",get:function(){return this._onFocus.event}},{key:"onBlur",get:function(){return this._onBlur.event}},{key:"onA11yChar",get:function(){return this._onA11yCharEmitter.event}},{key:"onA11yTab",get:function(){return this._onA11yTabEmitter.event}},{key:"onWillOpen",get:function(){return this._onWillOpen.event}},{key:"_handleColorEvent",value:function(e){var i=!0,r=!1,n=void 0;if(this._themeService)try{for(var s,o,a=e[Symbol.iterator]();!(i=(o=a.next()).done);i=!0)s=this,function(){var e=o.value,i=void 0,r="";switch(e.index){case 256:i="foreground",r="10";break;case 257:i="background",r="11";break;case 258:i="cursor",r="12";break;default:i="ansi",r="4;"+e.index}switch(e.type){case 0:var n=nz.toColorRGB("ansi"===i?s._themeService.colors.ansi[e.index]:s._themeService.colors[i]);s.coreService.triggerDataEvent("".concat(i2.ESC,"]").concat(r,";").concat(function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,r=(0,v._)(e,3),n=r[0],s=r[1],o=r[2];return"rgb:".concat(st(n,i),"/").concat(st(s,i),"/").concat(st(o,i))}(n)).concat(i5.ST));break;case 1:if("ansi"===i)s._themeService.modifyColors(function(i){return i.ansi[e.index]=(a=i6).toColor.apply(a,(0,g._)(e.color))});else{var a,l,c=i;s._themeService.modifyColors(function(i){return i[c]=(l=i6).toColor.apply(l,(0,g._)(e.color))})}break;case 2:s._themeService.restoreColor(e.index)}}()}catch(e){r=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"_setup",value:function(){(0,h._)((0,u._)(i.prototype),"_setup",this).call(this),this._customKeyEventHandler=void 0}},{key:"buffer",get:function(){return this.buffers.active}},{key:"focus",value:function(){this.textarea&&this.textarea.focus({preventScroll:!0})}},{key:"_handleScreenReaderModeOptionChange",value:function(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(sS,this)):this._accessibilityManager.clear()}},{key:"_handleTextAreaFocus",value:function(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(i2.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}},{key:"blur",value:function(){var e;return null==(e=this.textarea)?void 0:e.blur()}},{key:"_handleTextAreaBlur",value:function(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(i2.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}},{key:"_syncTextArea",value:function(){if(this.textarea&&this.buffer.isCursorInViewport&&!this._compositionHelper.isComposing&&this._renderService){var e=this.buffer.ybase+this.buffer.y,i=this.buffer.lines.get(e);if(i){var r=Math.min(this.buffer.x,this.cols-1),n=this._renderService.dimensions.css.cell.height,s=i.getWidth(r),o=this._renderService.dimensions.css.cell.width*s,a=this.buffer.y*this._renderService.dimensions.css.cell.height,l=r*this._renderService.dimensions.css.cell.width;this.textarea.style.left=l+"px",this.textarea.style.top=a+"px",this.textarea.style.width=o+"px",this.textarea.style.height=n+"px",this.textarea.style.lineHeight=n+"px",this.textarea.style.zIndex="-5"}}}},{key:"_initGlobal",value:function(){var e=this;this._bindKeys(),this._register(ii(this.element,"copy",function(i){var r;e.hasSelection()&&(r=e._selectionService,i.clipboardData&&i.clipboardData.setData("text/plain",r.selectionText),i.preventDefault())}));var i=function(i){var r,n,s;return r=e.textarea,n=e.coreService,s=e.optionsService,void(i.stopPropagation(),i.clipboardData&&R(i.clipboardData.getData("text/plain"),r,n,s))};this._register(ii(this.textarea,"paste",i)),this._register(ii(this.element,"paste",i)),rA?this._register(ii(this.element,"mousedown",function(i){2===i.button&&L(i,e.textarea,e.screenElement,e._selectionService,e.options.rightClickSelectsWord)})):this._register(ii(this.element,"contextmenu",function(i){L(i,e.textarea,e.screenElement,e._selectionService,e.options.rightClickSelectsWord)})),rK&&this._register(ii(this.element,"auxclick",function(i){1===i.button&&M(i,e.textarea,e.screenElement)}))}},{key:"_bindKeys",value:function(){var e=this;this._register(ii(this.textarea,"keyup",function(i){return e._keyUp(i)},!0)),this._register(ii(this.textarea,"keydown",function(i){return e._keyDown(i)},!0)),this._register(ii(this.textarea,"keypress",function(i){return e._keyPress(i)},!0)),this._register(ii(this.textarea,"compositionstart",function(){return e._compositionHelper.compositionstart()})),this._register(ii(this.textarea,"compositionupdate",function(i){return e._compositionHelper.compositionupdate(i)})),this._register(ii(this.textarea,"compositionend",function(){return e._compositionHelper.compositionend()})),this._register(ii(this.textarea,"input",function(i){return e._inputEvent(i)},!0)),this._register(this.onRender(function(){return e._compositionHelper.updateCompositionElements()}))}},{key:"open",value:function(e){var r,n,s,o=this;if(!e)throw Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),(null==(r=this.element)?void 0:r.ownerDocument.defaultView)&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&(0,d._)(this.options.documentOverride,Document)&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);var a=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),a.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(ii(this.screenElement,"mousemove",function(e){return o.updateCursorStyle(e)})),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),a.appendChild(this.screenElement);var l=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",E()),rU||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",function(){return l.readOnly=o.optionsService.rawOptions.disableStdin})),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(rb,this.textarea,null!=(n=e.ownerDocument.defaultView)?n:window,(null!=(s=this._document)?s:("undefined"==typeof window?"undefined":(0,p._)(window))<"u")?window.document:null)),this._instantiationService.setService(et,this._coreBrowserService),this._register(ii(this.textarea,"focus",function(e){return o._handleTextAreaFocus(e)})),this._register(ii(this.textarea,"blur",function(){return o._handleTextAreaBlur()})),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(ry,this._document,this._helperContainer),this._instantiationService.setService(ee,this._charSizeService),this._themeService=this._instantiationService.createInstance(nr),this._instantiationService.setService(eo,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(rn),this._instantiationService.setService(es,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(rG,this.rows,this.screenElement)),this._instantiationService.setService(er,this._renderService),this._register(this._renderService.onRenderedViewportChange(function(e){return o._onRender.fire(e)})),this.onResize(function(e){return o._renderService.resize(e.cols,e.rows)}),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(iN,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(rE),this._instantiationService.setService(ei,this._mouseService);var c=this._linkifier.value=this._register(this._instantiationService.createInstance(sk,this.screenElement));this.element.appendChild(a);try{this._onWillOpen.fire(this.element)}catch(e){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(function(){o._renderService.handleCursorMove(),o._syncTextArea()})),this._register(this.onResize(function(){return o._renderService.handleResize(o.cols,o.rows)})),this._register(this.onBlur(function(){return o._renderService.handleBlur()})),this._register(this.onFocus(function(){return o._renderService.handleFocus()})),this._viewport=this._register(this._instantiationService.createInstance(iM,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(function(e){(0,h._)((0,u._)(i.prototype),"scrollLines",o).call(o,e,!1),o.refresh(0,o.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(r6,this.element,this.screenElement,c)),this._instantiationService.setService(en,this._selectionService),this._register(this._selectionService.onRequestScrollLines(function(e){return o.scrollLines(e.amount,e.suppressScrollEvent)})),this._register(this._selectionService.onSelectionChange(function(){return o._onSelectionChange.fire()})),this._register(this._selectionService.onRequestRedraw(function(e){return o._renderService.handleSelectionChanged(e.start,e.end,e.columnSelectMode)})),this._register(this._selectionService.onLinuxMouseSelection(function(e){o.textarea.value=e,o.textarea.focus(),o.textarea.select()})),this._register(eU.any(this._onScroll.event,this._inputHandler.onScroll)(function(){var e;o._selectionService.refresh(),null==(e=o._viewport)||e.queueSync()})),this._register(this._instantiationService.createInstance(iL,this.screenElement)),this._register(ii(this.element,"mousedown",function(e){return o._selectionService.handleMouseDown(e)})),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(sS,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",function(e){return o._handleScreenReaderModeOptionChange(e)})),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(iI,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",function(e){!o._overviewRulerRenderer&&e&&o._viewportElement&&o.screenElement&&(o._overviewRulerRenderer=o._register(o._instantiationService.createInstance(iI,o._viewportElement,o.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}},{key:"_createRenderer",value:function(){return this._instantiationService.createInstance(rp,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}},{key:"bindMouse",value:function(){var e=this,i=this,r=this.element;function n(e){var r=i._mouseService.getMouseReportCoords(e,i.screenElement);if(!r)return!1;switch(e.overrideType||e.type){case"mousemove":s=32,void 0===e.buttons?(n=3,void 0!==e.button&&(n=e.button<3?e.button:3)):n=1&e.buttons?0:4&e.buttons?1:2&e.buttons?2:3;break;case"mouseup":s=0,n=e.button<3?e.button:3;break;case"mousedown":s=1,n=e.button<3?e.button:3;break;case"wheel":if(i._customWheelEventHandler&&!1===i._customWheelEventHandler(e))return!1;var n,s,o,a,l,c,h,u=e.deltaY;if(0===u||0===i.coreMouseService.consumeWheelEvent(e,null==(c=i._renderService)||null==(l=c.dimensions)||null==(a=l.device)||null==(o=a.cell)?void 0:o.height,null==(h=i._coreBrowserService)?void 0:h.dpr))return!1;s=u<0?0:1,n=4;break;default:return!1}return void 0!==s&&void 0!==n&&!(n>4)&&i.coreMouseService.triggerMouseEvent({col:r.col,row:r.row,x:r.x,y:r.y,button:n,action:s,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey})}var s={mouseup:null,wheel:null,mousedrag:null,mousemove:null},o=function(i){return n(i),i.buttons||(e._document.removeEventListener("mouseup",s.mouseup),s.mousedrag&&e._document.removeEventListener("mousemove",s.mousedrag)),e.cancel(i)},a=function(i){return n(i),e.cancel(i,!0)},l=function(e){e.buttons&&n(e)},c=function(e){e.buttons||n(e)};this._register(this.coreMouseService.onProtocolChange(function(i){i?("debug"===e.optionsService.rawOptions.logLevel&&e._logService.debug("Binding to mouse events:",e.coreMouseService.explainEvents(i)),e.element.classList.add("enable-mouse-events"),e._selectionService.disable()):(e._logService.debug("Unbinding from mouse events."),e.element.classList.remove("enable-mouse-events"),e._selectionService.enable()),8&i?s.mousemove||(r.addEventListener("mousemove",c),s.mousemove=c):(r.removeEventListener("mousemove",s.mousemove),s.mousemove=null),16&i?s.wheel||(r.addEventListener("wheel",a,{passive:!1}),s.wheel=a):(r.removeEventListener("wheel",s.wheel),s.wheel=null),2&i?s.mouseup||(s.mouseup=o):(e._document.removeEventListener("mouseup",s.mouseup),s.mouseup=null),4&i?s.mousedrag||(s.mousedrag=l):(e._document.removeEventListener("mousemove",s.mousedrag),s.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(ii(r,"mousedown",function(i){if(i.preventDefault(),e.focus(),!(!e.coreMouseService.areMouseEventsActive||e._selectionService.shouldForceSelection(i)))return n(i),s.mouseup&&e._document.addEventListener("mouseup",s.mouseup),s.mousedrag&&e._document.addEventListener("mousemove",s.mousedrag),e.cancel(i)})),this._register(ii(r,"wheel",function(r){if(!s.wheel){if(e._customWheelEventHandler&&!1===e._customWheelEventHandler(r))return!1;if(!e.buffer.hasScrollback){if(0===r.deltaY)return!1;if(0===i.coreMouseService.consumeWheelEvent(r,null==(l=i._renderService)||null==(a=l.dimensions)||null==(o=a.device)||null==(n=o.cell)?void 0:n.height,null==(c=i._coreBrowserService)?void 0:c.dpr))return e.cancel(r,!0);var n,o,a,l,c,h=i2.ESC+(e.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(r.deltaY<0?"A":"B");return e.coreService.triggerDataEvent(h,!0),e.cancel(r,!0)}}},{passive:!1}))}},{key:"refresh",value:function(e,i){var r;null==(r=this._renderService)||r.refreshRows(e,i)}},{key:"updateCursorStyle",value:function(e){var i;(null==(i=this._selectionService)?void 0:i.shouldColumnSelect(e))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}},{key:"_showCursor",value:function(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}},{key:"scrollLines",value:function(e,r){this._viewport?this._viewport.scrollLines(e):(0,h._)((0,u._)(i.prototype),"scrollLines",this).call(this,e,r),this.refresh(0,this.rows-1)}},{key:"scrollPages",value:function(e){this.scrollLines(e*(this.rows-1))}},{key:"scrollToTop",value:function(){this.scrollLines(-this._bufferService.buffer.ydisp)}},{key:"scrollToBottom",value:function(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}},{key:"scrollToLine",value:function(e){var i=e-this._bufferService.buffer.ydisp;0!==i&&this.scrollLines(i)}},{key:"paste",value:function(e){R(e,this.textarea,this.coreService,this.optionsService)}},{key:"attachCustomKeyEventHandler",value:function(e){this._customKeyEventHandler=e}},{key:"attachCustomWheelEventHandler",value:function(e){this._customWheelEventHandler=e}},{key:"registerLinkProvider",value:function(e){return this._linkProviderService.registerLinkProvider(e)}},{key:"registerCharacterJoiner",value:function(e){if(!this._characterJoinerService)throw Error("Terminal must be opened first");var i=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),i}},{key:"deregisterCharacterJoiner",value:function(e){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}},{key:"markers",get:function(){return this.buffer.markers}},{key:"registerMarker",value:function(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}},{key:"registerDecoration",value:function(e){return this._decorationService.registerDecoration(e)}},{key:"hasSelection",value:function(){return!!this._selectionService&&this._selectionService.hasSelection}},{key:"select",value:function(e,i,r){this._selectionService.setSelection(e,i,r)}},{key:"getSelection",value:function(){return this._selectionService?this._selectionService.selectionText:""}},{key:"getSelectionPosition",value:function(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}},{key:"clearSelection",value:function(){var e;null==(e=this._selectionService)||e.clearSelection()}},{key:"selectAll",value:function(){var e;null==(e=this._selectionService)||e.selectAll()}},{key:"selectLines",value:function(e,i){var r;null==(r=this._selectionService)||r.selectLines(e,i)}},{key:"_keyDown",value:function(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;var i=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!i&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;i||"Dead"!==e.key&&"AltGraph"!==e.key||(this._unprocessedDeadKey=!0);var r=function(e,i,r,n){var s={type:0,cancel:!1,key:void 0},o=!!e.shiftKey|2*!!e.altKey|4*!!e.ctrlKey|8*!!e.metaKey;switch(e.keyCode){case 0:"UIKeyInputUpArrow"===e.key?i?s.key=i2.ESC+"OA":s.key=i2.ESC+"[A":"UIKeyInputLeftArrow"===e.key?i?s.key=i2.ESC+"OD":s.key=i2.ESC+"[D":"UIKeyInputRightArrow"===e.key?i?s.key=i2.ESC+"OC":s.key=i2.ESC+"[C":"UIKeyInputDownArrow"===e.key&&(i?s.key=i2.ESC+"OB":s.key=i2.ESC+"[B");break;case 8:s.key=e.ctrlKey?"\b":i2.DEL,e.altKey&&(s.key=i2.ESC+s.key);break;case 9:if(e.shiftKey){s.key=i2.ESC+"[Z";break}s.key=i2.HT,s.cancel=!0;break;case 13:s.key=e.altKey?i2.ESC+i2.CR:i2.CR,s.cancel=!0;break;case 27:s.key=i2.ESC,e.altKey&&(s.key=i2.ESC+i2.ESC),s.cancel=!0;break;case 37:if(e.metaKey)break;o?s.key=i2.ESC+"[1;"+(o+1)+"D":i?s.key=i2.ESC+"OD":s.key=i2.ESC+"[D";break;case 39:if(e.metaKey)break;o?s.key=i2.ESC+"[1;"+(o+1)+"C":i?s.key=i2.ESC+"OC":s.key=i2.ESC+"[C";break;case 38:if(e.metaKey)break;o?s.key=i2.ESC+"[1;"+(o+1)+"A":i?s.key=i2.ESC+"OA":s.key=i2.ESC+"[A";break;case 40:if(e.metaKey)break;o?s.key=i2.ESC+"[1;"+(o+1)+"B":i?s.key=i2.ESC+"OB":s.key=i2.ESC+"[B";break;case 45:e.shiftKey||e.ctrlKey||(s.key=i2.ESC+"[2~");break;case 46:o?s.key=i2.ESC+"[3;"+(o+1)+"~":s.key=i2.ESC+"[3~";break;case 36:o?s.key=i2.ESC+"[1;"+(o+1)+"H":i?s.key=i2.ESC+"OH":s.key=i2.ESC+"[H";break;case 35:o?s.key=i2.ESC+"[1;"+(o+1)+"F":i?s.key=i2.ESC+"OF":s.key=i2.ESC+"[F";break;case 33:e.shiftKey?s.type=2:e.ctrlKey?s.key=i2.ESC+"[5;"+(o+1)+"~":s.key=i2.ESC+"[5~";break;case 34:e.shiftKey?s.type=3:e.ctrlKey?s.key=i2.ESC+"[6;"+(o+1)+"~":s.key=i2.ESC+"[6~";break;case 112:o?s.key=i2.ESC+"[1;"+(o+1)+"P":s.key=i2.ESC+"OP";break;case 113:o?s.key=i2.ESC+"[1;"+(o+1)+"Q":s.key=i2.ESC+"OQ";break;case 114:o?s.key=i2.ESC+"[1;"+(o+1)+"R":s.key=i2.ESC+"OR";break;case 115:o?s.key=i2.ESC+"[1;"+(o+1)+"S":s.key=i2.ESC+"OS";break;case 116:o?s.key=i2.ESC+"[15;"+(o+1)+"~":s.key=i2.ESC+"[15~";break;case 117:o?s.key=i2.ESC+"[17;"+(o+1)+"~":s.key=i2.ESC+"[17~";break;case 118:o?s.key=i2.ESC+"[18;"+(o+1)+"~":s.key=i2.ESC+"[18~";break;case 119:o?s.key=i2.ESC+"[19;"+(o+1)+"~":s.key=i2.ESC+"[19~";break;case 120:o?s.key=i2.ESC+"[20;"+(o+1)+"~":s.key=i2.ESC+"[20~";break;case 121:o?s.key=i2.ESC+"[21;"+(o+1)+"~":s.key=i2.ESC+"[21~";break;case 122:o?s.key=i2.ESC+"[23;"+(o+1)+"~":s.key=i2.ESC+"[23~";break;case 123:o?s.key=i2.ESC+"[24;"+(o+1)+"~":s.key=i2.ESC+"[24~";break;default:if(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)if((!r||n)&&e.altKey&&!e.metaKey){var a,l=null==(a=sf[e.keyCode])?void 0:a[+!!e.shiftKey];if(l)s.key=i2.ESC+l;else if(e.keyCode>=65&&e.keyCode<=90){var c=String.fromCharCode(e.ctrlKey?e.keyCode-64:e.keyCode+32);e.shiftKey&&(c=c.toUpperCase()),s.key=i2.ESC+c}else if(32===e.keyCode)s.key=i2.ESC+(e.ctrlKey?i2.NUL:" ");else if("Dead"===e.key&&e.code.startsWith("Key")){var h=e.code.slice(3,4);e.shiftKey||(h=h.toLowerCase()),s.key=i2.ESC+h,s.cancel=!0}}else!r||e.altKey||e.ctrlKey||e.shiftKey||!e.metaKey?!e.key||e.ctrlKey||e.altKey||e.metaKey||!(e.keyCode>=48)||1!==e.key.length?e.key&&e.ctrlKey&&("_"===e.key&&(s.key=i2.US),"@"===e.key&&(s.key=i2.NUL)):s.key=e.key:65===e.keyCode&&(s.type=1);else e.keyCode>=65&&e.keyCode<=90?s.key=String.fromCharCode(e.keyCode-64):32===e.keyCode?s.key=i2.NUL:e.keyCode>=51&&e.keyCode<=55?s.key=String.fromCharCode(e.keyCode-51+27):56===e.keyCode?s.key=i2.DEL:219===e.keyCode?s.key=i2.ESC:220===e.keyCode?s.key=i2.FS:221===e.keyCode&&(s.key=i2.GS)}return s}(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),3===r.type||2===r.type){var n=this.rows-1;return this.scrollLines(2===r.type?-n:n),this.cancel(e,!0)}return 1===r.type&&this.selectAll(),!!(this._isThirdLevelShift(this.browser,e)||(r.cancel&&this.cancel(e,!0),!r.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&1===e.key.length&&e.key.charCodeAt(0)>=65&&90>=e.key.charCodeAt(0))||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):((r.key===i2.ETX||r.key===i2.CR)&&(this.textarea.value=""),this._onKey.fire({key:r.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(r.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)?this.cancel(e,!0):void(this._keyDownHandled=!0))}},{key:"_isThirdLevelShift",value:function(e,i){var r=e.isMac&&!this.options.macOptionIsMeta&&i.altKey&&!i.ctrlKey&&!i.metaKey||e.isWindows&&i.altKey&&i.ctrlKey&&!i.metaKey||e.isWindows&&i.getModifierState("AltGraph");return"keypress"===i.type?r:r&&(!i.keyCode||i.keyCode>47)}},{key:"_keyUp",value:function(e){var i;this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e)||(16===(i=e).keyCode||17===i.keyCode||18===i.keyCode||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}},{key:"_keyPress",value:function(e){var i;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;if(this.cancel(e),e.charCode)i=e.charCode;else if(null===e.which||void 0===e.which)i=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;i=e.which}return!!i&&(!e.altKey&&!e.ctrlKey&&!e.metaKey||!!this._isThirdLevelShift(this.browser,e))&&(i=String.fromCharCode(i),this._onKey.fire({key:i,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}},{key:"_inputEvent",value:function(e){if(e.data&&"insertText"===e.inputType&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;var i=e.data;return this.coreService.triggerDataEvent(i,!0),this.cancel(e),!0}return!1}},{key:"resize",value:function(e,r){if(e===this.cols&&r===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}(0,h._)((0,u._)(i.prototype),"resize",this).call(this,e,r)}},{key:"_afterResize",value:function(e,i){var r;null==(r=this._charSizeService)||r.measure()}},{key:"clear",value:function(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(var e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(nh));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}},{key:"reset",value:function(){this.options.rows=this.rows,this.options.cols=this.cols;var e,r=this._customKeyEventHandler;this._setup(),(0,h._)((0,u._)(i.prototype),"reset",this).call(this),null==(e=this._selectionService)||e.reset(),this._decorationService.reset(),this._customKeyEventHandler=r,this.refresh(0,this.rows-1)}},{key:"clearTextureAtlas",value:function(){var e;null==(e=this._renderService)||e.clearTextureAtlas()}},{key:"_reportFocus",value:function(){var e;(null==(e=this.element)?void 0:e.classList.contains("focus"))?this.coreService.triggerDataEvent(i2.ESC+"[I"):this.coreService.triggerDataEvent(i2.ESC+"[O")}},{key:"_reportWindowsOptions",value:function(e){if(this._renderService)switch(e){case 0:var i=this._renderService.dimensions.css.canvas.width.toFixed(0),r=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent("".concat(i2.ESC,"[4;").concat(r,";").concat(i,"t"));break;case 1:var n=this._renderService.dimensions.css.cell.width.toFixed(0),s=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent("".concat(i2.ESC,"[6;").concat(s,";").concat(n,"t"))}}},{key:"cancel",value:function(e,i){if(!(!this.options.cancelEvents&&!i))return e.preventDefault(),e.stopPropagation(),!1}}]),i}(su),sw=function(){function e(){(0,o._)(this,e),this._addons=[]}return(0,l._)(e,[{key:"dispose",value:function(){for(var e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}},{key:"loadAddon",value:function(e,i){var r=this,n={instance:i,dispose:i.dispose,isDisposed:!1};this._addons.push(n),i.dispose=function(){return r._wrappedAddonDispose(n)},i.activate(e)}},{key:"_wrappedAddonDispose",value:function(e){if(!e.isDisposed){for(var i=-1,r=0;r<this._addons.length;r++)if(this._addons[r]===e){i=r;break}if(-1===i)throw Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(i,1)}}}]),e}(),sC=function(){function e(i){(0,o._)(this,e),this._line=i}return(0,l._)(e,[{key:"isWrapped",get:function(){return this._line.isWrapped}},{key:"length",get:function(){return this._line.length}},{key:"getCell",value:function(e,i){if(!(e<0||e>=this._line.length))return i?(this._line.loadCell(e,i),i):this._line.loadCell(e,new H)}},{key:"translateToString",value:function(e,i,r){return this._line.translateToString(e,i,r)}}]),e}(),sx=function(){function e(i,r){(0,o._)(this,e),this._buffer=i,this.type=r}return(0,l._)(e,[{key:"init",value:function(e){return this._buffer=e,this}},{key:"cursorY",get:function(){return this._buffer.y}},{key:"cursorX",get:function(){return this._buffer.x}},{key:"viewportY",get:function(){return this._buffer.ydisp}},{key:"baseY",get:function(){return this._buffer.ybase}},{key:"length",get:function(){return this._buffer.lines.length}},{key:"getLine",value:function(e){var i=this._buffer.lines.get(e);if(i)return new sC(i)}},{key:"getNullCell",value:function(){return new H}}]),e}(),sE=function(e){function i(e){var r;return(0,o._)(this,i),(r=(0,s._)(this,i))._core=e,r._onBufferChange=r._register(new e4),r.onBufferChange=r._onBufferChange.event,r._normal=new sx(r._core.buffers.normal,"normal"),r._alternate=new sx(r._core.buffers.alt,"alternate"),r._core.buffers.onBufferActivate(function(){return r._onBufferChange.fire(r.active)}),r}return(0,f._)(i,e),(0,l._)(i,[{key:"active",get:function(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}},{key:"normal",get:function(){return this._normal.init(this._core.buffers.normal)}},{key:"alternate",get:function(){return this._alternate.init(this._core.buffers.alt)}}]),i}(eC),sD=function(){function e(i){(0,o._)(this,e),this._core=i}return(0,l._)(e,[{key:"registerCsiHandler",value:function(e,i){return this._core.registerCsiHandler(e,function(e){return i(e.toArray())})}},{key:"addCsiHandler",value:function(e,i){return this.registerCsiHandler(e,i)}},{key:"registerDcsHandler",value:function(e,i){return this._core.registerDcsHandler(e,function(e,r){return i(e,r.toArray())})}},{key:"addDcsHandler",value:function(e,i){return this.registerDcsHandler(e,i)}},{key:"registerEscHandler",value:function(e,i){return this._core.registerEscHandler(e,i)}},{key:"addEscHandler",value:function(e,i){return this.registerEscHandler(e,i)}},{key:"registerOscHandler",value:function(e,i){return this._core.registerOscHandler(e,i)}},{key:"addOscHandler",value:function(e,i){return this.registerOscHandler(e,i)}}]),e}(),sB=function(){function e(i){(0,o._)(this,e),this._core=i}return(0,l._)(e,[{key:"register",value:function(e){this._core.unicodeService.register(e)}},{key:"versions",get:function(){return this._core.unicodeService.versions}},{key:"activeVersion",get:function(){return this._core.unicodeService.activeVersion},set:function(e){this._core.unicodeService.activeVersion=e}}]),e}(),sR=["cols","rows"],sM=0,sL=function(e){function i(e){(0,o._)(this,i),(r=(0,s._)(this,i))._core=r._register(new sb(e)),r._addonManager=r._register(new sw),r._publicOptions=(0,_._)({},r._core.options);var r,n=function(e){return r._core.options[e]},a=function(e,i){r._checkReadonlyOptions(e),r._core.options[e]=i};for(var l in r._core.options){var c={get:n.bind(r,l),set:a.bind(r,l)};Object.defineProperty(r._publicOptions,l,c)}return r}return(0,f._)(i,e),(0,l._)(i,[{key:"_checkReadonlyOptions",value:function(e){if(sR.includes(e))throw Error('Option "'.concat(e,'" can only be set in the constructor'))}},{key:"_checkProposedApi",value:function(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}},{key:"onBell",get:function(){return this._core.onBell}},{key:"onBinary",get:function(){return this._core.onBinary}},{key:"onCursorMove",get:function(){return this._core.onCursorMove}},{key:"onData",get:function(){return this._core.onData}},{key:"onKey",get:function(){return this._core.onKey}},{key:"onLineFeed",get:function(){return this._core.onLineFeed}},{key:"onRender",get:function(){return this._core.onRender}},{key:"onResize",get:function(){return this._core.onResize}},{key:"onScroll",get:function(){return this._core.onScroll}},{key:"onSelectionChange",get:function(){return this._core.onSelectionChange}},{key:"onTitleChange",get:function(){return this._core.onTitleChange}},{key:"onWriteParsed",get:function(){return this._core.onWriteParsed}},{key:"element",get:function(){return this._core.element}},{key:"parser",get:function(){return this._parser||(this._parser=new sD(this._core)),this._parser}},{key:"unicode",get:function(){return this._checkProposedApi(),new sB(this._core)}},{key:"textarea",get:function(){return this._core.textarea}},{key:"rows",get:function(){return this._core.rows}},{key:"cols",get:function(){return this._core.cols}},{key:"buffer",get:function(){return this._buffer||(this._buffer=this._register(new sE(this._core))),this._buffer}},{key:"markers",get:function(){return this._checkProposedApi(),this._core.markers}},{key:"modes",get:function(){var e=this._core.coreService.decPrivateModes,i="none";switch(this._core.coreMouseService.activeProtocol){case"X10":i="x10";break;case"VT200":i="vt200";break;case"DRAG":i="drag";break;case"ANY":i="any"}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:i,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}},{key:"options",get:function(){return this._publicOptions},set:function(e){for(var i in e)this._publicOptions[i]=e[i]}},{key:"blur",value:function(){this._core.blur()}},{key:"focus",value:function(){this._core.focus()}},{key:"input",value:function(e){var i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._core.input(e,i)}},{key:"resize",value:function(e,i){this._verifyIntegers(e,i),this._core.resize(e,i)}},{key:"open",value:function(e){this._core.open(e)}},{key:"attachCustomKeyEventHandler",value:function(e){this._core.attachCustomKeyEventHandler(e)}},{key:"attachCustomWheelEventHandler",value:function(e){this._core.attachCustomWheelEventHandler(e)}},{key:"registerLinkProvider",value:function(e){return this._core.registerLinkProvider(e)}},{key:"registerCharacterJoiner",value:function(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}},{key:"deregisterCharacterJoiner",value:function(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}},{key:"registerMarker",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._verifyIntegers(e),this._core.registerMarker(e)}},{key:"registerDecoration",value:function(e){var i,r,n;return this._checkProposedApi(),this._verifyPositiveIntegers(null!=(i=e.x)?i:0,null!=(r=e.width)?r:0,null!=(n=e.height)?n:0),this._core.registerDecoration(e)}},{key:"hasSelection",value:function(){return this._core.hasSelection()}},{key:"select",value:function(e,i,r){this._verifyIntegers(e,i,r),this._core.select(e,i,r)}},{key:"getSelection",value:function(){return this._core.getSelection()}},{key:"getSelectionPosition",value:function(){return this._core.getSelectionPosition()}},{key:"clearSelection",value:function(){this._core.clearSelection()}},{key:"selectAll",value:function(){this._core.selectAll()}},{key:"selectLines",value:function(e,i){this._verifyIntegers(e,i),this._core.selectLines(e,i)}},{key:"dispose",value:function(){(0,h._)((0,u._)(i.prototype),"dispose",this).call(this)}},{key:"scrollLines",value:function(e){this._verifyIntegers(e),this._core.scrollLines(e)}},{key:"scrollPages",value:function(e){this._verifyIntegers(e),this._core.scrollPages(e)}},{key:"scrollToTop",value:function(){this._core.scrollToTop()}},{key:"scrollToBottom",value:function(){this._core.scrollToBottom()}},{key:"scrollToLine",value:function(e){this._verifyIntegers(e),this._core.scrollToLine(e)}},{key:"clear",value:function(){this._core.clear()}},{key:"write",value:function(e,i){this._core.write(e,i)}},{key:"writeln",value:function(e,i){this._core.write(e),this._core.write("\r\n",i)}},{key:"paste",value:function(e){this._core.paste(e)}},{key:"refresh",value:function(e,i){this._verifyIntegers(e,i),this._core.refresh(e,i)}},{key:"reset",value:function(){this._core.reset()}},{key:"clearTextureAtlas",value:function(){this._core.clearTextureAtlas()}},{key:"loadAddon",value:function(e){this._addonManager.loadAddon(this,e)}},{key:"_verifyIntegers",value:function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var n=!0,s=!1,o=void 0;try{for(var a,l=i[Symbol.iterator]();!(n=(a=l.next()).done);n=!0)if((sM=a.value)===1/0||isNaN(sM)||sM%1!=0)throw Error("This API only accepts integers")}catch(e){s=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(s)throw o}}}},{key:"_verifyPositiveIntegers",value:function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var n=!0,s=!1,o=void 0;try{for(var a,l=i[Symbol.iterator]();!(n=(a=l.next()).done);n=!0)if((sM=a.value)&&(sM===1/0||isNaN(sM)||sM%1!=0||sM<0))throw Error("This API only accepts positive integers")}catch(e){s=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(s)throw o}}}}],[{key:"strings",get:function(){return{get promptLabel(){return E()},set promptLabel(t){x=t},get tooMuchOutput(){return B()},set tooMuchOutput(t){D=t}}}}]),i}(eC);e.s(["Terminal",()=>sL])}]);

//# debugId=6aefe581-8dbe-ae7d-0868-33b08b500b41
//# sourceMappingURL=0d60c94dc2703ae6.js.map