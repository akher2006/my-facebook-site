"use strict";var __adoraExports__=(()=>{var Oi=Object.create;var bt=Object.defineProperty;var Ni=Object.getOwnPropertyDescriptor;var _i=Object.getOwnPropertyNames;var Li=Object.getPrototypeOf,Di=Object.prototype.hasOwnProperty;var qn=t=>{throw TypeError(t)};var Pi=(t,e,r)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Yn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ui=(t,e)=>{for(var r in e)bt(t,r,{get:e[r],enumerable:!0})},Zn=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of _i(e))!Di.call(t,o)&&o!==r&&bt(t,o,{get:()=>e[o],enumerable:!(n=Ni(e,o))||n.enumerable});return t};var Fi=(t,e,r)=>(r=t!=null?Oi(Li(t)):{},Zn(e||!t||!t.__esModule?bt(r,"default",{value:t,enumerable:!0}):r,t)),Wi=t=>Zn(bt({},"__esModule",{value:!0}),t);var U=(t,e,r)=>Pi(t,typeof e!="symbol"?e+"":e,r),Nr=(t,e,r)=>e.has(t)||qn("Cannot "+r);var C=(t,e,r)=>(Nr(t,e,"read from private field"),r?r.call(t):e.get(t)),ge=(t,e,r)=>e.has(t)?qn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Q=(t,e,r,n)=>(Nr(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),Pe=(t,e,r)=>(Nr(t,e,"access private method"),r);var Fs=Yn((Od,Us)=>{"use strict";Us.exports=Ds;function Ds(t,e,r){t instanceof RegExp&&(t=Ls(t,r)),e instanceof RegExp&&(e=Ls(e,r));var n=Ps(t,e,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+t.length,n[1]),post:r.slice(n[1]+e.length)}}function Ls(t,e){var r=e.match(t);return r?r[0]:null}Ds.range=Ps;function Ps(t,e,r){var n,o,s,i,l,a=r.indexOf(t),u=r.indexOf(e,a+1),c=a;if(a>=0&&u>0){if(t===e)return[a,u];for(n=[],s=r.length;c>=0&&!l;)c==a?(n.push(c),a=r.indexOf(t,c+1)):n.length==1?l=[n.pop(),u]:(o=n.pop(),o<s&&(s=o,i=u),u=r.indexOf(e,c+1)),c=a<u&&a>=0?a:u;n.length&&(l=[s,i])}return l}});var $s=Yn((Nd,Vs)=>{var Ws=Fs();Vs.exports=Ac;var zs="\0SLASH"+Math.random()+"\0",Bs="\0OPEN"+Math.random()+"\0",In="\0CLOSE"+Math.random()+"\0",Hs="\0COMMA"+Math.random()+"\0",Gs="\0PERIOD"+Math.random()+"\0";function Rn(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function Ic(t){return t.split("\\\\").join(zs).split("\\{").join(Bs).split("\\}").join(In).split("\\,").join(Hs).split("\\.").join(Gs)}function Tc(t){return t.split(zs).join("\\").split(Bs).join("{").split(In).join("}").split(Hs).join(",").split(Gs).join(".")}function js(t){if(!t)return[""];var e=[],r=Ws("{","}",t);if(!r)return t.split(",");var n=r.pre,o=r.body,s=r.post,i=n.split(",");i[i.length-1]+="{"+o+"}";var l=js(s);return s.length&&(i[i.length-1]+=l.shift(),i.push.apply(i,l)),e.push.apply(e,i),e}function Ac(t){return t?(t.substr(0,2)==="{}"&&(t="\\{\\}"+t.substr(2)),_t(Ic(t),!0).map(Tc)):[]}function kc(t){return"{"+t+"}"}function xc(t){return/^-?0\d/.test(t)}function Mc(t,e){return t<=e}function Oc(t,e){return t>=e}function _t(t,e){var r=[],n=Ws("{","}",t);if(!n)return[t];var o=n.pre,s=n.post.length?_t(n.post,!1):[""];if(/\$$/.test(n.pre))for(var i=0;i<s.length;i++){var l=o+"{"+n.body+"}"+s[i];r.push(l)}else{var a=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),c=a||u,h=n.body.indexOf(",")>=0;if(!c&&!h)return n.post.match(/,(?!,).*\}/)?(t=n.pre+"{"+n.body+In+n.post,_t(t)):[t];var f;if(c)f=n.body.split(/\.\./);else if(f=js(n.body),f.length===1&&(f=_t(f[0],!1).map(kc),f.length===1))return s.map(function(W){return n.pre+f[0]+W});var p;if(c){var m=Rn(f[0]),d=Rn(f[1]),y=Math.max(f[0].length,f[1].length),g=f.length==3?Math.abs(Rn(f[2])):1,S=Mc,v=d<m;v&&(g*=-1,S=Oc);var A=f.some(xc);p=[];for(var I=m;S(I,d);I+=g){var b;if(u)b=String.fromCharCode(I),b==="\\"&&(b="");else if(b=String(I),A){var T=y-b.length;if(T>0){var R=new Array(T+1).join("0");I<0?b="-"+R+b.slice(1):b=R+b}}p.push(b)}}else{p=[];for(var O=0;O<f.length;O++)p.push.apply(p,_t(f[O],!1))}for(var O=0;O<p.length;O++)for(var i=0;i<s.length;i++){var l=o+p[O]+s[i];(!e||c||l)&&r.push(l)}}return r}});var Nu={};Ui(Nu,{adoraIsRunning:()=>rt,adoraStart:()=>Mu,adoraStop:()=>Ou,getDom0EventHandlers:()=>Ln});var zi=/\{[^{}]+\}/g,Bi=()=>typeof process=="object"&&Number.parseInt(process?.versions?.node?.substring(0,2))>=18&&process.versions.undici;function Hi(){return Math.random().toString(36).slice(2,11)}function Qn(t){let{baseUrl:e="",Request:r=globalThis.Request,fetch:n=globalThis.fetch,querySerializer:o,bodySerializer:s,headers:i,requestInitExt:l=void 0,...a}={...t};l=Bi()?l:void 0,e=Jn(e);let u=[];async function c(h,f){let{baseUrl:p,fetch:m=n,Request:d=r,headers:y,params:g={},parseAs:S="json",querySerializer:v,bodySerializer:A=s??ji,body:I,middleware:b=[],...T}=f||{},R=e;p&&(R=Jn(p)??e);let O=typeof o=="function"?o:Kn(o);v&&(O=typeof v=="function"?v:Kn({...typeof o=="object"?o:{},...v}));let W=I===void 0?void 0:A(I,Xn(i,y,g.header)),se=Xn(W===void 0||W instanceof FormData?{}:{"Content-Type":"application/json"},i,y,g.header),z=[...u,...b],ie={redirect:"follow",...a,...T,body:W,headers:se},j,H,k=new d(Vi(h,{baseUrl:R,params:g,querySerializer:O}),ie),M;for(let x in T)x in k||(k[x]=T[x]);if(z.length){j=Hi(),H=Object.freeze({baseUrl:R,fetch:m,parseAs:S,querySerializer:O,bodySerializer:A});for(let x of z)if(x&&typeof x=="object"&&typeof x.onRequest=="function"){let P=await x.onRequest({request:k,schemaPath:h,params:g,options:H,id:j});if(P)if(P instanceof d)k=P;else if(P instanceof Response){M=P;break}else throw new Error("onRequest: must return new Request() or Response() when modifying the request")}}if(!M){try{M=await m(k,l)}catch(x){let P=x;if(z.length)for(let V=z.length-1;V>=0;V--){let J=z[V];if(J&&typeof J=="object"&&typeof J.onError=="function"){let ce=await J.onError({request:k,error:P,schemaPath:h,params:g,options:H,id:j});if(ce){if(ce instanceof Response){P=void 0,M=ce;break}if(ce instanceof Error){P=ce;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(P)throw P}if(z.length)for(let x=z.length-1;x>=0;x--){let P=z[x];if(P&&typeof P=="object"&&typeof P.onResponse=="function"){let V=await P.onResponse({request:k,response:M,schemaPath:h,params:g,options:H,id:j});if(V){if(!(V instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");M=V}}}}if(M.status===204||k.method==="HEAD"||M.headers.get("Content-Length")==="0")return M.ok?{data:void 0,response:M}:{error:void 0,response:M};if(M.ok)return S==="stream"?{data:M.body,response:M}:{data:await M[S](),response:M};let X=await M.text();try{X=JSON.parse(X)}catch{}return{error:X,response:M}}return{request(h,f,p){return c(f,{...p,method:h.toUpperCase()})},GET(h,f){return c(h,{...f,method:"GET"})},PUT(h,f){return c(h,{...f,method:"PUT"})},POST(h,f){return c(h,{...f,method:"POST"})},DELETE(h,f){return c(h,{...f,method:"DELETE"})},OPTIONS(h,f){return c(h,{...f,method:"OPTIONS"})},HEAD(h,f){return c(h,{...f,method:"HEAD"})},PATCH(h,f){return c(h,{...f,method:"PATCH"})},TRACE(h,f){return c(h,{...f,method:"TRACE"})},use(...h){for(let f of h)if(f){if(typeof f!="object"||!("onRequest"in f||"onResponse"in f||"onError"in f))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");u.push(f)}},eject(...h){for(let f of h){let p=u.indexOf(f);p!==-1&&u.splice(p,1)}}}}function Vt(t,e,r){if(e==null)return"";if(typeof e=="object")throw new Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${r?.allowReserved===!0?e:encodeURIComponent(e)}`}function eo(t,e,r){if(!e||typeof e!="object")return"";let n=[],o={simple:",",label:".",matrix:";"}[r.style]||"&";if(r.style!=="deepObject"&&r.explode===!1){for(let l in e)n.push(l,r.allowReserved===!0?e[l]:encodeURIComponent(e[l]));let i=n.join(",");switch(r.style){case"form":return`${t}=${i}`;case"label":return`.${i}`;case"matrix":return`;${t}=${i}`;default:return i}}for(let i in e){let l=r.style==="deepObject"?`${t}[${i}]`:i;n.push(Vt(l,e[i],r))}let s=n.join(o);return r.style==="label"||r.style==="matrix"?`${o}${s}`:s}function to(t,e,r){if(!Array.isArray(e))return"";if(r.explode===!1){let s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[r.style]||",",i=(r.allowReserved===!0?e:e.map(l=>encodeURIComponent(l))).join(s);switch(r.style){case"simple":return i;case"label":return`.${i}`;case"matrix":return`;${t}=${i}`;default:return`${t}=${i}`}}let n={simple:",",label:".",matrix:";"}[r.style]||"&",o=[];for(let s of e)r.style==="simple"||r.style==="label"?o.push(r.allowReserved===!0?s:encodeURIComponent(s)):o.push(Vt(t,s,r));return r.style==="label"||r.style==="matrix"?`${n}${o.join(n)}`:o.join(n)}function Kn(t){return function(r){let n=[];if(r&&typeof r=="object")for(let o in r){let s=r[o];if(s!=null){if(Array.isArray(s)){if(s.length===0)continue;n.push(to(o,s,{style:"form",explode:!0,...t?.array,allowReserved:t?.allowReserved||!1}));continue}if(typeof s=="object"){n.push(eo(o,s,{style:"deepObject",explode:!0,...t?.object,allowReserved:t?.allowReserved||!1}));continue}n.push(Vt(o,s,t))}}return n.join("&")}}function Gi(t,e){let r=t;for(let n of t.match(zi)??[]){let o=n.substring(1,n.length-1),s=!1,i="simple";if(o.endsWith("*")&&(s=!0,o=o.substring(0,o.length-1)),o.startsWith(".")?(i="label",o=o.substring(1)):o.startsWith(";")&&(i="matrix",o=o.substring(1)),!e||e[o]===void 0||e[o]===null)continue;let l=e[o];if(Array.isArray(l)){r=r.replace(n,to(o,l,{style:i,explode:s}));continue}if(typeof l=="object"){r=r.replace(n,eo(o,l,{style:i,explode:s}));continue}if(i==="matrix"){r=r.replace(n,`;${Vt(o,l)}`);continue}r=r.replace(n,i==="label"?`.${encodeURIComponent(l)}`:encodeURIComponent(l))}return r}function ji(t,e){return t instanceof FormData?t:e&&(e.get instanceof Function?e.get("Content-Type")??e.get("content-type"):e["Content-Type"]??e["content-type"])==="application/x-www-form-urlencoded"?new URLSearchParams(t).toString():JSON.stringify(t)}function Vi(t,e){let r=`${e.baseUrl}${t}`;e.params?.path&&(r=Gi(r,e.params.path));let n=e.querySerializer(e.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(r+=`?${n}`),r}function Xn(...t){let e=new Headers;for(let r of t){if(!r||typeof r!="object")continue;let n=r instanceof Headers?r.entries():Object.entries(r);for(let[o,s]of n)if(s===null)e.delete(o);else if(Array.isArray(s))for(let i of s)e.append(o,i);else s!==void 0&&e.set(o,s)}return e}function Jn(t){return t.endsWith("/")?t.substring(0,t.length-1):t}var ro="https://c.adora-cdn.com";var Me=class{constructor(e){U(this,"backendClient");U(this,"eventPostBackendClient");this.backendClient=_r({baseUrl:e??ro})}getOrCreateEventPostClient(e){return!e.eventPostUrl||!e.eventPostToken?{path:e.sessionId,client:this.backendClient}:(this.eventPostBackendClient||(this.eventPostBackendClient=_r({baseUrl:e.eventPostUrl})),{path:e.sessionId,client:this.eventPostBackendClient})}async sessionPreload({orgId:e}){return this.backendClient.POST("/sessions/preload",{body:{orgId:e},mode:"cors"}).catch(()=>{})}async startSession({bypassSampling:e,orgId:r,language:n,domain:o,userCohorts:s,uid:i,devicePixelRatio:l,adoraUserId:a,userAgent:u,documentReferrer:c,snippetVersion:h}){return this.backendClient.POST("/sessions/start",{body:{bypassSampling:e,orgId:r,language:n,domain:o,devicePixelRatio:l,userCohorts:s||{},userAgent:u,uid:typeof i=="number"?i.toString():i!=="null"&&i!=="undefined"?i:void 0,adoraUserId:a,documentReferrer:c,snippetVersion:h},mode:"cors"}).catch(()=>{})}async gzipWithCompressionStream(e){let r=JSON.stringify(e),o=new TextEncoder().encode(r),s=new CompressionStream("gzip"),l=new ReadableStream({start(u){u.enqueue(o),u.close()}}).pipeThrough(s);return new Response(l).arrayBuffer()}async saveSessionEvents({sessionId:e,events:r,metadata:n,eventPostUrl:o,eventPostToken:s,fastpathToken:i}){let{path:l,client:a}=this.getOrCreateEventPostClient({sessionId:e,eventPostToken:s,eventPostUrl:o}),u={events:r.slice(),metadata:n,fastpathToken:i},c={params:{path:{sessionId:l}},headers:s?{token:s}:void 0};if(typeof CompressionStream<"u"){let h=await this.gzipWithCompressionStream(u);return a.POSTGzipped("/sessions/{sessionId}/events",{...c,body:h}).catch(()=>{})}return a.POST("/sessions/{sessionId}/events",{...c,body:u}).catch(()=>{})}async refreshEventToken(e){return await this.backendClient.POST("/sessions/{sessionId}/events/token",{params:{path:{sessionId:e.sessionId}},body:{},mode:"cors"}).catch(()=>{})}async syncSession(e){return await this.backendClient.POST("/sessions/{sessionId}/sync",{params:{path:{sessionId:e.sessionId}}}).catch(()=>{})}};var _r=t=>({...Qn(t),POSTGzipped:async(r,n)=>{if(!n?.body)throw new Error("Body is required for gzipped requests");let o={...n.headers,"Content-Type":"application/json","Content-Encoding":"gzip"},s=r;n.params?.path&&Object.entries(n.params.path).forEach(([a,u])=>{s=s.replace(`{${a}}`,u)});let i=await fetch(`${t.baseUrl}${s}`,{method:"POST",headers:o,body:n.body});if(!i.ok){let a=await i.text();try{a=JSON.parse(a)}catch{}return{data:void 0,error:a,response:i}}return{data:await i.json(),error:void 0,response:i}}});var $i=Object.getOwnPropertyNames,qi=Object.getOwnPropertySymbols,Yi=Object.prototype.hasOwnProperty;function no(t,e){return function(n,o,s){return t(n,o,s)&&e(n,o,s)}}function $t(t){return function(r,n,o){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,o);var s=o.cache,i=s.get(r),l=s.get(n);if(i&&l)return i===n&&l===r;s.set(r,n),s.set(n,r);var a=t(r,n,o);return s.delete(r),s.delete(n),a}}function Zi(t){return t?.[Symbol.toStringTag]}function oo(t){return $i(t).concat(qi(t))}var Ki=Object.hasOwn||(function(t,e){return Yi.call(t,e)});function Ye(t,e){return t===e||!t&&!e&&t!==t&&e!==e}var Xi="__v",Ji="__o",Qi="_owner",so=Object.getOwnPropertyDescriptor,io=Object.keys;function ea(t,e,r){var n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function ta(t,e){return Ye(t.getTime(),e.getTime())}function ra(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function na(t,e){return t===e}function ao(t,e,r){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var o=new Array(n),s=t.entries(),i,l,a=0;(i=s.next())&&!i.done;){for(var u=e.entries(),c=!1,h=0;(l=u.next())&&!l.done;){if(o[h]){h++;continue}var f=i.value,p=l.value;if(r.equals(f[0],p[0],a,h,t,e,r)&&r.equals(f[1],p[1],f[0],p[0],t,e,r)){c=o[h]=!0;break}h++}if(!c)return!1;a++}return!0}var oa=Ye;function sa(t,e,r){var n=io(t),o=n.length;if(io(e).length!==o)return!1;for(;o-- >0;)if(!ho(t,e,r,n[o]))return!1;return!0}function Ct(t,e,r){var n=oo(t),o=n.length;if(oo(e).length!==o)return!1;for(var s,i,l;o-- >0;)if(s=n[o],!ho(t,e,r,s)||(i=so(t,s),l=so(e,s),(i||l)&&(!i||!l||i.configurable!==l.configurable||i.enumerable!==l.enumerable||i.writable!==l.writable)))return!1;return!0}function ia(t,e){return Ye(t.valueOf(),e.valueOf())}function aa(t,e){return t.source===e.source&&t.flags===e.flags}function lo(t,e,r){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var o=new Array(n),s=t.values(),i,l;(i=s.next())&&!i.done;){for(var a=e.values(),u=!1,c=0;(l=a.next())&&!l.done;){if(!o[c]&&r.equals(i.value,l.value,i.value,l.value,t,e,r)){u=o[c]=!0;break}c++}if(!u)return!1}return!0}function la(t,e){var r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function ca(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function ho(t,e,r,n){return(n===Qi||n===Ji||n===Xi)&&(t.$$typeof||e.$$typeof)?!0:Ki(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}var ua="[object Arguments]",da="[object Boolean]",ha="[object Date]",fa="[object Error]",pa="[object Map]",ma="[object Number]",ga="[object Object]",ya="[object RegExp]",va="[object Set]",Sa="[object String]",ba="[object URL]",Ca=Array.isArray,co=typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView:null,uo=Object.assign,wa=Object.prototype.toString.call.bind(Object.prototype.toString);function Ea(t){var e=t.areArraysEqual,r=t.areDatesEqual,n=t.areErrorsEqual,o=t.areFunctionsEqual,s=t.areMapsEqual,i=t.areNumbersEqual,l=t.areObjectsEqual,a=t.arePrimitiveWrappersEqual,u=t.areRegExpsEqual,c=t.areSetsEqual,h=t.areTypedArraysEqual,f=t.areUrlsEqual,p=t.unknownTagComparators;return function(d,y,g){if(d===y)return!0;if(d==null||y==null)return!1;var S=typeof d;if(S!==typeof y)return!1;if(S!=="object")return S==="number"?i(d,y,g):S==="function"?o(d,y,g):!1;var v=d.constructor;if(v!==y.constructor)return!1;if(v===Object)return l(d,y,g);if(Ca(d))return e(d,y,g);if(co!=null&&co(d))return h(d,y,g);if(v===Date)return r(d,y,g);if(v===RegExp)return u(d,y,g);if(v===Map)return s(d,y,g);if(v===Set)return c(d,y,g);var A=wa(d);if(A===ha)return r(d,y,g);if(A===ya)return u(d,y,g);if(A===pa)return s(d,y,g);if(A===va)return c(d,y,g);if(A===ga)return typeof d.then!="function"&&typeof y.then!="function"&&l(d,y,g);if(A===ba)return f(d,y,g);if(A===fa)return n(d,y,g);if(A===ua)return l(d,y,g);if(A===da||A===ma||A===Sa)return a(d,y,g);if(p){var I=p[A];if(!I){var b=Zi(d);b&&(I=p[b])}if(I)return I(d,y,g)}return!1}}function Ra(t){var e=t.circular,r=t.createCustomConfig,n=t.strict,o={areArraysEqual:n?Ct:ea,areDatesEqual:ta,areErrorsEqual:ra,areFunctionsEqual:na,areMapsEqual:n?no(ao,Ct):ao,areNumbersEqual:oa,areObjectsEqual:n?Ct:sa,arePrimitiveWrappersEqual:ia,areRegExpsEqual:aa,areSetsEqual:n?no(lo,Ct):lo,areTypedArraysEqual:n?Ct:la,areUrlsEqual:ca,unknownTagComparators:void 0};if(r&&(o=uo({},o,r(o))),e){var s=$t(o.areArraysEqual),i=$t(o.areMapsEqual),l=$t(o.areObjectsEqual),a=$t(o.areSetsEqual);o=uo({},o,{areArraysEqual:s,areMapsEqual:i,areObjectsEqual:l,areSetsEqual:a})}return o}function Ia(t){return function(e,r,n,o,s,i,l){return t(e,r,l)}}function Ta(t){var e=t.circular,r=t.comparator,n=t.createState,o=t.equals,s=t.strict;if(n)return function(a,u){var c=n(),h=c.cache,f=h===void 0?e?new WeakMap:void 0:h,p=c.meta;return r(a,u,{cache:f,equals:o,meta:p,strict:s})};if(e)return function(a,u){return r(a,u,{cache:new WeakMap,equals:o,meta:void 0,strict:s})};var i={cache:void 0,equals:o,meta:void 0,strict:s};return function(a,u){return r(a,u,i)}}var ed=Ue(),fo=Ue({strict:!0}),td=Ue({circular:!0}),rd=Ue({circular:!0,strict:!0}),nd=Ue({createInternalComparator:function(){return Ye}}),od=Ue({strict:!0,createInternalComparator:function(){return Ye}}),sd=Ue({circular:!0,createInternalComparator:function(){return Ye}}),id=Ue({circular:!0,createInternalComparator:function(){return Ye},strict:!0});function Ue(t){t===void 0&&(t={});var e=t.circular,r=e===void 0?!1:e,n=t.createInternalComparator,o=t.createState,s=t.strict,i=s===void 0?!1:s,l=Ra(t),a=Ea(l),u=n?n(a):Ia(a);return Ta({circular:r,comparator:a,createState:o,equals:u,strict:i})}function qt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}var Aa={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Lr(t,e){function r(o,s,i){if(!(typeof document>"u")){i=qt({},e,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),o=encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var a in i)i[a]&&(l+="; "+a,i[a]!==!0&&(l+="="+i[a].split(";")[0]));return document.cookie=o+"="+t.write(s,o)+l}}function n(o){if(!(typeof document>"u"||arguments.length&&!o)){for(var s=document.cookie?document.cookie.split("; "):[],i={},l=0;l<s.length;l++){var a=s[l].split("="),u=a.slice(1).join("=");try{var c=decodeURIComponent(a[0]);if(i[c]=t.read(u,c),o===c)break}catch{}}return o?i[o]:i}}return Object.create({set:r,get:n,remove:function(o,s){r(o,"",qt({},s,{expires:-1}))},withAttributes:function(o){return Lr(this.converter,qt({},this.attributes,o))},withConverter:function(o){return Lr(qt({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var wt=Lr(Aa,{path:"/"});var Yt="0123456789abcdef",Zt=class t{constructor(e){this.bytes=e}static ofInner(e){if(e.length!==16)throw new TypeError("not 128-bit length");return new t(e)}static fromFieldsV7(e,r,n,o){if(!Number.isInteger(e)||!Number.isInteger(r)||!Number.isInteger(n)||!Number.isInteger(o)||e<0||r<0||n<0||o<0||e>0xffffffffffff||r>4095||n>1073741823||o>4294967295)throw new RangeError("invalid field value");let s=new Uint8Array(16);return s[0]=e/2**40,s[1]=e/2**32,s[2]=e/2**24,s[3]=e/2**16,s[4]=e/2**8,s[5]=e,s[6]=112|r>>>8,s[7]=r,s[8]=128|n>>>24,s[9]=n>>>16,s[10]=n>>>8,s[11]=n,s[12]=o>>>24,s[13]=o>>>16,s[14]=o>>>8,s[15]=o,new t(s)}static parse(e){var r,n,o,s;let i;switch(e.length){case 32:i=(r=/^[0-9a-f]{32}$/i.exec(e))===null||r===void 0?void 0:r[0];break;case 36:i=(n=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(e))===null||n===void 0?void 0:n.slice(1,6).join("");break;case 38:i=(o=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(e))===null||o===void 0?void 0:o.slice(1,6).join("");break;case 45:i=(s=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(e))===null||s===void 0?void 0:s.slice(1,6).join("");break;default:break}if(i){let l=new Uint8Array(16);for(let a=0;a<16;a+=4){let u=parseInt(i.substring(2*a,2*a+8),16);l[a+0]=u>>>24,l[a+1]=u>>>16,l[a+2]=u>>>8,l[a+3]=u}return new t(l)}else throw new SyntaxError("could not parse UUID string")}toString(){let e="";for(let r=0;r<this.bytes.length;r++)e+=Yt.charAt(this.bytes[r]>>>4),e+=Yt.charAt(this.bytes[r]&15),(r===3||r===5||r===7||r===9)&&(e+="-");return e}toHex(){let e="";for(let r=0;r<this.bytes.length;r++)e+=Yt.charAt(this.bytes[r]>>>4),e+=Yt.charAt(this.bytes[r]&15);return e}toJSON(){return this.toString()}getVariant(){let e=this.bytes[8]>>>4;if(e<0)throw new Error("unreachable");if(e<=7)return this.bytes.every(r=>r===0)?"NIL":"VAR_0";if(e<=11)return"VAR_10";if(e<=13)return"VAR_110";if(e<=15)return this.bytes.every(r=>r===255)?"MAX":"VAR_RESERVED";throw new Error("unreachable")}getVersion(){return this.getVariant()==="VAR_10"?this.bytes[6]>>>4:void 0}clone(){return new t(this.bytes.slice(0))}equals(e){return this.compareTo(e)===0}compareTo(e){for(let r=0;r<16;r++){let n=this.bytes[r]-e.bytes[r];if(n!==0)return Math.sign(n)}return 0}},Dr=class{constructor(e){this.timestamp=0,this.counter=0,this.random=e??ka()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(e,r){let n=this.generateOrAbortCore(e,r);return n===void 0&&(this.timestamp=0,n=this.generateOrAbortCore(e,r)),n}generateOrAbortCore(e,r){if(!Number.isInteger(e)||e<1||e>0xffffffffffff)throw new RangeError("`unixTsMs` must be a 48-bit positive integer");if(r<0||r>0xffffffffffff)throw new RangeError("`rollbackAllowance` out of reasonable range");if(e>this.timestamp)this.timestamp=e,this.resetCounter();else if(e+r>=this.timestamp)this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter());else return;return Zt.fromFieldsV7(this.timestamp,Math.trunc(this.counter/2**30),this.counter&2**30-1,this.random.nextUint32())}resetCounter(){this.counter=this.random.nextUint32()*1024+(this.random.nextUint32()&1023)}generateV4(){let e=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return e[6]=64|e[6]>>>4,e[8]=128|e[8]>>>2,Zt.ofInner(e)}},ka=()=>{if(typeof crypto<"u"&&typeof crypto.getRandomValues<"u")return new Pr;if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");return{nextUint32:()=>Math.trunc(Math.random()*65536)*65536+Math.trunc(Math.random()*65536)}},Pr=class{constructor(){this.buffer=new Uint32Array(8),this.cursor=65535}nextUint32(){return this.cursor>=this.buffer.length&&(crypto.getRandomValues(this.buffer),this.cursor=0),this.buffer[this.cursor++]}},po,mo=()=>xa().toString(),xa=()=>(po||(po=new Dr)).generate();var Kt=class{constructor(e,r){this.storage=r;this.eventStorageKey=e==="adoraSessionScript"?"adoraEventsScript":"adoraEventsExtension"}getEvents(){let e=this.storage.getItem(this.eventStorageKey);return e?JSON.parse(e):null}setEvents(e){this.storage.setItem(this.eventStorageKey,JSON.stringify(e))}removeEvents(){this.storage.removeItem(this.eventStorageKey)}};function Ur(t){return`${t}-rate-limit-timestamp`}var Fe=class{constructor(e,r){this.sessionType=e;this.storage=r}get lastRateLimitedTimestamp(){let e=this.storage.getItem(Ur(this.sessionType));if(Ma(e))return e}clearLastRateLimitedTimestamp(){this.storage.removeItem(Ur(this.sessionType))}setLastRateLimitedTimestamp(e){this.storage.setItem(Ur(this.sessionType),e.toString())}getSession(){let e=this.storage.getItem(this.sessionType);return e?JSON.parse(e):null}setSession(e){this.storage.setItem(this.sessionType,JSON.stringify(e))}removeSession(){this.storage.removeItem(this.sessionType)}};function Ma(t){return!Number.isNaN(Number(t))}function E(t,...e){(typeof window=="object"&&window.enableAdoraDebugLogs||typeof window=="object"&&window.localStorage.getItem("enableAdoraDebugLogs"))&&console.log(t,...e)}function go(t){return{id:t.id,pathConfig:t.pathConfig,allowedQueryParams:t.allowedQueryParams,cookieDomains:t.cookieDomains,cohortsBootstrapConfig:t.cohortsBootstrapConfig||{},customQueryParamsCohorts:t.customQueryParamsCohorts,blockedCSSClasses:t.blockedCSSClasses||[],maskedCSSClasses:t.maskedCSSClasses,maskByDefault:t.maskByDefault??!1,unmaskSelectors:t.unmaskSelectors||[]}}function Oa(t){return{id:t.id,compressionType:t.compressionType||"NONE",canvasRecordingEnabled:t.canvasRecordingEnabled,limitedCanvasRecording:t.limitedCanvasRecording}}function yo(t){return"scheduledDowntime"in t?{scheduledDowntime:!0}:{organization:go(t.organization)}}function Xt(t){return{session:Oa(t.session),organization:go(t.organization),eventPostUrl:t.eventPostUrl,eventPostToken:t.eventPostToken}}function vo(t,e,r,n){return{id:t.session.id,compressionType:t.session.compressionType,organization:t.organization,settings:e,canvasRecordingEnabled:t.session.canvasRecordingEnabled,limitedCanvasRecording:t.session.limitedCanvasRecording,eventPostUrl:t.eventPostUrl,eventPostToken:t.eventPostToken,adoraUserId:r,documentReferrer:n}}function So(t,e){return{id:e.session.id,compressionType:e.session.compressionType,organization:e.organization,settings:t.settings,canvasRecordingEnabled:e.session.canvasRecordingEnabled,limitedCanvasRecording:e.session.limitedCanvasRecording,eventPostUrl:e.eventPostUrl,eventPostToken:e.eventPostToken,adoraUserId:t.adoraUserId,documentReferrer:t.documentReferrer}}var Oe=class{getItem(e){if(!Fr())return null;try{return window.sessionStorage.getItem(e)}catch{return null}}setItem(e,r){if(!Fr())return null;try{return window.sessionStorage.setItem(e,r)}catch{return null}}removeItem(e){if(!Fr())return null;try{return window.sessionStorage.removeItem(e)}catch{return null}}};function Fr(){return typeof window.sessionStorage=="object"}var Jt="v0.0.11";var bo=async(t,e,r)=>{let n=new Fe(t,new Oe),o=new Me(r.backendUrl),s=await Na(o,r,e);return s.type==="success"&&n.setSession(s.storedSession),s};async function Na(t,e,r){try{E("starting session over network",{uid:e.uid,userCohorts:e.userCohorts||{}});let n=await t.startSession({bypassSampling:e.bypassSampling,orgId:e.orgId,language:e.language||navigator.language,domain:new URL(window.location.href).hostname,userCohorts:e.userCohorts||{},uid:e.uid,devicePixelRatio:window.devicePixelRatio,adoraUserId:r,documentReferrer:document.referrer,snippetVersion:Jt});if(!n)return{type:"error",code:void 0};if(n.error)return{type:"error",code:n.error.code};if(n.response.status!==201)return E("session not created, aborting"),{type:"error",code:"code"in n.data?n.data.code:void 0};if(n.data&&"scheduledDowntime"in n.data)return E("scheduled downtime, exiting"),{type:"error",code:void 0};if(!n.data||!("session"in n.data))return E("malformed session, exiting"),{type:"error",code:void 0};let o=Xt(n.data);return{type:"success",storedSession:vo(o,e,r,n.data.session.documentReferrer)}}catch{return{type:"error",code:void 0}}}var ko=-1,Et=t=>{addEventListener("pageshow",(e=>{e.persisted&&(ko=e.timeStamp,t(e))}),!0)},We=(t,e,r,n)=>{let o,s;return i=>{e.value>=0&&(i||n)&&(s=e.value-(o??0),(s||o===void 0)&&(o=e.value,e.delta=s,e.rating=((l,a)=>l>a[1]?"poor":l>a[0]?"needs-improvement":"good")(e.value,r),t(e)))}},$r=t=>{requestAnimationFrame((()=>requestAnimationFrame((()=>t()))))},xo=()=>{let t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},er=()=>xo()?.activationStart??0,ze=(t,e=-1)=>{let r=xo(),n="navigate";return ko>=0?n="back-forward-cache":r&&(document.prerendering||er()>0?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},Wr=new WeakMap;function qr(t,e){return Wr.get(t)||Wr.set(t,new e),Wr.get(t)}var Br=class{constructor(){U(this,"t");U(this,"i",0);U(this,"o",[])}h(e){if(e.hadRecentInput)return;let r=this.o[0],n=this.o.at(-1);this.i&&r&&n&&e.startTime-n.startTime<1e3&&e.startTime-r.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}},Rt=(t,e,r={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){let n=new PerformanceObserver((o=>{Promise.resolve().then((()=>{e(o.getEntries())}))}));return n.observe({type:t,buffered:!0,...r}),n}}catch{}},Yr=t=>{let e=!1;return()=>{e||(t(),e=!0)}},it=-1,Mo=new Set,Co=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,Hr=t=>{if(document.visibilityState==="hidden"){if(t.type==="visibilitychange")for(let e of Mo)e();isFinite(it)||(it=t.type==="visibilitychange"?t.timeStamp:0,removeEventListener("prerenderingchange",Hr,!0))}},tr=()=>{if(it<0){let t=er();it=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter((r=>r.name==="hidden"&&r.startTime>t))[0]?.startTime)??Co(),addEventListener("visibilitychange",Hr,!0),addEventListener("prerenderingchange",Hr,!0),Et((()=>{setTimeout((()=>{it=Co()}))}))}return{get firstHiddenTime(){return it},onHidden(t){Mo.add(t)}}},Zr=t=>{document.prerendering?addEventListener("prerenderingchange",(()=>t()),!0):t()},wo=[1800,3e3],_a=(t,e={})=>{Zr((()=>{let r=tr(),n,o=ze("FCP"),s=Rt("paint",(i=>{for(let l of i)l.name==="first-contentful-paint"&&(s.disconnect(),l.startTime<r.firstHiddenTime&&(o.value=Math.max(l.startTime-er(),0),o.entries.push(l),n(!0)))}));s&&(n=We(t,o,wo,e.reportAllChanges),Et((i=>{o=ze("FCP"),n=We(t,o,wo,e.reportAllChanges),$r((()=>{o.value=performance.now()-i.timeStamp,n(!0)}))})))}))},Eo=[.1,.25],Oo=(t,e={})=>{let r=tr();_a(Yr((()=>{let n,o=ze("CLS",0),s=qr(e,Br),i=a=>{for(let u of a)s.h(u);s.i>o.value&&(o.value=s.i,o.entries=s.o,n())},l=Rt("layout-shift",i);l&&(n=We(t,o,Eo,e.reportAllChanges),r.onHidden((()=>{i(l.takeRecords()),n(!0)})),Et((()=>{s.i=0,o=ze("CLS",0),n=We(t,o,Eo,e.reportAllChanges),$r((()=>n()))})),setTimeout(n))})))},No=0,zr=1/0,Qt=0,La=t=>{for(let e of t)e.interactionId&&(zr=Math.min(zr,e.interactionId),Qt=Math.max(Qt,e.interactionId),No=Qt?(Qt-zr)/7+1:0)},Gr,Ro=()=>Gr?No:performance.interactionCount??0,Da=()=>{"interactionCount"in performance||Gr||(Gr=Rt("event",La,{type:"event",buffered:!0,durationThreshold:0}))},Io=0,jr=class{constructor(){U(this,"u",[]);U(this,"l",new Map);U(this,"m");U(this,"p")}v(){Io=Ro(),this.u.length=0,this.l.clear()}L(){let e=Math.min(this.u.length-1,Math.floor((Ro()-Io)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&e.entryType!=="first-input")return;let r=this.u.at(-1),n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>r.P){if(n?e.duration>n.P?(n.entries=[e],n.P=e.duration):e.duration===n.P&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],P:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort(((o,s)=>s.P-o.P)),this.u.length>10){let o=this.u.splice(10);for(let s of o)this.l.delete(s.id)}this.p?.(n)}}},_o=t=>{let e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?t():(t=Yr(t),addEventListener("visibilitychange",t,{once:!0,capture:!0}),e((()=>{t(),removeEventListener("visibilitychange",t,{capture:!0})})))},To=[200,500],Lo=(t,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;let r=tr();Zr((()=>{Da();let n,o=ze("INP"),s=qr(e,jr),i=a=>{_o((()=>{for(let c of a)s.h(c);let u=s.L();u&&u.P!==o.value&&(o.value=u.P,o.entries=u.entries,n())}))},l=Rt("event",i,{durationThreshold:e.durationThreshold??40});n=We(t,o,To,e.reportAllChanges),l&&(l.observe({type:"first-input",buffered:!0}),r.onHidden((()=>{i(l.takeRecords()),n(!0)})),Et((()=>{s.v(),o=ze("INP"),n=We(t,o,To,e.reportAllChanges)})))}))},Vr=class{constructor(){U(this,"m")}h(e){this.m?.(e)}},Ao=[2500,4e3],Do=(t,e={})=>{Zr((()=>{let r=tr(),n,o=ze("LCP"),s=qr(e,Vr),i=a=>{e.reportAllChanges||(a=a.slice(-1));for(let u of a)s.h(u),u.startTime<r.firstHiddenTime&&(o.value=Math.max(u.startTime-er(),0),o.entries=[u],n())},l=Rt("largest-contentful-paint",i);if(l){n=We(t,o,Ao,e.reportAllChanges);let a=Yr((()=>{i(l.takeRecords()),l.disconnect(),n(!0)})),u=c=>{c.isTrusted&&(_o(a),removeEventListener(c.type,u,{capture:!0}))};for(let c of["keydown","click","visibilitychange"])addEventListener(c,u,{capture:!0});Et((c=>{o=ze("LCP"),n=We(t,o,Ao,e.reportAllChanges),$r((()=>{o.value=performance.now()-c.timeStamp,n(!0)}))}))}}))};var Po="__STATSIG__",Ua="statsig@@",Uo=t=>{try{if(!t[Po])return;let e=t[Po];if(!Wa(e))return;let r={};return Object.values(e.instances).forEach(n=>{n._logger?._lastExposureTimeMap&&Object.keys(n._logger?._lastExposureTimeMap).forEach(o=>{let s=Fa(o);if(!s)return;let i=n.getExperiment(s);Ha(i)&&(r[Ua+i.name]=i.groupName)})}),r}catch{return}},Fa=t=>{let e=t.split("|");if(e.length>3)return e[3]};function Wa(t){if(!t||typeof t!="object"||!("instances"in t)||typeof t.instances!="object"||!t.instances)return!1;let e=Object.values(t.instances);for(let r of e)if(!za(r))return!1;return!0}function za(t){return!t||typeof t!="object"?!1:"_logger"in t&&typeof t._logger=="object"&&Ba(t._logger)&&"_sdkKey"in t&&typeof t._sdkKey=="string"&&"getExperiment"in t&&typeof t.getExperiment=="function"}function Ba(t){return!t||typeof t!="object"?!1:"_lastExposureTimeMap"in t&&typeof t._lastExposureTimeMap=="object"}function Ha(t){return!t||typeof t!="object"?!1:"name"in t&&typeof t.name=="string"&&"groupName"in t&&typeof t.groupName=="string"}function rr(t,e){if(!e.windowGetters)return;let r={};if(e.windowGetters.forEach(({key:n,paths:o})=>{let s=Ga(t,o);s&&(r[n]=s)}),Object.keys(r).length!==0)return r}function Ga(t,e){if(typeof t>"u")return;let r=t;for(let o=0;o<e.length-1;o++)if(r=r[e[o]],typeof r!="object")return;let n=r[e[e.length-1]];if(typeof n=="string")return n;if(typeof n=="boolean"||typeof n=="number")return n.toString()}function Kr(t){return Uo(t)}var ja=Object.defineProperty,Va=(t,e,r)=>e in t?ja(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,w=(t,e,r)=>Va(t,typeof e!="symbol"?e+"":e,r),Fo,$a=Object.defineProperty,qa=(t,e,r)=>e in t?$a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wo=(t,e,r)=>qa(t,typeof e!="symbol"?e+"":e,r),ee=(t=>(t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment",t))(ee||{}),zo={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},Bo={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},nr={};function vn(t){if(nr[t])return nr[t];let e=globalThis[t],r=e.prototype,n=t in zo?zo[t]:void 0,o=!!(n&&n.every(l=>{var a,u;return!!((u=(a=Object.getOwnPropertyDescriptor(r,l))==null?void 0:a.get)!=null&&u.toString().includes("[native code]"))})),s=t in Bo?Bo[t]:void 0,i=!!(s&&s.every(l=>{var a;return typeof r[l]=="function"&&((a=r[l])==null?void 0:a.toString().includes("[native code]"))}));if(o&&i)return nr[t]=e.prototype,e.prototype;try{let l=document.createElement("iframe");document.body.appendChild(l);let a=l.contentWindow;if(!a)return e.prototype;let u=a[t].prototype;return document.body.removeChild(l),u?nr[t]=u:r}catch{return r}}var Xr={};function He(t,e,r){var n;let o=`${t}.${String(r)}`;if(Xr[o])return Xr[o].call(e);let s=vn(t),i=(n=Object.getOwnPropertyDescriptor(s,r))==null?void 0:n.get;return i?(Xr[o]=i,i.call(e)):e[r]}var Jr={};function os(t,e,r){let n=`${t}.${String(r)}`;if(Jr[n])return Jr[n].bind(e);let s=vn(t)[r];return typeof s!="function"?e[r]:(Jr[n]=s,s.bind(e))}function Ya(t){return He("Node",t,"childNodes")}function Za(t){return He("Node",t,"parentNode")}function Ka(t){return He("Node",t,"parentElement")}function Xa(t){return He("Node",t,"textContent")}function Ja(t,e){return os("Node",t,"contains")(e)}function Qa(t){return os("Node",t,"getRootNode")()}function el(t){return!t||!("host"in t)?null:He("ShadowRoot",t,"host")}function tl(t){return t.styleSheets}function rl(t){return!t||!("shadowRoot"in t)?null:He("Element",t,"shadowRoot")}function nl(t,e){return He("Element",t,"querySelector")(e)}function ol(t,e){return He("Element",t,"querySelectorAll")(e)}function sl(){return vn("MutationObserver").constructor}var le={childNodes:Ya,parentNode:Za,parentElement:Ka,textContent:Xa,contains:Ja,getRootNode:Qa,host:el,styleSheets:tl,shadowRoot:rl,querySelector:nl,querySelectorAll:ol,mutationObserver:sl};function ss(t){return t.nodeType===t.ELEMENT_NODE}function Tt(t){let e=t&&"host"in t&&"mode"in t&&le.host(t)||null;return!!(e&&"shadowRoot"in e&&le.shadowRoot(e)===t)}function At(t){return Object.prototype.toString.call(t)==="[object ShadowRoot]"}function il(t){return t.includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;")),t}function al(t){let{cssText:e}=t;if(e.split('"').length<3)return e;let r=["@import",`url(${JSON.stringify(t.href)})`];return t.layerName===""?r.push("layer"):t.layerName&&r.push(`layer(${t.layerName})`),t.supportsText&&r.push(`supports(${t.supportsText})`),t.media.length&&r.push(t.media.mediaText),r.join(" ")+";"}function on(t){try{let e=t.rules||t.cssRules;if(!e)return null;let r=t.href;!r&&t.ownerNode&&t.ownerNode.ownerDocument&&(r=t.ownerNode.ownerDocument.location.href);let n=Array.from(e,o=>is(o,r)).join("");return il(n)}catch{return null}}function is(t,e){if(cl(t)){let r;try{r=on(t.styleSheet)||al(t)}catch{r=t.cssText}return t.styleSheet.href?dr(r,t.styleSheet.href):r}else{let r=t.cssText;return ul(t)&&t.selectorText.includes(":")&&(r=ll(r)),e?dr(r,e):r}}function ll(t){let e=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return t.replace(e,"$1\\$2")}function cl(t){return"styleSheet"in t}function ul(t){return"selectorText"in t}var cr=class{constructor(){Wo(this,"idNodeMap",new Map),Wo(this,"nodeMetaMap",new WeakMap)}getId(e){var r;return e?((r=this.getMeta(e))==null?void 0:r.id)??-1:-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){let r=this.getId(e);this.idNodeMap.delete(r),e.childNodes&&e.childNodes.forEach(n=>this.removeNodeFromMap(n))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,r){let n=r.id;this.idNodeMap.set(n,e),this.nodeMetaMap.set(e,r)}replace(e,r){let n=this.getNode(e);if(n){let o=this.nodeMetaMap.get(n);o&&this.nodeMetaMap.set(r,o)}this.idNodeMap.set(e,r)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}};function dl(){return new cr}function ur({element:t,maskInputOptions:e,tagName:r,type:n,value:o,maskInputFn:s}){let i=o||"",l=n&&Ke(n);return(e[r.toLowerCase()]||l&&e[l])&&(s?i=s(i,t):i="*".repeat(i.length)),i}function Ke(t){return t.toLowerCase()}var Ho="__rrweb_original__";function hl(t){let e=t.getContext("2d");if(!e)return!0;let r=50;for(let n=0;n<t.width;n+=r)for(let o=0;o<t.height;o+=r){let s=e.getImageData,i=Ho in s?s[Ho]:s;if(new Uint32Array(i.call(e,n,o,Math.min(r,t.width-n),Math.min(r,t.height-o)).data.buffer).some(a=>a!==0))return!1}return!0}function Sn(t){let e=t.type;return t.hasAttribute("data-rr-is-password")?"password":e?Ke(e):null}function as(t,e){let r;try{r=new URL(t,e??window.location.href)}catch{return null}let n=/\.([0-9a-z]+)(?:$)/i,o=r.pathname.match(n);return o?.[1]??null}function fl(t){let e="";return t.indexOf("//")>-1?e=t.split("/").slice(0,3).join("/"):e=t.split("/")[0],e=e.split("?")[0],e}var pl=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,ml=/^(?:[a-z+]+:)?\/\//i,gl=/^www\..*/i,yl=/^(data:)([^,]*),(.*)/i;function dr(t,e){return(t||"").replace(pl,(r,n,o,s,i,l)=>{let a=o||i||l,u=n||s||"";if(!a)return r;if(ml.test(a)||gl.test(a))return`url(${u}${a}${u})`;if(yl.test(a))return`url(${u}${a}${u})`;if(a[0]==="/")return`url(${u}${fl(e)+a}${u})`;let c=e.split("/"),h=a.split("/");c.pop();for(let f of h)f!=="."&&(f===".."?c.pop():c.push(f));return`url(${u}${c.join("/")}${u})`})}function Qr(t){return t.replace(/(\/\*[^*]*\*\/)|[\s;]/g,"")}function vl(t,e){let r=Array.from(e.childNodes),n=[];if(r.length>1&&t&&typeof t=="string"){let o=Qr(t);for(let s=1;s<r.length;s++)if(r[s].textContent&&typeof r[s].textContent=="string"){let i=Qr(r[s].textContent);for(let l=3;l<i.length;l++){let a=i.substring(0,l);if(o.split(a).length===2){let u=o.indexOf(a);for(let c=u;c<t.length;c++)if(Qr(t.substring(0,c)).length===u){n.push(t.substring(0,c)),t=t.substring(c);break}break}}}}return n.push(t),n}function Sl(t,e){return vl(t,e).join("/* rr_split */")}var bl=1,Cl=new RegExp("[^a-z0-9-_:]"),xt=-2;function ls(){return bl++}function wl(t){if(t instanceof HTMLFormElement)return"form";let e=Ke(t.tagName);return Cl.test(e)?"div":e}var at,Go,El=/^[^ \t\n\r\u000c]+/,Rl=/^[, \t\n\r\u000c]+/;function Il(t,e){if(e.trim()==="")return e;let r=0;function n(s){let i,l=s.exec(e.substring(r));return l?(i=l[0],r+=i.length,i):""}let o=[];for(;n(Rl),!(r>=e.length);){let s=n(El);if(s.slice(-1)===",")s=ut(t,s.substring(0,s.length-1)),o.push(s);else{let i="";s=ut(t,s);let l=!1;for(;;){let a=e.charAt(r);if(a===""){o.push((s+i).trim());break}else if(l)a===")"&&(l=!1);else if(a===","){r+=1,o.push((s+i).trim());break}else a==="("&&(l=!0);i+=a,r+=1}}}return o.join(", ")}var jo=new WeakMap;function ut(t,e){return!e||e.trim()===""?e:bn(t,e)}function Tl(t){return!!(t.tagName==="svg"||t.ownerSVGElement)}function bn(t,e){let r=jo.get(t);if(r||(r=t.createElement("a"),jo.set(t,r)),!e)e="";else if(e.startsWith("blob:")||e.startsWith("data:"))return e;return r.setAttribute("href",e),r.href}function cs(t,e,r,n){return n&&(r==="src"||r==="href"&&!(e==="use"&&n[0]==="#")||r==="xlink:href"&&n[0]!=="#"||r==="background"&&(e==="table"||e==="td"||e==="th")?ut(t,n):r==="srcset"?Il(t,n):r==="style"?dr(n,bn(t)):e==="object"&&r==="data"?ut(t,n):n)}function us(t,e,r){return(t==="video"||t==="audio")&&e==="autoplay"}function Al(t,e,r,n){try{if(typeof e=="string"){if(t.classList.contains(e))return!0}else for(let o=t.classList.length;o--;){let s=t.classList[o];if(e.test(s))return!0}if(r)return t.matches(r);if(n&&t.tagName==="IMG"){let o=t.getAttribute("src");if(o&&n.test(o))return!0}}catch{}return!1}function hr(t,e,r){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return r?hr(le.parentNode(t),e,r):!1;for(let n=t.classList.length;n--;){let o=t.classList[n];if(e.test(o))return!0}return r?hr(le.parentNode(t),e,r):!1}function ds(t,e,r,n){let o;if(ss(t)){if(o=t,!le.childNodes(o).length)return!1}else{if(le.parentElement(t)===null)return!1;o=le.parentElement(t)}try{if(typeof e=="string"){if(n){if(o.closest(`.${e}`))return!0}else if(o.classList.contains(e))return!0}else if(hr(o,e,n))return!0;if(r){if(n){if(o.closest(r))return!0}else if(o.matches(r))return!0}if(o.getAttribute("contenteditable")||o.closest('[contenteditable="true"]'))return!0}catch{}return!1}function kl(t,e,r){let n=t.contentWindow;if(!n)return;let o=!1,s;try{s=n.document.readyState}catch{return}if(s!=="complete"){let l=setTimeout(()=>{o||(e(),o=!0)},r);t.addEventListener("load",()=>{clearTimeout(l),o=!0,e()});return}let i="about:blank";if(n.location.href!==i||t.src===i||t.src==="")return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}function xl(t,e,r){let n=!1,o;try{o=t.sheet}catch{return}if(o)return;let s=setTimeout(()=>{n||(e(),n=!0)},r);t.addEventListener("load",()=>{clearTimeout(s),n=!0,e()})}function Ml(t,e){let{doc:r,mirror:n,blockClass:o,blockSelector:s,needsMask:i,inlineStylesheet:l,maskInputOptions:a={},maskTextFn:u,maskInputFn:c,maskAnchorHrefFn:h,blockImgSrcPattern:f,blockImgSrcFillOptions:p,dataURLOptions:m={},inlineImages:d,recordCanvas:y,keepIframeSrcFn:g,newlyAddedElement:S=!1,cssCaptured:v=!1}=e,A=Ol(r,n);switch(t.nodeType){case t.DOCUMENT_NODE:return t.compatMode!=="CSS1Compat"?{type:ee.Document,childNodes:[],compatMode:t.compatMode}:{type:ee.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:ee.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:A};case t.ELEMENT_NODE:return _l(t,{doc:r,blockClass:o,blockSelector:s,inlineStylesheet:l,maskInputOptions:a,maskInputFn:c,maskAnchorHrefFn:h,blockImgSrcPattern:f,blockImgSrcFillOptions:p,dataURLOptions:m,inlineImages:d,recordCanvas:y,keepIframeSrcFn:g,newlyAddedElement:S,rootId:A});case t.TEXT_NODE:return Nl(t,{doc:r,needsMask:i,maskTextFn:u,rootId:A,cssCaptured:v});case t.CDATA_SECTION_NODE:return{type:ee.CDATA,textContent:"",rootId:A};case t.COMMENT_NODE:return{type:ee.Comment,textContent:le.textContent(t)||"",rootId:A};default:return!1}}function Ol(t,e){if(!e.hasNode(t))return;let r=e.getId(t);return r===1?void 0:r}function Nl(t,e){let{needsMask:r,maskTextFn:n,rootId:o,cssCaptured:s}=e,i=le.parentNode(t),l=i&&i.tagName,a="",u=l==="STYLE"?!0:void 0,c=l==="SCRIPT"?!0:void 0;return c?a="SCRIPT_PLACEHOLDER":s||(a=le.textContent(t),u&&a&&(a=dr(a,bn(e.doc)))),!u&&!c&&a&&r&&(a=n?n(a,le.parentElement(t)):a.replace(/[\S]/g,"*")),{type:ee.Text,textContent:a||"",rootId:o}}function _l(t,e){let{doc:r,blockClass:n,blockSelector:o,inlineStylesheet:s,maskInputOptions:i={},maskInputFn:l,maskAnchorHrefFn:a,blockImgSrcPattern:u,blockImgSrcFillOptions:c,dataURLOptions:h={},inlineImages:f,recordCanvas:p,keepIframeSrcFn:m,newlyAddedElement:d=!1,rootId:y}=e,g=Al(t,n,o,u),S=wl(t),v={},A=t.attributes.length;for(let b=0;b<A;b++){let T=t.attributes[b];us(S,T.name,T.value)||(v[T.name]=cs(r,S,Ke(T.name),T.value))}if(S==="a"&&a&&typeof v.href=="string"&&(v.href=a(v.href,t)),S==="link"&&s){let b=Array.from(r.styleSheets).find(R=>R.href===t.href);if(!b&&t.href.includes(".css")){let R=window.location.origin,O=t.href.replace(window.location.href,""),W=R+"/"+O;b=Array.from(r.styleSheets).find(se=>se.href===W)}let T=null;b&&(T=on(b)),T&&(delete v.rel,delete v.href,v._cssText=T)}if(S==="style"&&t.sheet){let b=on(t.sheet);b&&(t.childNodes.length>1&&(b=Sl(b,t)),v._cssText=b)}if(S==="input"||S==="textarea"||S==="select"){let b=t.value,T=t.checked;v.type!=="radio"&&v.type!=="checkbox"&&v.type!=="submit"&&v.type!=="button"&&b?v.value=ur({element:t,type:Sn(t),tagName:S,value:b,maskInputOptions:i,maskInputFn:l}):T&&(v.checked=T)}if(S==="option"&&(t.selected&&!i.select?v.selected=!0:delete v.selected),S==="dialog"&&t.open&&(v.rr_open_mode=t.matches("dialog:modal")?"modal":"non-modal"),S==="canvas"&&p){if(t.__context==="2d")hl(t)||(v.rr_dataURL=t.toDataURL(h.type,h.quality));else if(!("__context"in t)){let b=t.toDataURL(h.type,h.quality),T=r.createElement("canvas");T.width=t.width,T.height=t.height;let R=T.toDataURL(h.type,h.quality);b!==R&&(v.rr_dataURL=b)}}if(S==="img"&&f){at||(at=r.createElement("canvas"),Go=at.getContext("2d"));let b=t,T=b.currentSrc||b.getAttribute("src")||"<unknown-src>",R=b.crossOrigin,O=()=>{b.removeEventListener("load",O);try{at.width=b.naturalWidth,at.height=b.naturalHeight,Go.drawImage(b,0,0),v.rr_dataURL=at.toDataURL(h.type,h.quality)}catch(W){if(b.crossOrigin!=="anonymous"){b.crossOrigin="anonymous",b.complete&&b.naturalWidth!==0?O():b.addEventListener("load",O);return}else console.warn(`Cannot inline img src=${T}! Error: ${W}`)}b.crossOrigin==="anonymous"&&(R?v.crossOrigin=R:b.removeAttribute("crossorigin"))};b.complete&&b.naturalWidth!==0?O():b.addEventListener("load",O)}if(S==="audio"||S==="video"){let b=v;b.rr_mediaState=t.paused?"paused":"played",b.rr_mediaCurrentTime=t.currentTime,b.rr_mediaPlaybackRate=t.playbackRate,b.rr_mediaMuted=t.muted,b.rr_mediaLoop=t.loop,b.rr_mediaVolume=t.volume}if(d||(t.scrollLeft&&(v.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(v.rr_scrollTop=t.scrollTop)),g){let{width:b,height:T}=t.getBoundingClientRect();v={class:v.class,rr_width:`${b}px`,rr_height:`${T}px`}}g&&S==="img"&&(v={...v,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP89v3nfwAJuAPnyTr4jAAAAABJRU5ErkJggg==",rr_fill:c.backgroundColor,rr_stroke:c.strokeColor,rr_stroke_width:c.strokeWidth}),S==="iframe"&&!m(v.src)&&(t.contentDocument||(v.rr_src=v.src),delete v.src);let I;try{customElements.get(S)&&(I=!0)}catch{}return{type:ee.Element,tagName:S,attributes:v,childNodes:[],isSVG:Tl(t)||void 0,needBlock:g,rootId:y,isCustom:I}}function $(t){return t==null?"":t.toLowerCase()}function Ll(t,e){if(e.comment&&t.type===ee.Comment)return!0;if(t.type===ee.Element){if(e.script&&(t.tagName==="script"||t.tagName==="link"&&(t.attributes.rel==="preload"||t.attributes.rel==="modulepreload")&&t.attributes.as==="script"||t.tagName==="link"&&t.attributes.rel==="prefetch"&&typeof t.attributes.href=="string"&&as(t.attributes.href)==="js"))return!0;if(e.headFavicon&&(t.tagName==="link"&&t.attributes.rel==="shortcut icon"||t.tagName==="meta"&&($(t.attributes.name).match(/^msapplication-tile(image|color)$/)||$(t.attributes.name)==="application-name"||$(t.attributes.rel)==="icon"||$(t.attributes.rel)==="apple-touch-icon"||$(t.attributes.rel)==="shortcut icon")))return!0;if(t.tagName==="meta"){if(e.headMetaDescKeywords&&$(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&($(t.attributes.property).match(/^(og|twitter|fb):/)||$(t.attributes.name).match(/^(og|twitter):/)||$(t.attributes.name)==="pinterest"))return!0;if(e.headMetaRobots&&($(t.attributes.name)==="robots"||$(t.attributes.name)==="googlebot"||$(t.attributes.name)==="bingbot"))return!0;if(e.headMetaHttpEquiv&&t.attributes["http-equiv"]!==void 0)return!0;if(e.headMetaAuthorship&&($(t.attributes.name)==="author"||$(t.attributes.name)==="generator"||$(t.attributes.name)==="framework"||$(t.attributes.name)==="publisher"||$(t.attributes.name)==="progid"||$(t.attributes.property).match(/^article:/)||$(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&($(t.attributes.name)==="google-site-verification"||$(t.attributes.name)==="yandex-verification"||$(t.attributes.name)==="csrf-token"||$(t.attributes.name)==="p:domain_verify"||$(t.attributes.name)==="verify-v1"||$(t.attributes.name)==="verification"||$(t.attributes.name)==="shopify-checkout-api-token"))return!0}}return!1}function dt(t,e){if(t.nodeName.toLowerCase().includes("grammarly"))return null;let{doc:r,mirror:n,blockClass:o,blockSelector:s,maskTextClass:i,maskTextSelector:l,skipChild:a=!1,inlineStylesheet:u=!0,maskInputOptions:c={},maskTextFn:h,maskInputFn:f,maskAnchorHrefFn:p,blockImgSrcPattern:m,blockImgSrcFillOptions:d,slimDOMOptions:y,dataURLOptions:g={},inlineImages:S=!1,recordCanvas:v=!1,onSerialize:A,onIframeLoad:I,iframeLoadTimeout:b=5e3,onStylesheetLoad:T,stylesheetLoadTimeout:R=5e3,keepIframeSrcFn:O=()=>!1,newlyAddedElement:W=!1,cssCaptured:se=!1}=e,{needsMask:z}=e,{preserveWhiteSpace:ie=!0}=e;z||(z=ds(t,i,l,z===void 0));let j=Ml(t,{doc:r,mirror:n,blockClass:o,blockSelector:s,needsMask:z,inlineStylesheet:u,maskInputOptions:c,maskTextFn:h,maskInputFn:f,maskAnchorHrefFn:p,blockImgSrcPattern:m,blockImgSrcFillOptions:d,dataURLOptions:g,inlineImages:S,recordCanvas:v,keepIframeSrcFn:O,newlyAddedElement:W,cssCaptured:se});if(!j)return console.warn(t,"not serialized"),null;let H;n.hasNode(t)?H=n.getId(t):Ll(j,y)||!ie&&j.type===ee.Text&&!j.textContent.replace(/^\s+|\s+$/gm,"").length?H=xt:H=ls();let k=Object.assign(j,{id:H});if(n.add(t,k),H===xt)return null;A&&A(t);let M=!a;if(k.type===ee.Element){M=M&&!k.needBlock,delete k.needBlock;let x=le.shadowRoot(t);x&&At(x)&&(k.isShadowHost=!0)}if((k.type===ee.Document||k.type===ee.Element)&&M){y.headWhitespace&&k.type===ee.Element&&k.tagName==="head"&&(ie=!1);let x={doc:r,mirror:n,blockClass:o,blockSelector:s,needsMask:z,maskTextClass:i,maskTextSelector:l,skipChild:a,inlineStylesheet:u,maskInputOptions:c,maskTextFn:h,maskInputFn:f,maskAnchorHrefFn:p,blockImgSrcPattern:m,blockImgSrcFillOptions:d,slimDOMOptions:y,dataURLOptions:g,inlineImages:S,recordCanvas:v,preserveWhiteSpace:ie,onSerialize:A,onIframeLoad:I,iframeLoadTimeout:b,onStylesheetLoad:T,stylesheetLoadTimeout:R,keepIframeSrcFn:O,cssCaptured:!1};if(!(k.type===ee.Element&&k.tagName==="textarea"&&k.attributes.value!==void 0)){k.type===ee.Element&&k.attributes._cssText!==void 0&&typeof k.attributes._cssText=="string"&&(x.cssCaptured=!0);for(let V of Array.from(le.childNodes(t))){let J=dt(V,x);J&&k.childNodes.push(J)}}let P=null;if(ss(t)&&(P=le.shadowRoot(t)))for(let V of Array.from(le.childNodes(P))){let J=dt(V,x);J&&(At(P)&&(J.isShadow=!0),k.childNodes.push(J))}}let X=le.parentNode(t);return X&&Tt(X)&&At(X)&&(k.isShadow=!0),k.type===ee.Element&&k.tagName==="iframe"&&kl(t,()=>{let x=t.contentDocument;if(x&&I){let P=dt(x,{doc:x,mirror:n,blockClass:o,blockSelector:s,needsMask:z,maskTextClass:i,maskTextSelector:l,skipChild:!1,inlineStylesheet:u,maskInputOptions:c,maskTextFn:h,maskInputFn:f,maskAnchorHrefFn:p,blockImgSrcPattern:m,blockImgSrcFillOptions:d,slimDOMOptions:y,dataURLOptions:g,inlineImages:S,recordCanvas:v,preserveWhiteSpace:ie,onSerialize:A,onIframeLoad:I,iframeLoadTimeout:b,onStylesheetLoad:T,stylesheetLoadTimeout:R,keepIframeSrcFn:O});P&&I(t,P)}},b),k.type===ee.Element&&k.tagName==="link"&&typeof k.attributes.rel=="string"&&(k.attributes.rel==="stylesheet"||k.attributes.rel==="preload"&&typeof k.attributes.href=="string"&&as(k.attributes.href)==="css")&&xl(t,()=>{if(T){let x=dt(t,{doc:r,mirror:n,blockClass:o,blockSelector:s,needsMask:z,maskTextClass:i,maskTextSelector:l,skipChild:!1,inlineStylesheet:u,maskInputOptions:c,maskTextFn:h,maskInputFn:f,maskAnchorHrefFn:p,blockImgSrcPattern:m,blockImgSrcFillOptions:d,slimDOMOptions:y,dataURLOptions:g,inlineImages:S,recordCanvas:v,preserveWhiteSpace:ie,onSerialize:A,onIframeLoad:I,iframeLoadTimeout:b,onStylesheetLoad:T,stylesheetLoadTimeout:R,keepIframeSrcFn:O});x&&T(t,x)}},R),k}function Dl(t,e){let{mirror:r=new cr,blockClass:n="rr-block",blockSelector:o=null,maskTextClass:s="rr-mask",maskTextSelector:i=null,inlineStylesheet:l=!0,inlineImages:a=!1,recordCanvas:u=!1,maskAllInputs:c=!1,maskTextFn:h,maskInputFn:f,maskAnchorHrefFn:p,blockImgSrcPattern:m=null,blockImgSrcFillOptions:d={backgroundColor:"#F6F7F9",strokeColor:"#E9EBEF",strokeWidth:"1px"},slimDOM:y=!1,dataURLOptions:g,preserveWhiteSpace:S,onSerialize:v,onIframeLoad:A,iframeLoadTimeout:I,onStylesheetLoad:b,stylesheetLoadTimeout:T,keepIframeSrcFn:R=()=>!1}=e||{};return dt(t,{doc:t,mirror:r,blockClass:n,blockSelector:o,maskTextClass:s,maskTextSelector:i,skipChild:!1,inlineStylesheet:l,maskInputOptions:c===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:c===!1?{password:!0}:c,maskTextFn:h,maskInputFn:f,maskAnchorHrefFn:p,blockImgSrcPattern:m,blockImgSrcFillOptions:d,slimDOMOptions:y===!0||y==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:y==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:y===!1?{}:y,dataURLOptions:g,inlineImages:a,recordCanvas:u,preserveWhiteSpace:S,onSerialize:v,onIframeLoad:A,iframeLoadTimeout:I,onStylesheetLoad:b,stylesheetLoadTimeout:T,keepIframeSrcFn:R,newlyAddedElement:!1})}var sn=class t{constructor(...e){__publicField2(this,"parentElement",null),__publicField2(this,"parentNode",null),__publicField2(this,"ownerDocument"),__publicField2(this,"firstChild",null),__publicField2(this,"lastChild",null),__publicField2(this,"previousSibling",null),__publicField2(this,"nextSibling",null),__publicField2(this,"ELEMENT_NODE",1),__publicField2(this,"TEXT_NODE",3),__publicField2(this,"nodeType"),__publicField2(this,"nodeName"),__publicField2(this,"RRNodeType")}get childNodes(){let e=[],r=this.firstChild;for(;r;)e.push(r),r=r.nextSibling;return e}contains(e){if(e instanceof t){if(e.ownerDocument!==this.ownerDocument)return!1;if(e===this)return!0}else return!1;for(;e.parentNode;){if(e.parentNode===this)return!0;e=e.parentNode}return!1}appendChild(e){throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.")}insertBefore(e,r){throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.")}removeChild(e){throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.")}toString(){return"RRNode"}},Vo={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},$o={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},or={};function Cn(t){if(or[t])return or[t];let e=globalThis[t],r=e.prototype,n=t in Vo?Vo[t]:void 0,o=!!(n&&n.every(l=>{var a,u;return!!((u=(a=Object.getOwnPropertyDescriptor(r,l))==null?void 0:a.get)!=null&&u.toString().includes("[native code]"))})),s=t in $o?$o[t]:void 0,i=!!(s&&s.every(l=>{var a;return typeof r[l]=="function"&&((a=r[l])==null?void 0:a.toString().includes("[native code]"))}));if(o&&i)return or[t]=e.prototype,e.prototype;try{let l=document.createElement("iframe");document.body.appendChild(l);let a=l.contentWindow;if(!a)return e.prototype;let u=a[t].prototype;return document.body.removeChild(l),u?or[t]=u:r}catch{return r}}var en={};function Ge(t,e,r){var n;let o=`${t}.${String(r)}`;if(en[o])return en[o].call(e);let s=Cn(t),i=(n=Object.getOwnPropertyDescriptor(s,r))==null?void 0:n.get;return i?(en[o]=i,i.call(e)):e[r]}var tn={};function hs(t,e,r){let n=`${t}.${String(r)}`;if(tn[n])return tn[n].bind(e);let s=Cn(t)[r];return typeof s!="function"?e[r]:(tn[n]=s,s.bind(e))}function Pl(t){return Ge("Node",t,"childNodes")}function Ul(t){return Ge("Node",t,"parentNode")}function Fl(t){return Ge("Node",t,"parentElement")}function Wl(t){return Ge("Node",t,"textContent")}function zl(t,e){return hs("Node",t,"contains")(e)}function Bl(t){return hs("Node",t,"getRootNode")()}function Hl(t){return!t||!("host"in t)?null:Ge("ShadowRoot",t,"host")}function Gl(t){return t.styleSheets}function jl(t){return!t||!("shadowRoot"in t)?null:Ge("Element",t,"shadowRoot")}function Vl(t,e){return Ge("Element",t,"querySelector")(e)}function $l(t,e){return Ge("Element",t,"querySelectorAll")(e)}function fs(){return Cn("MutationObserver").constructor}var N={childNodes:Pl,parentNode:Ul,parentElement:Fl,textContent:Wl,contains:zl,getRootNode:Bl,host:Hl,styleSheets:Gl,shadowRoot:jl,querySelector:Vl,querySelectorAll:$l,mutationObserver:fs};function ue(t,e,r=document){let n={capture:!0,passive:!0};return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}var lt=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`,qo={map:{},getId(){return console.error(lt),-1},getNode(){return console.error(lt),null},removeNodeFromMap(){console.error(lt)},has(){return console.error(lt),!1},reset(){console.error(lt)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(qo=new Proxy(qo,{get(t,e,r){return e==="map"&&console.error(lt),Reflect.get(t,e,r)}}));function Mt(t,e,r={}){let n=null,o=0;return function(...s){let i=Date.now();!o&&r.leading===!1&&(o=i);let l=e-(i-o),a=this;l<=0||l>e?(n&&(clearTimeout(n),n=null),o=i,t.apply(a,s)):!n&&r.trailing!==!1&&(n=setTimeout(()=>{o=r.leading===!1?0:Date.now(),n=null,t.apply(a,s)},l))}}function yr(t,e,r,n,o=window){let s=o.Object.getOwnPropertyDescriptor(t,e);return o.Object.defineProperty(t,e,n?r:{set(i){setTimeout(()=>{r.set.call(this,i)},0),s&&s.set&&s.set.call(this,i)}}),()=>yr(t,e,s||{},!0)}function pt(t,e,r){try{if(!(e in t))return()=>{};let n=t[e],o=r(n);return typeof o=="function"&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:n}})),t[e]=o,()=>{t[e]=n}}catch{return()=>{}}}var fr=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(fr=()=>new Date().getTime());function ps(t){var e,r,n,o;let s=t.document;return{left:s.scrollingElement?s.scrollingElement.scrollLeft:t.pageXOffset!==void 0?t.pageXOffset:s.documentElement.scrollLeft||s?.body&&((e=N.parentElement(s.body))==null?void 0:e.scrollLeft)||((r=s?.body)==null?void 0:r.scrollLeft)||0,top:s.scrollingElement?s.scrollingElement.scrollTop:t.pageYOffset!==void 0?t.pageYOffset:s?.documentElement.scrollTop||s?.body&&((n=N.parentElement(s.body))==null?void 0:n.scrollTop)||((o=s?.body)==null?void 0:o.scrollTop)||0}}function ms(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function gs(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function ys(t){return t?t.nodeType===t.ELEMENT_NODE?t:N.parentElement(t):null}function de(t,e,r,n){if(!t)return!1;let o=ys(t);if(!o)return!1;try{if(typeof e=="string"){if(o.classList.contains(e)||n&&o.closest("."+e)!==null)return!0}else if(hr(o,e,n))return!0}catch{}return!!(r&&(o.matches(r)||n&&o.closest(r)!==null))}function ql(t,e){return e.getId(t)!==-1}function rn(t,e,r){return t.tagName==="TITLE"&&r.headTitleMutations?!0:e.getId(t)===xt}function vs(t,e){if(Tt(t))return!1;let r=e.getId(t);if(!e.has(r))return!0;let n=N.parentNode(t);return n&&n.nodeType===t.DOCUMENT_NODE?!1:n?vs(n,e):!0}function an(t){return!!t.changedTouches}function Yl(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach)}function Ss(t,e){return!!(t.nodeName==="IFRAME"&&e.getMeta(t))}function bs(t,e){return!!(t.nodeName==="LINK"&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&t.getAttribute("rel")==="stylesheet"&&e.getMeta(t))}function ln(t){return t?t instanceof sn&&"shadowRoot"in t?!!t.shadowRoot:!!N.shadowRoot(t):!1}var cn=class{constructor(){w(this,"id",1),w(this,"styleIDMap",new WeakMap),w(this,"idStyleMap",new Map)}getId(e){return this.styleIDMap.get(e)??-1}has(e){return this.styleIDMap.has(e)}add(e,r){if(this.has(e))return this.getId(e);let n;return r===void 0?n=this.id++:n=r,this.styleIDMap.set(e,n),this.idStyleMap.set(n,e),n}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}};function Cs(t){var e;let r=null;return"getRootNode"in t&&((e=N.getRootNode(t))==null?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&N.host(N.getRootNode(t))&&(r=N.host(N.getRootNode(t))),r}function Zl(t){let e=t,r;for(;r=Cs(e);)e=r;return e}function Kl(t){let e=t.ownerDocument;if(!e)return!1;let r=Zl(t);return N.contains(e,r)}function ws(t){let e=t.ownerDocument;return e?N.contains(e,t)||Kl(t):!1}var F=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(F||{}),_=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t))(_||{}),ye=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(ye||{}),Ne=(t=>(t[t.Mouse=0]="Mouse",t[t.Pen=1]="Pen",t[t.Touch=2]="Touch",t))(Ne||{}),ft=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(ft||{}),ct=(t=>(t[t.Play=0]="Play",t[t.Pause=1]="Pause",t[t.Seeked=2]="Seeked",t[t.VolumeChange=3]="VolumeChange",t[t.RateChange=4]="RateChange",t))(ct||{});function Yo(t){return"__ln"in t}var un=class{constructor(){w(this,"length",0),w(this,"head",null),w(this,"tail",null)}get(e){if(e>=this.length)throw new Error("Position outside of list range");let r=this.head;for(let n=0;n<e;n++)r=r?.next||null;return r}addNode(e){let r={value:e,previous:null,next:null};if(e.__ln=r,e.previousSibling&&Yo(e.previousSibling)){let n=e.previousSibling.__ln.next;r.next=n,r.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=r,n&&(n.previous=r)}else if(e.nextSibling&&Yo(e.nextSibling)&&e.nextSibling.__ln.previous){let n=e.nextSibling.__ln.previous;r.previous=n,r.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=r,n&&(n.next=r)}else this.head&&(this.head.previous=r),r.next=this.head,this.head=r;r.next===null&&(this.tail=r),this.length++}removeNode(e){let r=e.__ln;this.head&&(r.previous?(r.previous.next=r.next,r.next?r.next.previous=r.previous:this.tail=r.previous):(this.head=r.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}},Zo=(t,e)=>`${t}@${e}`,dn=class{constructor(){w(this,"frozen",!1),w(this,"locked",!1),w(this,"texts",[]),w(this,"attributes",[]),w(this,"attributeMap",new WeakMap),w(this,"removes",[]),w(this,"mapRemoves",[]),w(this,"movedMap",{}),w(this,"addedSet",new Set),w(this,"movedSet",new Set),w(this,"droppedSet",new Set),w(this,"mutationCb"),w(this,"blockClass"),w(this,"blockSelector"),w(this,"maskTextClass"),w(this,"maskTextSelector"),w(this,"inlineStylesheet"),w(this,"maskInputOptions"),w(this,"maskTextFn"),w(this,"maskInputFn"),w(this,"maskAnchorHrefFn"),w(this,"blockImgSrcPattern"),w(this,"blockImgSrcFillOptions"),w(this,"keepIframeSrcFn"),w(this,"recordCanvas"),w(this,"inlineImages"),w(this,"slimDOMOptions"),w(this,"dataURLOptions"),w(this,"doc"),w(this,"mirror"),w(this,"iframeManager"),w(this,"stylesheetManager"),w(this,"shadowDomManager"),w(this,"canvasManager"),w(this,"processedNodeManager"),w(this,"unattachedDoc"),w(this,"processMutations",e=>{e.forEach(this.processMutation),this.emit()}),w(this,"emit",()=>{if(this.frozen||this.locked)return;let e=[],r=new Set,n=new un,o=a=>{let u=a,c=xt;for(;c===xt;)u=u&&u.nextSibling,c=u&&this.mirror.getId(u);return c},s=a=>{let u=N.parentNode(a);if(!u||!ws(a))return;let c=!1;if(a.nodeType===Node.TEXT_NODE){let m=u.tagName;if(m==="TEXTAREA")return;m==="STYLE"&&this.addedSet.has(u)&&(c=!0)}let h=Tt(u)?this.mirror.getId(Cs(a)):this.mirror.getId(u),f=o(a);if(h===-1||f===-1)return n.addNode(a);let p=dt(a,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,maskAnchorHrefFn:this.maskAnchorHrefFn,blockImgSrcPattern:this.blockImgSrcPattern,blockImgSrcFillOptions:this.blockImgSrcFillOptions,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:m=>{Ss(m,this.mirror)&&this.iframeManager.addIframe(m),bs(m,this.mirror)&&this.stylesheetManager.trackLinkElement(m),ln(a)&&this.shadowDomManager.addShadowRoot(N.shadowRoot(a),this.doc)},onIframeLoad:(m,d)=>{this.iframeManager.attachIframe(m,d),this.shadowDomManager.observeAttachShadow(m)},onStylesheetLoad:(m,d)=>{this.stylesheetManager.attachLinkElement(m,d)},cssCaptured:c});p&&(e.push({parentId:h,nextId:f,node:p}),r.add(p.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(let a of this.movedSet)Ko(this.removes,a,this.mirror)&&!this.movedSet.has(N.parentNode(a))||s(a);for(let a of this.addedSet)!Xo(this.droppedSet,a)&&!Ko(this.removes,a,this.mirror)||Xo(this.movedSet,a)?s(a):this.droppedSet.add(a);let i=null;for(;n.length;){let a=null;if(i){let u=this.mirror.getId(N.parentNode(i.value)),c=o(i.value);u!==-1&&c!==-1&&(a=i)}if(!a){let u=n.tail;for(;u;){let c=u;if(u=u.previous,c){let h=this.mirror.getId(N.parentNode(c.value));if(o(c.value)===-1)continue;if(h!==-1){a=c;break}else{let p=c.value,m=N.parentNode(p);if(m&&m.nodeType===Node.DOCUMENT_FRAGMENT_NODE){let d=N.host(m);if(this.mirror.getId(d)!==-1){a=c;break}}}}}}if(!a){for(;n.head;)n.removeNode(n.head.value);break}i=a.previous,n.removeNode(a.value),s(a.value)}let l={texts:this.texts.map(a=>{let u=a.node,c=N.parentNode(u);return c&&c.tagName==="TEXTAREA"&&this.genTextAreaValueMutation(c),{id:this.mirror.getId(u),value:a.value}}).filter(a=>!r.has(a.id)).filter(a=>this.mirror.has(a.id)),attributes:this.attributes.map(a=>{let{attributes:u}=a;if(typeof u.style=="string"){let c=JSON.stringify(a.styleDiff),h=JSON.stringify(a._unchangedStyles);c.length<u.style.length&&(c+h).split("var(").length===u.style.split("var(").length&&(u.style=a.styleDiff)}return{id:this.mirror.getId(a.node),attributes:u}}).filter(a=>!r.has(a.id)).filter(a=>this.mirror.has(a.id)),removes:this.removes,adds:e};!l.texts.length&&!l.attributes.length&&!l.removes.length&&!l.adds.length||(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(l))}),w(this,"genTextAreaValueMutation",e=>{let r=this.attributeMap.get(e);r||(r={node:e,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(r),this.attributeMap.set(e,r));let n=r.attributes.value=Array.from(N.childNodes(e),o=>N.textContent(o)||"").join("");r.attributes.value=ur({element:e,maskInputOptions:this.maskInputOptions,tagName:e.tagName,type:null,value:n,maskInputFn:this.maskInputFn})}),w(this,"processMutation",e=>{if(!rn(e.target,this.mirror,this.slimDOMOptions))switch(e.type){case"characterData":{let r=N.textContent(e.target);!de(e.target,this.blockClass,this.blockSelector,!1)&&r!==e.oldValue&&this.texts.push({value:ds(e.target,this.maskTextClass,this.maskTextSelector,!0)&&r?this.maskTextFn?this.maskTextFn(r,ys(e.target)):r.replace(/[\S]/g,"*"):r,node:e.target});break}case"attributes":{let r=e.target,n=e.attributeName,o=e.target.getAttribute(n);if(n==="value"){let l=Sn(r);o=ur({element:r,maskInputOptions:this.maskInputOptions,tagName:r.tagName,type:l,value:o,maskInputFn:this.maskInputFn})}let s=de(e.target,this.blockClass,this.blockSelector,!1);if(s&&n==="style"){let l=e.target,{width:a,height:u}=l.getBoundingClientRect(),c=this.attributeMap.get(e.target);c||(c={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(c),this.attributeMap.set(e.target,c)),c.attributes.rr_width=`${a}px`,c.attributes.rr_height=`${u}px`}if(s||o===e.oldValue)return;let i=this.attributeMap.get(e.target);if(r.tagName==="IFRAME"&&n==="src"&&!this.keepIframeSrcFn(o))if(!r.contentDocument)n="rr_src";else return;if(i||(i={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(i),this.attributeMap.set(e.target,i)),n==="type"&&r.tagName==="INPUT"&&(e.oldValue||"").toLowerCase()==="password"&&r.setAttribute("data-rr-is-password","true"),!us(r.tagName,n))if(i.attributes[n]=cs(this.doc,Ke(r.tagName),Ke(n),o),n==="style"){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch{this.unattachedDoc=this.doc}let l=this.unattachedDoc.createElement("span");e.oldValue&&l.setAttribute("style",e.oldValue);for(let a of Array.from(r.style)){let u=r.style.getPropertyValue(a),c=r.style.getPropertyPriority(a);u!==l.style.getPropertyValue(a)||c!==l.style.getPropertyPriority(a)?c===""?i.styleDiff[a]=u:i.styleDiff[a]=[u,c]:i._unchangedStyles[a]=[u,c]}for(let a of Array.from(l.style))r.style.getPropertyValue(a)===""&&(i.styleDiff[a]=!1)}else n==="open"&&r.tagName==="DIALOG"&&(r.matches("dialog:modal")?i.attributes.rr_open_mode="modal":i.attributes.rr_open_mode="non-modal");break}case"childList":{if(de(e.target,this.blockClass,this.blockSelector,!0))return;if(e.target.tagName==="TEXTAREA"){this.genTextAreaValueMutation(e.target);return}e.addedNodes.forEach(r=>this.genAdds(r,e.target)),e.removedNodes.forEach(r=>{let n=this.mirror.getId(r),o=Tt(e.target)?this.mirror.getId(N.host(e.target)):this.mirror.getId(e.target);de(e.target,this.blockClass,this.blockSelector,!1)||rn(r,this.mirror,this.slimDOMOptions)||!ql(r,this.mirror)||(this.addedSet.has(r)?(hn(this.addedSet,r),this.droppedSet.add(r)):this.addedSet.has(e.target)&&n===-1||vs(e.target,this.mirror)||(this.movedSet.has(r)&&this.movedMap[Zo(n,o)]?hn(this.movedSet,r):this.removes.push({parentId:o,id:n,isShadow:Tt(e.target)&&At(e.target)?!0:void 0})),this.mapRemoves.push(r))});break}}}),w(this,"genAdds",(e,r)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!(this.addedSet.has(e)||this.movedSet.has(e))){if(this.mirror.hasNode(e)){if(rn(e,this.mirror,this.slimDOMOptions))return;this.movedSet.add(e);let n=null;r&&this.mirror.hasNode(r)&&(n=this.mirror.getId(r)),n&&n!==-1&&(this.movedMap[Zo(this.mirror.getId(e),n)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);de(e,this.blockClass,this.blockSelector,!1)||(N.childNodes(e).forEach(n=>this.genAdds(n)),ln(e)&&N.childNodes(N.shadowRoot(e)).forEach(n=>{this.processedNodeManager.add(n,this),this.genAdds(n,e)}))}})}init(e){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","maskAnchorHrefFn","blockImgSrcPattern","blockImgSrcFillOptions","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(r=>{this[r]=e[r]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}};function hn(t,e){t.delete(e),N.childNodes(e).forEach(r=>hn(t,r))}function Ko(t,e,r){return t.length===0?!1:Xl(t,e,r)}function Xl(t,e,r){let n=N.parentNode(e);for(;n;){let o=r.getId(n);if(t.some(s=>s.id===o))return!0;n=N.parentNode(n)}return!1}function Xo(t,e){return t.size===0?!1:Es(t,e)}function Es(t,e){let r=N.parentNode(e);return r?t.has(r)?!0:Es(t,r):!1}var kt;function Jl(t){kt=t}function Ql(){kt=void 0}var D=t=>kt?(...r)=>{try{return t(...r)}catch(n){if(kt&&kt(n)===!0)return;throw n}}:t,Ze=[];function Ot(t){try{if("composedPath"in t){let e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0]}catch{}return t&&t.target}function Rs(t,e){let r=new dn;Ze.push(r),r.init(t);let n=new(fs())(D(r.processMutations.bind(r)));return n.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),n}function ec({mousemoveCb:t,sampling:e,doc:r,mirror:n}){if(e.mousemove===!1)return()=>{};let o=typeof e.mousemove=="number"?e.mousemove:50,s=typeof e.mousemoveCallback=="number"?e.mousemoveCallback:500,i=[],l,a=Mt(D(h=>{let f=Date.now()-l;t(i.map(p=>(p.timeOffset-=f,p)),h),i=[],l=null}),s),u=D(Mt(D(h=>{let f=Ot(h),{clientX:p,clientY:m}=an(h)?h.changedTouches[0]:h;l||(l=fr()),i.push({x:p,y:m,id:n.getId(f),timeOffset:fr()-l}),a(typeof DragEvent<"u"&&h instanceof DragEvent?_.Drag:h instanceof MouseEvent?_.MouseMove:_.TouchMove)}),o,{trailing:!1})),c=[ue("mousemove",u,r),ue("touchmove",u,r),ue("drag",u,r)];return D(()=>{c.forEach(h=>h())})}function tc({mouseInteractionCb:t,doc:e,mirror:r,blockClass:n,blockSelector:o,sampling:s}){if(s.mouseInteraction===!1)return()=>{};let i=s.mouseInteraction===!0||s.mouseInteraction===void 0?{}:s.mouseInteraction,l=[],a=null,u=c=>h=>{let f=Ot(h);if(de(f,n,o,!0))return;let p=null,m=c;if("pointerType"in h){switch(h.pointerType){case"mouse":p=Ne.Mouse;break;case"touch":p=Ne.Touch;break;case"pen":p=Ne.Pen;break}p===Ne.Touch?ye[c]===ye.MouseDown?m="TouchStart":ye[c]===ye.MouseUp&&(m="TouchEnd"):Ne.Pen}else an(h)&&(p=Ne.Touch);p!==null?(a=p,(m.startsWith("Touch")&&p===Ne.Touch||m.startsWith("Mouse")&&p===Ne.Mouse)&&(p=null)):ye[c]===ye.Click&&(p=a,a=null);let d=an(h)?h.changedTouches[0]:h;if(!d)return;let y=r.getId(f),{clientX:g,clientY:S}=d;D(t)({type:ye[m],id:y,x:g,y:S,...p!==null&&{pointerType:p}})};return Object.keys(ye).filter(c=>Number.isNaN(Number(c))&&!c.endsWith("_Departed")&&i[c]!==!1).forEach(c=>{let h=Ke(c),f=u(c);if(window.PointerEvent)switch(ye[c]){case ye.MouseDown:case ye.MouseUp:h=h.replace("mouse","pointer");break;case ye.TouchStart:case ye.TouchEnd:return}l.push(ue(h,f,e))}),D(()=>{l.forEach(c=>c())})}function Is({scrollCb:t,doc:e,mirror:r,blockClass:n,blockSelector:o,sampling:s}){let i=D(Mt(D(l=>{let a=Ot(l);if(!a||de(a,n,o,!0))return;let u=r.getId(a);if(a===e&&e.defaultView){let c=ps(e.defaultView);t({id:u,x:c.left,y:c.top})}else t({id:u,x:a.scrollLeft,y:a.scrollTop})}),s.scroll||100));return ue("scroll",i,e)}function rc({viewportResizeCb:t},{win:e}){let r=-1,n=-1,o=D(Mt(D(()=>{let s=ms(),i=gs();(r!==s||n!==i)&&(t({width:Number(i),height:Number(s)}),r=s,n=i)}),200));return ue("resize",o,e)}var nc=["INPUT","TEXTAREA","SELECT"],Jo=new WeakMap;function oc({inputCb:t,doc:e,mirror:r,blockClass:n,blockSelector:o,ignoreClass:s,ignoreSelector:i,maskInputOptions:l,maskInputFn:a,sampling:u,userTriggeredOnInput:c}){function h(S){let v=Ot(S),A=S.isTrusted,I=v&&v.tagName;if(v&&I==="OPTION"&&(v=N.parentElement(v)),!v||!I||nc.indexOf(I)<0||de(v,n,o,!0)||v.classList.contains(s)||i&&v.matches(i))return;let b=v.value,T=!1,R=Sn(v)||"";R==="radio"||R==="checkbox"?T=v.checked:(l[I.toLowerCase()]||l[R])&&(b=ur({element:v,maskInputOptions:l,tagName:I,type:R,value:b,maskInputFn:a})),f(v,c?{text:b,isChecked:T,userTriggered:A}:{text:b,isChecked:T});let O=v.name;R==="radio"&&O&&T&&e.querySelectorAll(`input[type="radio"][name="${sc(O)}"]`).forEach(W=>{if(W!==v){let se=W.value;f(W,c?{text:se,isChecked:!T,userTriggered:!1}:{text:se,isChecked:!T})}})}function f(S,v){let A=Jo.get(S);if(!A||A.text!==v.text||A.isChecked!==v.isChecked){Jo.set(S,v);let I=r.getId(S);D(t)({...v,id:I})}}let m=(u.input==="last"?["change"]:["input","change"]).map(S=>ue(S,D(h),e)),d=e.defaultView;if(!d)return()=>{m.forEach(S=>S())};let y=d.Object.getOwnPropertyDescriptor(d.HTMLInputElement.prototype,"value"),g=[[d.HTMLInputElement.prototype,"value"],[d.HTMLInputElement.prototype,"checked"],[d.HTMLSelectElement.prototype,"value"],[d.HTMLTextAreaElement.prototype,"value"],[d.HTMLSelectElement.prototype,"selectedIndex"],[d.HTMLOptionElement.prototype,"selected"]];return y&&y.set&&m.push(...g.map(S=>yr(S[0],S[1],{set(){D(h)({target:this,isTrusted:!1})}},!1,d))),D(()=>{m.forEach(S=>S())})}function pr(t){let e=[];function r(n,o){if(sr("CSSGroupingRule")&&n.parentRule instanceof CSSGroupingRule||sr("CSSMediaRule")&&n.parentRule instanceof CSSMediaRule||sr("CSSSupportsRule")&&n.parentRule instanceof CSSSupportsRule||sr("CSSConditionRule")&&n.parentRule instanceof CSSConditionRule){let i=Array.from(n.parentRule.cssRules).indexOf(n);o.unshift(i)}else if(n.parentStyleSheet){let i=Array.from(n.parentStyleSheet.cssRules).indexOf(n);o.unshift(i)}return o}return r(t,e)}function sc(t){return t.replace(/["\\]/g,"\\$&")}function Be(t,e,r){let n,o;return t?(t.ownerNode?n=e.getId(t.ownerNode):o=r.getId(t),{styleId:o,id:n}):{}}function ic({styleSheetRuleCb:t,mirror:e,stylesheetManager:r},{win:n}){if(!n.CSSStyleSheet||!n.CSSStyleSheet.prototype)return()=>{};let o=n.CSSStyleSheet.prototype.insertRule;n.CSSStyleSheet.prototype.insertRule=new Proxy(o,{apply:D((c,h,f)=>{let[p,m]=f,{id:d,styleId:y}=Be(h,e,r.styleMirror);return(d&&d!==-1||y&&y!==-1)&&t({id:d,styleId:y,adds:[{rule:p,index:m}]}),c.apply(h,f)})}),n.CSSStyleSheet.prototype.addRule=function(c,h,f=this.cssRules.length){let p=`${c} { ${h} }`;return n.CSSStyleSheet.prototype.insertRule.apply(this,[p,f])};let s=n.CSSStyleSheet.prototype.deleteRule;n.CSSStyleSheet.prototype.deleteRule=new Proxy(s,{apply:D((c,h,f)=>{let[p]=f,{id:m,styleId:d}=Be(h,e,r.styleMirror);return(m&&m!==-1||d&&d!==-1)&&t({id:m,styleId:d,removes:[{index:p}]}),c.apply(h,f)})}),n.CSSStyleSheet.prototype.removeRule=function(c){return n.CSSStyleSheet.prototype.deleteRule.apply(this,[c])};let i;n.CSSStyleSheet.prototype.replace&&(i=n.CSSStyleSheet.prototype.replace,n.CSSStyleSheet.prototype.replace=new Proxy(i,{apply:D((c,h,f)=>{let[p]=f,{id:m,styleId:d}=Be(h,e,r.styleMirror);return(m&&m!==-1||d&&d!==-1)&&t({id:m,styleId:d,replace:p}),c.apply(h,f)})}));let l;n.CSSStyleSheet.prototype.replaceSync&&(l=n.CSSStyleSheet.prototype.replaceSync,n.CSSStyleSheet.prototype.replaceSync=new Proxy(l,{apply:D((c,h,f)=>{let[p]=f,{id:m,styleId:d}=Be(h,e,r.styleMirror);return(m&&m!==-1||d&&d!==-1)&&t({id:m,styleId:d,replaceSync:p}),c.apply(h,f)})}));let a={};ir("CSSGroupingRule")?a.CSSGroupingRule=n.CSSGroupingRule:(ir("CSSMediaRule")&&(a.CSSMediaRule=n.CSSMediaRule),ir("CSSConditionRule")&&(a.CSSConditionRule=n.CSSConditionRule),ir("CSSSupportsRule")&&(a.CSSSupportsRule=n.CSSSupportsRule));let u={};return Object.entries(a).forEach(([c,h])=>{u[c]={insertRule:h.prototype.insertRule,deleteRule:h.prototype.deleteRule},h.prototype.insertRule=new Proxy(u[c].insertRule,{apply:D((f,p,m)=>{let[d,y]=m,{id:g,styleId:S}=Be(p.parentStyleSheet,e,r.styleMirror);return(g&&g!==-1||S&&S!==-1)&&t({id:g,styleId:S,adds:[{rule:d,index:[...pr(p),y||0]}]}),f.apply(p,m)})}),h.prototype.deleteRule=new Proxy(u[c].deleteRule,{apply:D((f,p,m)=>{let[d]=m,{id:y,styleId:g}=Be(p.parentStyleSheet,e,r.styleMirror);return(y&&y!==-1||g&&g!==-1)&&t({id:y,styleId:g,removes:[{index:[...pr(p),d]}]}),f.apply(p,m)})})}),D(()=>{n.CSSStyleSheet.prototype.insertRule=o,n.CSSStyleSheet.prototype.deleteRule=s,i&&(n.CSSStyleSheet.prototype.replace=i),l&&(n.CSSStyleSheet.prototype.replaceSync=l),Object.entries(a).forEach(([c,h])=>{h.prototype.insertRule=u[c].insertRule,h.prototype.deleteRule=u[c].deleteRule})})}function Ts({mirror:t,stylesheetManager:e},r){var n,o,s;let i=null;r.nodeName==="#document"?i=t.getId(r):i=t.getId(N.host(r));let l=r.nodeName==="#document"?(n=r.defaultView)==null?void 0:n.Document:(s=(o=r.ownerDocument)==null?void 0:o.defaultView)==null?void 0:s.ShadowRoot,a=l?.prototype?Object.getOwnPropertyDescriptor(l?.prototype,"adoptedStyleSheets"):void 0;return i===null||i===-1||!l||!a?()=>{}:(Object.defineProperty(r,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get(){var u;return(u=a.get)==null?void 0:u.call(this)},set(u){var c;let h=(c=a.set)==null?void 0:c.call(this,u);if(i!==null&&i!==-1)try{e.adoptStyleSheets(u,i)}catch{}return h}}),D(()=>{Object.defineProperty(r,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get:a.get,set:a.set})}))}function ac({styleDeclarationCb:t,mirror:e,ignoreCSSAttributes:r,stylesheetManager:n},{win:o}){let s=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=new Proxy(s,{apply:D((l,a,u)=>{var c;let[h,f,p]=u;if(r.has(h))return s.apply(a,[h,f,p]);let{id:m,styleId:d}=Be((c=a.parentRule)==null?void 0:c.parentStyleSheet,e,n.styleMirror);return(m&&m!==-1||d&&d!==-1)&&t({id:m,styleId:d,set:{property:h,value:f,priority:p},index:pr(a.parentRule)}),l.apply(a,u)})});let i=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=new Proxy(i,{apply:D((l,a,u)=>{var c;let[h]=u;if(r.has(h))return i.apply(a,[h]);let{id:f,styleId:p}=Be((c=a.parentRule)==null?void 0:c.parentStyleSheet,e,n.styleMirror);return(f&&f!==-1||p&&p!==-1)&&t({id:f,styleId:p,remove:{property:h},index:pr(a.parentRule)}),l.apply(a,u)})}),D(()=>{o.CSSStyleDeclaration.prototype.setProperty=s,o.CSSStyleDeclaration.prototype.removeProperty=i})}function lc({mediaInteractionCb:t,blockClass:e,blockSelector:r,mirror:n,sampling:o,doc:s}){let i=D(a=>Mt(D(u=>{let c=Ot(u);if(!c||de(c,e,r,!0))return;let{currentTime:h,volume:f,muted:p,playbackRate:m,loop:d}=c;t({type:a,id:n.getId(c),currentTime:h,volume:f,muted:p,playbackRate:m,loop:d})}),o.media||500)),l=[ue("play",i(ct.Play),s),ue("pause",i(ct.Pause),s),ue("seeked",i(ct.Seeked),s),ue("volumechange",i(ct.VolumeChange),s),ue("ratechange",i(ct.RateChange),s)];return D(()=>{l.forEach(a=>a())})}function cc({fontCb:t,doc:e}){let r=e.defaultView;if(!r)return()=>{};let n=[],o=new WeakMap,s=r.FontFace;r.FontFace=function(a,u,c){let h=new s(a,u,c);return o.set(h,{family:a,buffer:typeof u!="string",descriptors:c,fontSource:typeof u=="string"?u:JSON.stringify(Array.from(new Uint8Array(u)))}),h};let i=pt(e.fonts,"add",function(l){return function(a){return setTimeout(D(()=>{let u=o.get(a);u&&(t(u),o.delete(a))}),0),l.apply(this,[a])}});return n.push(()=>{r.FontFace=s}),n.push(i),D(()=>{n.forEach(l=>l())})}function uc(t){let{doc:e,mirror:r,blockClass:n,blockSelector:o,selectionCb:s}=t,i=!0,l=D(()=>{let a=e.getSelection();if(!a||i&&a?.isCollapsed)return;i=a.isCollapsed||!1;let u=[],c=a.rangeCount||0;for(let h=0;h<c;h++){let f=a.getRangeAt(h),{startContainer:p,startOffset:m,endContainer:d,endOffset:y}=f;de(p,n,o,!0)||de(d,n,o,!0)||u.push({start:r.getId(p),startOffset:m,end:r.getId(d),endOffset:y})}s({ranges:u})});return l(),ue("selectionchange",l)}function dc({doc:t,customElementCb:e}){let r=t.defaultView;return!r||!r.customElements?()=>{}:pt(r.customElements,"define",function(o){return function(s,i,l){try{e({define:{name:s}})}catch{console.warn(`Custom element callback failed for ${s}`)}return o.apply(this,[s,i,l])}})}function hc(t,e){let{mutationCb:r,mousemoveCb:n,mouseInteractionCb:o,scrollCb:s,viewportResizeCb:i,inputCb:l,mediaInteractionCb:a,styleSheetRuleCb:u,styleDeclarationCb:c,canvasMutationCb:h,fontCb:f,selectionCb:p,customElementCb:m}=t;t.mutationCb=(...d)=>{e.mutation&&e.mutation(...d),r(...d)},t.mousemoveCb=(...d)=>{e.mousemove&&e.mousemove(...d),n(...d)},t.mouseInteractionCb=(...d)=>{e.mouseInteraction&&e.mouseInteraction(...d),o(...d)},t.scrollCb=(...d)=>{e.scroll&&e.scroll(...d),s(...d)},t.viewportResizeCb=(...d)=>{e.viewportResize&&e.viewportResize(...d),i(...d)},t.inputCb=(...d)=>{e.input&&e.input(...d),l(...d)},t.mediaInteractionCb=(...d)=>{e.mediaInteaction&&e.mediaInteaction(...d),a(...d)},t.styleSheetRuleCb=(...d)=>{e.styleSheetRule&&e.styleSheetRule(...d),u(...d)},t.styleDeclarationCb=(...d)=>{e.styleDeclaration&&e.styleDeclaration(...d),c(...d)},t.canvasMutationCb=(...d)=>{e.canvasMutation&&e.canvasMutation(...d),h(...d)},t.fontCb=(...d)=>{e.font&&e.font(...d),f(...d)},t.selectionCb=(...d)=>{e.selection&&e.selection(...d),p(...d)},t.customElementCb=(...d)=>{e.customElement&&e.customElement(...d),m(...d)}}function fc(t,e={}){let r=t.doc.defaultView;if(!r)return()=>{};hc(t,e);let n;t.recordDOM&&(n=Rs(t,t.doc));let o=ec(t),s=tc(t),i=Is(t),l=rc(t,{win:r}),a=oc(t),u=lc(t),c=()=>{},h=()=>{},f=()=>{},p=()=>{};t.recordDOM&&(c=ic(t,{win:r}),h=Ts(t,t.doc),f=ac(t,{win:r}),t.collectFonts&&(p=cc(t)));let m=uc(t),d=dc(t),y=[];for(let g of t.plugins)y.push(g.observer(g.callback,r,g.options));return D(()=>{Ze.forEach(g=>g.reset()),n?.disconnect(),o(),s(),i(),l(),a(),u(),c(),h(),f(),p(),m(),d(),y.forEach(g=>g())})}function sr(t){return typeof window[t]<"u"}function ir(t){return!!(typeof window[t]<"u"&&window[t].prototype&&"insertRule"in window[t].prototype&&"deleteRule"in window[t].prototype)}var mr=class{constructor(e){w(this,"iframeIdToRemoteIdMap",new WeakMap),w(this,"iframeRemoteIdToIdMap",new WeakMap),this.generateIdFn=e}getId(e,r,n,o){let s=n||this.getIdToRemoteIdMap(e),i=o||this.getRemoteIdToIdMap(e),l=s.get(r);return l||(l=this.generateIdFn(),s.set(r,l),i.set(l,r)),l}getIds(e,r){let n=this.getIdToRemoteIdMap(e),o=this.getRemoteIdToIdMap(e);return r.map(s=>this.getId(e,s,n,o))}getRemoteId(e,r,n){let o=n||this.getRemoteIdToIdMap(e);if(typeof r!="number")return r;let s=o.get(r);return s||-1}getRemoteIds(e,r){let n=this.getRemoteIdToIdMap(e);return r.map(o=>this.getRemoteId(e,o,n))}reset(e){if(!e){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let r=this.iframeIdToRemoteIdMap.get(e);return r||(r=new Map,this.iframeIdToRemoteIdMap.set(e,r)),r}getRemoteIdToIdMap(e){let r=this.iframeRemoteIdToIdMap.get(e);return r||(r=new Map,this.iframeRemoteIdToIdMap.set(e,r)),r}},fn=class{constructor(e){w(this,"iframes",new WeakMap),w(this,"crossOriginIframeMap",new WeakMap),w(this,"crossOriginIframeMirror",new mr(ls)),w(this,"crossOriginIframeStyleMirror"),w(this,"crossOriginIframeRootIdMap",new WeakMap),w(this,"mirror"),w(this,"mutationCb"),w(this,"wrappedEmit"),w(this,"loadListener"),w(this,"stylesheetManager"),w(this,"recordCrossOriginIframes"),this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new mr(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,r){var n,o;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:r}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),this.recordCrossOriginIframes&&((n=e.contentWindow)==null||n.addEventListener("message",this.handleMessage.bind(this))),(o=this.loadListener)==null||o.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){let r=e;if(r.data.type!=="rrweb"||r.origin!==r.data.origin||!e.source)return;let o=this.crossOriginIframeMap.get(e.source);if(!o)return;let s=this.transformCrossOriginEvent(o,r.data.event);s&&this.wrappedEmit(s,r.data.isCheckout)}transformCrossOriginEvent(e,r){var n;switch(r.type){case F.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(r.data.node,e);let o=r.data.node.id;return this.crossOriginIframeRootIdMap.set(e,o),this.patchRootIdOnNode(r.data.node,o),{timestamp:r.timestamp,type:F.IncrementalSnapshot,data:{source:_.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:r.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case F.Meta:case F.Load:case F.DomContentLoaded:return!1;case F.Plugin:return r;case F.Custom:return this.replaceIds(r.data.payload,e,["id","parentId","previousId","nextId"]),r;case F.IncrementalSnapshot:switch(r.data.source){case _.Mutation:return r.data.adds.forEach(o=>{this.replaceIds(o,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(o.node,e);let s=this.crossOriginIframeRootIdMap.get(e);s&&this.patchRootIdOnNode(o.node,s)}),r.data.removes.forEach(o=>{this.replaceIds(o,e,["parentId","id"])}),r.data.attributes.forEach(o=>{this.replaceIds(o,e,["id"])}),r.data.texts.forEach(o=>{this.replaceIds(o,e,["id"])}),r;case _.Drag:case _.TouchMove:case _.MouseMove:return r.data.positions.forEach(o=>{this.replaceIds(o,e,["id"])}),r;case _.ViewportResize:return!1;case _.MediaInteraction:case _.MouseInteraction:case _.Scroll:case _.CanvasMutation:case _.Input:return this.replaceIds(r.data,e,["id"]),r;case _.StyleSheetRule:case _.StyleDeclaration:return this.replaceIds(r.data,e,["id"]),this.replaceStyleIds(r.data,e,["styleId"]),r;case _.Font:return r;case _.Selection:return r.data.ranges.forEach(o=>{this.replaceIds(o,e,["start","end"])}),r;case _.AdoptedStyleSheet:return this.replaceIds(r.data,e,["id"]),this.replaceStyleIds(r.data,e,["styleIds"]),(n=r.data.styles)==null||n.forEach(o=>{this.replaceStyleIds(o,e,["styleId"])}),r}}return!1}replace(e,r,n,o){for(let s of o)!Array.isArray(r[s])&&typeof r[s]!="number"||(Array.isArray(r[s])?r[s]=e.getIds(n,r[s]):r[s]=e.getId(n,r[s]));return r}replaceIds(e,r,n){return this.replace(this.crossOriginIframeMirror,e,r,n)}replaceStyleIds(e,r,n){return this.replace(this.crossOriginIframeStyleMirror,e,r,n)}replaceIdOnNode(e,r){this.replaceIds(e,r,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach(n=>{this.replaceIdOnNode(n,r)})}patchRootIdOnNode(e,r){e.type!==ee.Document&&!e.rootId&&(e.rootId=r),"childNodes"in e&&e.childNodes.forEach(n=>{this.patchRootIdOnNode(n,r)})}},pn=class{constructor(e){w(this,"shadowDoms",new WeakSet),w(this,"mutationCb"),w(this,"scrollCb"),w(this,"bypassOptions"),w(this,"mirror"),w(this,"restoreHandlers",[]),this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,r){if(!At(e)||this.shadowDoms.has(e))return;this.shadowDoms.add(e);let n=Rs({...this.bypassOptions,doc:r,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this},e);this.restoreHandlers.push(()=>n.disconnect()),this.restoreHandlers.push(Is({...this.bypassOptions,scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),setTimeout(()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(N.host(e))),this.restoreHandlers.push(Ts({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))},0)}observeAttachShadow(e){!e.contentWindow||!e.contentDocument||this.patchAttachShadow(e.contentWindow.Element,e.contentDocument)}patchAttachShadow(e,r){let n=this;this.restoreHandlers.push(pt(e.prototype,"attachShadow",function(o){return function(s){let i=o.call(this,s),l=N.shadowRoot(this);return l&&ws(this)&&n.addShadowRoot(l,r),i}}))}reset(){this.restoreHandlers.forEach(e=>{try{e()}catch{}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}},ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(It=0;It<ht.length;It++)pc[ht.charCodeAt(It)]=It;var It,mc=function(t){var e=new Uint8Array(t),r,n=e.length,o="";for(r=0;r<n;r+=3)o+=ht[e[r]>>2],o+=ht[(e[r]&3)<<4|e[r+1]>>4],o+=ht[(e[r+1]&15)<<2|e[r+2]>>6],o+=ht[e[r+2]&63];return n%3===2?o=o.substring(0,o.length-1)+"=":n%3===1&&(o=o.substring(0,o.length-2)+"=="),o},Qo=new Map;function gc(t,e){let r=Qo.get(t);return r||(r=new Map,Qo.set(t,r)),r.has(e)||r.set(e,[]),r.get(e)}var As=(t,e,r)=>{if(!t||!(xs(t,e)||typeof t=="object"))return;let n=t.constructor.name,o=gc(r,n),s=o.indexOf(t);return s===-1&&(s=o.length,o.push(t)),s};function ar(t,e,r){if(t instanceof Array)return t.map(n=>ar(n,e,r));if(t===null)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray)return{rr_type:t.constructor.name,args:[Object.values(t)]};if(t instanceof ArrayBuffer){let n=t.constructor.name,o=mc(t);return{rr_type:n,base64:o}}else{if(t instanceof DataView)return{rr_type:t.constructor.name,args:[ar(t.buffer,e,r),t.byteOffset,t.byteLength]};if(t instanceof HTMLImageElement){let n=t.constructor.name,{src:o}=t;return{rr_type:n,src:o}}else if(t instanceof HTMLCanvasElement){let n="HTMLImageElement",o=t.toDataURL();return{rr_type:n,src:o}}else{if(t instanceof ImageData)return{rr_type:t.constructor.name,args:[ar(t.data,e,r),t.width,t.height]};if(xs(t,e)||typeof t=="object"){let n=t.constructor.name,o=As(t,e,r);return{rr_type:n,index:o}}}}return t}var ks=(t,e,r)=>t.map(n=>ar(n,e,r)),xs=(t,e)=>!!["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(o=>typeof e[o]=="function").find(o=>t instanceof e[o]);function yc(t,e,r,n){let o=[],s=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(let i of s)try{if(typeof e.CanvasRenderingContext2D.prototype[i]!="function")continue;let l=pt(e.CanvasRenderingContext2D.prototype,i,function(a){return function(...u){return de(this.canvas,r,n,!0)||setTimeout(()=>{let c=ks(u,e,this);t(this.canvas,{type:ft["2D"],property:i,args:c})},0),a.apply(this,u)}});o.push(l)}catch{let l=yr(e.CanvasRenderingContext2D.prototype,i,{set(a){t(this.canvas,{type:ft["2D"],property:i,args:[a],setter:!0})}});o.push(l)}return()=>{o.forEach(i=>i())}}function vc(t){return t==="experimental-webgl"?"webgl":t}function es(t,e,r,n){let o=[];try{let s=pt(t.HTMLCanvasElement.prototype,"getContext",function(i){return function(l,...a){if(!de(this,e,r,!0)){let u=vc(l);if("__context"in this||(this.__context=u),n&&["webgl","webgl2"].includes(u))if(a[0]&&typeof a[0]=="object"){let c=a[0];c.preserveDrawingBuffer||(c.preserveDrawingBuffer=!0)}else a.splice(0,1,{preserveDrawingBuffer:!0})}return i.apply(this,[l,...a])}});o.push(s)}catch{console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{o.forEach(s=>s())}}function ts(t,e,r,n,o,s){let i=[],l=Object.getOwnPropertyNames(t);for(let a of l)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(a))try{if(typeof t[a]!="function")continue;let u=pt(t,a,function(c){return function(...h){let f=c.apply(this,h);if(As(f,s,this),"tagName"in this.canvas&&!de(this.canvas,n,o,!0)){let p=ks(h,s,this),m={type:e,property:a,args:p};r(this.canvas,m)}return f}});i.push(u)}catch{let u=yr(t,a,{set(c){r(this.canvas,{type:e,property:a,args:[c],setter:!0})}});i.push(u)}return i}function Sc(t,e,r,n){let o=[];return o.push(...ts(e.WebGLRenderingContext.prototype,ft.WebGL,t,r,n,e)),typeof e.WebGL2RenderingContext<"u"&&o.push(...ts(e.WebGL2RenderingContext.prototype,ft.WebGL2,t,r,n,e)),()=>{o.forEach(s=>s())}}var Ms="KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgY2hhcnMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyI7CiAgdmFyIGxvb2t1cCA9IHR5cGVvZiBVaW50OEFycmF5ID09PSAidW5kZWZpbmVkIiA/IFtdIDogbmV3IFVpbnQ4QXJyYXkoMjU2KTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJzLmxlbmd0aDsgaSsrKSB7CiAgICBsb29rdXBbY2hhcnMuY2hhckNvZGVBdChpKV0gPSBpOwogIH0KICB2YXIgZW5jb2RlID0gZnVuY3Rpb24oYXJyYXlidWZmZXIpIHsKICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGFycmF5YnVmZmVyKSwgaTIsIGxlbiA9IGJ5dGVzLmxlbmd0aCwgYmFzZTY0ID0gIiI7CiAgICBmb3IgKGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDMpIHsKICAgICAgYmFzZTY0ICs9IGNoYXJzW2J5dGVzW2kyXSA+PiAyXTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMl0gJiAzKSA8PCA0IHwgYnl0ZXNbaTIgKyAxXSA+PiA0XTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMiArIDFdICYgMTUpIDw8IDIgfCBieXRlc1tpMiArIDJdID4+IDZdOwogICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaTIgKyAyXSAmIDYzXTsKICAgIH0KICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgIj0iOwogICAgfSBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgIj09IjsKICAgIH0KICAgIHJldHVybiBiYXNlNjQ7CiAgfTsKICBjb25zdCBsYXN0QmxvYk1hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICBhc3luYyBmdW5jdGlvbiBnZXRUcmFuc3BhcmVudEJsb2JGb3Iod2lkdGgsIGhlaWdodCwgZGF0YVVSTE9wdGlvbnMpIHsKICAgIGNvbnN0IGlkID0gYCR7d2lkdGh9LSR7aGVpZ2h0fWA7CiAgICBpZiAoIk9mZnNjcmVlbkNhbnZhcyIgaW4gZ2xvYmFsVGhpcykgewogICAgICBpZiAodHJhbnNwYXJlbnRCbG9iTWFwLmhhcyhpZCkpIHJldHVybiB0cmFuc3BhcmVudEJsb2JNYXAuZ2V0KGlkKTsKICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgICAgb2Zmc2NyZWVuLmdldENvbnRleHQoIjJkIik7CiAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBvZmZzY3JlZW4uY29udmVydFRvQmxvYihkYXRhVVJMT3B0aW9ucyk7CiAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpOwogICAgICBjb25zdCBiYXNlNjQgPSBlbmNvZGUoYXJyYXlCdWZmZXIpOwogICAgICB0cmFuc3BhcmVudEJsb2JNYXAuc2V0KGlkLCBiYXNlNjQpOwogICAgICByZXR1cm4gYmFzZTY0OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICIiOwogICAgfQogIH0KICBjb25zdCB3b3JrZXIgPSBzZWxmOwogIHdvcmtlci5vbm1lc3NhZ2UgPSBhc3luYyBmdW5jdGlvbihlKSB7CiAgICBpZiAoIk9mZnNjcmVlbkNhbnZhcyIgaW4gZ2xvYmFsVGhpcykgewogICAgICBjb25zdCB7IGlkLCBiaXRtYXAsIHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zIH0gPSBlLmRhdGE7CiAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICBkYXRhVVJMT3B0aW9ucwogICAgICApOwogICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBvZmZzY3JlZW4uZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDApOwogICAgICBiaXRtYXAuY2xvc2UoKTsKICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IG9mZnNjcmVlbi5jb252ZXJ0VG9CbG9iKGRhdGFVUkxPcHRpb25zKTsKICAgICAgY29uc3QgdHlwZSA9IGJsb2IudHlwZTsKICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7CiAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7CiAgICAgIGlmICghbGFzdEJsb2JNYXAuaGFzKGlkKSAmJiBhd2FpdCB0cmFuc3BhcmVudEJhc2U2NCA9PT0gYmFzZTY0KSB7CiAgICAgICAgbGFzdEJsb2JNYXAuc2V0KGlkLCBiYXNlNjQpOwogICAgICAgIHJldHVybiB3b3JrZXIucG9zdE1lc3NhZ2UoeyBpZCB9KTsKICAgICAgfQogICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KSByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7CiAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgaWQsCiAgICAgICAgdHlwZSwKICAgICAgICBiYXNlNjQsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0pOwogICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsKICAgIH0KICB9Owp9KSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD1pbWFnZS1iaXRtYXAtZGF0YS11cmwtd29ya2VyLUlKcEM3Z19iLmpzLm1hcAo=",bc=t=>Uint8Array.from(atob(t),e=>e.charCodeAt(0)),rs=typeof window<"u"&&window.Blob&&new Blob([bc(Ms)],{type:"text/javascript;charset=utf-8"});function Cc(t){let e;try{if(e=rs&&(window.URL||window.webkitURL).createObjectURL(rs),!e)throw"";let r=new Worker(e,{name:t?.name});return r.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),r}catch{return new Worker("data:text/javascript;base64,"+Ms,{name:t?.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var mn=class{constructor(e){w(this,"pendingCanvasMutations",new Map),w(this,"rafStamps",{latestId:0,invokeId:null}),w(this,"mirror"),w(this,"mutationCb"),w(this,"resetObservers"),w(this,"frozen",!1),w(this,"locked",!1),w(this,"processMutation",(a,u)=>{(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(a)||this.pendingCanvasMutations.set(a,[]),this.pendingCanvasMutations.get(a).push(u)});let{sampling:r="all",win:n,blockClass:o,blockSelector:s,recordCanvas:i,dataURLOptions:l}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,i&&r==="all"&&this.initCanvasMutationObserver(n,o,s),i&&typeof r=="number"&&this.initCanvasFPSObserver(r,n,o,s,{dataURLOptions:l})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(e,r,n,o,s){let i=es(r,n,o,!0),l=new Map,a=new Cc;a.onmessage=m=>{let{id:d}=m.data;if(l.set(d,!1),!("base64"in m.data))return;let{base64:y,type:g,width:S,height:v}=m.data;this.mutationCb({id:d,type:ft["2D"],commands:[{property:"clearRect",args:[0,0,S,v]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:y}],type:g}]},0,0]}]})};let u=1e3/e,c=0,h,f=()=>{let m=[];return r.document.querySelectorAll("canvas").forEach(d=>{de(d,n,o,!0)||m.push(d)}),m},p=m=>{if(c&&m-c<u){h=requestAnimationFrame(p);return}c=m,f().forEach(async d=>{var y;let g=this.mirror.getId(d);if(l.get(g)||d.width===0||d.height===0)return;if(l.set(g,!0),["webgl","webgl2"].includes(d.__context)){let v=d.getContext(d.__context);((y=v?.getContextAttributes())==null?void 0:y.preserveDrawingBuffer)===!1&&v.clear(v.COLOR_BUFFER_BIT)}let S=await createImageBitmap(d);a.postMessage({id:g,bitmap:S,width:d.width,height:d.height,dataURLOptions:s.dataURLOptions},[S])}),h=requestAnimationFrame(p)};h=requestAnimationFrame(p),this.resetObservers=()=>{i(),cancelAnimationFrame(h)}}initCanvasMutationObserver(e,r,n){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();let o=es(e,r,n,!1),s=yc(this.processMutation.bind(this),e,r,n),i=Sc(this.processMutation.bind(this),e,r,n);this.resetObservers=()=>{o(),s(),i()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){let e=r=>{this.rafStamps.latestId=r,requestAnimationFrame(e)};requestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((e,r)=>{let n=this.mirror.getId(r);this.flushPendingCanvasMutationFor(r,n)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(e,r){if(this.frozen||this.locked)return;let n=this.pendingCanvasMutations.get(e);if(!n||r===-1)return;let o=n.map(i=>{let{type:l,...a}=i;return a}),{type:s}=n[0];this.mutationCb({id:r,type:s,commands:o}),this.pendingCanvasMutations.delete(e)}},gn=class{constructor(e){w(this,"trackedLinkElements",new WeakSet),w(this,"mutationCb"),w(this,"adoptedStyleSheetCb"),w(this,"styleMirror",new cn),this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,r){"_cssText"in r.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:r.id,attributes:r.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,r){if(e.length===0)return;let n={id:r,styleIds:[]},o=[];for(let s of e){let i;this.styleMirror.has(s)?i=this.styleMirror.getId(s):(i=this.styleMirror.add(s),o.push({styleId:i,rules:Array.from(s.rules||CSSRule,(l,a)=>({rule:is(l,s.href),index:a}))})),n.styleIds.push(i)}o.length>0&&(n.styles=o),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}},yn=class{constructor(){w(this,"nodeMap",new WeakMap),w(this,"active",!1)}inOtherBuffer(e,r){let n=this.nodeMap.get(e);return n&&Array.from(n).some(o=>o!==r)}add(e,r){this.active||(this.active=!0,requestAnimationFrame(()=>{this.nodeMap=new WeakMap,this.active=!1})),this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(r))}destroy(){}},K,lr,nn,gr=!1;try{if(Array.from([1],t=>t*2)[0]!==2){let t=document.createElement("iframe");document.body.appendChild(t),Array.from=((Fo=t.contentWindow)==null?void 0:Fo.Array.from)||Array.from,document.body.removeChild(t)}}catch(t){console.debug("Unable to override Array.from",t)}var Ee=dl();function Ae(t={}){let{emit:e,checkoutEveryNms:r,checkoutEveryNth:n,blockClass:o="rr-block",blockSelector:s=null,ignoreClass:i="rr-ignore",ignoreSelector:l=null,maskTextClass:a="rr-mask",maskTextSelector:u=null,inlineStylesheet:c=!0,maskAllInputs:h,maskInputOptions:f,slimDOMOptions:p,maskInputFn:m,maskTextFn:d,maskAnchorHrefFn:y,blockImgSrcPattern:g=null,blockImgSrcFillOptions:S={backgroundColor:"#F6F7F9",strokeColor:"#E9EBEF",strokeWidth:"1px"},hooks:v,packFn:A,sampling:I={},dataURLOptions:b={},mousemoveWait:T,recordDOM:R=!0,recordCanvas:O=!1,recordCrossOriginIframes:W=!1,recordAfter:se=t.recordAfter==="DOMContentLoaded"?t.recordAfter:"load",userTriggeredOnInput:z=!1,collectFonts:ie=!1,inlineImages:j=!1,plugins:H,keepIframeSrcFn:k=()=>!1,ignoreCSSAttributes:M=new Set([]),errorHandler:X}=t;Jl(X);let x=W?window.parent===window:!0,P=!1;if(!x)try{window.parent.document&&(P=!1)}catch{P=!0}if(x&&!e)throw new Error("emit function is required");if(!x&&!P)return()=>{};T!==void 0&&I.mousemove===void 0&&(I.mousemove=T),Ee.reset();let V=h===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:f!==void 0?f:{password:!0},J=p===!0||p==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:p==="all",headMetaDescKeywords:p==="all",headTitleMutations:p==="all"}:p||{};Yl();let ce,me=0,ae=L=>{for(let we of H||[])we.eventProcessor&&(L=we.eventProcessor(L));return A&&!P&&(L=A(L)),L};K=(L,we)=>{var Y;let Z=L;if(Z.timestamp=fr(),(Y=Ze[0])!=null&&Y.isFrozen()&&Z.type!==F.FullSnapshot&&!(Z.type===F.IncrementalSnapshot&&Z.data.source===_.Mutation)&&Ze.forEach(Te=>Te.unfreeze()),x)e?.(ae(Z),we);else if(P){let Te={type:"rrweb",event:ae(Z),origin:window.location.origin,isCheckout:we};window.parent.postMessage(Te,"*")}if(Z.type===F.FullSnapshot)ce=Z,me=0;else if(Z.type===F.IncrementalSnapshot){if(Z.data.source===_.Mutation&&Z.data.isAttachIframe)return;me++;let Te=n&&me>=n,G=r&&Z.timestamp-ce.timestamp>r;(Te||G)&&lr(!0)}};let nt=L=>{K({type:F.IncrementalSnapshot,data:{source:_.Mutation,...L}})},St=L=>K({type:F.IncrementalSnapshot,data:{source:_.Scroll,...L}}),ot=L=>K({type:F.IncrementalSnapshot,data:{source:_.CanvasMutation,...L}}),Mr=L=>K({type:F.IncrementalSnapshot,data:{source:_.AdoptedStyleSheet,...L}}),Re=new gn({mutationCb:nt,adoptedStyleSheetCb:Mr}),Ie=new fn({mirror:Ee,mutationCb:nt,stylesheetManager:Re,recordCrossOriginIframes:W,wrappedEmit:K});for(let L of H||[])L.getMirror&&L.getMirror({nodeMirror:Ee,crossOriginIframeMirror:Ie.crossOriginIframeMirror,crossOriginIframeStyleMirror:Ie.crossOriginIframeStyleMirror});let st=new yn;nn=new mn({recordCanvas:O,mutationCb:ot,win:window,blockClass:o,blockSelector:s,mirror:Ee,sampling:I.canvas,dataURLOptions:b});let jt=new pn({mutationCb:nt,scrollCb:St,bypassOptions:{blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:u,inlineStylesheet:c,maskInputOptions:V,dataURLOptions:b,maskTextFn:d,maskInputFn:m,maskAnchorHrefFn:y,blockImgSrcPattern:g,blockImgSrcFillOptions:S,recordCanvas:O,inlineImages:j,sampling:I,slimDOMOptions:J,iframeManager:Ie,stylesheetManager:Re,canvasManager:nn,keepIframeSrcFn:k,processedNodeManager:st},mirror:Ee});lr=(L=!1)=>{if(!R)return;K({type:F.Meta,data:{href:window.location.href,width:gs(),height:ms()}},L),Re.reset(),jt.init(),Ze.forEach(Y=>Y.lock());let we=Dl(document,{mirror:Ee,blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:u,inlineStylesheet:c,maskAllInputs:V,maskTextFn:d,maskInputFn:m,maskAnchorHrefFn:y,blockImgSrcPattern:g,blockImgSrcFillOptions:S,slimDOM:J,dataURLOptions:b,recordCanvas:O,inlineImages:j,onSerialize:Y=>{Ss(Y,Ee)&&Ie.addIframe(Y),bs(Y,Ee)&&Re.trackLinkElement(Y),ln(Y)&&jt.addShadowRoot(N.shadowRoot(Y),document)},onIframeLoad:(Y,Z)=>{Ie.attachIframe(Y,Z),jt.observeAttachShadow(Y)},onStylesheetLoad:(Y,Z)=>{Re.attachLinkElement(Y,Z)},keepIframeSrcFn:k});if(!we)return console.warn("Failed to snapshot the document");K({type:F.FullSnapshot,data:{node:we,initialOffset:ps(window)}},L),Ze.forEach(Y=>Y.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&Re.adoptStyleSheets(document.adoptedStyleSheets,Ee.getId(document))};try{let L=[],we=Z=>{var Te;return D(fc)({mutationCb:nt,mousemoveCb:(G,Or)=>K({type:F.IncrementalSnapshot,data:{source:Or,positions:G}}),mouseInteractionCb:G=>K({type:F.IncrementalSnapshot,data:{source:_.MouseInteraction,...G}}),scrollCb:St,viewportResizeCb:G=>K({type:F.IncrementalSnapshot,data:{source:_.ViewportResize,...G}}),inputCb:G=>K({type:F.IncrementalSnapshot,data:{source:_.Input,...G}}),mediaInteractionCb:G=>K({type:F.IncrementalSnapshot,data:{source:_.MediaInteraction,...G}}),styleSheetRuleCb:G=>K({type:F.IncrementalSnapshot,data:{source:_.StyleSheetRule,...G}}),styleDeclarationCb:G=>K({type:F.IncrementalSnapshot,data:{source:_.StyleDeclaration,...G}}),canvasMutationCb:ot,fontCb:G=>K({type:F.IncrementalSnapshot,data:{source:_.Font,...G}}),selectionCb:G=>{K({type:F.IncrementalSnapshot,data:{source:_.Selection,...G}})},customElementCb:G=>{K({type:F.IncrementalSnapshot,data:{source:_.CustomElement,...G}})},blockClass:o,ignoreClass:i,ignoreSelector:l,maskTextClass:a,maskTextSelector:u,maskInputOptions:V,inlineStylesheet:c,sampling:I,recordDOM:R,recordCanvas:O,inlineImages:j,userTriggeredOnInput:z,collectFonts:ie,doc:Z,maskInputFn:m,maskTextFn:d,maskAnchorHrefFn:y,blockImgSrcPattern:g,blockImgSrcFillOptions:S,keepIframeSrcFn:k,blockSelector:s,slimDOMOptions:J,dataURLOptions:b,mirror:Ee,iframeManager:Ie,stylesheetManager:Re,shadowDomManager:jt,processedNodeManager:st,canvasManager:nn,ignoreCSSAttributes:M,plugins:((Te=H?.filter(G=>G.observer))==null?void 0:Te.map(G=>({observer:G.observer,options:G.options,callback:Or=>K({type:F.Plugin,data:{plugin:G.name,payload:Or}})})))||[]},v)};Ie.addLoadListener(Z=>{try{L.push(we(Z.contentDocument))}catch(Te){console.warn(Te)}});let Y=()=>{lr(),L.push(we(document)),gr=!0};return document.readyState==="interactive"||document.readyState==="complete"?Y():(L.push(ue("DOMContentLoaded",()=>{K({type:F.DomContentLoaded,data:{}}),se==="DOMContentLoaded"&&Y()})),L.push(ue("load",()=>{K({type:F.Load,data:{}}),se==="load"&&Y()},window))),()=>{L.forEach(Z=>Z()),st.destroy(),gr=!1,Ql()}}catch(L){console.warn(L)}}Ae.addCustomEvent=(t,e)=>{if(!gr)throw new Error("please add custom event after start recording");K({type:F.Custom,data:{tag:t,payload:e}})};Ae.freezePage=()=>{Ze.forEach(t=>t.freeze())};Ae.takeFullSnapshot=t=>{if(!gr)throw new Error("please take full snapshot after start recording");lr(t)};Ae.mirror=Ee;var ns;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(ns||(ns={}));var he=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(he||{}),Xe=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t))(Xe||{}),wn=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(wn||{});function vr(t,e){if(!e)return;let r=new URL(t),n={};for(let[o,s]of r.searchParams)e.includes(o)&&(n[o]=s);return Object.keys(n).length>0?n:void 0}var wc="Adora.URLChange",Os="Adora.Cohort",Ec="Adora.AddCohort",Rc="Adora.Click";var En=["onclick","ondblclick","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onchange","onfocus","onblur","onscroll","onselect","onsubmit","onkeydown","onkeypress","onkeyup","onload","onunload"];function Ns({dom0EventHandlers:t,delay:e,timestamp:r}){return{type:he.Custom,data:{tag:Rc,payload:{dom0EventHandlers:t}},delay:e,timestamp:r}}function Nt({payload:t,delay:e,timestamp:r}){return{type:he.Custom,data:{tag:Ec,payload:t},delay:e,timestamp:r}}function _s({href:t,delay:e,timestamp:r}){return{type:he.Custom,data:{tag:wc,payload:{href:t}},delay:e,timestamp:r}}var ri=Fi($s(),1);var Lt=t=>{if(typeof t!="string")throw new TypeError("invalid pattern");if(t.length>65536)throw new TypeError("pattern is too long")};var Nc={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Dt=t=>t.replace(/[[\]\\-]/g,"\\$&"),_c=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),qs=t=>t.join(""),Ys=(t,e)=>{let r=e;if(t.charAt(r)!=="[")throw new Error("not in a brace expression");let n=[],o=[],s=r+1,i=!1,l=!1,a=!1,u=!1,c=r,h="";e:for(;s<t.length;){let d=t.charAt(s);if((d==="!"||d==="^")&&s===r+1){u=!0,s++;continue}if(d==="]"&&i&&!a){c=s+1;break}if(i=!0,d==="\\"&&!a){a=!0,s++;continue}if(d==="["&&!a){for(let[y,[g,S,v]]of Object.entries(Nc))if(t.startsWith(y,s)){if(h)return["$.",!1,t.length-r,!0];s+=y.length,v?o.push(g):n.push(g),l=l||S;continue e}}if(a=!1,h){d>h?n.push(Dt(h)+"-"+Dt(d)):d===h&&n.push(Dt(d)),h="",s++;continue}if(t.startsWith("-]",s+1)){n.push(Dt(d+"-")),s+=2;continue}if(t.startsWith("-",s+1)){h=d,s+=2;continue}n.push(Dt(d)),s++}if(c<s)return["",!1,0,!1];if(!n.length&&!o.length)return["$.",!1,t.length-r,!0];if(o.length===0&&n.length===1&&/^\\?.$/.test(n[0])&&!u){let d=n[0].length===2?n[0].slice(-1):n[0];return[_c(d),!1,c-r,!1]}let f="["+(u?"^":"")+qs(n)+"]",p="["+(u?"":"^")+qs(o)+"]";return[n.length&&o.length?"("+f+"|"+p+")":n.length?f:p,l,c-r,!0]};var je=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var Lc=new Set(["!","?","+","*","@"]),Zs=t=>Lc.has(t),Dc="(?!(?:^|/)\\.\\.?(?:$|/))",Sr="(?!\\.)",Pc=new Set(["[","."]),Uc=new Set(["..","."]),Fc=new Set("().*{}+?[]^$\\!"),Wc=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),An="[^/]",Ks=An+"*?",Xs=An+"+?",re,oe,_e,q,te,Ve,Je,$e,ke,Qe,Pt,et,Js,qe,br,Tn,Qs,fe=class fe{constructor(e,r,n={}){ge(this,et);U(this,"type");ge(this,re);ge(this,oe);ge(this,_e,!1);ge(this,q,[]);ge(this,te);ge(this,Ve);ge(this,Je);ge(this,$e,!1);ge(this,ke);ge(this,Qe);ge(this,Pt,!1);this.type=e,e&&Q(this,oe,!0),Q(this,te,r),Q(this,re,C(this,te)?C(C(this,te),re):this),Q(this,ke,C(this,re)===this?n:C(C(this,re),ke)),Q(this,Je,C(this,re)===this?[]:C(C(this,re),Je)),e==="!"&&!C(C(this,re),$e)&&C(this,Je).push(this),Q(this,Ve,C(this,te)?C(C(this,te),q).length:0)}get hasMagic(){if(C(this,oe)!==void 0)return C(this,oe);for(let e of C(this,q))if(typeof e!="string"&&(e.type||e.hasMagic))return Q(this,oe,!0);return C(this,oe)}toString(){return C(this,Qe)!==void 0?C(this,Qe):this.type?Q(this,Qe,this.type+"("+C(this,q).map(e=>String(e)).join("|")+")"):Q(this,Qe,C(this,q).map(e=>String(e)).join(""))}push(...e){for(let r of e)if(r!==""){if(typeof r!="string"&&!(r instanceof fe&&C(r,te)===this))throw new Error("invalid part: "+r);C(this,q).push(r)}}toJSON(){let e=this.type===null?C(this,q).slice().map(r=>typeof r=="string"?r:r.toJSON()):[this.type,...C(this,q).map(r=>r.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===C(this,re)||C(C(this,re),$e)&&C(this,te)?.type==="!")&&e.push({}),e}isStart(){if(C(this,re)===this)return!0;if(!C(this,te)?.isStart())return!1;if(C(this,Ve)===0)return!0;let e=C(this,te);for(let r=0;r<C(this,Ve);r++){let n=C(e,q)[r];if(!(n instanceof fe&&n.type==="!"))return!1}return!0}isEnd(){if(C(this,re)===this||C(this,te)?.type==="!")return!0;if(!C(this,te)?.isEnd())return!1;if(!this.type)return C(this,te)?.isEnd();let e=C(this,te)?C(C(this,te),q).length:0;return C(this,Ve)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){let r=new fe(this.type,e);for(let n of C(this,q))r.copyIn(n);return r}static fromGlob(e,r={}){var o;let n=new fe(null,void 0,r);return Pe(o=fe,qe,br).call(o,e,n,0,r),n}toMMPattern(){if(this!==C(this,re))return C(this,re).toMMPattern();let e=this.toString(),[r,n,o,s]=this.toRegExpSource();if(!(o||C(this,oe)||C(this,ke).nocase&&!C(this,ke).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return n;let l=(C(this,ke).nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${r}$`,l),{_src:r,_glob:e})}get options(){return C(this,ke)}toRegExpSource(e){let r=e??!!C(this,ke).dot;if(C(this,re)===this&&Pe(this,et,Js).call(this),!this.type){let a=this.isStart()&&this.isEnd(),u=C(this,q).map(p=>{var S;let[m,d,y,g]=typeof p=="string"?Pe(S=fe,qe,Qs).call(S,p,C(this,oe),a):p.toRegExpSource(e);return Q(this,oe,C(this,oe)||y),Q(this,_e,C(this,_e)||g),m}).join(""),c="";if(this.isStart()&&typeof C(this,q)[0]=="string"&&!(C(this,q).length===1&&Uc.has(C(this,q)[0]))){let m=Pc,d=r&&m.has(u.charAt(0))||u.startsWith("\\.")&&m.has(u.charAt(2))||u.startsWith("\\.\\.")&&m.has(u.charAt(4)),y=!r&&!e&&m.has(u.charAt(0));c=d?Dc:y?Sr:""}let h="";return this.isEnd()&&C(C(this,re),$e)&&C(this,te)?.type==="!"&&(h="(?:$|\\/)"),[c+u+h,je(u),Q(this,oe,!!C(this,oe)),C(this,_e)]}let n=this.type==="*"||this.type==="+",o=this.type==="!"?"(?:(?!(?:":"(?:",s=Pe(this,et,Tn).call(this,r);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){let a=this.toString();return Q(this,q,[a]),this.type=null,Q(this,oe,void 0),[a,je(this.toString()),!1,!1]}let i=!n||e||r||!Sr?"":Pe(this,et,Tn).call(this,!0);i===s&&(i=""),i&&(s=`(?:${s})(?:${i})*?`);let l="";if(this.type==="!"&&C(this,Pt))l=(this.isStart()&&!r?Sr:"")+Xs;else{let a=this.type==="!"?"))"+(this.isStart()&&!r&&!e?Sr:"")+Ks+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`;l=o+s+a}return[l,je(s),Q(this,oe,!!C(this,oe)),C(this,_e)]}};re=new WeakMap,oe=new WeakMap,_e=new WeakMap,q=new WeakMap,te=new WeakMap,Ve=new WeakMap,Je=new WeakMap,$e=new WeakMap,ke=new WeakMap,Qe=new WeakMap,Pt=new WeakMap,et=new WeakSet,Js=function(){if(this!==C(this,re))throw new Error("should only call on root");if(C(this,$e))return this;this.toString(),Q(this,$e,!0);let e;for(;e=C(this,Je).pop();){if(e.type!=="!")continue;let r=e,n=C(r,te);for(;n;){for(let o=C(r,Ve)+1;!n.type&&o<C(n,q).length;o++)for(let s of C(e,q)){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(C(n,q)[o])}r=n,n=C(r,te)}}return this},qe=new WeakSet,br=function(e,r,n,o){var p,m;let s=!1,i=!1,l=-1,a=!1;if(r.type===null){let d=n,y="";for(;d<e.length;){let g=e.charAt(d++);if(s||g==="\\"){s=!s,y+=g;continue}if(i){d===l+1?(g==="^"||g==="!")&&(a=!0):g==="]"&&!(d===l+2&&a)&&(i=!1),y+=g;continue}else if(g==="["){i=!0,l=d,a=!1,y+=g;continue}if(!o.noext&&Zs(g)&&e.charAt(d)==="("){r.push(y),y="";let S=new fe(g,r);d=Pe(p=fe,qe,br).call(p,e,S,d,o),r.push(S);continue}y+=g}return r.push(y),d}let u=n+1,c=new fe(null,r),h=[],f="";for(;u<e.length;){let d=e.charAt(u++);if(s||d==="\\"){s=!s,f+=d;continue}if(i){u===l+1?(d==="^"||d==="!")&&(a=!0):d==="]"&&!(u===l+2&&a)&&(i=!1),f+=d;continue}else if(d==="["){i=!0,l=u,a=!1,f+=d;continue}if(Zs(d)&&e.charAt(u)==="("){c.push(f),f="";let y=new fe(d,c);c.push(y),u=Pe(m=fe,qe,br).call(m,e,y,u,o);continue}if(d==="|"){c.push(f),f="",h.push(c),c=new fe(null,r);continue}if(d===")")return f===""&&C(r,q).length===0&&Q(r,Pt,!0),c.push(f),f="",r.push(...h,c),u;f+=d}return r.type=null,Q(r,oe,void 0),Q(r,q,[e.substring(n-1)]),u},Tn=function(e){return C(this,q).map(r=>{if(typeof r=="string")throw new Error("string type in extglob ast??");let[n,o,s,i]=r.toRegExpSource(e);return Q(this,_e,C(this,_e)||i),n}).filter(r=>!(this.isStart()&&this.isEnd())||!!r).join("|")},Qs=function(e,r,n=!1){let o=!1,s="",i=!1;for(let l=0;l<e.length;l++){let a=e.charAt(l);if(o){o=!1,s+=(Fc.has(a)?"\\":"")+a;continue}if(a==="\\"){l===e.length-1?s+="\\\\":o=!0;continue}if(a==="["){let[u,c,h,f]=Ys(e,l);if(h){s+=u,i=i||c,l+=h-1,r=r||f;continue}}if(a==="*"){n&&e==="*"?s+=Xs:s+=Ks,r=!0;continue}if(a==="?"){s+=An,r=!0;continue}s+=Wc(a)}return[s,je(e),!!r,i]},ge(fe,qe);var mt=fe;var kn=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&");var ne=(t,e,r={})=>(Lt(e),!r.nocomment&&e.charAt(0)==="#"?!1:new gt(e,r).match(t)),zc=/^\*+([^+@!?\*\[\(]*)$/,Bc=t=>e=>!e.startsWith(".")&&e.endsWith(t),Hc=t=>e=>e.endsWith(t),Gc=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),jc=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),Vc=/^\*+\.\*+$/,$c=t=>!t.startsWith(".")&&t.includes("."),qc=t=>t!=="."&&t!==".."&&t.includes("."),Yc=/^\.\*+$/,Zc=t=>t!=="."&&t!==".."&&t.startsWith("."),Kc=/^\*+$/,Xc=t=>t.length!==0&&!t.startsWith("."),Jc=t=>t.length!==0&&t!=="."&&t!=="..",Qc=/^\?+([^+@!?\*\[\(]*)?$/,eu=([t,e=""])=>{let r=ni([t]);return e?(e=e.toLowerCase(),n=>r(n)&&n.toLowerCase().endsWith(e)):r},tu=([t,e=""])=>{let r=oi([t]);return e?(e=e.toLowerCase(),n=>r(n)&&n.toLowerCase().endsWith(e)):r},ru=([t,e=""])=>{let r=oi([t]);return e?n=>r(n)&&n.endsWith(e):r},nu=([t,e=""])=>{let r=ni([t]);return e?n=>r(n)&&n.endsWith(e):r},ni=([t])=>{let e=t.length;return r=>r.length===e&&!r.startsWith(".")},oi=([t])=>{let e=t.length;return r=>r.length===e&&r!=="."&&r!==".."},si=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",ei={win32:{sep:"\\"},posix:{sep:"/"}},ou=si==="win32"?ei.win32.sep:ei.posix.sep;ne.sep=ou;var Se=Symbol("globstar **");ne.GLOBSTAR=Se;var su="[^/]",iu=su+"*?",au="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",lu="(?:(?!(?:\\/|^)\\.).)*?",cu=(t,e={})=>r=>ne(r,t,e);ne.filter=cu;var ve=(t,e={})=>Object.assign({},t,e),uu=t=>{if(!t||typeof t!="object"||!Object.keys(t).length)return ne;let e=ne;return Object.assign((n,o,s={})=>e(n,o,ve(t,s)),{Minimatch:class extends e.Minimatch{constructor(o,s={}){super(o,ve(t,s))}static defaults(o){return e.defaults(ve(t,o)).Minimatch}},AST:class extends e.AST{constructor(o,s,i={}){super(o,s,ve(t,i))}static fromGlob(o,s={}){return e.AST.fromGlob(o,ve(t,s))}},unescape:(n,o={})=>e.unescape(n,ve(t,o)),escape:(n,o={})=>e.escape(n,ve(t,o)),filter:(n,o={})=>e.filter(n,ve(t,o)),defaults:n=>e.defaults(ve(t,n)),makeRe:(n,o={})=>e.makeRe(n,ve(t,o)),braceExpand:(n,o={})=>e.braceExpand(n,ve(t,o)),match:(n,o,s={})=>e.match(n,o,ve(t,s)),sep:e.sep,GLOBSTAR:Se})};ne.defaults=uu;var ii=(t,e={})=>(Lt(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:(0,ri.default)(t));ne.braceExpand=ii;var xn=(t,e={})=>new gt(t,e).makeRe();ne.makeRe=xn;var du=(t,e,r={})=>{let n=new gt(e,r);return t=t.filter(o=>n.match(o)),n.options.nonull&&!t.length&&t.push(e),t};ne.match=du;var ti=/[?*]|[+@!]\(.*?\)|\[|\]/,hu=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),gt=class{constructor(e,r={}){U(this,"options");U(this,"set");U(this,"pattern");U(this,"windowsPathsNoEscape");U(this,"nonegate");U(this,"negate");U(this,"comment");U(this,"empty");U(this,"preserveMultipleSlashes");U(this,"partial");U(this,"globSet");U(this,"globParts");U(this,"nocase");U(this,"isWindows");U(this,"platform");U(this,"windowsNoMagicRoot");U(this,"regexp");Lt(e),r=r||{},this.options=r,this.pattern=e,this.platform=r.platform||si,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!r.windowsPathsNoEscape||r.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!r.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!r.nonegate,this.comment=!1,this.empty=!1,this.partial=!!r.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=r.windowsNoMagicRoot!==void 0?r.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let e of this.set)for(let r of e)if(typeof r!="string")return!0;return!1}debug(...e){}make(){let e=this.pattern,r=this.options;if(!r.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],r.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);let n=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(n),this.debug(this.pattern,this.globParts);let o=this.globParts.map((s,i,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){let a=s[0]===""&&s[1]===""&&(s[2]==="?"||!ti.test(s[2]))&&!ti.test(s[3]),u=/^[a-z]:/i.test(s[0]);if(a)return[...s.slice(0,4),...s.slice(4).map(c=>this.parse(c))];if(u)return[s[0],...s.slice(1).map(c=>this.parse(c))]}return s.map(a=>this.parse(a))});if(this.debug(this.pattern,o),this.set=o.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){let i=this.set[s];i[0]===""&&i[1]===""&&this.globParts[s][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let n=0;n<e.length;n++)for(let o=0;o<e[n].length;o++)e[n][o]==="**"&&(e[n][o]="*");let{optimizationLevel:r=1}=this.options;return r>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):r>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(r=>{let n=-1;for(;(n=r.indexOf("**",n+1))!==-1;){let o=n;for(;r[o+1]==="**";)o++;o!==n&&r.splice(n,o-n)}return r})}levelOneOptimize(e){return e.map(r=>(r=r.reduce((n,o)=>{let s=n[n.length-1];return o==="**"&&s==="**"?n:o===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(n.pop(),n):(n.push(o),n)},[]),r.length===0?[""]:r))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let r=!1;do{if(r=!1,!this.preserveMultipleSlashes){for(let o=1;o<e.length-1;o++){let s=e[o];o===1&&s===""&&e[0]===""||(s==="."||s==="")&&(r=!0,e.splice(o,1),o--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(r=!0,e.pop())}let n=0;for(;(n=e.indexOf("..",n+1))!==-1;){let o=e[n-1];o&&o!=="."&&o!==".."&&o!=="**"&&(r=!0,e.splice(n-1,2),n-=2)}}while(r);return e.length===0?[""]:e}firstPhasePreProcess(e){let r=!1;do{r=!1;for(let n of e){let o=-1;for(;(o=n.indexOf("**",o+1))!==-1;){let i=o;for(;n[i+1]==="**";)i++;i>o&&n.splice(o+1,i-o);let l=n[o+1],a=n[o+2],u=n[o+3];if(l!==".."||!a||a==="."||a===".."||!u||u==="."||u==="..")continue;r=!0,n.splice(o,1);let c=n.slice(0);c[o]="**",e.push(c),o--}if(!this.preserveMultipleSlashes){for(let i=1;i<n.length-1;i++){let l=n[i];i===1&&l===""&&n[0]===""||(l==="."||l==="")&&(r=!0,n.splice(i,1),i--)}n[0]==="."&&n.length===2&&(n[1]==="."||n[1]==="")&&(r=!0,n.pop())}let s=0;for(;(s=n.indexOf("..",s+1))!==-1;){let i=n[s-1];if(i&&i!=="."&&i!==".."&&i!=="**"){r=!0;let a=s===1&&n[s+1]==="**"?["."]:[];n.splice(s-1,2,...a),n.length===0&&n.push(""),s-=2}}}}while(r);return e}secondPhasePreProcess(e){for(let r=0;r<e.length-1;r++)for(let n=r+1;n<e.length;n++){let o=this.partsMatch(e[r],e[n],!this.preserveMultipleSlashes);o&&(e[r]=o,e[n]=[])}return e.filter(r=>r.length)}partsMatch(e,r,n=!1){let o=0,s=0,i=[],l="";for(;o<e.length&&s<r.length;)if(e[o]===r[s])i.push(l==="b"?r[s]:e[o]),o++,s++;else if(n&&e[o]==="**"&&r[s]===e[o+1])i.push(e[o]),o++;else if(n&&r[s]==="**"&&e[o]===r[s+1])i.push(r[s]),s++;else if(e[o]==="*"&&r[s]&&(this.options.dot||!r[s].startsWith("."))&&r[s]!=="**"){if(l==="b")return!1;l="a",i.push(e[o]),o++,s++}else if(r[s]==="*"&&e[o]&&(this.options.dot||!e[o].startsWith("."))&&e[o]!=="**"){if(l==="a")return!1;l="b",i.push(r[s]),o++,s++}else return!1;return e.length===r.length&&i}parseNegate(){if(this.nonegate)return;let e=this.pattern,r=!1,n=0;for(let o=0;o<e.length&&e.charAt(o)==="!";o++)r=!r,n++;n&&(this.pattern=e.slice(n)),this.negate=r}matchOne(e,r,n=!1){let o=this.options;if(this.isWindows){let d=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),y=!d&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),g=typeof r[0]=="string"&&/^[a-z]:$/i.test(r[0]),S=!g&&r[0]===""&&r[1]===""&&r[2]==="?"&&typeof r[3]=="string"&&/^[a-z]:$/i.test(r[3]),v=y?3:d?0:void 0,A=S?3:g?0:void 0;if(typeof v=="number"&&typeof A=="number"){let[I,b]=[e[v],r[A]];I.toLowerCase()===b.toLowerCase()&&(r[A]=I,A>v?r=r.slice(A):v>A&&(e=e.slice(v)))}}let{optimizationLevel:s=1}=this.options;s>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:r}),this.debug("matchOne",e.length,r.length);for(var i=0,l=0,a=e.length,u=r.length;i<a&&l<u;i++,l++){this.debug("matchOne loop");var c=r[l],h=e[i];if(this.debug(r,c,h),c===!1)return!1;if(c===Se){this.debug("GLOBSTAR",[r,c,h]);var f=i,p=l+1;if(p===u){for(this.debug("** at the end");i<a;i++)if(e[i]==="."||e[i]===".."||!o.dot&&e[i].charAt(0)===".")return!1;return!0}for(;f<a;){var m=e[f];if(this.debug(`
globstar while`,e,f,r,p,m),this.matchOne(e.slice(f),r.slice(p),n))return this.debug("globstar found match!",f,a,m),!0;if(m==="."||m===".."||!o.dot&&m.charAt(0)==="."){this.debug("dot detected!",e,f,r,p);break}this.debug("globstar swallow a segment, and continue"),f++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,f,r,p),f===a))}let d;if(typeof c=="string"?(d=h===c,this.debug("string match",c,h,d)):(d=c.test(h),this.debug("pattern match",c,h,d)),!d)return!1}if(i===a&&l===u)return!0;if(i===a)return n;if(l===u)return i===a-1&&e[i]==="";throw new Error("wtf?")}braceExpand(){return ii(this.pattern,this.options)}parse(e){Lt(e);let r=this.options;if(e==="**")return Se;if(e==="")return"";let n,o=null;(n=e.match(Kc))?o=r.dot?Jc:Xc:(n=e.match(zc))?o=(r.nocase?r.dot?jc:Gc:r.dot?Hc:Bc)(n[1]):(n=e.match(Qc))?o=(r.nocase?r.dot?tu:eu:r.dot?ru:nu)(n):(n=e.match(Vc))?o=r.dot?qc:$c:(n=e.match(Yc))&&(o=Zc);let s=mt.fromGlob(e,this.options).toMMPattern();return o&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:o}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let r=this.options,n=r.noglobstar?iu:r.dot?au:lu,o=new Set(r.nocase?["i"]:[]),s=e.map(a=>{let u=a.map(c=>{if(c instanceof RegExp)for(let h of c.flags.split(""))o.add(h);return typeof c=="string"?hu(c):c===Se?Se:c._src});return u.forEach((c,h)=>{let f=u[h+1],p=u[h-1];c!==Se||p===Se||(p===void 0?f!==void 0&&f!==Se?u[h+1]="(?:\\/|"+n+"\\/)?"+f:u[h]=n:f===void 0?u[h-1]=p+"(?:\\/|"+n+")?":f!==Se&&(u[h-1]=p+"(?:\\/|\\/"+n+"\\/)"+f,u[h+1]=Se))}),u.filter(c=>c!==Se).join("/")}).join("|"),[i,l]=e.length>1?["(?:",")"]:["",""];s="^"+i+s+l+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...o].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,r=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&r)return!0;let n=this.options;this.isWindows&&(e=e.split("\\").join("/"));let o=this.slashSplit(e);this.debug(this.pattern,"split",o);let s=this.set;this.debug(this.pattern,"set",s);let i=o[o.length-1];if(!i)for(let l=o.length-2;!i&&l>=0;l--)i=o[l];for(let l=0;l<s.length;l++){let a=s[l],u=o;if(n.matchBase&&a.length===1&&(u=[i]),this.matchOne(u,a,r))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return ne.defaults(e).Minimatch}};ne.AST=mt;ne.Minimatch=gt;ne.escape=kn;ne.unescape=je;function Ut(t){throw new Error(`This code path should be unreachable: ${t}`)}function fu(t){throw new Error(`This code path should be unreachable: ${t}`)}function pu(t){return t.endsWith("$")&&(t=t.substring(0,t.length-1)),(t.endsWith("+?")||t.endsWith("*?"))&&(t=t.substring(0,t.length-1)),t}function yt(t,e){let r=e.replace||e.path;switch(e.type){case"regexp":{let n=(e.path.startsWith("^")?"":"^")+e.path+(!e.path.endsWith("$")&&!e.partial?"$":""),o=new RegExp(n);return o.test(t)?e.partial?t.replace(o,r):r:void 0}case"wildcard":case void 0:if(e.partial){let n=xn(e.path,{partial:e.partial,dot:!0});if(!n)throw new Error("unable to make regexp");let o=new RegExp(pu(n.source));return o.test(t)?t.replace(o,r):void 0}return ne(t,e.path,{dot:!0})?r:void 0;default:fu(e.type)}}function Mn(t){try{return new URL(t),!0}catch{return!1}}function mu(t){return(t.startsWith("http://")||t.startsWith("https://"))&&(t=t.replace(/^https?:\/\//,"")),t.endsWith("/")&&(t=t.substring(0,t.length-1)),t=t.replace(/:\d+$/,""),t}function Cr(t,e){if(!e||e==="")return!1;if(e==="*")return!0;let r=mu(e);return t===r}function ai(t,e){if(yt(t,e)!==void 0)return e.action!=="block"}function On(t,e){let r=t.pathname,n=t.hostname,o=e.rules.filter(i=>Cr(n,i.domain));if(o.length>0){let i=o.find(l=>l.path==="**");if(!i)return e.defaultAction==="allow";for(let l of o){if(l.path==="**")continue;let a=ai(r,l);if(a!==void 0)return a}return i.action==="allow"}let s=e.rules.filter(i=>!i.domain);for(let i of s){let l=ai(r,i);if(l!==void 0)return l}return e.defaultAction==="allow"}function li(t,e,r){let n=yt(e,r);if(n!==void 0&&r.action==="replace"){let o=new URL(t.toString());return o.pathname=n,o}}function Nn(t,e){let{pathname:r,hostname:n}=t,o=e.rules.filter(i=>Cr(n,i.domain));if(o.length>0)for(let i of o){if(i.path==="**")continue;let l=li(t,r,i);if(l)return l}let s=e.rules.filter(i=>!i.domain);for(let i of s){let l=li(t,r,i);if(l)return l}return t}function be(t,e){if(!Mn(t))return{accepted:!1};let r=new URL(t);return On(r,e)?{accepted:!0,url:Nn(r,e)}:{accepted:!1}}function Ft(t,e,r){let n=be(t,r);if(!n.accepted||!n.url)return t;let{url:o}=n,s=gu(o.pathname,e.rules||[]),i=[];for(let l of o.searchParams.keys()){let a=yu(l,s?.rules||[]);switch(a){case"accept":break;case"delete":i.push(l);break;case"anonymize":o.searchParams.set(l,"*");break;default:Ut(a)}}for(let l of i)o.searchParams.delete(l);if(o.pathname.includes("%3F")){let l=o.pathname.split("/");l[l.length-1]=l[l.length-1].split("%3F")[0],o.pathname=l.join("/")}return o.hash.includes("=")&&(o.hash=""),o.toString()}function gu(t,e){for(let r of e)if(yt(t,{path:r.path}))return r}function yu(t,e){for(let r of e)if(ne(t,r.param))return r.anonymizeValue?"anonymize":"accept";return"delete"}function vu(t){typeof requestIdleCallback<"u"?requestIdleCallback(t):setTimeout(t,0)}var _n=class{constructor(e,r,n){this.org=e;this.recorder=r;this.events=[];this._estimatedByteSize=0;this._pendingEvents=[];this._sizeUpdateScheduled=!1;this.events=n,this._estimatedByteSize+=this.calculateEventsSize(n)}get estimatedByteSize(){return this._estimatedByteSize}calculateEventsSize(e){try{let r=JSON.stringify(e,this.getCircularReplacer());return Su(r)}catch(r){return E(`Error calculating event size: ${r}. Falling back to approximation.`),500}}getCircularReplacer(){let e=new WeakSet;return(r,n)=>{if(typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}}clearEvents(){this.events=[],this._estimatedByteSize=0,this._pendingEvents=[],this._sizeUpdateScheduled=!1}pushEvent({eventHref:e,event:r}){if(!be(e,this.org.pathConfig).accepted){E(`URL not accepted: ${e}`);return}if(!this.recorder.isRecording){E("Dropping event - recorder is not recording");return}this.events.push(r),this._pendingEvents.push(r),this._sizeUpdateScheduled||(this._sizeUpdateScheduled=!0,vu(()=>{this._estimatedByteSize+=this.calculateEventsSize(this._pendingEvents),this._pendingEvents=[],this._sizeUpdateScheduled=!1}))}getEvents(){return this.events}},wr=class{constructor(e,r,n,o,s){this.org=e;this.eventStorage=r;this.getHref=n;this.eventStore=new _n(e,o,s)}get estimatedSerializedByteSize(){return this.eventStore.estimatedByteSize}clear(){this.eventStore.clearEvents(),this.eventStorage.removeEvents()}getEvents(){return this.eventStore.getEvents()}onVisibilityChange(e){e||this.eventStorage.setEvents(this.getEvents())}append(e){let r=this.getHref();if(e.type===he.Meta)e.data.href=Ft(e.data.href,this.org.allowedQueryParams,this.org.pathConfig),this.lastHref=this.getHref();else if(this.lastHref&&r!==this.lastHref){E(`URL changed from ${this.lastHref} to ${r}, adding artificial meta event for ${this.getHref()}`),this.eventStore.pushEvent({eventHref:r,event:_s({href:Ft(r,this.org.allowedQueryParams,this.org.pathConfig),delay:e.delay,timestamp:e.timestamp})});let n=vr(r,this.org.customQueryParamsCohorts);n&&this.eventStore.pushEvent({eventHref:r,event:Nt({payload:{userCohorts:n,source:"query_params"},timestamp:e.timestamp,delay:e.delay})}),this.lastHref=this.getHref()}if(e.type===he.IncrementalSnapshot&&e.data.source===Xe.MouseInteraction&&e.data.type===wn.Click){let n=Ae.mirror.getNode(e.data.id);if(n){let o=Ln(n),s=Ns({dom0EventHandlers:o,delay:e.delay,timestamp:e.timestamp});this.eventStore.pushEvent({eventHref:r,event:s})}}this.eventStore.pushEvent({eventHref:r,event:e})}};function Su(t){return new Blob([t]).size}function Ln(t){let e=[];for(let r=0;r<En.length;r++){let o=En[r];typeof t[o]=="function"&&e.push(o)}return e}var Ce=Uint8Array,pe=Uint16Array,Ht=Uint32Array,zn=new Ce([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Bn=new Ce([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ci=new Ce([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fi=function(t,e){for(var r=new pe(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var o=new Ht(r[30]),n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)o[s]=s-r[n]<<5|n;return[r,o]},pi=fi(zn,2),bu=pi[0],Pn=pi[1];bu[28]=258,Pn[258]=28;var mi=fi(Bn,0),kh=mi[0],ui=mi[1],Un=new pe(32768);for(B=0;B<32768;++B)Le=(B&43690)>>>1|(B&21845)<<1,Le=(Le&52428)>>>2|(Le&13107)<<2,Le=(Le&61680)>>>4|(Le&3855)<<4,Un[B]=((Le&65280)>>>8|(Le&255)<<8)>>>1;var Le,B,Bt=function(t,e,r){for(var n=t.length,o=0,s=new pe(e);o<n;++o)++s[t[o]-1];var i=new pe(e);for(o=0;o<e;++o)i[o]=i[o-1]+s[o-1]<<1;var l;if(r){l=new pe(1<<e);var a=15-e;for(o=0;o<n;++o)if(t[o])for(var u=o<<4|t[o],c=e-t[o],h=i[t[o]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)l[Un[h]>>>a]=u}else for(l=new pe(n),o=0;o<n;++o)l[o]=Un[i[t[o]-1]++]>>>15-t[o];return l},tt=new Ce(288);for(B=0;B<144;++B)tt[B]=8;var B;for(B=144;B<256;++B)tt[B]=9;var B;for(B=256;B<280;++B)tt[B]=7;var B;for(B=280;B<288;++B)tt[B]=8;var B,Er=new Ce(32);for(B=0;B<32;++B)Er[B]=5;var B,Cu=Bt(tt,9,0);var wu=Bt(Er,5,0);var gi=function(t){return(t/8>>0)+(t&7&&1)},yi=function(t,e,r){(r==null||r>t.length)&&(r=t.length);var n=new(t instanceof pe?pe:t instanceof Ht?Ht:Ce)(r-e);return n.set(t.subarray(e,r)),n};var De=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8},Wt=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},Dn=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var o=r.length,s=r.slice();if(!o)return[new Ce(0),0];if(o==1){var i=new Ce(r[0].s+1);return i[r[0].s]=1,[i,1]}r.sort(function(I,b){return I.f-b.f}),r.push({s:-1,f:25001});var l=r[0],a=r[1],u=0,c=1,h=2;for(r[0]={s:-1,f:l.f+a.f,l,r:a};c!=o-1;)l=r[r[u].f<r[h].f?u++:h++],a=r[u!=c&&r[u].f<r[h].f?u++:h++],r[c++]={s:-1,f:l.f+a.f,l,r:a};for(var f=s[0].s,n=1;n<o;++n)s[n].s>f&&(f=s[n].s);var p=new pe(f+1),m=Fn(r[c-1],p,0);if(m>e){var n=0,d=0,y=m-e,g=1<<y;for(s.sort(function(b,T){return p[T.s]-p[b.s]||b.f-T.f});n<o;++n){var S=s[n].s;if(p[S]>e)d+=g-(1<<m-p[S]),p[S]=e;else break}for(d>>>=y;d>0;){var v=s[n].s;p[v]<e?d-=1<<e-p[v]++-1:++n}for(;n>=0&&d;--n){var A=s[n].s;p[A]==e&&(--p[A],++d)}m=e}return[new Ce(p),m]},Fn=function(t,e,r){return t.s==-1?Math.max(Fn(t.l,e,r+1),Fn(t.r,e,r+1)):e[t.s]=r},di=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new pe(++e),n=0,o=t[0],s=1,i=function(a){r[n++]=a},l=1;l<=e;++l)if(t[l]==o&&l!=e)++s;else{if(!o&&s>2){for(;s>138;s-=138)i(32754);s>2&&(i(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(i(o),--s;s>6;s-=6)i(8304);s>2&&(i(s-3<<5|8208),s=0)}for(;s--;)i(o);s=1,o=t[l]}return[r.subarray(0,n),e]},zt=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},Wn=function(t,e,r){var n=r.length,o=gi(e+2);t[o]=n&255,t[o+1]=n>>>8,t[o+2]=t[o]^255,t[o+3]=t[o+1]^255;for(var s=0;s<n;++s)t[o+s+4]=r[s];return(o+4+n)*8},hi=function(t,e,r,n,o,s,i,l,a,u,c){De(e,c++,r),++o[256];for(var h=Dn(o,15),f=h[0],p=h[1],m=Dn(s,15),d=m[0],y=m[1],g=di(f),S=g[0],v=g[1],A=di(d),I=A[0],b=A[1],T=new pe(19),R=0;R<S.length;++R)T[S[R]&31]++;for(var R=0;R<I.length;++R)T[I[R]&31]++;for(var O=Dn(T,7),W=O[0],se=O[1],z=19;z>4&&!W[ci[z-1]];--z);var ie=u+5<<3,j=zt(o,tt)+zt(s,Er)+i,H=zt(o,f)+zt(s,d)+i+14+3*z+zt(T,W)+(2*T[16]+3*T[17]+7*T[18]);if(ie<=j&&ie<=H)return Wn(e,c,t.subarray(a,a+u));var k,M,X,x;if(De(e,c,1+(H<j)),c+=2,H<j){k=Bt(f,p,0),M=f,X=Bt(d,y,0),x=d;var P=Bt(W,se,0);De(e,c,v-257),De(e,c+5,b-1),De(e,c+10,z-4),c+=14;for(var R=0;R<z;++R)De(e,c+3*R,W[ci[R]]);c+=3*z;for(var V=[S,I],J=0;J<2;++J)for(var ce=V[J],R=0;R<ce.length;++R){var me=ce[R]&31;De(e,c,P[me]),c+=W[me],me>15&&(De(e,c,ce[R]>>>5&127),c+=ce[R]>>>12)}}else k=Cu,M=tt,X=wu,x=Er;for(var R=0;R<l;++R)if(n[R]>255){var me=n[R]>>>18&31;Wt(e,c,k[me+257]),c+=M[me+257],me>7&&(De(e,c,n[R]>>>23&31),c+=zn[me]);var ae=n[R]&31;Wt(e,c,X[ae]),c+=x[ae],ae>3&&(Wt(e,c,n[R]>>>5&8191),c+=Bn[ae])}else Wt(e,c,k[n[R]]),c+=M[n[R]];return Wt(e,c,k[256]),c+M[256]},Eu=new Ht([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ru=function(t,e,r,n,o,s){var i=t.length,l=new Ce(n+i+5*(1+Math.floor(i/7e3))+o),a=l.subarray(n,l.length-o),u=0;if(!e||i<8)for(var c=0;c<=i;c+=65535){var h=c+65535;h<i?u=Wn(a,u,t.subarray(c,h)):(a[c]=s,u=Wn(a,u,t.subarray(c,i)))}else{for(var f=Eu[e-1],p=f>>>13,m=f&8191,d=(1<<r)-1,y=new pe(32768),g=new pe(d+1),S=Math.ceil(r/3),v=2*S,A=function(L){return(t[L]^t[L+1]<<S^t[L+2]<<v)&d},I=new Ht(25e3),b=new pe(288),T=new pe(32),R=0,O=0,c=0,W=0,se=0,z=0;c<i;++c){var ie=A(c),j=c&32767,H=g[ie];if(y[j]=H,g[ie]=j,se<=c){var k=i-c;if((R>7e3||W>24576)&&k>423){u=hi(t,a,0,I,b,T,O,W,z,c-z,u),W=R=O=0,z=c;for(var M=0;M<286;++M)b[M]=0;for(var M=0;M<30;++M)T[M]=0}var X=2,x=0,P=m,V=j-H&32767;if(k>2&&ie==A(c-V))for(var J=Math.min(p,k)-1,ce=Math.min(32767,c),me=Math.min(258,k);V<=ce&&--P&&j!=H;){if(t[c+X]==t[c+X-V]){for(var ae=0;ae<me&&t[c+ae]==t[c+ae-V];++ae);if(ae>X){if(X=ae,x=V,ae>J)break;for(var nt=Math.min(V,ae-2),St=0,M=0;M<nt;++M){var ot=c-V+M+32768&32767,Mr=y[ot],Re=ot-Mr+32768&32767;Re>St&&(St=Re,H=ot)}}}j=H,H=y[j],V+=j-H+32768&32767}if(x){I[W++]=268435456|Pn[X]<<18|ui[x];var Ie=Pn[X]&31,st=ui[x]&31;O+=zn[Ie]+Bn[st],++b[257+Ie],++T[st],se=c+X,++R}else I[W++]=t[c],++b[t[c]]}}u=hi(t,a,s,I,b,T,O,W,z,c-z,u)}return yi(l,0,n+gi(u)+o)},Iu=function(){var t=1,e=0;return{p:function(r){for(var n=t,o=e,s=r.length,i=0;i!=s;){for(var l=Math.min(i+5552,s);i<l;++i)n+=r[i],o+=n;n%=65521,o%=65521}t=n,e=o},d:function(){return(t>>>8<<16|(e&255)<<8|e>>>8)+((t&255)<<23)*2}}},Tu=function(t,e,r,n,o){return Ru(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,!o)},Au=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8},ku=function(t,e){var r=e.level,n=r==0?0:r<6?1:r==9?3:2;t[0]=120,t[1]=n<<6|(n?32-2*n:1)};function vi(t,e){e===void 0&&(e={});var r=Iu();r.p(t);var n=Tu(t,e,2,4);return ku(n,e),Au(n,n.length-4,r.d()),n}function Hn(t,e){var r=t.length;if(!e&&typeof TextEncoder<"u")return new TextEncoder().encode(t);for(var n=new Ce(t.length+(t.length>>>1)),o=0,s=function(u){n[o++]=u},i=0;i<r;++i){if(o+5>n.length){var l=new Ce(o+8+(r-i<<1));l.set(n),n=l}var a=t.charCodeAt(i);a<128||e?s(a):a<2048?(s(192|a>>>6),s(128|a&63)):a>55295&&a<57344?(a=65536+(a&1047552)|t.charCodeAt(++i)&1023,s(240|a>>>18),s(128|a>>>12&63),s(128|a>>>6&63),s(128|a&63)):(s(224|a>>>12),s(128|a>>>6&63),s(128|a&63))}return yi(n,0,o)}function Gn(t,e){var r="";if(!e&&typeof TextDecoder<"u")return new TextDecoder().decode(t);for(var n=0;n<t.length;){var o=t[n++];o<128||e?r+=String.fromCharCode(o):o<224?r+=String.fromCharCode((o&31)<<6|t[n++]&63):o<240?r+=String.fromCharCode((o&15)<<12|(t[n++]&63)<<6|t[n++]&63):(o=((o&15)<<18|(t[n++]&63)<<12|(t[n++]&63)<<6|t[n++]&63)-65536,r+=String.fromCharCode(55296|o>>10,56320|o&1023))}return r}var jn="v1";var Vn=t=>{let e={...t,v:jn};return Gn(vi(Hn(JSON.stringify(e))),!0)};function Si(t){let e=new URL(t),r={};for(let[n,o]of e.searchParams)switch(n){case"utm_source":case"utm_medium":case"utm_campaign":case"utm_term":case"utm_content":r[`UTM@@${n}`]=o;break}return Object.keys(r).length>0?r:void 0}var bi=3*1024*1024,Ci=5e3,Rr=class{constructor(e,r,n,o,s,i,l){this.window=e;this.storage=r;this.eventHolder=n;this.recorder=o;this.api=s;this.organization=i;this.windowGetters=l;this.lastSendTime=-1;this.lastAutoCohorts=void 0;this.fastpathToken=void 0;o.setOnEvent(a=>this.onEvent(a))}onEvent(e){if(e.type===he.FullSnapshot){let s,i=rr(this.window,this.organization.cohortsBootstrapConfig),l=Si(this.windowGetters.getHref()),a=vr(this.windowGetters.getHref(),this.organization.customQueryParamsCohorts),u=Kr(this.window);this.lastAutoCohorts=u,(l||i||u||a)&&(s=Nt({payload:{userCohorts:{...i||{},...u||{},...l||{},...a||{}},source:"window_getters"},delay:e.delay,timestamp:e.timestamp}));let c=s?[...this.eventHolder.getEvents(),s,e]:[...this.eventHolder.getEvents(),e];this.clearAndSaveEvents(c);return}else if(e.type===he.IncrementalSnapshot&&e.data.source===Xe.Mutation){let s=Kr(this.window);s&&(!this.lastAutoCohorts||Object.keys(s).length!==Object.keys(this.lastAutoCohorts).length)&&(E("auto cohorts different, appending new event",s),this.eventHolder.append(Nt({payload:{userCohorts:s,source:"window_getters"},delay:e.delay,timestamp:e.timestamp}))),this.lastAutoCohorts=s}this.eventHolder.append(e);let r=this.eventHolder.estimatedSerializedByteSize,o=Date.now()-this.lastSendTime;r>bi&&o>=Ci&&(E(`MAX_EVENT_BYTE_SIZE and timeSinceLastSend exceeded: ${r} > ${bi} and ${o} >= ${Ci}`),this.clearAndSaveEvents())}async clearAndSaveEvents(e){let r=this.windowGetters.getHref();if(!be(r,this.organization.pathConfig).accepted)return;let o=e||this.eventHolder.getEvents();if(o.length!==0){this.eventHolder.clear();try{E("saving events...");let s=await this.prepareAndSendEvents(o);switch(E("save events result",s.type),s.type){case"success":break;case"recreate-session":await this.recreateSession(s.session);break;case"no-session":case"unknown-failure":case"rate-limit-exceeded":this.storage.removeSession(),this.eventHolder.clear();break;default:Ut(s)}}catch(s){throw E("error saving events",s),this.storage.removeSession(),s}}}async prepareAndSendEvents(e){this.lastSendTime=Date.now();let r=this.storage.getSession();if(!r)return{type:"no-session"};if(r.eventPostUrl&&r.eventPostToken){let s=JSON.parse(atob(r.eventPostToken.split(".")[1]));if(s&&Date.now()>s.lastEventAt-10*1e3){E("refreshing token as it is about to expire");let i=await this.refreshToken(r);if(i.type!=="success")return i;if(r=this.storage.getSession(),!r)return{type:"no-session"}}}let n=r.compressionType==="RRWEB_PACK"?e.map(s=>Vn(s)):e,o=await this.api.saveSessionEvents({sessionId:r.id,events:n,metadata:{url:Ft(this.windowGetters.getHref(),this.organization.allowedQueryParams,this.organization.pathConfig)},eventPostUrl:r.eventPostUrl,eventPostToken:r.eventPostToken,fastpathToken:this.fastpathToken});if(!o)return{type:"unknown-failure"};if(o.error)switch(o.error.code){case"SessionNotFound":case"SessionAlreadySynced":return{type:"recreate-session",session:r};case"RateLimitExceeded":return{type:"rate-limit-exceeded"}}if(!o.data)return{type:"unknown-failure"};if(o.data&&"code"in o.data)switch(o.data.code){case"TOKEN_REFRESH":{E("refreshing token as it expired on the worker");let s=await this.refreshToken(r);return s.type!=="success"?s:this.prepareAndSendEvents(e)}default:Ut(o.data.code)}if(this.fastpathToken=o.data.fastpathToken,o.response.status<200||o.response.status>201)throw new Error(`got status ${o.response.status}`);return{type:"success"}}async refreshToken(e){let r=await this.api.refreshEventToken({sessionId:e.id});if(!r)return{type:"unknown-failure"};if(r.error)switch(r.error.code){case"SessionNotFound":case"SessionAlreadySynced":return{type:"recreate-session",session:e};case"RateLimitExceeded":return{type:"rate-limit-exceeded"}}return r.data?(this.storage.setSession({...e,eventPostToken:r.data.token}),{type:"success"}):{type:"unknown-failure"}}async recreateSession(e){E("recreating sessions");let r=this.recorder.isRecording;this.recorder.setRecording(!1),this.storage.removeSession(),this.fastpathToken=void 0;try{E("recreating session...");let n=await this.api.startSession({orgId:e.settings.orgId,language:e.settings.language||this.windowGetters.getLanguage(),domain:new URL(this.windowGetters.getHref()).hostname,userCohorts:e.settings.userCohorts||{},uid:e.settings.uid,devicePixelRatio:this.windowGetters.getDevicePixelRatio(),adoraUserId:e.adoraUserId,documentReferrer:e.documentReferrer,snippetVersion:Jt});if(!n||n.error)return;if(n.response.status!==201){E("session not created, aborting");return}if(!n.data||!("session"in n.data)){E("malformed session, exiting");return}let o=Xt(n.data),s=So(e,o);this.storage.setSession(s),this.eventHolder.clear(),r&&this.recorder.setRecording(!0)}catch{}}};var Tr=class{constructor(e){this._options=e;this._buckets={};this._refillBuckets=()=>{Object.keys(this._buckets).forEach(e=>{let r=this._getBucket(e)+this._refillRate;r>=this._bucketSize?delete this._buckets[e]:this._setBucket(e,r)})};this._getBucket=e=>this._buckets[String(e)];this._setBucket=(e,r)=>{this._buckets[String(e)]=r};this.consumeRateLimit=e=>{let r=this._getBucket(e)??this._bucketSize;if(r=Math.max(r-1,0),r===0)return!0;this._setBucket(e,r);let n=r===0;return n&&this._onBucketRateLimited?.(e),n};this._onBucketRateLimited=this._options._onBucketRateLimited,this._bucketSize=Ir(this._options.bucketSize,0,100),this._refillRate=Ir(this._options.refillRate,0,this._bucketSize),this._refillInterval=Ir(this._options.refillInterval,0,864e5),this._removeInterval=setInterval(()=>{this._refillBuckets()},this._refillInterval)}stop(){this._removeInterval&&(clearInterval(this._removeInterval),this._removeInterval=void 0)}};function Ir(t,e,r,n){return e>r&&(e=r),xu(t)?t>r?r:t<e?e:t:Ir(n||r,e,r)}var xu=t=>toString.call(t)==="[object Number]";var Ar=class{constructor(e,r={}){this._rrweb=e;this._options=r;this._loggedTracker={};this._onNodeRateLimited=e=>{if(!this._loggedTracker[e]){this._loggedTracker[e]=!0;let r=this._getNode(e);this._options.onBlockedNode?.(e,r)}};this._getNodeOrRelevantParent=e=>{let r=this._getNode(e);if(r?.nodeName!=="svg"&&r instanceof Element){let n=r.closest("svg");if(n)return[this._rrweb.mirror.getId(n),n]}return[e,r]};this._getNode=e=>this._rrweb.mirror.getNode(e);this._numberOfChanges=e=>(e.removes?.length??0)+(e.attributes?.length??0)+(e.texts?.length??0)+(e.adds?.length??0);this.throttleMutations=e=>{if(e.type!==he.IncrementalSnapshot||e.data.source!==Xe.Mutation)return e;let r=e.data,n=this._numberOfChanges(r);r.attributes&&(r.attributes=r.attributes.filter(s=>{let[i]=this._getNodeOrRelevantParent(s.id);return this._rateLimiter.consumeRateLimit(i)?!1:s}));let o=this._numberOfChanges(r);if(!(o===0&&n!==o))return e};this._rateLimiter=new Tr({bucketSize:this._options.bucketSize??100,refillRate:this._options.refillRate??10,refillInterval:1e3,_onBucketRateLimited:this._onNodeRateLimited})}reset(){this._loggedTracker={}}stop(){this._rateLimiter.stop(),this.reset()}};var vt,wi=()=>{if(vt!==void 0)return vt;try{return vt=document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")===0,E("adora script - isWebpSupported? - ",vt),vt}catch{return vt=!1,!1}};var kr=class{constructor(e,r,n,o){this.limitedCanvasRecording=e;this.canvasRecordingEnabled=r;this.org=n;this.rrwebRecorder=o;this.startable=!0;E("new recorder")}setOnEvent(e){this.onEvent=e}get args(){let e=this.org.blockedCSSClasses.length>0?`|(${this.org.blockedCSSClasses.join(")|(")})`:"",r=this.org.maskedCSSClasses&&this.org.maskedCSSClasses?.length>0?`|(${this.org.maskedCSSClasses?.join(")|(")})`:"",n=wi()?"image/webp":this.limitedCanvasRecording?"image/jpeg":"image/png";return{emit:o=>{if(!this.onEvent)throw new Error("onEvent must be assigned before starting recording");o.type===he.FullSnapshot&&this.mutationThrottler?.reset();let s=this.mutationThrottler?this.mutationThrottler.throttleMutations(o):o;s&&this.onEvent(s)},userTriggeredOnInput:!0,blockClass:new RegExp(`(adora-block)|(rr-block|fs-exclude|ph-no-capture)${e}`),blockSelector:"[data-adora-block]",maskTextClass:new RegExp(`(adora-mask)|(rr-mask|fs-mask)${r}`),maskAllInputs:!0,maskInputFn:(o,s)=>Ei(this.org,s)?o:"*".repeat(o.length),maskTextFn:(o,s)=>s&&this.org.maskByDefault&&s.closest('button,a,div[role="button"],div[role*="menuitem"],input[type="button"],input[type="submit"],input[type="reset"]')||s&&Ei(this.org,s)?o:o.replace(/[\S]/g,"*"),maskTextSelector:this.org?.maskByDefault?"*":'[data-adora-mask="true"]',recordCanvas:this.canvasRecordingEnabled,sampling:this.canvasRecordingEnabled?{canvas:this.limitedCanvasRecording?1:2}:void 0,dataURLOptions:this.canvasRecordingEnabled?{type:n,quality:.6}:{}}}recordChangeCustomCohort(e){E("sending custom cohort change",e),this.rrwebRecorder.addCustomEvent(Os,e)}recordCLS(e){this.rrwebRecorder.addCustomEvent("CLS",e)}recordINP(e){this.rrwebRecorder.addCustomEvent("INP",e)}recordLCP(e){this.rrwebRecorder.addCustomEvent("LCP",e)}recordVisibilityChange(e){this.rrwebRecorder.addCustomEvent("Adora.VisibilityChange",{visibilityState:e})}recordFocusChange(e){this.rrwebRecorder.addCustomEvent("Adora.FocusChange",{focusState:e})}get isRecording(){return this.rrwebRecorder.isRecording}setRecording(e){if(E("setRecording",`requested status: ${e}`,`current status ${this.rrwebRecorder.isRecording}`),this.rrwebRecorder.isRecording!==e){if(e){this.startRecording();return}this.stopRecording()}}startRecording(){if(this.isRecording)throw new Error("recording already in progress!");if(!this.startable){E("recorder is not startable, returning");return}this.mutationThrottler=new Ar(this.rrwebRecorder,{bucketSize:100,refillRate:10,onBlockedNode:(e,r)=>{E("mutation throttler blocked node",{id:e,node:r})}}),this.rrwebRecorder.record(this.args)}stopRecording(){this.mutationThrottler?.stop(),this.mutationThrottler=void 0,this.rrwebRecorder.stop()}stopFutureRecordings(){this.startable=!1}};function Ei(t,e){if(e.classList.contains("adora-unmask"))return!0;for(let r of t.unmaskSelectors)if(Array.from(document.querySelectorAll(r)).find(n=>n===e))return!0;return!1}var xr=class{constructor(){this._isRecording=!1}get isRecording(){return this._isRecording}get mirror(){return Ae.mirror}record(e){if(E("record",{stopFn:typeof this.stopFn,isRecording:this._isRecording}),this.stopFn!==void 0&&this.stop(),this._isRecording=!0,this.stopFn=Ae(e),!this.stopFn)throw new Error("recorder could not successfully start")}stop(){this._isRecording=!1,this.stopFn&&(this.stopFn(),this.stopFn=void 0)}addCustomEvent(e,r){if(!this._isRecording)return E("WARNING! attempting to add custom event with recording off"),!1;try{Ae.addCustomEvent(e,r)}catch(n){return E("trying to record an event even though",n),!1}return!0}};var Ri=5e3;function Ii({sessionType:t}){E("initialize recording");let e=new Fe(t,new Oe),r=e.getSession();if(!r)return;let n=new Me(r.settings.backendUrl),o=new Kt(t,new Oe),s=o.getEvents();o.removeEvents();let i=()=>window.location.href,l=()=>window.navigator.language,a=()=>window.devicePixelRatio,u=new xr,c=new kr(r.limitedCanvasRecording??!1,r.canvasRecordingEnabled??!1,r.organization,u),h=new wr(r.organization,o,i,c,s||[]),f=new Rr(window,e,h,c,n,r.organization,{getHref:i,getLanguage:l,getDevicePixelRatio:a}),p=window.location.href;be(p,r.organization.pathConfig).accepted?(E("starting recording..."),c.setRecording(!0)):E("recording did not start as current URL is blocked");let d=rr(window,r.organization.cohortsBootstrapConfig);c.isRecording&&(c.recordChangeCustomCohort({uid:r.settings.uid,userCohorts:r.settings.userCohorts?{...d,...r.settings.userCohorts}:{}}),e.setSession(r)),Oo(I=>{c.isRecording&&c.recordCLS(I)}),Lo(I=>{c.isRecording&&c.recordINP(I)}),Do(I=>{c.isRecording&&c.recordLCP(I)});let y=()=>{f.clearAndSaveEvents(h.getEvents())},g=window.setInterval(y,Ri);window.addEventListener("blur",()=>{c.recordFocusChange("blur")}),window.addEventListener("focus",()=>{c.recordFocusChange("focus")}),document.addEventListener("visibilitychange",()=>{if(E(`detected a visibility change to ${document.visibilityState}`),c.isRecording&&c.recordVisibilityChange(document.visibilityState),document.visibilityState==="hidden"){g&&(E("clearing the saveInterval"),clearInterval(g),g=void 0),h.onVisibilityChange(!1);return}g||(E("resuming the saveInterval"),g=window.setInterval(y,Ri))});let S=p,v=new MutationObserver(()=>{if(h&&window.location.href!==S){let I=be(window.location.href,r.organization.pathConfig);E(`url changed detected, status: ${I.accepted}`),c.setRecording(I.accepted),S=window.location.href}});return v.observe(document,{subtree:!0,childList:!0}),{recorder:c,eventSync:f,urlChangeObserverDispose:()=>{v.disconnect()}}}var Ti=t=>Ii(t);var rt=!1,Ai="_adora_user_id",ki="_adora_rate_limited",xe,Gt,$n="stopped",xi=()=>{E("startRecording",`adoraIsRunning: ${rt}`),$n==="started"&&(xe=Ti({sessionType:"adoraSessionScript"}))},Mi=1e3*60*30,Mu=async({userCohorts:t,...e})=>{let r=e;if($n="started",E("adora start",{adoraIsRunning:rt,uid:r.uid,userCohorts:t||{}}),typeof window.sessionStorage!="object"){E("SSR detected");return}if(t){r.userCohorts={};for(let[a,u]of Object.entries(t))u!==void 0?(E("setting user cohorts key",{key:a,value:u}),r.userCohorts[a]=u):E("found undefined user cohorts key",{key:a})}let n=new Fe("adoraSessionScript",new Oe),o=n.getSession();if(o){E("session detected; finding if changes should be written");let a=!1;if(r.uid&&o.settings.uid!==r.uid&&(E("detected uid change"),o.settings.uid=r.uid,n.setSession(o),a=!0),r.userCohorts&&Object.keys(r.userCohorts).length>0){E("detected user cohorts");let u=structuredClone(o.settings.userCohorts);fo(u,r.userCohorts)||(E("detected user cohorts have been changed"),o.settings.userCohorts=r.userCohorts,n.setSession(o),a=!0)}a&&xe?.recorder&&xe?.recorder.isRecording&&(E("writing cohort change to recorder"),xe?.recorder.recordChangeCustomCohort({uid:o.settings.uid,userCohorts:o.settings.userCohorts?{...o.settings.userCohorts}:{}}))}if(rt===!0)return;rt=!0;let s=n.lastRateLimitedTimestamp;if(s!==void 0){if(Date.now()-s<Mi){E("exiting as the session has been rate limited recently");return}n.clearLastRateLimitedTimestamp()}if(wt.get(ki)){E("exiting as the domain has been rate limited recently");return}if(o){E("start recording for existing session"),xi();return}let i=!1,l=async(a,u)=>{if(E("start status",{started:i}),i)return;i=!0;let c=await bo("adoraSessionScript",u,r);if(c.type==="error"){c.code==="RateLimitExceeded"&&(E("setting expiration on local storage"),n.setLastRateLimitedTimestamp(Date.now()),a&&(E("setting expiration cookie"),wt.set(ki,a,{expires:new Date(Date.now()+Mi),domain:a})));return}xi()};E("launching session preload");try{let a=await new Me(r.backendUrl).sessionPreload({orgId:r.orgId});E("session preload resolved");let u=window.location.href;if(a){if(a.error){E("error preloading",a.error);return}let c=yo(a.data);if("scheduledDowntime"in c){E("scheduled downtime; exiting");return}let{organization:h}=c;E("session preload success");let f=wt.get(Ai),p;E("existing adora user id cookie:",f);for(let d of h.cookieDomains)(window.location.hostname.toLowerCase()===d||window.location.hostname.toLowerCase().endsWith(`.${d}`))&&(p=d,f||(f=mo(),wt.set(Ai,f,{domain:d,expires:new Date(Date.now()+365*24*60*60*1e3)}),E("setting adoraUserId cookie on domain",f)));E("using adora user id:",f),be(u,h.pathConfig).accepted?(E("at an unblocked URL, starting adora"),await l(p,f)):(E("at an blocked URL, waiting for unblocked URL to start adora"),Gt&&Gt.disconnect(),Gt=new MutationObserver((d,y)=>{if(u!==window.location.href){let g=window.location.href,S=be(g,h.pathConfig);if(E(`url changed detected during blocked state, status: ${S.accepted}`),S.accepted){E("disconnecting observer"),y.disconnect(),E("scheduling adora to start"),l(p,f);return}u=g}}),Gt.observe(document,{subtree:!0,childList:!0}))}}catch(a){E("Error in adoraStart:",a)}},Ou=async()=>{$n="stopped",E("adora stop",{adoraIsRunning:rt}),xe&&(xe.recorder.setRecording(!1),xe.recorder.stopFutureRecordings(),xe.urlChangeObserverDispose(),await xe.eventSync.clearAndSaveEvents()),Gt?.disconnect(),rt=!1,xe=void 0};return Wi(Nu);})();
/*! Bundled license information:

js-cookie/dist/js.cookie.mjs:
  (*! js-cookie v3.0.5 | MIT *)

uuidv7/dist/index.js:
  (**
   * uuidv7: A JavaScript implementation of UUID version 7
   *
   * Copyright 2021-2024 LiosK
   *
   * @license Apache-2.0
   * @packageDocumentation
   *)
*/
// Expose functions directly on window (not under a namespace)
if (typeof window !== 'undefined' && window.__adoraExports__) {
  window.adoraStart = window.__adoraExports__.adoraStart;
  window.adoraStop = window.__adoraExports__.adoraStop;
  // Use getter to create reactive reference to adoraIsRunning
  Object.defineProperty(window, 'adoraIsRunning', {
    get: function() {
      return window.__adoraExports__.adoraIsRunning;
    },
    configurable: true
  });
}
//# sourceMappingURL=adora-start.temp.js.map
